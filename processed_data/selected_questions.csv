,PostId,Title,Body,AnswerCount,AcceptedAnswerId
0,1743526,Differences between Go and Cython,"Today a great friend of mine asked me what are the main differences between the newest Go language and Cython, which is a set of C-extensions for Python. I don't have much knowledge on Python, can anyone tell me why Go is better/worse than Cython?
",6,1749058.0
1,1798455,How does shared memory vs message passing handle large data structures?,"In looking at Go and Erlang's approach to concurrency, I noticed that they both rely on message passing.

This approach obviously alleviates the need for complex locks because there is no shared state.

However, consider the case of many clients wanting parallel read-only access to a single large data structure in memory -- like a suffix array.

My questions:


Will using shared state be faster and use less memory than message passing, as locks will mostly be unnecessary because the data is read-only, and only needs to exist in a single location?
How would this problem be approached in a message passing context? Would there be a single process with access to the data structure and clients would simply need to sequentially request data from it? Or, if possible, would the data be chunked to create several processes that hold chunks?
Given the architecture of modern CPUs & memory, is there much difference between the two solutions -- i.e., can shared memory be read in parallel by multiple cores -- meaning there is no hardware bottleneck that would otherwise make both implementations roughly perform the same?

",10,1798578.0
2,2893772,Import web.go error after using goinstall,"With halfdans advice, I was successfully able to use goinstall github.com/hoisie/web.go without any errors after installing git first. However, now when I try to compile the sample code given, go is not finding the web package. I get the error,

main.go:4: can't find import: web


On this code

package main

import (
    ""web""
)

func hello(val string) string { return ""hello "" + val }

func main() {
    web.Get(""/(.*)"", hello)
    web.Run(""0.0.0.0:9999"")
}


Is there something special I need to do in order for it to recognize the package? I found the package source at $GOROOT/src/pkg/github.com/hoisie/web.go/web. I tried github.com/hoisie/web.go/web as the import and it still did not like that.
",2,2893994.0
3,3125381,"What is a ""value"" array?","In C, the idea of an array is very straightforward—simply a pointer to the first element in a row of elements in memory, which can be accessed via pointer arithmetic/ the standard array[i] syntax.

However, in languages like Google Go, ""arrays are values"", not pointers. What does that mean? How is it implemented?
",3,3125521.0
4,3129324,Unnamed arrays in structs in Go,"So I can have

struct {
    int
    x []int
}


However,

struct {
    int
    []int
}


will result in a syntax error: unexpected [, expecting }. Is there a way of having unnamed arrays in structs in Go? If so, what's the correct syntax?
",2,3129440.0
5,3516357,Are there any go libraries that provide associative array capability?,"I'm looking for a go language capability similar to the ""dictionary"" in python to facilitate the conversion of some python code.

EDIT: Maps worked quite well for this de-dupe application.  I was able to condense 1.3e6 duplicated items down to 2.5e5 unique items using a map with a 16 byte string index in just a few seconds.  The map-related code was simple so I've included it below.  Worth noting that pre-allocation of map with 1.3e6 elements sped it up by only a few percent:

var m = make(map[string]int, 1300000) // map with initial space for 1.3e6 elements

ct, ok := m[ax_hash]
if ok {
    m[ax_hash] = ct + 1
} else {
    m[ax_hash] = 1
}

",3,3516402.0
6,3863972,Is there a Go profiler?,"I played around with Go a bit shortly after it came out. There wasn't a profiler then; is there one now?
",2,3864079.0
7,4278430,Convert string to integer type in Go?,"I'm trying to convert a string returned from flag.Arg(n) to an int. What is the idiomatic way to do this in Go?
",2,4279644.0
8,5367961,Casting from one pointer to pointer type to another in Golang error,"Can anyone tell my why this wouldn't compile?

package main

type myint int
func set(a **myint) {
    i := myint(5)
    *a = &i 
}

func main() {
    var k *int
    set( (**myint)(&k) ) // cannot convert &k (type **int) to type **myint
    print( *k )
}


My reasoning so far is this. All types in Golang are different, but it allows to convert from one type to another with C-like cast syntax as long as underlying types are identical. In my example, converting 'int' to 'myint' is not a problem. '*int' to '*myint' isn't either. It's when you have pointer to pointer problems arise. I've been stuck on this for the second day now. Any help is appreciated.
",2,5372575.0
9,6000524,Is there any SFTP or SSH library for Go?,"I can't seem to find any... it's a bit sad for a language positioned as networking-oriented one.
",2,9393711.0
10,6051088,Initialize custom int type in Go,"In Go it is valid to create a type:

type Num int


but how can one then initialize that type? make(Num, 2) does not seem to work.
",1,6051270.0
11,6118919,Compile Go file in Windows?,"I am trying to learn Go and have installed Go MinGW but I cannot find out how to actually compile a .go file ANYWHERE.  This is the program linked directly from the Go wiki for Windows Support, but all the tutorials talk about using 6g and gccgo etc. to compile and none of those work from my windows machine.
",1,6119041.0
12,6125345,How would I implement one-to-many on App Engine in Go?,"How would I implement one-to-many on Google App Engine in the Go programming language?
For example, if I have the structs below, how would I store the association of many Votes to one Comment?  Would I use an array (slice) of keys to Votes in the Comment struct, or one key to the Comment from the Vote struct?

type Comment struct {
    Author  string
    Content string
    Date    datastore.Time
}

type Vote struct {
    User string
    Score int
}

",3,6192309.0
13,6163096,"""unexpected R_X86_64_64 relocation for dynamic symbol"" when using Cgo","I am trying to create binding for a C library using Cgo. I have package which uses Cgo to import the library and make some calls to it. It compiles and installs fine. But when trying to use that package from a Go program, I get the the error ""unexpected R_X86_64_64 relocation for dynamic symbol"" when linking.

Any ideas?
",3,
14,6384824,"in golang, reflect pkg, 8g error ""undefined: reflect.NewValue""","little confused with reflect pkg

all of the examples us reflect.NewValue() to get the reflect.Value of a var, but 


func NewValue is not documented in http://golang.org/pkg/reflect/
the 8g compiler returns ""undefined: reflect.NewValue""


is NewValue() still supported? if not, how does one get reflect.Value from a var?



the Typeof and NewValue functions have been renamed to TypeOf and ValueOf.
",1,6385066.0
15,7309355,How can I quickly scale and sharpen an image in Go?,"I'm currently porting a pretty basic gallery application from PHP to Go. This application features automatic generation of thumbnails and middle-sized version of every image.

In PHP I used GD, because it ships with it and worked pretty well. (Code is at the end of the question). I thought I could just replicate that in Go and found go-gd from https://github.com/bolknote/go-gd (again, code is at the end). It works, but it is roughly 10 times slower (measured using time wget $URL). The PHP implementation takes about 1 second for generating a 1024x768 version from a 10 MP-image, while the Go-Code takes almost 10 seconds.

Is there any way to speed this up or any other image-processing libary for Go, which implements scaling and convolution while being reasonably fast?

PHP-Code

public function saveThumb($outName, $options) {
    $this->img = imagecreatefromjpeg($filename);
    if (!is_dir(dirname($outName))) {
        mkdir(dirname($outName), 0777, true);
    }

    $width = imagesx($this->img);
    $height = imagesy($this->img);

    if ($options[""keep_aspect""]) {
        $factor = min($options[""size_x""]/$width, $options[""size_y""]/$height);
        $new_width = round($factor*$width);
        $new_height = round($factor*$height);
    } else {
        $new_width  = $options[""size_x""];
        $new_height = $options[""size_y""];
    }

    // create a new temporary image
    $tmp_img = imagecreatetruecolor($new_width, $new_height);

    // copy and resize old image into new image
    imagecopyresampled($tmp_img, $this->img, 0, 0, 0, 0, $new_width, $new_height, $width, $height);

    if ($options[""sharpen""]) {
        // define the sharpen matrix
        $sharpen = array(
            array(-1, -1.7, -1),
            array(-1.7, 20, -1.7),
            array(-1, -1.7, -1) 
        );

        // calculate the sharpen divisor
        $divisor = array_sum(array_map('array_sum', $sharpen));

        // apply the matrix
        imageconvolution($tmp_img, $sharpen, $divisor, 0);
    }

    // save thumbnail into a file
    imagejpeg($tmp_img, $outName);     
}


Go-Code

func (entry *entry) GenerateThumb(options ImageType, overwrite bool) os.Error {
    targetFilename := entry.Filename(imageType)
    sourceFilename := entry.Filename(IMAGE_TYPE_FULL)
    targetDirname, _ := filepath.Split(targetFilename)
    os.MkdirAll(targetDirname, 0777)

    targetFi, errT := os.Stat(targetFilename)
    sourceFi, errS := os.Stat(sourceFilename)

    image := gd.CreateFromJpeg(sourceFilename)
    if image == nil {
        return os.NewError(""Image could not be loaded"")
    }

    var targetX, targetY int = 0, 0

    if options.KeepAspect {
        factor := math.Fmin(float64(options.SizeX)/float64(image.Sx()), float64(options.SizeY)/float64(image.Sy()))
        targetX = int(factor*float64(image.Sx()))
        targetY = int(factor*float64(image.Sy()))
    } else {
        targetX = options.SizeX
        targetY = options.SizeY
    }
    tmpImage := gd.CreateTrueColor(targetX, targetY)
    image.CopyResampled(tmpImage, 0, 0, 0, 0, tmpImage.Sx(), tmpImage.Sy(), image.Sx(), image.Sy())

    if options.Sharpen {
        sharpenMatrix := [3][3]float32{
        {-1, -1.7, -1},
        {-1.7, 20, -1.7},
        {-1, -1.7, -1} }
        tmpImage.Convolution(sharpenMatrix, 9.2, 0)
    }
    tmpImage.Jpeg(targetFilename, 90)

    return nil
}


EDIT: Go-Code using resize.go (see answer)

func (entry *entry) GenerateThumb(options ImageType, overwrite bool) os.Error {
    targetFilename := entry.Filename(imageType)
    sourceFilename := entry.Filename(IMAGE_TYPE_FULL)
    targetDirname, _ := filepath.Split(targetFilename)
    os.MkdirAll(targetDirname, 0777)

    targetFi, errT := os.Stat(targetFilename)
    sourceFi, errS := os.Stat(sourceFilename)

    if errT == nil && errS == nil {
        if targetFi.Mtime_ns > sourceFi.Mtime_ns && !overwrite {
            // already up-to-date, nothing to do
            return nil
        }
    }

    log.Printf(""Generate(\""%v\"", %v)\n"", imageType, overwrite)

    inFile, fErr := os.Open(sourceFilename)
    if fErr != nil {
        log.Fatal(fErr)
    }
    defer inFile.Close()

    img, _, err := image.Decode(inFile)
    if err != nil {
        log.Fatal(err)
    }

    var targetX, targetY int
    if options.KeepAspect {
        factor := math.Fmin(float64(options.SizeX)/float64(img.Bounds().Max.X), float64(options.SizeY)/float64(img.Bounds().Max.Y))
        targetX = int(factor*float64(img.Bounds().Max.X))
        targetY = int(factor*float64(img.Bounds().Max.Y))
    } else {
        targetX = curType.SizeX
        targetY = curType.SizeY
    }
    newImg := resize.Resample(img, image.Rect(0, 0, img.Bounds().Max.X, img.Bounds().Max.Y), targetX, targetY)

    var outFile *os.File
    outFile, fErr = os.Create(targetFilename)
    if fErr != nil {
        log.Fatal(fErr)
    }
    defer outFile.Close()

    err = jpeg.Encode(outFile, newImg, &jpeg.Options{90})
    if err != nil {
        log.Fatal(err)
    }
    return nil
}

",3,7314110.0
16,7535803,How do you add an external package to a GoClipse project for Google App Engine?,"I've compiled Goauth so that I can use OAuth in my Go Google App Engine project.  Where do I put the goauth.a file so that I can both use it in the project, and have it available when deploying to the GAE servers?  I can get it working locally if I put it in a subfolder of $GOROOT/pkg, but then it can't be found when compiling at deployment time.

GoClipse sets up a project with lots of folders, I'm not really sure what their purpose is,  where should I put goauth.a and how do I import it?
",1,7552319.0
17,7599476,What is the correct way to install Google Go and App Engine SDK?,"I've been playing with Go and GAE using GoClipse for a bit now on my Mac (since they won't run on Windows). Recently I noticed that when I goinstall a package from github it had some problems working. I figured I'd reinstall the whole thing and set it up properly. Go installed nicely, but when it came to integrating the GAE SDK it took me a couple hours of searching and came up with only this article:
http://code.google.com/p/goclipse/wiki/GoClipseAndTheGoogleAppEngine
But since it tell you to move files from the go/scr folder (where goinstall installs packages), I reckon it is not the correct way to set everything up.

Can anyone give me a clear, easy to follow step-by-step guide on how to install both Go and GAE SDK on a Mac?
",1,7613998.0
18,7846846,Google App Engine Go SDK update problems with template,"I`ve just updated my GAE Go SDK to the newest release. I ran the gofix
on my code, but there were still some errors. The code used to look:

   AnkietaTemp = template.New(nil)
   err := AnkietaTemp.ParseFile(""ankieta/ankieta.html"")


but now passing nil doesn't seem to work, so I replaced it into:

   AnkietaTemp = template.New("""")
   _, err := AnkietaTemp.ParseFile(""ankieta/ankieta.html"")


Tried running my app, but in HTML source I get:

 <img src=""images/{.section One}{@}{.end}""
alt=""images/{.section One}{@}{.end}"" width=""100%""/>


Instead of a neat reference to an image file.

What is the proper way to parse the template files now, after the
update?
",1,7847142.0
19,7987154,How to create a socket using WSASocket function in go programming language?,"Does anyone know how to create a SOCKET as returned by WSASocket() function in go programming language?

Using a normal syscall.Socket type syscall.Bind results in:
WSAENOTSOCK - Error 10038 - An operation was attempted on something that is not a socket. The specified socket parameter refers to a file, not a socket.

Thanks
",1,
20,8037783,Resource usage of google Go vs Python and Java on Appengine,"Will google Go use less resources than Python and Java on Appengine? Are the instance startup times for go faster than Java's and Python's startup times? 

Is the go program uploaded as binaries or source code and if it is uploaded as source code is it then compiled once or at each instance startup?

In other words: Will I benefit from using Go in app engine from a cost perspective? (only taking to account the cost of the appengine resources not development time)
",5,
21,8340751,WebP encoder/decoder in go,"Is there somewhere a complete WebP encoder and decoder compatible with current weekly (or forkable)?

Is it comparable in speed to the standard png one ?
",4,31143133.0
22,8868077,can't fetch the go language repository on Debian,"I follow the installation guide at http://golang.org/doc/install.html, 
at first everything goes well, but problem comes at the ""fetch the repository"" step,

the guide says ""$ hg clone -u release https://go.googlecode.com/hg/ go""
I follow the command but system always say that's wrong
so I read the help and modified it into 
""$ hg clone -U release ..repo url... go""
(I don't see a lowercase u option but there's a U instead which means noupdate)
but still goes wrong
so I modified it again 
""$ hg clone -U r60 ..repo url... go""
(I think release actually means go release number?)
ok, now that works finally 
but, when it's over
cd to the go directory,hey,why all the files are hidden?!
and different with the url directory, for ex there's no such a src directory

so what am I doing wrong, and sorry for my english is not good
thank you for your help



for as a new user I can't attach a image and can't have more than two links in one post, see the picture link below at the reply to Evan Shaw

and in the guide page they say that I need to install python-setuptools python-dev and build-essential, because in ubuntu/debian users' distribution's package repository, the  will ""most likely be old and broken"", what that mean? Am I suppose to install the tool manually(but not a easy_install)?



for a new user I can't answer myself,I think jnml points out the best matched answer

I thought this question is answerd,
the problem is that repository in Ubuntu/Debian for  is tool old,
if you just easy_install  (apt-get install ) 
you got version 1.0.1 , that's not match for the command gave on the go installation guide,
so a simple way to work it out is(thanks jnml for pointing this out):


hg clone
cd go
hg update release


that's done.

but I still wonder how can I get the latest version of  be installed on my Debian,but that's another question, 

Thanks a lot to all of you who reply to me, thank you for your help!
",1,8868451.0
23,9704895,Golang Regular Expressions - what am I doing incorrectly?,"As a personal project, trying to learn Go(lang) by applying it to something, I am writing an EMCAScript/JavaScript ""compiler""; all it will (initially) do is allow you to include other .js files.

Functionality aside, I am pulling my hair out trying to figure out the regexp package. Here is the snippet that does not seem to be doing what I want it to:

// Note: ""lines"" is an array of strings.

var includeRegex, _ = regexp.Compile(""^[ \t]*include[(]{1}\""([^\""]+)\""[)]{1};"")
for _, line := range lines {
   var isInclude = includeRegex.Match([]byte(line))
   if isInclude {
      var includeFile = includeRegex.FindString(line)
      fmt.Println(""INCLUDE"", includeFile)
   } else {
      // ...
   }


I have already stumbled across Go's subset of regular expressions, hence why the regex does not read as ^\s*include\(""([^""]+)""\);. I have already tested both the preferred, and the Go-style regex, in RegexPal, and both definitely work.  The match just never seems to occurr; what am I doing wrong?

For what it's worth, the include() statement I am trying to parse looks like so:

include(""somefile.js"");


EDIT: For what it's worth, I am keeping the code here.
",2,9706515.0
24,9748196,Reading bytes into structs using reflection,"I'm trying to write functions that will allow me to marshal/unmarshal simple structs into byte arrays. I've succeeded in writing Marshal, with help from the kind folks at #go-nuts, but I'm running into trouble writing Unmarshal.

// Unmarshal unpacks the binary data and stores it in the packet using
// reflection.
func Unmarshal(b []byte, t reflect.Type) (pkt interface{}, err error) {
    buf := bytes.NewBuffer(b)
    p := reflect.New(t)
    v := reflect.ValueOf(p)
    for i := 0; i < t.NumField(); i++ {
        f := v.Field(i)
        switch f.Kind() {
        case reflect.String:
            // length of string
            var l int16
            var e error
            e = binary.Read(buf, binary.BigEndian, &l)
            if e != nil {
                err = e
                return
            }

            // read length-of-string bytes from the buffer
            raw := make([]byte, l)
            _, e = buf.Read(raw)
            if e != nil {
                err = e
                return
            }

            // convert the bytes to a string
            f.SetString(bytes.NewBuffer(raw).String())
        default:
            e := binary.Read(buf, binary.BigEndian, f.Addr())
            if e != nil {
                err = e
                return
            }
        }
    }

    pkt = p
    return
}


The problem with the code above is that the call to f.Addr() near the end is apparently trying to get the address of an unaddressable value.

If there is an alternative solution, I would appreciate that as well. Either way, any help would be much appreciated.

Thanks!
",3,9748995.0
25,9862443,"Golang, is there a better way read a file of integers into an array?","I need to read a file of integers into an array.  I have it working with this:

package main

import (
    ""fmt""
    ""io""
    ""os""
)

func readFile(filePath string) (numbers []int) {
    fd, err := os.Open(filePath)
    if err != nil {
        panic(fmt.Sprintf(""open %s: %v"", filePath, err))
    }
    var line int
    for {

        _, err := fmt.Fscanf(fd, ""%d\n"", &line)

        if err != nil {
            fmt.Println(err)
            if err == io.EOF {
                return
            }
            panic(fmt.Sprintf(""Scan Failed %s: %v"", filePath, err))

        }
        numbers = append(numbers, line)
    }
    return
}

func main() {
    numbers := readFile(""numbers.txt"")
    fmt.Println(len(numbers))
}


The file numbers.txt is just:

1
2
3
...


ReadFile() seems too long (maybe because of the error handing).

Is there a shorter / more Go idiomatic way to load a file?
",3,
26,10022110,How to eliminate this type of recursion?,"This is a bit more intricate than a simple left-recursion or tail-call recursion. So I'm wondering how I can eliminate this kind of recursion. I'm already keeping my own stack as you can see below, so the function needs to no params or return values. However, it's still calling itself up (or down) to a certain level and I want to turn this into a loop, but been scratching my head over this for some time now.

Here's the simplified test case, replacing all ""real logic"" with printf(""dostuff at level #n"") messages. This is in Go but the problem is applicable to most languages. Use of loops and goto's would be perfectly acceptable (but I played with this and it gets convoluted, out-of-hand and seemingly unworkable to begin with); however, additional helper functions should be avoided. I guess I should to turn this into some kind of simple state machine, but... which?  ;)

As for the practicality, this is to run at about 20 million times per second (stack depth can range from 1 through 25 max later on). This is a case where maintaining my own stack is bound to be more stable / faster than the function call stack. (There are no other function calls in this function, only calculations.) Also, no garbage generated = no garbage collected.

So here goes:

func testRecursion () {
    var root *TMyTreeNode = makeSomeDeepTreeStructure()
    // rl: current recursion level
    // ml: max recursion level
    var rl, ml = 0, root.MaxDepth
    // node: ""the stack""
    var node = make([]*TMyTreeNode, ml + 1)

    // the recursive and the non-recursive / iterative test functions:
    var walkNodeRec, walkNodeIt func ();

    walkNodeIt = func () {
        log.Panicf(""YOUR ITERATIVE / NON-RECURSIVE IDEAS HERE"")
    }

    walkNodeRec = func () {
        log.Printf(""ENTER LEVEL %v"", rl)
        if (node[rl].Level == ml) || (node[rl].ChildNodes == nil) {
            log.Printf(""EXIT LEVEL %v"", rl)
            return
        }
        log.Printf(""PRE-STUFF LEVEL %v"", rl)
        for i := 0; i < 3; i++ {
            switch i {
            case 0:
                log.Printf(""PRECASE %v.%v"", rl, i)
                node[rl + 1] = node[rl].ChildNodes[rl + i]; rl++; walkNodeRec(); rl--
                log.Printf(""POSTCASE %v.%v"", rl,  i)
            case 1:
                log.Printf(""PRECASE %v.%v"", rl, i)
                node[rl + 1] = node[rl].ChildNodes[rl + i]; rl++; walkNodeRec(); rl--
                log.Printf(""POSTCASE %v.%v"", rl,  i)
            case 2:
                log.Printf(""PRECASE %v.%v"", rl, i)
                node[rl + 1] = node[rl].ChildNodes[rl + i]; rl++; walkNodeRec(); rl--
                log.Printf(""POSTCASE %v.%v"", rl,  i)
            }
        }
    }

    // test recursion for reference:
    if true {
        rl, node[0] = 0, root
        log.Printf(""\n\n=========>RECURSIVE ML=%v:"", ml)
        walkNodeRec()
    }

    // test non-recursion, output should be identical
    if true {
        rl, node[0] = 0, root
        log.Printf(""\n\n=========>ITERATIVE ML=%v:"", ml)
        walkNodeIt()
    }


}

UPDATE -- after some discussion here, and further thinking:

I just made up the following pseudo-code which in theory should do what I need:

curLevel = 0
for {
    cn = nextsibling(curLevel, coords)
    lastnode[curlevel] = cn
    if cn < 8 {
        if isleaf {
            process()
        } else {
            curLevel++
        }
    } else if curLevel == 0 {
        break
    } else {
        curLevel--
    }
}


Of course the tricky part will be filling out nextsibling() for my custom use-case. But just as a general solution to eliminating inner recursion while maintaining the depth-first traversal order I need, this rough outline should do so in some form or another.
",1,
27,10045481,Is there something like go-eldoc-mode for Emacs?,"eldoc-mode show you the parameters of the function you are calling when you write in Emacs Lisp.  Does anything like this exist for Google Go in Emacs?
",2,
28,10136478,"Go webserver how is the performance stability, in terms of long run stability compared to Tomcat, Apache?","I have been thinking instead of using:


Tomcat
Apache 
Lightweight webserver
PHP
Ruby
JSP


Why not switch my projects to Go language. Because there i have:


webserver built in 
i do not even need to depend on PHP, Ruby, JSP 
Go solves cross-platform such as: runs on FreeBSD, Linux, Solaris (Windows, Mac, Android, Tizen)
nor Apache nor Tomcat nor other webserver maintainence
speed of browser would be extreamly faster then other web server scripting languages.


But one thing i am worried about, which is the stablity of Go webserver compared to other webservers.

Has anyone done this before or am i alone building such projects for production releases?
",3,10138446.0
29,10152478,How to make a long connection with http.Client?,"I try to connect a http server as long connection, like below:

func main() {
    request, err := http.NewRequest(""GET"", ""http://long.connection.org:8080/"", nil)
    request.SetBasicAuth(""xxx"", ""oooo"")

    http_client := &http.Client{}
    response, _ := http_client.Do(request)

    var buf []byte
    for {
        _, err := response.Body.Read(buf)
        if err == io.EOF { break }
        fmt.Printf(""%s"", string(buf))
    }
}


But read from response.Body always empty. And seems I can't use response.Body to send data to server.

Any one can help?
",1,
30,10185942,golang output templates,"how to display the contents of the template?

package main

import (
    ""fmt""
    ""html/template""
    ""os""

)

func main() {
    t := template.New(""another"")
    t,e:=t.ParseFiles(""test.html"")
    if(e!=nil){
            fmt.Println(e);
    }
    t.Execute(os.Stdout, nil)

}


Why does not?
test.html exists
",1,10187062.0
31,10529365,Use Google Go's Goroutines To Create A Bayes Network,"I have a large dataset of philosophic arguments, each of which connect to other arguments as proof or disproof of a given statement. A root statement can have many proofs and disproofs, each of which may also have proofs and disproofs.  Statements can also be used in multiple graphs, and graphs can be analyzed under a ""given context"" or assumption.

I need to construct a bayesian network of related arguments, so that each node propagates influence fairly and accurately to it's connected arguments; I need to be able to calculate the probability of chains of connected nodes concurrently, with each node requiring datastore lookups that must block to get results; the process is mostly I/O bound, and my datastore connection can run asynchronously in java, go and python {google appengine}.  Once each lookup completes, it propagates the effects to all other connected nodes until the probability delta drops below a threshold of irrelevance {currently 0.1%}.  Each node of the process must calculate chains of connections, then sum up all the results across all queries to adjust validity results, with results chained outward to any connected arguments.

In order to avoid recurring infinitely, I was thinking of using an A*-like process in goroutines to propagate updates to the argument maps, with a heuristic based on compounding influence which ignores nodes once probability of influence dips below, say 0.1% .  I'd tried to set up the calculations with SQL triggers, but it got complex and messy way too fast. Then I moved to google appengine to take advantage of asynchronous nosql, and it was better, but still too slow.  I need to be run the updates fast enough to get a snappy UI, so when a user creates or votes for or against a proof or disproof, they can see the results reflected in UI immediately.

I think Go is the language of choice to support the concurrency I need, but I'm open to suggestions.  The client is a monolithic javascript app that just uses XHR and websockets to push and pull argument maps {and their updates} in real time.  I have a java prototype that can compute large chains in 10~15s, but monitoring of performance shows that most of my runtime is wasted in synchronization and overhead from ConcurrentHashMap.

If there are other highly-concurrent languages worth trying out, please let me know. I know java, python, go, ruby and scala, but will learn any language if it suits my needs. 

Similarly, if there are open source implementations of huge Bayesian networks, please leave a suggestion.
",1,10534905.0
32,10716433,Go HTTP handler - handling more than two form actions,"I have a webapp where I have code like:

func handler (w res, r req) {
  if req.Method == POST {
    // create html form 2 with a submit button2
    return ;
  }
  // create html form 1 with a submit button1
  return
} 

func main() {
  handle(""/"", handler)
}


Now, the root / is registered with the handler func. In the first request (GET), I create a form and send it to the user. If the user submits this form, I handle it under the ""POST"" method. Now, I create a different form in the post method handler, and now I want a way to do some operations based on what the user typed in this form2, when [s]he submits form2.

What is the standard way with go to handle the form2 form submission ? I have done some asp programming earlier and we use form action to submit to a different asp file. How can I do some actions based on parsing the form2 submission request ? 
",1,10757939.0
33,10828187,Marshal arbitrary XML attributes in an element in Go?,"I need to marshal in extra attributes on an element at runtime. I've tried this:

type Meh struct {
    XMLName xml.Name
    Attrs []xml.Attr
}

Meh{
    Attrs: []xml.Attr{
        xml.Attr{xml.Name{Local: ""hi""}, ""there""},
    },  
}


But the fields are treated as new elements:

there


If I add the tag xml:"",attr"" to the Attr field, it expects a []byte or string specifying the contents of a single attribute.

How do I specify attributes at runtime? How do I annotate the type to provide field(s) for this?
",1,
34,10869843,How to assert with a debug message in Go tests?,"I want to do this:

test.FailNow(""My Message"")


but test.T.FailNow doesn't take a message. I am currently doing:

log.Println(""Expected exception but got none"")
test.FailNow()


Is there a better way? 
",2,10869872.0
35,10990174,"How is declaring a new struct instance with ""var"" different from using ""new"" in Go?","The following code creates a usable instance of the struct, Car. How is this different than using new(Car)?

Example:

type Car struct {
  make string
}

func Main() {
  var car Car; // how is this different than ""car := new(Car)""?

  car.make = ""Honda""
}

",1,10990287.0
36,10998222,json parsing of int64 in go; null values,"I'm trying to parse a json stream in Go. I've created a simplified example:

 package main
 import (
    ""encoding/json""
    ""fmt""
 )

 var d = []byte(`{ ""world"":[{""data"": 2251799813685312}, {""data"": null}]}`)

 type jsonobj struct{ World []World }
 type World struct{ Data int64 }

 func main() {
    var data jsonobj
    jerr := json.Unmarshal(d, &data)
    fmt.Println(jerr)
 }


this will give me 

go run testmin.go
json: cannot unmarshal null into Go value of type int64


I've found a nullable int64 in the sql package, but json doesn't seem to be able to handle it. 

Is there a nullable int64 type that json can handle? If possible I'd be happy with the json null being translated to, -1 or MinValue. 

Thank you for your input,
Fabian
",1,10998318.0
37,11609583,golang: runtime error: invalid memory address or nil pointer dereference,"I am new to golang and currently following this tutorial and source code here - http://golang.org/doc/articles/wiki/part2.go

After building this file, I am getting 

calvin$ ./mywebwiki2 
2012/07/23 17:12:59 http: panic serving [::1]:58820: runtime error: invalid memory address or nil pointer dereference
/usr/local/go/src/pkg/net/http/server.go:576 (0x3f202)
    _func_003: buf.Write(debug.Stack())
/private/tmp/bindist454984655/go/src/pkg/runtime/proc.c:1443 (0x10c79)
/private/tmp/bindist454984655/go/src/pkg/runtime/runtime.c:128 (0x11745)
/private/tmp/bindist454984655/go/src/pkg/runtime/thread_darwin.c:418 (0x148b5)
/Users/calvin/work/gowiki/mywebwiki2.go:33 (0x2248)
    viewHandler: fmt.Fprintf(w, ""%s%s"", p.Title, p.Body)
/usr/local/go/src/pkg/net/http/server.go:690 (0x331ae)
    HandlerFunc.ServeHTTP: f(w, r)
/usr/local/go/src/pkg/net/http/server.go:926 (0x34030)
    (*ServeMux).ServeHTTP: mux.handler(r).ServeHTTP(w, r)
/usr/local/go/src/pkg/net/http/server.go:656 (0x32fc1)
    (*conn).serve: handler.ServeHTTP(w, w.req)
/private/tmp/bindist454984655/go/src/pkg/runtime/proc.c:271 (0xed7f)
2012/07/23 17:12:59 http: panic serving [::1]:58821: runtime error: invalid memory address or nil pointer dereference


Any idea what I did wrong to be causing this apparent memory corruption?
",2,11611782.0
38,11805356,text/template issue Parse() vs. ParseFiles(),"I'm trying to do some simple work with the text/template package.  The sample given at the top of template is what I'm working with.

How do I write the 'parsed' file so template.ParseFiles() properly reads and executes it?

package main

import (
    ""text/template""
    ""os""
)

type Inventory struct {
    Material string
    Count    uint
}

func main() {
    sweaters := Inventory{""wool"", 17}
    tmpl, err := template.New(""test"").Parse(""{{.Count}} items are made of {{.Material}}"")
    // tmpl, err := template.New(""test"").ParseFiles(""file.txt"")

    if err != nil { panic(err) }
    err = tmpl.Execute(os.Stdout, sweaters)
    if err != nil { panic(err) }
}

/*
Contents of file.txt:
{{.Count}} items are made of {{.Material}}

Error thrown:
panic: template: test:1: ""test"" is an incomplete or empty template

goroutine 1 [running]:
main.main()
    /tmp/templates/t.go:19 +0x21a

goroutine 2 [syscall]:
created by runtime.main
    /var/tmp/portage/dev-lang/go-1.0.1/work/go/src/pkg/runtime/proc.c:221
*/


I have a copy of this code posted at the golang playground here

Edit #1:
I've been doing some research on this issue... since it's the Execute() method that actually throws the exception, and not the ParseFiles() part, I checked the method definition:

// Execute applies a parsed template to the specified data object,
// and writes the output to wr.
func (t *Template) Execute(wr io.Writer, data interface{}) (err error) {
    defer errRecover(&err)
    value := reflect.ValueOf(data)
    state := &state{
        tmpl: t,
        wr:   wr,
        line: 1,
        vars: []variable{{""$"", value}},
    }
    if t.Tree == nil || t.Root == nil {
        state.errorf(""%q is an incomplete or empty template"", t.name)
    }
    state.walk(value, t.Root)
    return
}


So, on a hunch, I dumped the value of t.Tree for the inline 'non-file' style, tmpl is: &parse.Tree{Name:""test"", Root:(*parse.ListNode)(0xf840030700), funcs:[]map[string]interface {}(nil), lex:(*parse.lexer)(nil), token:[2]parse.item{parse.item{typ:6, val:""""}, parse.item{typ:9, val:""{{""}}, peekCount:1, vars:[]string(nil)} and
 when ran with ParseFiles(), tmpl is: (*parse.Tree)(nil).  I find it odd that one is a dereference, and one value is a pointer.  This may help solve the riddle
",2,11807674.0
39,12224412,Why does the function return early?,"I've just started learning go, and have been working through the tour. The last exercise is to edit a web crawler to crawl in parallel and without repeats.

Here is the link to the exercise: http://tour.golang.org/#70

Here is the code. I only changed the crawl and the main function. So I'll just post those to keep it neat.

    // Crawl uses fetcher to recursively crawl
    // pages starting with url, to a maximum of depth.
    var used = make(map[string]bool)
    var urlchan = make(chan string)
    func Crawl(url string, depth int, fetcher Fetcher) {
        // TODO: Fetch URLs in parallel.
        // Done: Don't fetch the same URL twice.
        // This implementation doesn't do either:
        done := make(chan bool)
        if depth <= 0 {
            return
        }
        body, urls, err := fetcher.Fetch(url)
        if err != nil {
            fmt.Println(err)
            return
        }
        fmt.Printf(""\nfound: %s %q\n\n"", url, body)
        go func() {
            for _, i := range urls {
                urlchan <- i
            }
            done <- true
        }()
        for u := range urlchan {
            if used[u] == false {
                used[u] = true
                go Crawl(u, depth-1, fetcher)
            }
            if <-done == true {
                break
            }
        }
        return
    }

    func main() {
        used[""http://golang.org/""] = true
        Crawl(""http://golang.org/"", 4, fetcher)
    }


The problem is that when I run the program the crawler stops after printing

    not found: http://golang.org/cmd/


This only happens when I try to make the program run in parallel. If I have it run linearly then all the urls are found correctly.

Note: If I am not doing this right (parallelism I mean) then I apologise.
",1,12225044.0
40,12374718,I am trying to write a simple script in Go but get bad interpreter: Permission denied error,"I am trying to write a script in Go but I get this error: 


  bad interpreter: Permission denied


My super simple script is as follow:

#!/usr/local/Cellar/go/1.0.2/bin  
fmt.Println(""Hello World"")  


I don´t know if this is possible but I would really like to write scripts in Go since I like the language a lot.
",1,12374736.0
41,12425507,What do the operators '>' do?,"I was following 'A tour of GO` on http://tour.golang.org.
The table 15 has some code that I cannot understand. It defines two constants with the following syntax:

const (
    Big = 1<<100
    Small = Big>>99
)


And it's not clear at all to me what it means. I tried to modify the code and run it with different values, to record the change, but I was not able to understand what is going on there.

Then, it uses that operator again on table 24. It defines a variable with the following syntax:

MaxInt uint64 = 1

And when it prints the variable, it prints:

uint64(18446744073709551615)

Where uint64 is the type. But I can't understand where 18446744073709551615 comes from.
",4,12425607.0
42,12451898,Unmarshal Group with Nested XML-RPC in Go,"I'm using Webfaction API and trying to unmarshal their response to obtain the session ID (12345abcde... below).

How do I access the specific value when its nested under several fields (namely, params>param)?

Code below is at http://play.golang.org/p/krG4_fXVka

package main

import (""encoding/xml""
        ""fmt""
        )

type Result struct {
        XMLName xml.Name `xml:""methodResponse""`
        Values []string `xml:""params>param>value""`
}

func main() {
data := `
    

    
        
            12345abcde12345abcde12345
            
                
                    username
                    trex
                
                
                    home
                    /home
                
                
                    mail_server
                    Mailbox1
                
                
                    web_server
                    Web12
                
                
                    id
                    1234
                
            
        
    



`

v := Result{}
err := xml.Unmarshal([]byte(data), &v)
if err != nil {
fmt.Printf(""error: %v"", err)
        return
}
fmt.Printf(""XMLName: %#v\n"", v.XMLName)
fmt.Printf(""Values: %#v\n"", v.Values)

}

",1,12452721.0
43,12540057,Is there a Go Language equivalent to Perls' Dumper() method in Data::Dumper?,"I've looked at the very similarly titled post (Is there a C equivalent to Perls' Dumper() method in Data::Dumper?), regarding a C equivalent to Data::Dumper::Dumper();. I have a similar question for the Go language.

I'm a Perl Zealot by trade, and am a progamming hobbyist, and make use of Data::Dumper and similar offspring literally hundreds of times a day. I've taken up learning Go, because it looks like a fun and interesting language, something that will get me out of the Perl rut I'm in, while opening my eyes to new ways of doing stuffz... One of the things I really want is something like:

fmt.Println(dump.Dumper(decoded_json))


to see the resulting data structure, like Data::Dumper would turn the JSON into an Array of Hashes. Seeing this in Go, will help me to understand how to construct and work with the data. Something like this would be considered a major lightbulb moment in my learning of Go.

Contrary to the statements made in the C counterpart post, I believe we can write this, and since I'll be passing Dumper to Println, after compilation what ever JSON string or XML page I pass in and decode. I should be able to see the result of the decoding, in a Dumper like state... So, does any more know of anything like this that exists? or maybe some pointers to getting something like this done? 
",3,21488512.0
44,12558741,Issues retrieving MongoDB documents with Go,"I have the following code, and I'm not sure why it is not returning a slice of Notes. I am using the mgo library from labix.org to connect to MongoDB and following their online documentation.

type Note struct {
    Url string
    Title string
    Date string
    Body string
}

func loadNotes() ([]Note) {
    session, err := mgo.Dial(""localhost"")
    if err != nil {
            panic(err)
    }
    defer session.Close()

    // Optional. Switch the session to a monotonic behavior.
    session.SetMode(mgo.Monotonic, true)

    c := session.DB(""test"").C(""notes"")

    notes := []Note{}
    iter := c.Find(nil).Limit(100).Iter()
    err = iter.All(&notes)
    if err != nil {
        panic(iter.Err())
    }

    return notes
}

func main() {
    notes := loadNotes()
    for note := range notes {
        fmt.Println(note.Title)
    }
}  


If I just print out notes I get what looks like a slice of two structs, but I can't access them by means of notes.Title or anything like that.

[{ Some example title 20 September 2012 Some example content}]


This is what my documents look like:

> db.notes.find()
{ ""_id"" : ""some-example-title"", ""title"" : ""Some example title"", ""date"" : ""20 September 2012"", ""body"" : ""Some example content"" }


The real issue is that it's returning the notes as one big slice rather than a Note{} (I think?)

If I'm doing something obviously wrong, any insight would help.
",3,12568984.0
45,12574909,Can Go really be that much faster than python?,"I think I may have implemented this incorrectly because the results do not make sense. I have a go program that counts to 1000000000

    package main

    import (
        ""fmt""
    )

    func main() {
        for i := 0; i < 1000000000; i++ {}
        fmt.Println(""Done"") 
    }


It finishes in less than a second. On the other hand I have a python script

    x = 0
    while x < 1000000000:
        x+=1
    print 'Done'


It finishes in a few minutes.

Why is the Go version so much faster. Are they both counting up to 1000000000 or am I missing something?
",8,12575141.0
46,12612409,go programming POST FormValue can't be printed,"Before I being a bit of background, I am very new to go programming language. I am running go on Win 7, latest go package installer for windows. I'm not good at coding but I do like some challenge of learning a new language. I wanted to start learn Erlang but found go very interesting based on the GO I/O videos in youtube.

I'm having problem with capturing POST form values in GO. I spend three hours yesterday to get go to print a POST form value in the browser and failed miserably. I don't know what I'm doing wrong, can anyone point me to the right direction? I can easily do this in another language like C#, PHP, VB, ASP, Rails etc. I have search the entire interweb and haven't found a working sample. Below is my sample code.

Here is Index.html page

{{ define ""title"" }}Homepage{{ end }}

{{ define ""content"" }}
    My Homepage

    Hello, and welcome to my homepage!
    
     Enter your name :  
     Go
    
    

{{ end }}


Here is the base page



    
        {{ template ""title"" . }}
    
    
        
            {{ template ""content"" . }}
        
        
            My homepage 2012 copy
        
    



now some go code

    package main

import (
    ""fmt""
    ""http""
    ""strings""
    ""html/template""

)

var index = template.Must(template.ParseFiles(
  ""templates/_base.html"",
  ""templates/index.html"",
))


func GeneralHandler(w http.ResponseWriter, r *http.Request) {
    index.Execute(w, nil)
     if r.Method == ""POST"" {
        a := r.FormValue(""username"")
        fmt.Fprintf(w, ""hi %s!"",a); //<-- this variable does not rendered in the browser!!!

    }
}

func helloHandler(w http.ResponseWriter, r *http.Request) {
    remPartOfURL := r.URL.Path[len(""/hello/""):] 
    fmt.Fprintf(w, ""Hello %s!"", remPartOfURL)
}


func main() {
    http.HandleFunc(""/"", GeneralHandler)
    http.HandleFunc(""/hello/"", helloHandler)
    http.ListenAndServe(""localhost:81"", nil)
}


Thanks!

PS: Very tedious to add four space before every line of code in stackoverflow especially when you are copy pasting. Didn't find it very user friendly or is there an easier way?
",2,12615105.0
47,12659126,GAE filter entity key (Golang),"I want to use look like

datastore.NewQuery(""Article"").Filter(""ID ="", id)


to get entity key.

How do this?

Sorry for my poor English. Thanks!
",2,12664785.0
48,12885235,Google Go HelloWorld Tutorial erring out,"Starting to work through the Google Go HelloWorld tutorial from:  

https://developers.google.com/appengine/docs/go/gettingstarted/helloworld

Using OS X 10.8.2 on MacBook Pro.

Followed the steps, but when I run the first code ( dev_appserver.py myapp/ ), I get errors listed at end of question.

This is the hello world program:

package hello

import (
    ""fmt""
    ""net/http""
)

func init() {
    http.HandleFunc(""/"", handler)
}

func handler(w http.ResponseWriter, r *http.Request) {
    fmt.Fprint(w, ""Hello, world!"")
}


and this is the configuration file:

application: helloworld
version: 1
runtime: go
api_version: go1


handlers:

- url: /.*
  script: _go_app


Have googled and searched here on stackoverflow, but not found solution.

Let me know if you have any ideas/suggestions.

Last login: Sun Oct 14 13:05:37 on ttys000
derek-etnyres-macbook-pro-2:~ dereketnyre$ dev_appserver.py myapp/
WARNING  2012-10-14 18:19:54,239 rdbms_mysqldb.py:74] The rdbms API is not available because the MySQLdb library could not be loaded.
Warning: You are using a Python runtime (2.7) that is more recent than the production runtime environment (2.5). Your application may use features that are not available in the production environment and may not work correctly when deployed to production.
CRITICAL 2012-10-14 18:19:54,686 appcfg.py:562] The api_version specified in app.yaml (go1) is not supported by this release of the SDK.  The supported api_versions are ['1'].


==========

Update

Changed the api_version to be 1 ( api_version: 1) and it did help.  Still gives error message but the server starts.

It now says:

derek-etnyres-macbook-pro-2:~ dereketnyre$ dev_appserver.py myapp/
WARNING  2012-10-14 21:03:14,910 rdbms_mysqldb.py:74] The rdbms API is not available because the MySQLdb library could not be loaded.
Warning: You are using a Python runtime (2.7) that is more recent than the production runtime environment (2.5). Your application may use features that are not available in the production environment and may not work correctly when deployed to production.
INFO     2012-10-14 21:03:15,324 appcfg.py:585] Checking for updates to the SDK.
INFO     2012-10-14 21:03:15,551 appcfg.py:603] The SDK is up to date.
WARNING  2012-10-14 21:03:15,551 datastore_file_stub.py:518] Could not read datastore data from /var/folders/s0/095xdtkd3cgbjp73tpxx309r0000gn/T/dev_appserver.datastore
WARNING  2012-10-14 21:03:15,552 simple_search_stub.py:949] Could not read search indexes from /var/folders/s0/095xdtkd3cgbjp73tpxx309r0000gn/T/dev_appserver.searchindexes
WARNING  2012-10-14 21:03:15,562 dev_appserver.py:3621] Could not initialize images API; you are likely missing the Python ""PIL"" module. ImportError: No module named _imaging
INFO     2012-10-14 21:03:15,570 dev_appserver_multiprocess.py:655] Running application dev~helloworld on port 8080: http://localhost:8080
INFO     2012-10-14 21:03:15,570 dev_appserver_multiprocess.py:657] Admin console is available at: http://localhost:8080/_ah/admin


When I go to localhost:8080 using Safari - does not display hello word - gives a screen full of python script exceptions.

At the very bottom it says:

: no goroot found at /Applications/GoogleAppEngineLauncher.app/Contents/Resources/GoogleAppEngine-default.bundle/Contents/Resources/google_appengine/goroot 
      args = ('no goroot found at /Applications/GoogleAppEngine...bundle/Contents/Resources/google_appengine/goroot',) 
      message = 'no goroot found at /Applications/GoogleAppEngine...bundle/Contents/Resources/google_appengine/goroot'


Looks like the path is not set correctly?

The full text of the python errors is:

pe 'exceptions.AttributeError'> Python 2.7.2: /usr/bin/python
Sun Oct 14 21:29:05 2012
A problem occurred in a Python script. Here is the sequence of function calls leading up to the error, in the order they occurred.

 /Applications/GoogleAppEngineLauncher.app/Contents/Resources/GoogleAppEngine-default.bundle/Contents/Resources/google_appengine/google/appengine/tools/dev_appserver.py in _HandleRequest(self=)
   2952         outfile = cStringIO.StringIO()
   2953         try:
=> 2954           self._Dispatch(dispatcher, self.rfile, outfile, env_dict)
   2955         finally:
   2956           self.module_manager.UpdateModuleFileModificationTimes()
self = , self._Dispatch = >, dispatcher = , self.rfile = , outfile = , env_dict = {'APPENGINE_RUNTIME': 'go', 'APPLICATION_ID': 'dev~helloworld', 'CURRENT_VERSION_ID': '1.1', 'DEFAULT_VERSION_HOSTNAME': 'localhost:8080', 'REMOTE_ADDR': '127.0.0.1', 'REQUEST_ID_HASH': 'C1DFD96E', 'REQUEST_METHOD': 'GET', 'SDK_VERSION': '1.7.2', 'SERVER_NAME': 'localhost', 'SERVER_PORT': '8080', ...}
 /Applications/GoogleAppEngineLauncher.app/Contents/Resources/GoogleAppEngine-default.bundle/Contents/Resources/google_appengine/google/appengine/tools/dev_appserver.py in _Dispatch(self=, dispatcher=, socket_infile=, outfile=, env_dict={'APPENGINE_RUNTIME': 'go', 'APPLICATION_ID': 'dev~helloworld', 'CURRENT_VERSION_ID': '1.1', 'DEFAULT_VERSION_HOSTNAME': 'localhost:8080', 'REMOTE_ADDR': '127.0.0.1', 'REQUEST_ID_HASH': 'C1DFD96E', 'REQUEST_METHOD': 'GET', 'SDK_VERSION': '1.7.2', 'SERVER_NAME': 'localhost', 'SERVER_PORT': '8080', ...})
   2822           dispatcher.Dispatch(app_server_request,
   2823                               outfile,
=> 2824                               base_env_dict=env_dict)
   2825         finally:
   2826           request_file.close()
base_env_dict undefined, env_dict = {'APPENGINE_RUNTIME': 'go', 'APPLICATION_ID': 'dev~helloworld', 'CURRENT_VERSION_ID': '1.1', 'DEFAULT_VERSION_HOSTNAME': 'localhost:8080', 'REMOTE_ADDR': '127.0.0.1', 'REQUEST_ID_HASH': 'C1DFD96E', 'REQUEST_METHOD': 'GET', 'SDK_VERSION': '1.7.2', 'SERVER_NAME': 'localhost', 'SERVER_PORT': '8080', ...}
 /Applications/GoogleAppEngineLauncher.app/Contents/Resources/GoogleAppEngine-default.bundle/Contents/Resources/google_appengine/google/appengine/tools/dev_appserver.py in Dispatch(self=, request= force_admin: False>, outfile=, base_env_dict={'APPENGINE_RUNTIME': 'go', 'APPLICATION_ID': 'dev~helloworld', 'CURRENT_VERSION_ID': '1.1', 'DEFAULT_VERSION_HOSTNAME': 'localhost:8080', 'REMOTE_ADDR': '127.0.0.1', 'REQUEST_ID_HASH': 'C1DFD96E', 'REQUEST_METHOD': 'GET', 'SDK_VERSION': '1.7.2', 'SERVER_NAME': 'localhost', 'SERVER_PORT': '8080', ...})
    705         forward_request = dispatcher.Dispatch(request,
    706                                               outfile,
=>  707                                               base_env_dict=base_env_dict)
    708 
    709         while forward_request:
base_env_dict = {'APPENGINE_RUNTIME': 'go', 'APPLICATION_ID': 'dev~helloworld', 'CURRENT_VERSION_ID': '1.1', 'DEFAULT_VERSION_HOSTNAME': 'localhost:8080', 'REMOTE_ADDR': '127.0.0.1', 'REQUEST_ID_HASH': 'C1DFD96E', 'REQUEST_METHOD': 'GET', 'SDK_VERSION': '1.7.2', 'SERVER_NAME': 'localhost', 'SERVER_PORT': '8080', ...}
 /Applications/GoogleAppEngineLauncher.app/Contents/Resources/GoogleAppEngine-default.bundle/Contents/Resources/google_appengine/google/appengine/tools/dev_appserver.py in Dispatch(self=, request= force_admin: False>, outfile=, base_env_dict={'APPENGINE_RUNTIME': 'go', 'APPLICATION_ID': 'dev~helloworld', 'CURRENT_VERSION_ID': '1.1', 'DEFAULT_VERSION_HOSTNAME': 'localhost:8080', 'REMOTE_ADDR': '127.0.0.1', 'REQUEST_ID_HASH': 'C1DFD96E', 'REQUEST_METHOD': 'GET', 'SDK_VERSION': '1.7.2', 'SERVER_NAME': 'localhost', 'SERVER_PORT': '8080', ...})
   1770                      memory_file,
   1771                      outfile,
=> 1772                      self._module_dict)
   1773     finally:
   1774       logging.root.level = before_level
self = , self._module_dict = {'codecs': , 'email': , 'email.Charset': , 'email.Encoders': , 'email.Errors': , 'email.FeedParser': , 'email.Generator': , 'email.Header': , 'email.Iterators': , 'email.MIMEAudio': , ...}
 /Applications/GoogleAppEngineLauncher.app/Contents/Resources/GoogleAppEngine-default.bundle/Contents/Resources/google_appengine/google/appengine/tools/dev_appserver.py in ExecuteCGI(config=, root_path='/Users/dereketnyre/myapp', handler_path='_go_app', cgi_path='/Users/dereketnyre/myapp/_go_app', env={'APPENGINE_RUNTIME': 'go', 'APPLICATION_ID': 'dev~helloworld', 'AUTH_DOMAIN': 'gmail.com', 'CONTENT_LENGTH': '', 'CONTENT_TYPE': 'application/x-www-form-urlencoded', 'CURRENT_VERSION_ID': '1.1', 'DEFAULT_VERSION_HOSTNAME': 'localhost:8080', 'GATEWAY_INTERFACE': 'CGI/1.1', 'HTTP_ACCEPT': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8', 'HTTP_ACCEPT_LANGUAGE': 'en-us', ...}, infile=, outfile=, module_dict={'codecs': , 'email': , 'email.Charset': , 'email.Encoders': , 'email.Errors': , 'email.FeedParser': , 'email.Generator': , 'email.Header': , 'email.Iterators': , 'email.MIMEAudio': , ...}, exec_script=, exec_py27_handler=)
   1588     from google.appengine.ext.go import execute_go_cgi
   1589     return execute_go_cgi(root_path, config, handler_path, cgi_path,
=> 1590         env, infile, outfile)
   1591 
   1592 
env = {'APPENGINE_RUNTIME': 'go', 'APPLICATION_ID': 'dev~helloworld', 'AUTH_DOMAIN': 'gmail.com', 'CONTENT_LENGTH': '', 'CONTENT_TYPE': 'application/x-www-form-urlencoded', 'CURRENT_VERSION_ID': '1.1', 'DEFAULT_VERSION_HOSTNAME': 'localhost:8080', 'GATEWAY_INTERFACE': 'CGI/1.1', 'HTTP_ACCEPT': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8', 'HTTP_ACCEPT_LANGUAGE': 'en-us', ...}, infile = , outfile = 
 /Applications/GoogleAppEngineLauncher.app/Contents/Resources/GoogleAppEngine-default.bundle/Contents/Resources/google_appengine/google/appengine/ext/go/__init__.py in execute_go_cgi(root_path='/Users/dereketnyre/myapp', config=, handler_path='_go_app', cgi_path='/Users/dereketnyre/myapp/_go_app', env={'APPENGINE_RUNTIME': 'go', 'APPLICATION_ID': 'dev~helloworld', 'AUTH_DOMAIN': 'gmail.com', 'CONTENT_LENGTH': '', 'CONTENT_TYPE': 'application/x-www-form-urlencoded', 'CURRENT_VERSION_ID': '1.1', 'DEFAULT_VERSION_HOSTNAME': 'localhost:8080', 'GATEWAY_INTERFACE': 'CGI/1.1', 'HTTP_ACCEPT': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8', 'HTTP_ACCEPT_LANGUAGE': 'en-us', ...}, infile=, outfile=)
    519     RAPI_HANDLER = handler.ApiCallHandler()
    520     GO_APP = GoApp(root_path)
=>  521   GO_APP.make_and_run(env)
    522 
    523 
global GO_APP = None, GO_APP.make_and_run undefined, env = {'APPENGINE_RUNTIME': 'go', 'APPLICATION_ID': 'dev~helloworld', 'AUTH_DOMAIN': 'gmail.com', 'CONTENT_LENGTH': '', 'CONTENT_TYPE': 'application/x-www-form-urlencoded', 'CURRENT_VERSION_ID': '1.1', 'DEFAULT_VERSION_HOSTNAME': 'localhost:8080', 'GATEWAY_INTERFACE': 'CGI/1.1', 'HTTP_ACCEPT': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8', 'HTTP_ACCEPT_LANGUAGE': 'en-us', ...}
: 'NoneType' object has no attribute 'make_and_run' 
      args = (""'NoneType' object has no attribute 'make_and_run'"",) 
      message = ""'NoneType' object has no attribute 'make_and_run'""

",2,12889086.0
49,13020308,How to fmt.Printf an integer with thousands comma,"Does Go's fmt.Printf support outputting a number with the thousands comma?

fmt.Printf(""%d"", 1000) outputs 1000, what format can I specify to output 1,000 instead?

The docs don't seem to mention commas, and I couldn't immediately see anything in the source.
",9,13020503.0
50,13291958,Does Go allow specification of an interface for a map with particular key type?,"I wrote a function that would return a sorted slice of strings from a map[string]Foo.  I'm curious what is the best way to create a generic routine that can return a sorted slice of strings from any type that is a map with strings as keys.

Is there a way to do it using an interface specification?  For example, is there any way to do something like:

type MapWithStringKey interface {
    
}


To implement the interface above, a type would need strings as keys.  I could then write a generic function that returns a sorted list of keys for fulfilling types.

This is my current best solution using the reflect module:

func SortedKeys(mapWithStringKey interface{}) []string {
    keys := []string{}
    typ := reflect.TypeOf(mapWithStringKey)
    if typ.Kind() == reflect.Map && typ.Key().Kind() == reflect.String {
        switch typ.Elem().Kind() {
        case reflect.Int:
            for key, _ := range mapWithStringKey.(map[string]int) {
                keys = append(keys, key)
            }
        case reflect.String:
            for key, _ := range mapWithStringKey.(map[string]string) {
                keys = append(keys, key)
            }
            // ... add more cases as needed
        default:
            log.Fatalf(""Error: SortedKeys() does not handle %s\n"", typ)
        }
        sort.Strings(keys)
    } else {
        log.Fatalln(""Error: parameter to SortedKeys() not map[string]..."")
    }
    return keys
}


Click for Go Playground version

I'm forced to code type assertions for each supported type even though at compile time, we should know the exact type of the mapWithStringKey parameter.
",2,
51,13330274,Regex to find named capturing groups with Go programming language,"I'm looking for a regex to find named capturing groups in (other) regex strings.

Example: I want to find (?Pm((a|b).+)n), (?P.+) and (?P(5|6)\. .+) in the following regex:

/(?Pm((a|b).+)n)/(?P.+)/(?P(5|6)\. .+)


I tried the following regex to find the named capturing groups:

var subGroups string = `(\(.+\))*?`
var prefixedSubGroups string = `.+` + subGroups
var postfixedSubGroups string = subGroups + `.+`
var surroundedSubGroups string = `.+` + subGroups + `.+`
var capturingGroupNameRegex *regexp.RichRegexp = regexp.MustCompile(
    `(?U)` + 
    `\(\?P` + 
    `(` +   prefixedSubGroups + `|` + postfixedSubGroups + `|` + surroundedSubGroups + `)` + 
    `\)`) 


?U makes greedy quantifiers(+ and *) non-greedy, and non-greedy quantifiers (*?) greedy. Details in the Go regex documentation.

But it doesn't work because parenthesis are not matched correctly.
",1,13330293.0
52,13508332,How to import non-standard-library packages use gccgo,"First of all, all these code can be built successfully using go tool(e.g. go build, go install)

For say I got an a.go which tries to import a non-standard-library pkg from github:

package a

import (
    ""fmt""
    ""github.com/usr/pkg""
)

func init() {
    fmt.Println(""Import pkg"", pkg.somevar)
}


when I try to compile it with gccgo:

$ gccgo -c a.go
a.go:5:20: error: import file ‘github.com/usr/pkg’ not found
...


And then I read the Setting up and using gccgo , it says 


  When you import the package FILE with gccgo, it will look for the
  import data in the following files, and use the first one that it
  finds.
  
  FILE.gox
  FILE.o
  libFILE.so
  libFILE.a
  
  The gccgo compiler will look in the current directory for import files


So I cp the $GOPATH/pkg/github.com/usr/pkg.a to the current directory and rename it as libpkg.a.

It seems failed again:

$ gccgo -c a.go
a.go:9:4: error: libpkg.a: malformed archive header name at 8
a.go:9:4: error: libpkg.a exists but does not contain any Go export data


And yes, I use gccgo 4.7.2

I've got no experience woking with gcc, so I search for some help here.
",1,13544815.0
53,13514184,How can I read a whole file into a string variable in Golang?,"I have lots of small files, I don't want to read them line by line.

Is there a function in Golang to let me read a whole file into a string variable?
",4,13514395.0
54,13814868,Go - net.LookupAddr doesnt execute,"Before I added the feature to accept a input address all works fine.

After splitting of the IP-Addresse into 3 segements and surrender it to the getHostName function, the programm skipps ""all/inclusive of the function"" after the call of the function net.LookupAddr(ip).

package main

import (
    ""fmt""
    ""net""
    ""strconv""
    ""strings""
)

func getHostName(h chan string, ipAdresse string, n int) {
    ip := ipAdresse + strconv.Itoa(n)

    addr, ok := net.LookupAddr(ip)
    fmt.Println(ok)

    if ok == nil {
        h <- ip + "" - "" + addr[0]
    } else {
        fmt.Println(ok)
    }
}

func printer(n chan string) {
    msg := <-n
    fmt.Println(msg)
}

func main() {
    fmt.Println(""Please enter your local IP-Adresse e.g 192.168.1.1"")

    var ipAdresse_user string
    fmt.Scanln(&ipAdresse_user)

    ipsegment := strings.SplitAfter(ipAdresse_user, ""."")
    ipadresse_3 := ipsegment[0] + ipsegment[1] + ipsegment[2]

    host := make(chan string)

    for i := 0; i < 55; i++ {

        go getHostName(host, ipadresse_3, i)
        go printer(host)
    }

    fmt.Println(""Finish - Network Scan"")
}

",1,
55,13846522,GOLang Scanf error,"When using Scanf twice the first time it gets the useres input but the second time it does not and returns out of the function. This is only a problem when running on Windows. When I run it on my Mac it works as expected first asking the uers for their username then their password. Below is the code in questions. I am not sure why it works fine on Mac but not on Windows. Any help in advance is appreciated. Thank you.

func credentials() (string, string) {

    var username string
    var password string

    fmt.Print(""Enter Username: "")
    fmt.Scanf(""%s"", &username)

    fmt.Print(""Enter Password: "")
    fmt.Scanf(""%s"", &password)

    return username, password
}

",1,13846899.0
56,13870845,Converting from an integer to its binary representation,"Has anyone got an idea if there is any inbuilt functionality in Go for converting from any one of the numeric types to its binary number form.

For example, if 123 was the input, the string ""1111011"" would be the output.
",4,13870865.0
57,14061633,Why does the channel type have a '<-' in it?,"This works.

var tick <-chan time.Time = time.Tick(1e8)


However, this does not.

var tick chan time.Time = time.Tick(1e8)


Why do I need a  in my type declaration for a channel? I thought that  was for writing to or reading from a channel. Why would it appear in a type?
",3,14061714.0
58,14150985,Go: quoted string in templates,"I want to put in my html template (actually JavaScript part) null or string with email:

var email = null;
// or a string:
var email = ""somebody@somewhere.com"";


But with template

var email = {{.Email}};


I get quoted string everytime:

var email = ""null"";
var email = ""somebody@somewhere.com"";


How to fix it?

EDIT: here is my code: http://play.golang.org/p/8k4s8dv2PE

You can see Go surrounds string with quotes and removes comment - there is pre or post processing.
",1,
59,14151976,Google Go not generating unique identifiers?,"I'm trying to persist entities, and allow the database to generate a key.  Unfortunately, I can't seem to tease a synthetic ID out of the API...  Here's what I'm doing:

case ""POST"":
    d,_ := ioutil.ReadAll( r.Body)
    participant := new(Participant)
    err := json.Unmarshal( d, &participant)
    if err != nil {
        serveError( c, w, err)
        return
    }

    var key *datastore.Key;
    if participant.ID == 0 {
        // no id yet .. create an incomplete key and allow the db to create one.
        key = datastore.NewIncompleteKey( c, ""participant"", parentKey)
    } else {
        // we have an id.  use that to update
        key = datastore.NewKey( c, ""participant"", """", participant.ID, parentKey)
    }
    // PERSIST!
    putKey, e := datastore.Put( c, key, participant)
    if e != nil {
         serveError( c, w, e)
         return
    }

    // Fetch back out of the database, presumably with my new ID
    if e = datastore.Get( c, putKey, participant); e != nil {
         serveError( c, w, e)
         return
    }

    // send to the consumer
    json,_ := json.Marshal( participant)
    w.Write( json)


Well, oddly enough the ID is always zero!  The details are persisted, but I get multiple values persisted with the same ID field.  For grins, here's the object definition:

type Participant struct {
    ID         int64
    LastName   string
    FirstName  string
    Birthdate  string
    Email      string
    Cell       string
}


Following up with a GET operation, I am presented a list of entities (yes, the entities I created, as many times as I created them) all with the ID of zero.

[
 {""ID"":0,""LastName"":""Schmuck"",""FirstName"":""Joe"",""Birthdate"":""12-12-12"",""Email"":"""",""Cell"":""""},
 {""ID"":0,""LastName"":""Schmuck"",""FirstName"":""Jane"",""Birthdate"":""12-12-12"",""Email"":"""",""Cell"":""""},
 {""ID"":0,""LastName"":""Schmuck"",""FirstName"":""Jane"",""Birthdate"":""12-12-12"",""Email"":"""",""Cell"":""""},
 {""ID"":0,""LastName"":""Schmuck"",""FirstName"":""Jane"",""Birthdate"":""12-12-12"",""Email"":"""",""Cell"":""""},
 {""ID"":0,""LastName"":""Schmuck"",""FirstName"":""Jane"",""Birthdate"":""12-12-12"",""Email"":"""",""Cell"":""""},
 {""ID"":0,""LastName"":""Schmuck"",""FirstName"":""Jane"",""Birthdate"":""12-12-12"",""Email"":"""",""Cell"":""""}
]


For completeness, I've also tried using the NewKey() with an ID value of zero, but that was giving the same result.  The API documentation about NewKey says something about the (string) name and ID both being zero creating an incomplete key -- I'm not sure how to make a string zero, but nil doesn't work.

Somebody help me figure out what is probably amazingly obvious once pointed to the correct section of the document.
",2,14152356.0
60,14234224,How to build thrift4go?,"I'm new in GO.
I have decide to use implementation of Thrift for Go.
After reading manual installation instruction steps I have 
downloaded last Thrift  0.9.0 from git and start building process:

My build script is follow:

#!/bin/bash
export THRIFT=$(pwd)/thrift
export THRIFT4GO=$(pwd)/thrift4go
export GOROOT=/usr

bash $THRIFT4GO/scripts/merge_and_build.sh -b

cd $THRIFT
#./cleanup.sh
./bootstrap.sh
./configure --with-go --without-python --without-csharp

make
if ""$?"" == ""1""; then
    ln -s $THRIFT/lib/go/src/thrift $GOPATH/src/thrift
    go install thrift
fi


But make doesn't work well for GO, whereis the problem ?
I have correct installed GO with exported GOPATH variable in bash, ""go install"" worked for other projects.
I can't understand why GO can't find package.

Making all in go
make[3]: Entering directory `/home/user/projects/delkon/thrift/lib/go'
make  check-local
make[4]: Entering directory `/home/user/projects/delkon/thrift/lib/go'
go build -v -x thrift
WORK=/tmp/go-build548238117
src/thrift/tiostream_transport.go:23:2: import ""bufio"": cannot find package
src/thrift/tframed_transport.go:23:2: import ""bytes"": cannot find package
src/thrift/tmap.go:24:2: import ""container/list"": cannot find package
src/thrift/tjson_protocol.go:23:2: import ""encoding/base64"": cannot find package
src/thrift/tbinary_protocol.go:23:2: import ""encoding/binary"": cannot find package
src/thrift/tsimple_json_protocol.go:26:2: import ""encoding/json"": cannot find package
src/thrift/tapplication_exception.go:23:2: import ""errors"": cannot find package
src/thrift/tcompact_protocol.go:24:2: import ""fmt"": cannot find package
src/thrift/tbinary_protocol.go:24:2: import ""io"": cannot find package
src/thrift/ttransport.go:23:2: import ""log"": cannot find package
src/thrift/tbinary_protocol.go:25:2: import ""math"": cannot find package
src/thrift/tnonblocking_server_socket.go:23:2: import ""net"": cannot find package
src/thrift/thttp_client.go:24:2: import ""net/http"": cannot find package
src/thrift/thttp_client.go:25:2: import ""net/url"": cannot find package
src/thrift/ttransport.go:24:2: import ""os"": cannot find package
src/thrift/tmap.go:25:2: import ""reflect"": cannot find package
package thrift
imports runtime: import ""runtime"": cannot find package
src/thrift/tfield.go:23:2: import ""sort"": cannot find package
src/thrift/thttp_client.go:26:2: import ""strconv"": cannot find package
src/thrift/tbinary_protocol.go:26:2: import ""strings"": cannot find package
src/thrift/tnonblocking_socket.go:24:2: import ""time"": cannot find package
make[4]: *** [check-local] Error 1
make[4]: Leaving directory `/home/user/projects/delkon/thrift/lib/go'
make[3]: *** [check-am] Error 2
make[3]: Leaving directory `/home/user/projects/delkon/thrift/lib/go'
make[2]: *** [all-recursive] Error 1
make[2]: Leaving directory `/home/user/projects/delkon/thrift/lib'
make[1]: *** [all-recursive] Error 1
make[1]: Leaving directory `/home/user/projects/delkon/thrift'
make: *** [all] Error 2


Thank you for any input
p.s
Arch linux (X86, 64)

upd
The problem was when thrift cloned from GIT, use https://dist.apache.org/repos/dist/release/thrift/0.9.0/thrift-0.9.0.tar.gz version instead
",1,14234709.0
61,14236263,"When should a type be a struct containing another type and when should it just ""extend""(?) that type?","I'm currently learning Go by doing the rosalind problems (basically a bunch of bioinformatics related code katas). 

I'm currently representing a DNA strand with a type:

type DNAStrand struct {
    dna byte[]
}


My initial reason was to encapsulate the byte slice so I would know it only contained bytes representing the nucleotides: 'A', 'C', 'G', 'T'. I realized that this was obviously not guarateed since I could simply do:

DNAStrand{[]byte(""foo bar"")}


And there is no longer any guarantee that my dna strand contains a byte array with only elements from those four bytes.

Since my struct only contains a byte array is it better/more ideomatic to do:

type DNAStrand []byte


Or is it better to let the type contain the dna strand? Are there any rules of thumb for when to use either of the two approaches?
",3,14236499.0
62,14249217,"How do I know I'm running within ""go test""","When I run ""go test"", I want to use a different configuration file. How do I know within my code if I'm running within a test context or a normal context? Is there some sort of environment variable to check?
",4,
63,14322674,"Google App Engine logout of app only, not entire google account","I have created a logout url with the users api: https://developers.google.com/appengine/docs/go/users/overview

But I only want it to disconnect them from my app, not log them out of their other Google services (Gmail etc). Is that possible?
",1,14322756.0
64,14322724,What is the Go language garbage collection approach compared to others?,"I do not know much about the Go programming language, but I have seen several claims that said Go has latency-free garbage collection, and it is much better than other garbage collectors (like JVM garbage collector). I have developed application for JVM and i know that JVM garbage collector is not latency-free (specially in large memory usage). 

I was wondering, what is difference between the garbage collection approach in Go and and the others which make it latency-free?

Thanks in advance.



Edit:
@All I edited this question entirely, please vote to reopen this question if you find it constructive.
",1,
65,14427830,Convert string to time or create a time constant,"This is maybe a stupid question to ask but I can't seem to find how to convert date in string format to date time format. Many thanks!

s := ""12-25-2012""
var t time.Time

t = s.Time() ??? 


I would like t to contain the value of s.
",2,14427956.0
66,14440369,"What does the Go compiler mean by ""no such file or directory""?","I'm trying to compile a Go program made up of multiple modules, like so:

// main.go
package main
import ""mst""
// do something interesting involving minimum spanning trees

// src/mst/kruskal.go
import ""disjsets""
// Kruskal's algorithm follows

// src/disjsets/disjsets.go
// implements disjoint sets with union-find


Now, when I run either go run main.go or go build after export GOPATH=. in the directory containing both main.go and src, it prints

# disjsets
open src/disjsets/disjsets.go: No such file or directory


I don't get this. The file is there as ls -l src/disjsets/disjsets.go confirms. How can this happen? Where should the disjsets.go file live if Go is to find it?

(Google Go 1.0.2)
",2,14440697.0
67,14477941,"read ""SELECT *"" columns into []string in go","I want to write a Go program to dump rows from from a database table into a csv file using SELECT *.

Go provides the excellent sql and csv apis, but csv expects arrays of strings and the Scan method in Rows ""fills"" fields according to their types.
As I don't know the table before, I have no idea how many columns there are and what their types are.

It's my first program in Go, so I'm struggling a little.

How do I best read the columns from a Rows instance into a []string - and is that the ""right"" way?

Thanks!

UPDATE

I'm still struggling with the parameters. This is my code, for now I'm using panic instead of returning an error, but I'm going to change that later. In my test, I'm passing the query result and os.Stdout.

func dumpTable(rows *sql.Rows, out io.Writer) error {
    colNames, err := rows.Columns()
    if err != nil {
        panic(err)
    }
    if rows.Next() {
        writer := csv.NewWriter(out)
        writer.Comma = '\t'
        cols := make([]string, len(colNames))
        processRow := func() {
            err := rows.Scan(cols...)
            if err != nil {
                panic(err)
            }
            writer.Write(cols)
        }
        processRow()
        for rows.Next() {
            processRow()
        }
        writer.Flush()
    }
    return nil
}


For this, I get cannot use cols (type []string) as type []interface {} in function argument (at the writer.Write(cols) line.

I then tested

    readCols := make([]interface{}, len(colNames))
    writeCols := make([]string, len(colNames))
    processRow := func() {
        err := rows.Scan(readCols...)
        if err != nil {
            panic(err)
        }
        // ... CONVERSION?
        writer.Write(writeCols)
    }


which lead to panic: sql: Scan error on column index 0: destination not a pointer.

UPDATE 2

I independently arrived at ANisus' solution. This is the code I'm using now.

func dumpTable(rows *sql.Rows, out io.Writer) error {
    colNames, err := rows.Columns()
    if err != nil {
        panic(err)
    }
    writer := csv.NewWriter(out)
    writer.Comma = '\t'
    readCols := make([]interface{}, len(colNames))
    writeCols := make([]string, len(colNames))
    for i, _ := range writeCols {
        readCols[i] = &writeCols[i]
    }
    for rows.Next() {
        err := rows.Scan(readCols...)
        if err != nil {
            panic(err)
        }
        writer.Write(writeCols)
    }
    if err = rows.Err(); err != nil {
        panic(err)
    }
    writer.Flush()
    return nil
}

",3,14500756.0
68,14776879,Selectively retrieving depending on existence of key in map,"Is it possible to selectively retrieve depending on the existence of keys in a map in mongodb? And if so, how do you go about doing it?

Suppose I have a document that looks like this for example..

{ ""_id"": 1234,
    ""parentfield1"" : {
        ""childfield1"" : { ...},
        ""childfield2"" : { ...},
        ""childfield5"" : { ...}, // There might be many childfields.. > 50
    },
} 


How would I be able to selectively retrieve from the document a/some particular childfields given multiple options to choose from? Some of which may not exist in the document.

i.e. 

input ""childfield1"", ""childfield2"", ""childfield3""

-> output 

{ ""_id"": 1234,
  ""parentfield1"": {
      ""childfield1"" : { ... },
      ""childfield2"" : { ... },
  },
}


Is it even doable? Is it possible to do efficiently also?
Any help would be great (python, go).
",1,14777001.0
69,15073027,Why is gccgo slower than gc in that particular case?,"I'm sure everyone knowing golang knows that blog post here. 

Reading it again, I wondered if using gccgo instead of go build would increase the speed a bit more. In my typical use case (scientific computations), a gccgo-generated binary is always faster than a go build-generated one.

So, just grab this file: havlak6.go and compile it:

go build havlak6.go -O havlak6_go
gccgo -o havlak6_gccgo -march=native -Ofast havlak6.go


Surprise !

$/usr/bin/time ./havlak6_go
5.45user 0.06system 0:05.54elapsed 99%CPU

$/usr/bin/time ./havlak6_gccgo
11.38user 0.16system 0:11.74elapsed 98%CPU


I'm curious and want to know why an ""optimizing"" compiler does produce slower code.

I tried to use gprof on gccgo generated binary:

gccgo -pg -march=native -Ofast havlak6.go
./a.out
gprof a.out gmon.out


with no luck:

Flat profile:

Each sample counts as 0.01 seconds.
 no time accumulated


As you can see the code has not been actually profiled.

Of course, I read this, but as you can see, the program takes 10+ seconds to execute... The number of samples should be > 1000.

I also tried:

rm a.out gmon.out
LDFLAGS='-g -pg' gccgo -g -pg -march=native -Ofast havlak6.go
./a.out
gprof


No success neither.

Do you know what's wrong? Do you have an idea of why gccgo, with all its optimization routines fails to be faster than gc in this case?

go version: 1.0.2
gcc version: 4.7.2

EDIT:

Oh, I completely forgot to mention... I obviously tried pprof on the gccgo-generated binary... Here is a top10:

Welcome to pprof!  For help, type 'help'.
(pprof) top10
Total: 1143 samples
    1143 100.0% 100.0%     1143 100.0% 0x00007fbfb04cf1f4
       0   0.0% 100.0%      890  77.9% 0x00007fbfaf81101e
       0   0.0% 100.0%        4   0.3% 0x00007fbfaf8deb64
       0   0.0% 100.0%        1   0.1% 0x00007fbfaf8f2faf
       0   0.0% 100.0%        3   0.3% 0x00007fbfaf8f2fc5
       0   0.0% 100.0%        1   0.1% 0x00007fbfaf8f2fc9
       0   0.0% 100.0%        1   0.1% 0x00007fbfaf8f2fd6
       0   0.0% 100.0%        1   0.1% 0x00007fbfaf8f2fdf
       0   0.0% 100.0%        2   0.2% 0x00007fbfaf8f4a2f
       0   0.0% 100.0%        1   0.1% 0x00007fbfaf8f4a33


And that's why I'm looking for something else.

EDIT2:

Since it seems that someone wants my question to be closed, I did not try to use gprof out of the blue: https://groups.google.com/d/msg/golang-nuts/1xESoT5Xcd0/bpMvxQeJguMJ
",2,
70,15102643,Require help in understanding buffered channels,"I'm having a hard time understanding how buffered channels work. Based on the following example, i'm trying to utilize 2 threads at a time to print out the current time, with approximately 2 second delays between every 2 go calls:

package main
import ""fmt""
import ""time""

func main() {
    returnCurrentTime := func() string  {
        return time.Now().String()
    }

    c := make(chan string, 2)

    asyncReturnCurrentTime := func(c chan string) {
        time.Sleep(2001 * time.Millisecond)
        c <- returnCurrentTime()
    }

    for i := 1; i != 7; i++ {
        go asyncReturnCurrentTime(c)
        if(i % 3 == 0) {
            fmt.Println(<- c)
            fmt.Println(<- c)
            fmt.Println(<- c)
            fmt.Println()
        }
    }
}


This produces

2013-02-27 03:17:50
2013-02-27 03:17:50
2013-02-27 03:17:50

2013-02-27 03:17:52
2013-02-27 03:17:52
2013-02-27 03:17:52


What i'm expecting regarding the seconds is 2 second delays between ever 2 go calls and in this case the following result

2013-02-27 03:17:50
2013-02-27 03:17:50
2013-02-27 03:17:52 <- 3rd call with 2 buffer slots

2013-02-27 03:17:54
2013-02-27 03:17:54
2013-02-27 03:17:56 <- 3rd call with 2 buffer slots


Obviously i misunderstood the concept of buffered channels, would somebody please be kind enough to explain the fault in my logic and how to achieve the expected result?

Thank you
",1,15103151.0
71,15295522,Go - What is really a multipart.File?,"In the docs it is said that 


  If stored on disk, the File's underlying concrete type will be an
  *os.File.


In this case everything is clear. Great. But, what happens if not, if the file is stored in memory?

My actual problem is that I´m trying to get the size of the different files stored in memory that I got though an html form but I can not use os.Stat to do fileInfo.Size() because I don´t have the location of the file, just it´s name.

fhs := req.MultipartForm.File[""files""]
for _, fileHeader := range fhs {
    file, _ := fileHeader.Open()
    log.Println(len(file)) // Gives an error because is of type multipart.File
    fileInfo, err  := os.Stat(fileHeader.Filename) // Gives an error because it´s just the name, not the complete path

    // Here I would do things with the file
}

",3,15311116.0
72,15452004,My structures are not marshalling into json,"I am using Go 1.0.3 on Mac OS X 10.8.2, and I am experimenting with the json package, trying to marshal a struct to json, but I keep getting an empty {} json object.

The err value is nil, so nothing is wrong according to the json.Marshal function, and the struct is correct. Why is this happening?

package main

import (
  ""encoding/json""
  ""fmt""
)

type Address struct {
  street string
  extended string
  city string
  state string
  zip string
}

type Name struct {
  first string
  middle string
  last string
}

type Person struct {
  name Name
  age int
  address Address
  phone string
}

func main() {
  myname := Name{""Alfred"", ""H"", ""Eigenface""}
  myaddr := Address{""42 Place Rd"", ""Unit 2i"", ""Placeton"", ""ST"", ""00921""}
  me := Person{myname, 24, myaddr, ""000 555-0001""}

  b, err := json.Marshal(me)

  if err != nil {
    fmt.Println(err)
  }

  fmt.Println(string(b))    // err is nil, but b is empty, why?
  fmt.Println(""\n"")
  fmt.Println(me)           // me is as expected, full of data
}

",2,15452023.0
73,15619225,Creating a large csv file for testing file access,"I want to create a 10 GB file that looks like:

prefix:username:timestamp, number


So an example is like:

login:jbill:2013/3/25, 1


I want to create a 10GB file, by creating random rows like the one above.

How could I do this in Go?

I can have an array of prefixes like:

login, logout, register


And also an array of usernames:

jbill, dkennedy

",2,15622206.0
74,15643388,Any library of file system in memory?,"I would like to know if there is any library of file system in memory for c, c++, golang, java, .net

the purpose is to save temp file in memory, not for user access, only for program internal use, so I don't need ram drive.
",4,15643594.0
75,15802695,"What does ""itoa"" stand for in strconv.Itoa?","This might sound like a silly question... But I can't find anywhere what the ""a"" in strconv.Itoa actually stands for. If its taking an integer and turning it into a string, why isn't the function called Itos?
",1,15802707.0
76,15834278,Serving static content with a root URL with the Gorilla toolkit,"I am attempting to use the Gorilla toolkit's mux package to route URLs in a Go web server.  Using this question as a guide I have the following Go code: 

func main() {
    r := mux.NewRouter()
    r.Handle(""/"", http.FileServer(http.Dir(""./static/"")))
    r.HandleFunc(""/search/{searchTerm}"", Search)
    r.HandleFunc(""/load/{dataId}"", Load)
    http.Handle(""/"", r)
    http.ListenAndServe("":8100"", nil)
}


The directory structure is:

...
main.go
static\
  | index.html
  | js\
     | 
  | css\
     | 


The Javascript and CSS files are referenced in index.html like this:

...


...


When I access http://localhost:8100 in my web browser the index.html content is delivered successfully, however, all the js and css URLs return 404s.

How can I get the program to serve files out of static sub-directories?
",5,15835185.0
77,15858658,Do go channels preserve order when blocked?,"I have a slice of channels that all receive the same message:

func broadcast(c <-chan string, chans []chan<- string) {
    for msg := range c {
        for _, ch := range chans {
            ch <- msg
        }
    }
}


However, since each of the channels in chans are potentially being read at a different rate, I don't want to block the other channels when I get a slow consumer. I've solved this with goroutines:

func broadcast(c <-chan string, chans []chan<- string) {
    for msg := range c {
        for _, ch := range chans {
            go func() { ch <- msg }()
        }
    }
}


However, the order of the messages that get passed to each channel is important. I looked to the spec to see if channels preserve order when blocked, and all I found was this:


  If the capacity is greater than zero, the channel is asynchronous: communication operations succeed without blocking if the buffer is not full (sends) or not empty (receives), and elements are received in the order they are sent.


To me, if a write is blocked, then it is not ""sent"", but waiting to be sent. With that assumption, the above says nothing about order of sending when multiple goroutines are blocked on writing.

Are there any guarantees about the order of sends after a channel becomes unblocked?
",4,15858718.0
78,16141467,how to use index inside range in html/template to iterate through parallel arrays?,"I'm executing a template with 2 parallel arrays (same size) and I want to list items from both arrays in parallel, how do I use index inside of range?

this obviously doesn't work:

{{range $i, $e := .First}}$e - {{index .Second $i}}{{end}}

",1,16142329.0
79,16168601,Any good advice about how to avoid import cycle in Go?,"I'm working on a Go project for a month. The good thing is Go is really highly efficient. But after a month of development I've already got thousands lines of code and many packages. To avoid import cycle is a major issue for me that anytime I got a import cycle error, I have no idea where the problem may be at first time.

The Go compiler also only have very simple notice that always not good enough to locate issue quickly like: main.go:7:3: import cycle not allowed. It will only help you to know which file may cause the problem but nothing more deeply. Since import relationship just become more and more complex while code grows, I'm eager to know how to avoid import cycle more efficiently in Go. Any help is much appreciated.
",2,16169115.0
80,16916464,"In Go, how can I get the TypeOf a type using an anonymous field method?","How do I get the correct Type of the struct using the anonymous field (or superclass)?

I am trying to make this fish describe itself as a cod:

package main

import (
    ""fmt""
    ""reflect""
)

type Fish struct {
}

func (self *Fish) WhatAmI() string {
    return reflect.TypeOf(self).String()
}

type Cod struct {
    Fish
}

func main() {
    c := new(Cod)
    fmt.Println(""I am a"", c.WhatAmI())
}


The output I get is:

I am a *main.Fish


What I want is:

I am a *main.Cod

",2,16916602.0
81,16931499,"In Go Language, how do I unmarshal json to array of object?","I have the following JSON, and I want to parse it into array of class:

{
    ""1001"": {""level"":10, ""monster-id"": 1001, ""skill-level"": 1, ""aimer-id"": 301}
    ""1002"": {""level"":12, ""monster-id"": 1002, ""skill-level"": 1, ""aimer-id"": 302}
    ""1003"": {""level"":16, ""monster-id"": 1003, ""skill-level"": 2, ""aimer-id"": 303}
}


Here is what i am trying to do but failed:

type Monster struct {
    MonsterId  int32
    Level      int32
    SkillLevel int32
    AimerId    int32
}


type MonsterCollection struct {
    Pool map[string]Monster
}

func (mc *MonsterCollection) FromJson(jsonStr string) {
    var data interface{}
    b := []byte(jsonStr)
    err := json.Unmarshal(b, &data)
    if err != nil {
        return
    }

    m := data.(map[string]interface{})

    i := 0
    for k, v := range m {

        monster := new(Monster)
        monster.Level = v[""level""]
        monster.MonsterId = v[""monster-id""]
        monster.SkillLevel = v[""skill-level""]
        monster.AimerId = v[""aimer-id""]

        mc.Pool[i] = monster
        i++
    }

}


The compiler complain about the  v[""level""] 

",2,16931866.0
82,16931561,go fmt.Scan into Array,"The fmt package has a Scan function that reads stdin, and writes consecutive space separated values to the variables you provide. Is there a way to use this with Slices, so that I could create a slice of sice n, and have scan read n values and put them into the slice?
",1,16937083.0
83,17004405,How can I render a template in Go without any variables?,"I've loaded a template file into memory with the following code:

t := template.New(""master"")
tpl, err := t.ParseFiles(""templates/index.html"")


Now I want to draw that template into a string, so my index.html is pretty empty:

{{define ""master""}}
Hello World
{{end}}


I'm just starting out, so I don't have any data yet. Is there a way I can convert the Template object into a string without data?
",2,
84,17086309,Handling Go Git repositories and its non-code resources,"I'm new to Go and I'm struggling to find the best way to handle Git repositories.

At this moment I'm using the Go's official proposed directories structure, but I think it has many pitfalls.

It's something like

$GOPATH
  bin
    non-important-stuff
  pkg
    non-important-stuff
  src
    github.com
      username
        reponame


The case is that i have many non-code resources, like default settings files, html templates and images... but it seems a little weird to me place it in the ""src/github.com/username/reponame"" directory (because the first ""src"" part).

What are the most common solutions to this problem?

Another problem I'm facing now is that I don't know the most common ""make"" tools to build an entire project with external resources like default settings files or html (the ""go build/install"" commands only take care of source code files). How do you take care of relative paths when the executable is ""installed""?

Disclaimer: I've read this thread: How to access resource files after the 'go' tool installed the executable? , but I didn't see reliable solutions. My executable is a server, and it's not an option to embed the settings files and recompile every time I want to reconfigure the server (and its not an option to pass all the settings parameters via execution parameters, because the settings file is very complex).
",1,
85,17208763,Why is my Go program performing much worse than expected in the following scenario?,"I was solving a simple question in C, Go, and Python and comparing the results. The solution is simply supposed to have two equations inside an if-else block. The following are the code for my solution in:

C

python

go

I was comparing the way the three languages deal with floating point results and hence made this script to generate the test cases and this to compare the results, two at a time. 

The weird thing is the time it takes to run the first 3 scripts. The C program obviously runs within a couple of seconds. Python takes around 2.5-3 seconds. However, Go is taking around 24-25 seconds to run the program on the test cases generated by the generate_test_cases.py script.

I thought Go would be somewhere between C and Python as far as running time is concerned.  Am I doing something inefficiently with my Go code, and if so, what?

P.S. I also ran the above three programs without the file handling operations, and still the same result, i.e., Go takes an extraordinarily long time compared to the other two.
",2,17209612.0
86,17222021,Google App Engine Golang - how to get user's IP address?,"I want to integrate ReCAPTCHA to my GAE Golang web application. In order to verify a captcha, I need to get user's IP address. How can I fetch user's IP address from a form post?
",4,17222252.0
87,17266532,CSS selector or HTML parser for go?,"Is there anything like fizzler, htmlagilitypack or beautifulsoup for go?

I want to do something like doc.load(html); aelements:=doc.SelectAll(""a"") in go
",1,17266948.0
88,17383554,Go: Modelling general JSON arrays in a struct possible?,"I want to be able to Marshal/Unmarshall a struct

type MyType struct {
    Items       `json:""item""`
}


Where an example JSON document it must be able to handle is

{""items"":[""value1"", {""x"":""y""}, ""value3""]}


I am only starting to learn Go.  I am starting to think I might need to impose some restrictions on the structure of the array.  Using the above example, my idea would be

{""items"":[
    {""type"":null, ""value"":""value1""}
    {""type:""x"", ""value"":""y""},
    {""type"": ""value3"", ""value"":""value3""}
]}


Then modelling the objects inside with their own struct.  I'd rather do it the first way, is it possible?
",1,17383819.0
89,17574770,"In go, how to create a constructor for a type without any arguments","Given this type

type Response map[string]interface{}


I created a method NewResponse which fills in the default values:

 func NewResponse() Response {
    resp := Response{""status"": 200, ""msg"": ""Added jobs to queue""}

    resp_metadata := make(map[string]string)
    resp_metadata[""base""] = ""api/v1""
    resp_metadata[""self""] = ""/crawler/jobs/add""
    resp[""metadata""] = resp_metadata
    return resp
}


which i call like NewResponse() but I would like to do Response.New() instead, so the method signature should be like this

func (Response) New() Response {


but then I always get the error not enough arguments in call to Response.New.

So, how could this be implemented? 
",3,17575156.0
90,17595502,What is the best way to group errors in go?,"I was looking at net/http and crypto/x509

I wondering which approach is better and why.

net/http/http.go uses strings:

// HTTP request parsing errors.
type ProtocolError struct {
  ErrorString string
}

func (err *ProtocolError) Error() string { return err.ErrorString }

var (
  ErrHeaderTooLong        = &ProtocolError{""header too long""}
  ErrShortBody            = &ProtocolError{""entity body too short""}
  ErrNotSupported         = &ProtocolError{""feature not supported""}
  ErrUnexpectedTrailer    = &ProtocolError{""trailer header without chunked transfer encoding""}
  ErrMissingContentLength = &ProtocolError{""missing ContentLength in HEAD response""}
  ErrNotMultipart         = &ProtocolError{""request Content-Type isn't multipart/form-data""}
  ErrMissingBoundary      = &ProtocolError{""no multipart boundary param in Content-Type""}
)


crypto/x509/verify.go uses ints:

type InvalidReason int

const (
  TooManyIntermediates
  IncompatibleUsage
)

type CertificateInvalidError struct {
  Cert   *Certificate
  Reason InvalidReason
}

func (e CertificateInvalidError) Error() string {
  switch e.Reason {
  case TooManyIntermediates:
    return ""x509: too many intermediates for path length constraint""
  case IncompatibleUsage:
    return ""x509: certificate specifies an incompatible key usage""
  }
  return ""x509: unknown error""
}

",1,17595735.0
91,18006533,Go routine performance maximizing,"I writing a data mover in go.  Taking data located in one data center and moving it to another data center. Figured go would be perfect for this given the go routines.

I notice if I have one program running 1800 threads the amount of data being transmitted is really low

here's the dstat print out averaged over 30 seconds

---load-avg--- ----total-cpu-usage---- -dsk/total- -net/total- ---paging-- ---system--
 1m   5m  15m |usr sys idl wai hiq siq| read  writ| recv  send|  in   out | int   csw 
0.70 3.58 4.42| 10   1  89   0   0   0|   0   156k|7306k 6667k|   0     0 |  11k 6287 
0.61 3.28 4.29| 12   2  85   0   0   1|   0  6963B|8822k 8523k|   0     0 |  14k 7531 
0.65 3.03 4.18| 12   2  86   0   0   1|   0  1775B|8660k 8514k|   0     0 |  13k 7464 
0.67 2.81 4.07| 12   2  86   0   0   1|   0  1638B|8908k 8735k|   0     0 |  13k 7435 
0.67 2.60 3.96| 12   2  86   0   0   1|   0   819B|8752k 8385k|   0     0 |  13k 7445 
0.47 2.37 3.84| 11   2  86   0   0   1|   0  2185B|8740k 8491k|   0     0 |  13k 7548 
0.61 2.22 3.74| 10   2  88   0   0   0|   0  1229B|7122k 6765k|   0     0 |  11k 6228 
0.52 2.04 3.63|  3   1  97   0   0   0|   0   546B|1999k 1365k|   0     0 |3117  2033 


If I run 9 instances of the program with 200 threads each I see much better performance

---load-avg--- ----total-cpu-usage---- -dsk/total- -net/total- ---paging-- ---system--
 1m   5m  15m |usr sys idl wai hiq siq| read  writ| recv  send|  in   out | int   csw 
8.34 9.56 8.78| 53   8  36   0   0   3|   0   410B|  38M   32M|   0     0 |  41k   26k
8.01 9.37 8.74| 74  10  12   0   0   4|   0   137B|  51M   51M|   0     0 |  59k   39k
8.36 9.31 8.74| 75   9  12   0   0   4|   0  1092B|  51M   51M|   0     0 |  59k   39k
6.93 8.89 8.62| 74  10  12   0   0   4|   0  5188B|  50M   49M|   0     0 |  59k   38k
7.09 8.73 8.58| 75   9  12   0   0   4|   0   410B|  51M   50M|   0     0 |  60k   39k
7.40 8.62 8.54| 75   9  12   0   0   4|   0   137B|  52M   49M|   0     0 |  61k   40k
7.96 8.63 8.55| 75   9  12   0   0   4|   0   956B|  51M   51M|   0     0 |  59k   39k
7.46 8.44 8.49| 75   9  12   0   0   4|   0   273B|  51M   50M|   0     0 |  58k   38k
8.08 8.51 8.51| 75   9  12   0   0   4|   0   410B|  51M   51M|   0     0 |  59k   39k


load average is a little high but I'll worry about that later.  The network traffic though is almost hitting the network potential.

I'm on Ubuntu 12.04,
8 Gigs Ram,
2.3 GHz processors (says EC2 :P)

Also, I've increased my file descriptors from 1024 to 10240

I thought go was designed for this kind of thing or am I expecting too much of go for this application?

Is there something trivial that I'm missing?  Do I need to configure my system to maximizes go's potential?

EDIT

I guess my question wasn't clear enough. Sorry. I'm not asking for magic from go, I know the computers have limitations to what they can handle. 
So I'll rephrase. Why is 1 instance with 1800 go routines != 9 instances with 200 threads each?  Same amount of go routines significantly less performance for 1 instance compared to 9 instances. 
",2,18022615.0
92,18169071,Debugging App engine with golang -- There has to be a better way?,"I""m (slowly) working on a app-engine app using the go language -- While I like many parts of the experience (the nice integration with google services and the go language itself) but I'm a bit suprised at the lack of debug facilities especially with app engine.

I know that you can log to the console (The lowest form of debugging IMHO) but all attempts at anything more clever (attaching gdb on the local instance) fails. (the build tools for app engine specifically seem to strip debug info)

I can't believe I'm the only one who has observed this so I'm wondering what other folks are doing to develop/debug in app engine?
",3,
93,18187136,net/http ignoring system proxy settings,"I'm using Charles to debug HTTP requests, but it seems that Go's network stack ignores the system proxy settings (on OSX) and the requests are not logged.

How do I tell Go that the requests should use the proxy?
",2,18188477.0
94,18208394,Testing equivalence of maps (Golang),"I have a table-driven test case like this one:

func CountWords(s string) map[string]int

func TestCountWords(t *testing.T) {
  var tests = []struct {
    input string
    want map[string]int
  }{
    {""foo"", map[string]int{""foo"":1}},
    {""foo bar foo"", map[string]int{""foo"":2,""bar"":1}},
  }
  for i, c := range tests {
    got := CountWords(c.input)
    // TODO test whether c.want == got
  }
}


I could check whether the lengths are the same and write a loop that checks if every key-value pair is the same. But then I have to write this check again when I want to use it for another type of map (say map[string]string).

What I ended up doing is, I converted the maps to strings and compared the strings:

func checkAsStrings(a,b interface{}) bool {
  return fmt.Sprintf(""%v"", a) != fmt.Sprintf(""%v"", b) 
}

//...
if checkAsStrings(got, c.want) {
  t.Errorf(""Case #%v: Wanted: %v, got: %v"", i, c.want, got)
}


This assumes that the string representations of equivalent maps are the same, which seems to be true in this case (if the keys are the same then they hash to the same value, so their orders will be the same). Is there a better way to do this? What is the idiomatic way to compare two maps in table-driven tests?
",3,18211675.0
95,18298223,How to check if webpage is accessed from localhost or from outside?,"
How can I check from Go whether a webpage is accessed from localhost or from outside?
How can I disable some functions for external users?
How can I hide the whole site, like ""nope, nothing here, port 8080 is closed, move along"".

",1,18298762.0
96,18343208,How do I reverse sort a slice of integer Go?,"I am trying to reverse-sort a slice of integers in Go.

  example := []int{1,25,3,5,4}
  sort.Ints(example) // this will give me a slice sorted from 1 to the highest number


How do I sort it so that it goes from highest to lowest? so [25 5 4 3 1]

I have tried this 

sort.Sort(sort.Reverse(sort.Ints(keys)))


Source: http://golang.org/pkg/sort/#Reverse

However, I am getting the error below

# command-line-arguments
./Roman_Numerals.go:31: sort.Ints(keys) used as value

",2,18343326.0
97,18398200,"""Bounded"" meaning in programming","I am trying to follow below presentation

http://www.slideshare.net/borderj/concurrency-in-go-10662038

And I found this statement ,


  ""typed BOUNDED blocking""


in here what exactly mean by BOUNDED ?

I tried gooling and found that BOUNDED BUFFER explanations but I am looking for more general understanding 
",1,18399983.0
98,18425465,Enumerating Registry Values in Go (Golang),"I'm trying to enumerate over a list of values in the Windows registry using Go, but I'm running into some trouble.  I've tried two approaches: using both the Go-provided syscall library to call into RegEnumValue, as well as using a Windows API wrapper by lxn.  In both cases, I'm having the same issue.  This is the code I'm using (which is currently using the win library from lxn):

var root win.HKEY
rootpath, _ := syscall.UTF16PtrFromString(""HARDWARE\\DEVICEMAP\\SERIALCOMM"")
fmt.Println(win.RegOpenKeyEx(win.HKEY_LOCAL_MACHINE, rootpath, 0, win.KEY_READ, &root))

var name_length uint32 = 72
var name *uint16
var key_type uint32
var lpData *byte
var lpDataLength uint32 = 72
var zero_uint uint32 = 0
fmt.Println(win.RegEnumValue(root, zero_uint, name, &name_length, nil, &key_type, lpData, &lpDataLength))

win.RegCloseKey(root)


In this case, RegEnumValue always returns code 87, which MSDN's only explanation is ""The parameter is incorrect.""

Does anyone have any ideas that can point me in the right direction for this?
",2,18426453.0
99,18923123,Go http server and global variables,"I have a http server. It is written with Go.
I have this code:

package main
import (
    ""net/http""
    ""runtime""
)
var cur = 0
func handler(w http.ResponseWriter, r *http.Request) {
    cur = cur + 1;
}
func main() {
    runtime.GOMAXPROCS(runtime.NumCPU())
    http.HandleFunc(""/"", handler)
    http.ListenAndServe("":9010"", nil)
}


Is it safe?
May be I need to use a mutex?
",2,18923274.0
100,18926303,Iterate through a struct in Go,"Basically, the only way (that I know of) to iterate through the values of a struct is like this:

type Example struct {
    a_number uint32
    a_string string
}

//...

r := &Example{(2 << 31) - 1, ""....""}:
for _, d:= range []interface{}{ r.a_number, r.a_string, } {
  //do something with the d
}


I was wondering, if there's a better and more versatile way of achieving []interface{}{ r.a_number, r.a_string, }, so I don't need to list each parameter individually, or alternatively, is there a better way to loop through a struct?

I tried to look through the reflect package, but I hit a wall, because I'm not sure what to do once I retrieve reflect.ValueOf(*r).Field(0).

Thanks!
",1,18927729.0
101,18969572,How do I create an OpenGL 3.2 context in Go on MacOS (Lion-10.8),"I'm trying to write an OpenGL application in Go on MacOS, and can't figure out how to create a context with a version higher than OpenGL 2.1

I've tried using multiple OpenGL bindings out there, but settled on github.com/go-gl/gl

The below example will output 2.1 NVIDIA-8.12.47 310.40.00.05f01. What do I need to do to create an OpenGL 3.2 context?

package main

import (
    ""fmt""
    ""github.com/go-gl/gl""
    glfw ""github.com/go-gl/glfw3""
)
func main() {
    //request 3.2 context
    glfw.WindowHint(glfw.ContextVersionMajor, 3)
    glfw.WindowHint(glfw.ContextVersionMinor, 2)
    glfw.WindowHint(glfw.OpenglProfile, glfw.OpenglCoreProfile)
    if !glfw.Init() {
        panic(""glfw init failed"")
    }
    defer glfw.Terminate()

    //create and set window context
    window, err := glfw.CreateWindow(64, 64, ""foo"", nil, nil)
    if err != nil {
        panic(err)
    }
    window.MakeContextCurrent()

    //check version
    version := gl.GetString(gl.VERSION)
    fmt.Println(version)
}

",1,18973915.0
102,19087603,"What is the best way to model a ""superclass method implementation"" in Go?","I am looking to translate a ""classic OO"" example into Go, one in which a set of subclasses implement some methods on their own but they share an implementation of some methods via their superclass.  I'm well aware of how to use Go's interfaces and I've even used embedding, but I'm not quite sure what, if any, idioms to employ to capture this intended behavior.

Here's a concrete, and probably a very familiar example.  I'll use Ruby.  There are two kinds of animals, dogs and cows.  All animals have a name and they can speak.  The way you set and get the same is the same regardless of the animal type; the sound they make differs depending on the subclass.  Now there is a speak method which is the same for all animals, but it delegates to the subclass's sound method.  Here it is in Ruby:

class Animal
  def initialize(name); @name = name; end
  def speak; puts ""#{@name} says #{sound()}""; end
end
class Dog < Animal; def sound(); ""woof""; end; end
class Cow < Animal; def sound(); ""mooo""; end; end


How is this best captured in Go?

So far I've tried

type Animal struct {
    name string
}

type Cow struct {
    Animal
}

type Dog struct {
    Animal
}


and I've been able to construct ""animals"" like so:

func (d Dog) sound() string {return ""woof""}
func (c Cow) sound() string {return ""mooo""}

func main() {
    d := Dog{Animal{""Sparky""}}
    c := Cow{Animal{""Bessie""}}
    fmt.Println(d.name)
    fmt.Println(c.sound())
}


But I feel I'm going about this all wrong.  I know I can put sound() in an interface, but then the specific animals are sounders, not really animals.  If Animal becomes the interface, I can't share the name and the speak code.  I realize the designers of Go went with interfaces-only and chose not do directly support this classic OO use case the way we would see it done in Ruby, Python, Java, and so on, but I suspect there should be some idiom or best practice for simulating this.  What is the preferred way of doing so?
",4,19088749.0
103,19122477,How do I get the first Monday of a given month in Go?,"I'm trying to get the first Monday of a given month.

Best way I can come up with is to loop through first seven days and return when .Weekday() == ""Monday"". Is there a better way to do this?
",1,19122746.0
104,19243431,Why process created by exec.Start() quits if its parent is killed by SIGINT?,"I found a strange problem in golang.The program executed by exec.Start() will quit if the parent program is interrupt by the signal os.Interrupt,while the child program will NOT quit if the parent program exit normally.What's the difference between that two conditions?
   For examples:

package main

import ""fmt""
import ""os""
import ""time""
import ""os/exec""

func main(){
    cmd := exec.Command(""sleep"", ""100000"")
    cmd.Env = os.Environ()
    fmt.Println(cmd.Env)
    cmd.Start()

    time.Sleep(1e9*20)
    return
} 


In the later condition the parent of sleep 100000 will be the init process after 20s if we didn't interrupt the main program.
",2,19245284.0
105,19414427,"Go, Golang : Read() function","http://play.golang.org/p/Opb7pRFyMf

    // func (f *File) Read(b []byte) (n int, err error)
    record, err := reader.Read()


Is the Read() function defined in os package?
I am trying to understand this code but cannot find where the Read() function is defined... if that is the one in os package, it returns integer for record variable. But how come it is able to print out the text in the text file?

Thanks~
",1,19414475.0
106,19436860,"Go/Golang Trying to get window information via syscall. (As in EnumWindows, etc.)","Thanks for reading and any comments you may have.

Context:


I've been a UI/R&D dev (prototyping, etc.) for over 20 years and just started server/backend development.
I'm very new to Go - less than 2 months - and have 1) run through much of GoByExample and 2) set up a primitive, working web server on an Amazon EC2 instance.
I created a UI in another language which serves a HUD (Heads Up Display) for another 3rd party application - a game which spawns multiple windows. (Think multiple poker tables running in multiple windows.)
I connected the HUD to a Go client I created.
I use Go to grab OS information because of limitations in the first language.
I want to continue to use Go because I really enjoy it.
I'm on a Windows 7 machine.


Goal(s):


Big picture: When a User moves a window, I want the HUD to move with it.
To do this I need information about the main windows whos WindowText starts with ""Game"".
The ideal would be something like this:

windows: [ { windowHwnd:hwnd, windowText:windowText, windowX:x, windowY:y, windowWidth:width, windowHeight:height },
.
.
.
{ windowHwnd:hwnd, windowText:windowText, windowX:x, windowY:y, windowWidth:width, windowHeight:height } ]



Steps I've taken:


I've grabbed and modified github.com/AllenDang/w32 which I think formats syscall for Go.

When I need an unlisted function from user32.go, I add it.

Tried using GetForegroundWindow and GetWindowText with result, then GetWindow( hwnd, previous ) to just walkthrough everything
Read through:

syscall docs (http://golang.org/pkg/syscall/)
syscall/dll_windows.go
syscall/env_windows.go
syscall/exec_windows.go
syscall/syscall.go
syscall/syscall_windows.go
syscall/syscall_windows_386.go
syscall/syscall_windows_amd86.go
syscall/syscall_windows_test.go
syscall/zsyscall_windows_386.go
syscall/zsyscall_windows_amd86.go
syscall/ztypes_windows.go
syscall/ztypes_windows_386.go
syscall/ztypes_windows_amd86.go

Every potential Window Function at Windows Dev Center
Searched StackExchange, Google, DuckDuckGo
I can see there's something (TestEnumWindows)

line 125 in runtime/syscall_windows_test.go (http://golang.org/src/pkg/runtime/syscall_windows_test.go)
Though this function doesn't exist in syscall_windows_test.go



Questions:


Better solution? In my ignorance I could easily be overlooking some method like: GiveGeoffreyExactlyWhatHeWants()
Am I in the right ballpark?
Is this doable in Go?
What's the right direction to head?
Is this something anybody else needs?

",1,19440853.0
107,19579238,"exec.Command(""date"") not able to find date command","package main

import (
    ""fmt""
    ""log""
    ""os/exec""
)

func main() {
    out, err := exec.Command(""date"").Output()
    if err != nil {
        log.Fatal(err)
    }
    fmt.Printf(""The date is %s\n"", out)
}


This is a code example from the documentation for executing system commands. http://golang.org/pkg/os/exec/#example_Cmd_Output Even on the documentation site the example execute box doesn't run and has the same error:
2009/11/10 23:00:00 exec: ""date"": executable file not found in $PATH

On Windows I get:
exec: ""date"": executable file not found in %PATH%

How do I get commands to work? Do I need to set a path or write out the full path of the command?
",2,19579529.0
108,19580688,Go parser not detecting Doc comments on struct type,"I am trying to read the assocated Doc comments on a struct type using Go’s parser and ast packages. In this example, the code simply uses itself as the source.

package main

import (
    ""fmt""
    ""go/ast""
    ""go/parser""
    ""go/token""
)

// FirstType docs
type FirstType struct {
    // FirstMember docs
    FirstMember string
}

// SecondType docs
type SecondType struct {
    // SecondMember docs
    SecondMember string
}

// Main docs
func main() {
    fset := token.NewFileSet() // positions are relative to fset

    d, err := parser.ParseDir(fset, ""./"", nil, parser.ParseComments)
    if err != nil {
        fmt.Println(err)
        return
    }

    for _, f := range d {
        ast.Inspect(f, func(n ast.Node) bool {
            switch x := n.(type) {
            case *ast.FuncDecl:
                fmt.Printf(""%s:\tFuncDecl %s\t%s\n"", fset.Position(n.Pos()), x.Name, x.Doc)
            case *ast.TypeSpec:
                fmt.Printf(""%s:\tTypeSpec %s\t%s\n"", fset.Position(n.Pos()), x.Name, x.Doc)
            case *ast.Field:
                fmt.Printf(""%s:\tField %s\t%s\n"", fset.Position(n.Pos()), x.Names, x.Doc)
            }

            return true
        })
    }
}


The comment docs for the func and fields are output no problem, but for some reason the ‘FirstType docs’ and ‘SecondType docs’ are nowhere to be found. What am I missing? Go version is 1.1.2.

(To run the above, save it into a main.go file, and go run main.go)
",2,19580785.0
109,19847594,How to reliably detect os/platform in Go,"Here's what I'm currently using, which I think gets the job done, but there's got to be a better way:

func isWindows() bool {
    return os.PathSeparator == '\\' && os.PathListSeparator == ';'
}


As you can see, in my case all I need to know is how to detect windows but I'd like to know the way to detect any platform/os.

Play:

http://play.golang.org/p/r4lYWDJDxL
",2,19847868.0
110,19858664,Mgo-based app code structure dealing with connection pool and tcp timeouts,"I'm curious how should I structure JSON REST API server in Go language with Mgo library. I have dozens of collections related with each other. I've created the gist with sample part of file structure in my current approach.

It works great, but from time to time I encounter downtime caused by this error: ""read tcp 10.168.30.100:37288: i/o timeout"". I suppose that I handle mgo connection pool inapropriately. Are there any examples showing how should I create big applications based on mgo?
",1,19860606.0
111,19906544,How do I do something like numpy's arange in Go?,"Numpy's arange function returns a list of evenly spaced values within a given interval with float steps. Is there a short and simple way to create a slice like that in Go?
",2,19908214.0
112,19958767,Go: running a TCP server on two different ports at the same time?,"I'm trying to create a multi-protocol server using Go. One server is an HTTP server, listening on 80. Another, is a custom-made protocol (over TCP) running on port 8088. Is this possible with Go?
",1,19958942.0
113,20023944,How to invoke a Gurilla Mux handler programmatically?,"I'm trying to invoke a Gurilla Mux handler programmatically in another handler function.  Simply calling that handler function won't work, because it uses mux.Vars().  What I have at hand is a URL.  Therefore, I'm looking for a way to invoke that handler function just as if the user has visited that URL, and I want the response back to further process it.  Does anyone know a way to do it?
",1,
114,20086504,"golang : network response from ioutil.ReadAll() is empty, connection reset by peer","I'm trying to test out performing a simple TCP MODBUS read of a single register from a device emulator.  When running the code it is showing a response of 0 bytes and I get the message ""connection reset by peer"".  Any ideas as to why it's not working?

UPDATE, my request was incorrect, the correct working MODBUS TCP poll code is:

package main

import (
    ""fmt""
    ""net""
)

// TCP MODBUS client
func main() {
    conn, err := net.Dial(""tcp"", ""192.168.98.114:502"")
    if err != nil {
        fmt.Println(err)
    }
    numRegs := 1
    # make a MODBUS TCP request (be careful, the format is different to MODBUS serial)
    request := []byte{0x00, 0x00, 0x00, 0x00, 0x00, 0x06, 0x01, 0x03, 0x00, 0x01, 0x00, 0x01}
    n, err := conn.Write(request)
    if err != nil {
        fmt.Println(err)
    }
    expectedResponseLen := 5 + 2 * numRegs
    response := make([]byte, expectedResponseLen)
    n, err = conn.Read(response)
    conn.Close()
    if err != nil {
        fmt.Println(err)
    }
    for i := 0; i < n; i++ {
        fmt.Printf(""%02x "", response[i])
    }
    fmt.Println(""\n"")
}

",1,20107241.0
115,20154606,Marshall and UnMarshall JSON Content in GoLang,"I have a sample json file which is structured like this 

{
  ""method"":""brute_force"",
  ""bc"":""select * from blah;"",
  ""gc"":[
    ""select sum(year) from blah;"",
    ""select count(*) from table;""
      ]
}


I am trying to write a go program which can read this file and operate of json content.

package main 
import (
    ""fmt""
    ""encoding/json""
    ""io/ioutil""
    )


type Response2 struct {
    method string
    bc string
    gc []string
}

func main() {
    file,_ := ioutil.ReadFile(""config.json"")
    fmt.Printf(""%s"",string(file))

        res := &Response2{}


        json.Unmarshal([]byte(string(file)), &res)
        fmt.Println(res)

        fmt.Println(res.method)
        fmt.Println(res.gc)

}


res.method and res.gc dont print anything. I have no idea on whats going wrong.
",1,20154730.0
116,20163660,Call Go function that accepts a slice of interface A with a slice of struct B (B implements A),"I have the following types:

type Statement interface {
    Say() string
}

type Quote struct {
    quote string
}

func (p Quote) Say() string {
    return p.quote
}

func Replay(conversation []Statement) {
    for _, statement := range conversation {
        fmt.Println(statement.Say())
    }
}


I think I have a fairly good grasp of why a function that accepts a parameter of type []Statement, cannot be called with []Quote; even though Quote implements Statement, []Quote does not implement []Statement. []Statement is not even an interface. It has the type slice of Statement. While Go implicitly converts from a type to an interface type, it does no implicit conversion from a slice of type A to a slice of interface B.

We can convert the quotes to statements explicitly:

conversation := []Quote{
    Quote{""Nice Guy Eddie: C'mon, throw in a buck!""},
    Quote{""Mr. Pink: Uh-uh, I don't tip.""},
    Quote{""Nice Guy Eddie: You don't tip?""},
    Quote{""Mr. Pink: Nah, I don't believe in it.""},
    Quote{""Nice Guy Eddie: You don't believe in tipping?""},
}

// This doesn't work
// Replay(conversation)

// Create statements from quotes
statements := make([]Statement, len(conversation))
for i, quote := range conversation {
    statements[i] = quote
}

Replay(statements)


Now say that Replay is part of a library that wants to go out of its way in how easy it's to use Replay. It allows you to call Replay with any slice of objects as long as those objects implement the Statement interface. To do so it has the following conversion method:

func ConvertToStatements(its interface{}) ([]Statement, error) {
    itsValue := reflect.ValueOf(its)
    itsKind := itsValue.Kind()
    if itsKind != reflect.Array && itsKind != reflect.Slice {
        return nil, fmt.Errorf(""Expected items to be an Array or a Slice, got %s"", itsKind)
    }
    itsLength := itsValue.Len()
    items := make([]Statement, itsLength)
    for i := 0; i < itsLength; i++ {
        itsItem := itsValue.Index(i)
        if item, ok := itsItem.Interface().(Statement); ok {
            items[i] = item
        } else {
            return nil, fmt.Errorf(""item #%d does not implement the Statement interface: %s"", i, itsItem)
        }
    }
    return items, nil
}


Replay looks like this:

func Replay(its interface{}) {
    conversation := ConvertToStatements(its)
    for _, statement := range conversation {
        fmt.Println(statement.Say())
    }
}


We can now call Replay with quotes directly:

Replay(conversation)


Finally, my question: Is there a simpler way to allow Replay to accept a slice of any type A, as long as A implements the Statement interface?
",3,
117,20197563,Loading CSS files from a folder in Go,"I'm trying to build a small web app, and I'd like to have all my CSS files in one folder, and have them load automatically on all web pages (sort of like the Rails asset pipeline). 

I'm using this to serve the css files, but how would I get them to load with all pages?

http.Handle(""/css/"", http.StripPrefix(""/css/"", http.FileServer(http.Dir(""/css/""))))

",2,20202666.0
118,20380157,How Do I Stop a Delayed Task on Appengine?,"I launched a task using the delayed package

The only problem is that the task is failing (ooops!) and is keeping trying it again and again. I am aware of the RetryCount field but I would like to force kill the task myself.

Does anyone knows a way to do it ?
",1,
119,20395562,Go regexp FindAllStringSubmatch,"here is my snippet of code in Go which can be found here http://play.golang.org/p/L1AcgHf3E4.

package main

import (
    ""fmt""
    ""regexp""
)

func main() {
    reg := regexp.MustCompile(""([0-9]+[dh]){2}"")
    str := ""2d3h5d""

    fmt.Println(reg.FindAllStringSubmatch(str, -1))

}


I'd expect the result to be [[2d3h 3h] [3h5d 5d]], but it turned out to be [[2d3h 3h]]. Can you explain why? Thanks in advance.
",1,20396438.0
120,20401873,Remove invalid UTF-8 characters from a string (Go lang),"I get this on json.Marshal of a list of strings:

json: invalid UTF-8 in string: ""...ole\xc5\""


The reason is obvious, but how can I delete/replace such strings in Go? I've been reading docst on unicode and unicode/utf8 packages and there seems no obvious/quick way to do it.

In Python for example you have methods for it where the invalid characters can be deleted, replaced by a specified character or strict setting which raises exception on invalid chars. How can I do equivalent thing in Go?

UPDATE: I meant the reason for getting an exception (panic?) - illegal char in what json.Marshal expects to be valid UTF-8 string.

(how the illegal byte sequence got into that string is not important, the usual way - bugs, file corruption, other programs that do not conform to unicode, etc)
",1,20403220.0
121,20455116,Golang: newbie -- Master-Worker concurrency,"I'm having an issue trying to implement this (all goroutines asleep - deadlock!)
Here's the gist of the code:

var workers = runtime.NumCPU()

func main() {
    jobs := make(chan *myStruct, workers)
    done := make(chan *myStruct, workers)

    go produceWork(file_with_jobs, jobs)
    for i := 0; i < runtime.NumCPU(); i++ {
        go Worker(jobs, done)
    }
    consumeWork(done)
}

func produceWork(vf string, jobs chan *utils.DigSigEntries) {
    defer close(jobs)

    // load file with jobs
    file, err := ini.LoadFile(vf)

    // get data for processing
    for data, _ := range file {
        // ...
        jobs <- &myStruct{data1, data2, data3, false}
    }
}

func Worker(in, out chan *myStruct) {
    for {
        item, open := <-in
        if !open {
            break
        }

        process(item)
        out <- item
    }
    // close(out)   --> tried closing the out channel, but then not all items are processed
    //                  though no panics occur.
}

func process(item *myStruct) {
    //...modify the item
    item.status = true
}

func consumeWork(done chan *myStruct) {
    for val := range done {
        if !val.status {
            fmt.Println(val)
        }
    }
}


I'm mainly trying to understand how to do this without using the sync/Wait stuff -  just pure channels - is this possible?  The goal of this routine is to have a single producer load up items that are processed by N workers - appreciate any pointers / help.
",2,
122,20571280,how can I force division to be floating point in Go?,"I have the following code snippet:

package main

import(""fmt"";""flag"")

func main() {
    var a = flag.Int(""a"",0,""divident"")
    var b = flag.Int(""b"",1,""divisor"")
    flag.Parse()

    fmt.Printf(""%f"",*a / *b )
}


For -a 3 and -b 2 command line arguments, the output is: %!f(int=1)

What is the best / most elegant way to force this division to be floating point?
",3,20571539.0
123,20571822,"In go reflection package, is the call Value.Kind() a syntactic sugar to Value.Type().Kind()?","Both of the reflect.Type interface and reflect.Value type implement the same Kind() method signature, suppose that we have some value object v := reflect.ValueOf(x) 

Is v.Kind() just call v.Type().Kind() ?
",2,20572190.0
124,20628918,"cannot download, $GOPATH not set","I want to install json2csv using go get github.com/jehiah/json2csv but I receive this error:

package github.com/jehiah/json2csv: cannot download, $GOPATH not set. For more details see: go help go path


Any help on how to fix this on MacOS?
",11,20629533.0
125,20714004,Convert Value type to Map in Golang?,"I'm getting this return value from a function call in the ""reflect"" package: 

.

Wondering if I can access the actual map inside the return value and if so, how?

EDIT:

So this is where I'm making the call which returns the Value object. 
It returns [] to which I grab the first object in that array. However, I'm not sure how to convert [] into a regular map. 

view_args := reflect.ValueOf(&controller_ref).MethodByName(action_name).Call(in)

",2,20714739.0
126,20743400,"Go, Press return to continue","I have a program that is taking an array and shuffling it, once it has done this it will print out one of the first value from the shuffled array. Once it prints out the value I want to it display a 'Press return to continue' message will be displayed. This message will presist until the user presses return, then it will get the next value from the shuffled array.

I have a script working fine for the first value but after I press return it just creates empty lines in my terminal.

Here is my example:

package main

import (
    ""bufio""
    ""fmt""
    ""math/rand""
    ""os""
    ""time""
)

func main() {

    users := make(map[int]string)

    users[0] = ""Mike""
    users[1] = ""Paul""
    users[2] = ""Steve""
    users[3] = ""Lawrence""
    users[4] = ""Stephen""
    users[5] = ""James""

    getNextSpeaker(users)

}

func getNextSpeaker(users map[int]string) {
    numUsers := len(users)
    list := randList(1, numUsers)

    for _, element := range list {
        fmt.Println(users[element-1])
        pressAnyKey()
    }

}

func randList(min, max int) []int {
    if max < min {
        min, max = max, min
    }
    length := max - min + 1
    t0 := time.Now()
    rand.Seed(int64(t0.Nanosecond()))
    list := rand.Perm(length)
    for index, _ := range list {
        list[index] += min
    }

    return list
}

func pressAnyKey() string {
    fmt.Println(""Press Return To Continue..."")
    reader := bufio.NewReader(os.Stdin)
    input, err := reader.ReadString('.')
    if err != nil {
        panic(err)
    }

    return input
}


Terminal Output:

$ go run src/RandomMeetingSpeaker/meeting.go
Paul
Press Return To Continue...





etc etc

",1,20743558.0
127,20845256,How can I make use of dnsMsg in golang's net package,"I'm writing a simple golang application that needs to do some decoding of some DNS packets. I noticed that in the net library, there appears to be the perfect implementation in the form of net/dnsmsg.go which contains the right structs, pack / unpack functions etc.

However, the type is marked private (lower case dnsMsg). So it appears that I have no way of using this from within my app.

I'm quite new to golang, so don't know if my only option would be to reimplement net/dnsmsg.go myself, or if there's a better way around this.
",2,27259783.0
128,20909598,Getting Python version using Go,"I'm trying to get my Python version using Go:

import (
    ""log""
    ""os/exec""
    ""strings""
)

func verifyPythonVersion() {
    _, err := exec.LookPath(""python"")
    if err != nil {
        log.Fatalf(""No python version located"")

    }
    out, err := exec.Command(""python"", ""--version"").Output()
    log.Print(out)
    if err != nil {
        log.Fatalf(""Error checking Python version with the 'python' command: %v"", err)
    }
    fields := strings.Fields(string(out))
    log.Print(fields)

}

func main() {
    verifyPythonVersion()
}


This returns empty slices:

2014/01/03 20:39:53 []
2014/01/03 20:39:53 []


Any idea what I'm doing wrong?
",1,20909764.0
129,20930447,"Golang reflect package ""is not a type""","I'm trying to learn interfaces and how I can write a single function to work with different types. I came up with this example where I'm finding the maximum value in either a slice of int or a slice of float32. The code is as follows. I keep getting this error ""t is not a type"". Could someone please tell me what is wrong and how I might go about fixing it?

package main

import ""fmt""
import ""reflect""

var _ = fmt.Println
var _ = reflect.TypeOf

func maxer(s interface{}) interface{} {
    v := reflect.ValueOf(s)
    t := v.Type()

    maxval := s.(t)[0]
    for _, v := range s.(t)[1:] {
        if v > maxval {
            maxval = v
        }
    }
    return maxval
}

func main() {
    fmt.Println(maxer([]int{1, 2, 3, 4}))
    fmt.Println(maxer([]float32{1.1, 2.1, 3.14, 0.1, 2.4}))

",3,
130,20993139,How does goroutines behave on a multi-core processor,"I am a newbie in Go language, so please excuse me if my question is very basic. I have written a very simple code:

func main(){
    var count int // Default 0

    cptr := &count

    go incr(cptr)

    time.Sleep(100)

    fmt.Println(*cptr)
}

// Increments the value of count through pointer var
func incr(cptr *int) {
    for i := 0; i < 1000; i++ {
            go func() {
                    fmt.Println(*cptr)
                    *cptr = *cptr + 1
            }()
      }
    }


The value of count should increment by one the number of times the loop runs. Consider the cases:

Loop runs for 100 times--> value of count is 100 (Which is correct as the loop runs 100 times).

Loop runs for >510 times --> Value of count is either 508 OR 510. This happens even if it is 100000.

I am running this on an 8 core processor machine.
",4,20994420.0
131,21007259,Testing go channel throughput - all goroutines deadlock,"I made a small program to benchmark go channel throughput, however it always deadlocks, I tried very hard but cannot understand why:

package main

import (
    ""fmt""
    ""runtime""
)

const CONCURRENCY = 32
const WORK_PER_WORKER = 100
const TOTAL_WORK = CONCURRENCY * WORK_PER_WORKER

func work() {
    sum := 0
    for i := 0; i < 10000000; i++ {
        sum *= i
    }
}

type WorkItem struct {
    Done chan int
}

func main() {
    runtime.GOMAXPROCS(CONCURRENCY)
    var workQueue [CONCURRENCY]chan *WorkItem
    // initialize workers
    for i := 0; i < CONCURRENCY; i++ {
        workQueue[i] = make(chan *WorkItem)
    }
    // start workers
    for i := 0; i < CONCURRENCY; i++ {
        go func(i int) {
            anItem := <-workQueue[i]
            work()
            anItem.Done <- 1
        }(i)
    }
    completed := make(chan bool, TOTAL_WORK)
    for i := 0; i < TOTAL_WORK; i++ {
        go func(i int) {
            // send work to queues
            workToDo := &WorkItem{Done: make(chan int)}
            workQueue[i/WORK_PER_WORKER] <- workToDo // !! DEADLOCK
            // wait until the work is done
            <-workToDo.Done
            completed <- true
        }(i)
    }
    fmt.Println(""Waiting"")
    for i := 0; i < TOTAL_WORK; i++ {
        <-completed
    }
}

",2,21008704.0
132,21064426,Why does my Go program's memory fluctuate so much?,"I have a Go program that allocates lots of maps and slices. Generally a lot of usage, allocation overhead etc. I run it, it loads a lot of data in, and then I query it with a web service.

After I leave it running, when it's read in all its data and isn't doing any queries (i.e should be stable) I see memory fluctuations. Recently it's reported: 5.42 GB, 5.01 GB and 4.3 GB of real memory. That's a massive fluctuation.

I have about 150 million objects (slices hanging off the main hashtable). That's a lot of little objects. I expect a little fluctuation (although I would never expect memory to increase when no new objects are being allocated and the main thread/s is blocking on a socket).

Possible explanations are


the overhead of lots of small allocations just multiplies any natural fluctuation
some code is allocating objects (although I can't see how)
the Go GC is doing its own paging (?)
I'm using Mac OS, and it's at fault somehow


Is this amount of fluctuation normal / expected?
",2,
133,21201808,How to download a file with resume support?,"Am using golang as a programming tool of choice.

What i wanted to write is a program that downloads large files with resume support utilising range requests in the http headers 
something similar to aria2c.
",1,
134,21268000,Unmarshaling nested JSON objects in Golang,"There are a few questions on the topic but none of them seem to cover my case, thus I'm creating a new one.

I have JSON like the following:

{""foo"":{ ""bar"": ""1"", ""baz"": ""2"" }, ""more"": ""text""}


Is there a way to unmarshal the nested bar property and assign it directly to a struct property without creating a nested struct?

The solution I'm adopting right now is the following:

type Foo struct {
    More String `json:""more""`
    Foo  struct {
        Bar string `json:""bar""`
    } `json:""foo""`
    //  FooBar  string `json:""foo.bar""`
}


This is a simplified version, please ignore the verbosity. As you can see, I'd like to be able to parse and assign the value to

//  FooBar  string `json:""foo.bar""`


I've seen people using a map, but that's not my case. I basically don't care about the content of foo (which is a large object), except for a few specific elements.

What is the correct approach in this case? I'm not looking for weird hacks, thus if this is the way to go, I'm fine with that.
",5,21268855.0
135,21350962,Process command line arguments in go test,"Is there a way to get the command line arguments in go ""tests"",
When you call go test obviously your main is not run, so is there a way to process command line arguments,   

One way would be to use the flags packages and check for the command line arguments in each test or function being tested, but that is not ideal for that you need to do this in lots and lots of places, unlike the way you to it just in main when you run the application.   

EDIT: mainly to down-voters, I imagine you are downvoting the question because you think it is a wrong thing to do, and is against purity of unit-tests,  


not all tests are unit tests
it is very functional not to rely on ""ENV"" variables and actually pass the stuff as arguments in command line,
please put your opinion in the answers so that future generations can benefit,


EDIT 2: for the record I ended up putting an init() function in one of my _test files, and set the variable that is set through flags when the main is called this way.  
",3,21352256.0
136,21373558,Not getting proper data using json encoding for a structure in go language,"//package cluster
package main

import (
""encoding/csv""
""encoding/json""
""fmt""
""io""
""math/rand""
""net""
""os""
""strconv""
""time""
//""bytes""
)

const (
BROADCAST = -1
 )

var outbox, inbox chan *Envelope
var pids [10]int
var ips [10]string

type Envelope struct {
Pid   int
MsgId int64
Msg   interface{}
}

type Server interface {
Pid() int
Peers() []int
Outbox() chan *Envelope
Inbox() chan *Envelope
}

/*
func (envelope Envelope) Pid() int {
return envelope.MsgId
}
*/
var server Envelope

func (envelope Envelope) Peers() []int {
return nil //pids
}

func (envelope Envelope) Outbox() chan *Envelope {
return outbox
}

func (envelope Envelope) Inbox() chan *Envelope {
return inbox
}

func server_() {
// listen on a port
ln, err := net.Listen(""tcp"", "":9999"")
//time.Sleep(time.Second * 2)
if err != nil {
    fmt.Println(err)
    return
}
for {
    c, err := ln.Accept()
    if err != nil {
        fmt.Println(err)
        continue
    } else {
        fmt.Println(""handle"")
        go handleServerConnection(c)
    }
} 
}

func handleServerConnection(c net.Conn) {
// receive the message
var msg Envelope
var b []byte
//  for{
c.Read(b)
/*
    if b == nil{
        continue
    }else{
        break
    }
*/
//  }

fmt.Println(b)
err := json.Unmarshal(b, &msg)
if err != nil { //ERORR !!!!
    fmt.Println(err)
} else {
    fmt.Println(""Received : %+v"", msg)
}
c.Close()
}

func client() {
// connect to the server
for msg := range outbox {
    c, err := net.Dial(""tcp"", ""127.0.0.1:9999"")
    if err != nil {
        fmt.Println(err)
        return
    }

    if err != nil {
        fmt.Println(""error encoding the response to a join request"")
        fmt.Println(err)
    }
    b, _ := json.Marshal(msg)
    fmt.Printf(""the json: %s\n"", b)
    c.Write(b)
    c.Close()
}
time.Sleep(time.Second * 2)
}

func New(myPid int, ConFile string) Envelope {
inbox = make(chan *Envelope, 100)
outbox = make(chan *Envelope, 100)
file, err := os.Open(ConFile)
if err != nil {
    fmt.Println(""Error:"", err)
}
defer file.Close()
reader := csv.NewReader(file)

i := 0
j := 0
for {
    record, err := reader.Read()
    if err == io.EOF {
        break
    } else if err != nil {
        fmt.Println(""Error:"", err)
    }
    x, _ := strconv.Atoi(record[0])
    pids[i] = x
    i++
    ips[j] = record[1]
    j++
}

fmt.Println(""\n"", ips)
fmt.Println(""\n"", pids)
MsgId := rand.Int63n(0x10000000)
server = Envelope{Pid: myPid, MsgId: MsgId, Msg: ""Hello World :)""}

go server_()
go client()
var input string
fmt.Println(""\n\nPress enter ---\n\n"")
fmt.Scanln(&input)
return server
}

func main() {
//for i := 1; i <= 10; i++ {
server := New(12, ""config.txt"")

server.Outbox() <- &Envelope{Pid: BROADCAST, MsgId: server.MsgId, Msg: ""hello there""}
select {
case envelope := <-server.Inbox():
    fmt.Printf(""Received msg from %d: '%s'\n"", envelope.Pid, envelope.Msg)

case <-time.After(2 * time.Second):
    println(""Waited and waited. Ab thak gaya\n"")
}

//fmt.Println(server.Pid, server.MsgId, server.Msg )
//}

}


From client function I am trying to send some data but unable to receive data in handleServerConnection()

my program is written in go language 
help me out 

I have referred most of the examples given in the book and stack overflow 

i am getting an empty object in handleconnection function
",1,22027473.0
137,21460787,nil slice when passed as interface is not nil! Why? (golang),"See this playground: http://play.golang.org/p/nWHmlw1W01

package main

import ""fmt""

func main() {
    var i []int = nil
    yes(i) // output: true
    no(i)  // output: false
}

func yes(thing []int) {
    fmt.Println(thing == nil)
}

func no(thing interface{}) {
    fmt.Println(thing == nil)
}


Why the difference in output between the two functions?
",1,21461032.0
138,21494035,Cannot sign a valid gpg key using golang's openpgp packet,"I want to sign a public key from ascii armor with a private key in go language.For that I developed following code but the problem is when I check the signature in gpg --check-sigs the signature created by code is shown as ""bad Signature"".Please Help as I cant figure out any way of solving it.I have already postd on golang-nuts.I am just learning golang for my college project and I am stuck here,Please help.

    // signer
package main

import (
    ""bytes""
    ""code.google.com/p/go.crypto/openpgp""
    ""code.google.com/p/go.crypto/openpgp/armor""
    ""code.google.com/p/go.crypto/openpgp/packet""
    ""fmt""
)

// This function takes asciiarmored private key which will sign the public key
//Public key is also ascii armored,pripwd is password of private key in string
//This function will return ascii armored signed public key i.e. (pubkey+sign by prikey)
func SignPubKeyPKS(asciiPub string, asciiPri string, pripwd string) (asciiSignedKey string) {
    //get Private key from armor
    _, priEnt := getPri(asciiPri, pripwd) //pripwd is the password todecrypt the private key
    _, pubEnt := getPub(asciiPub)         //This will generate signature and add it to pubEnt
    usrIdstring := """"
    for _, uIds := range pubEnt.Identities {
        usrIdstring = uIds.Name

    }
    fmt.Println(usrIdstring)
    errSign := pubEnt.SignIdentity(usrIdstring, &priEnt, nil)
    if errSign != nil {
        fmt.Println(""Signing Key "", errSign.Error())
        return
    }
    asciiSignedKey = PubEntToAsciiArmor(pubEnt)
    return
}

//get packet.PublicKey and openpgp.Entity of Public Key from ascii armor
func getPub(asciiPub string) (pubKey packet.PublicKey, retEntity openpgp.Entity) {
    read1 := bytes.NewReader([]byte(asciiPub))
    entityList, errReadArm := openpgp.ReadArmoredKeyRing(read1)
    if errReadArm != nil {
        fmt.Println(""Reading Pubkey "", errReadArm.Error())
        return
    }
    for _, pubKeyEntity := range entityList {
        if pubKeyEntity.PrimaryKey != nil {
            pubKey = *pubKeyEntity.PrimaryKey
            retEntity = *pubKeyEntity
        }
    }
    return
}

//get packet.PrivateKEy and openpgp.Entity of Private Key from ascii armor
func getPri(asciiPri string, pripwd string) (priKey packet.PrivateKey, priEnt openpgp.Entity) {
    read1 := bytes.NewReader([]byte(asciiPri))
    entityList, errReadArm := openpgp.ReadArmoredKeyRing(read1)
    if errReadArm != nil {
        fmt.Println(""Reading PriKey "", errReadArm.Error())
        return
    }
    for _, can_pri := range entityList {
        smPr := can_pri.PrivateKey
        retEntity := can_pri
        if smPr == nil {
            fmt.Println(""No Private Key"")
            return
        }

        priKey = *smPr

        errDecr := priKey.Decrypt([]byte(pripwd))
        if errDecr != nil {
            fmt.Println(""Decrypting "", errDecr.Error())
            return
        }
        retEntity.PrivateKey = &priKey
        priEnt = *retEntity
    }
    return
}

//Create ASscii Armor from openpgp.Entity
func PubEntToAsciiArmor(pubEnt openpgp.Entity) (asciiEntity string) {
    gotWriter := bytes.NewBuffer(nil)
    wr, errEncode := armor.Encode(gotWriter, openpgp.PublicKeyType, nil)
    if errEncode != nil {
        fmt.Println(""Encoding Armor "", errEncode.Error())
        return
    }
    errSerial := pubEnt.Serialize(wr)
    if errSerial != nil {
        fmt.Println(""Serializing PubKey "", errSerial.Error())
    }
    errClosing := wr.Close()
    if errClosing != nil {
        fmt.Println(""Closing writer "", errClosing.Error())
    }
    asciiEntity = gotWriter.String()
    return
}

",1,21918434.0
139,21527489,"Go ""inheritance"" - using anonymous type in a struct as a method parameter","I'm trying to firm up the concept of inheritence that Go provides (rather ""composition"" than pure inheritence, perhaps). However, I'm failing to grasp why I can't use the ""parent"" type as a func parameter to produce a generic function that acts on the parameter.

package main

import ""log""

type Animal struct {
    Colour string
    Name string
}

type Dog struct {
    Animal
}

func PrintColour(a *Animal) {
    log.Printf(""%s\n"", a.Colour)
}


func main () {
    a := new (Animal)
    a.Colour = ""Void""
    d := new (Dog)
    d.Colour = ""Black""

    PrintColour(a)
    PrintColour(d)
}


Assuming my understanding's incorrect, how can I achieve what I want in Go?

Edit
Note: 


I don't want to attach the behaviour to the struct
I'd like to keep the pointer type as the method parameter because I'm working separately on a pet project and this requires I manipulate the struct passed in before then acting on it.
In reality my Dog struct would have additional fields/members; hopefully this doesn't muddy the water further

",5,21551995.0
140,21642991,Go: Get an io.ByteReader from a net.Conn,"I am connecting to a TCP/IP server using Go code similar to:

conn, err := net.Dial(""tcp"", host+"":""+strconv.Itoa(port))


Now I need to use binary.ReadVariant which takes an io.ByteReader, so trying to write code like this:

var length int64
var err error
length, err = binary.ReadVarint(conn)


Gives me an error like:

./main.go:67: cannot use conn (type net.Conn) as type io.ByteReader in function argument:
    net.Conn does not implement io.ByteReader (missing ReadByte method)


How can I make this work?
",2,21644134.0
141,21655408,Golang Construct Months for options in html select tag,"I have just started learning Golang and would like to list months in order for a options in an html select tag:

I have started this:

package main

import (
    ""fmt""
)

var months = [12]string{
    ""January"", ""February"", ""March"", ""April"", ""May"", ""June"",
    ""July"", ""August"", ""September"", ""October"", ""November"", ""December"",
}

func main(){
    for i, n := range months {
        fmt.Printf(""%2d: %s\n"", i, n)
    }
}


I would like to print out this:

January
February
March
April
May
June
July
August
September
October
November
December

",2,21656121.0
142,21862622,Golang - How to implement go get within an app that has no internet?,"I am certainly a GO newbie so I will apologize in advance. I am playing around with a GO app that imports martini for example. Every time I run the app, I have to run ""go get github.com/codegangsta/martini"". Any way to NOT have to do this? Either way, how would this work in an offline environment? I am considering GO for an app that will be offline with no internet access. 
",1,
143,21978883,how to define custom mux with golang,"i have viewed source code of mux,but i just want something simple ,not using all features.

i wanna get value of ""id"" in the url like /url/{id},setting the value in the req.Form and clean the path like mux.

code like 

    r:=http.NewServeMux()
    r.HandlerFunc(""/"",func(w http.ResponseWriter,r *http.Request){
        // Clean path to canonical form and redirect.
        if p := cleanPath(req.URL.Path); p != req.URL.Path {
            url := *req.URL
            url.Path = p
            p = url.String()
            //根据HTTP的协议重定向
            w.Header().Set(""Location"", p)
            w.WriteHeader(http.StatusMovedPermanently)
            return
        }
                // some code check the url parse id and set to req.form
    })
            //then add some specific url handlers.


in go doc ,it says long Pattern will take higher priority than short Pattern.
and i want to run something(parse id , clean path etc) before all handlers.

i don't want to give up the features of defaultmux. should i redefine a brand new route,or use http.NewServeMux()? if i use http.NewServerMux(),how should i do to add something while keeping the features? 
",1,
144,22128282,Easy way to check string is in json format in golang?,"I want to create a function to receive an input string which can be string in json format or just a string. For example, something easy like following function.

func checkJson(input string){
   if ... input is in json ... {
      fmt.Println(""it's json!"")
   } else {
      fmt.Println(""it's normal string!"")
   }
}

",6,22129435.0
145,22131865,defer log.SetOutput(os.Stdout) after log.SetOutput(ioutil.Discard),"In go-nsq library (https://github.com/bitly/go-nsq/blob/master/writer_test.go#L38), I found the following code:

log.SetOutput(ioutil.Discard)
defer log.SetOutput(os.Stdout)


Why does the author defer logging to stdout after discard the log?
",1,22132076.0
146,22181660,GO - subroutine behaviour in a for loop,"I'm having some doubts on my understanding of the behaviour of a go subroutine in a for loop.

From what I understand, when we have a for loop:

for key := range Map {
   go subroutine(Map[key])
}


Where Map has, let's say 3 (key,Value) pairs.

So my understanding is that the subroutine() function will run concurrently using all the Map[Key] values ie subroutine(Map[key1]),subroutine(Map[key2]) and subroutine(Map[key3]) will all run concurrently ?

Is my understanding of concurrent subroutines in a for loop correct?

Thanks!
",1,22234956.0
147,22296232,Can (the underlying array of) a slice with large starting index in Go be allocated memory-efficiently?,"I'm trying to use a slice, say mySlice, with a very large starting index. Rather than explicitly subtracting the starting index by always using it as mySlice[index - mySliceStartIndex], I am tempted to simply define the slice in such a way that I can use it without such arithmetic as mySlice[index]. Can this be done without allocating memory for all the unused low indices?

The naive way of doing this, allocating a slice and then reslicing it (e.g. mySlice = mySlice[3*1024*1024*1024:4*1024*1024*1024]) is obviously memory inefficient because the underlying array not only needs to be allocated for the entire range, but remains allocated. does not even work, because afterwards the data formerly at index 3*1024*1024*1024 is now at index 0, whilst my goal is to keep it at the original index.

Can I allocate the slice (or its underlying array) in such a way that indices below the slice's start are not allocated, ideally not even initially?
",1,22298485.0
148,22313317,Serious performance degradation with KyotoCabinet (TreeDB),"I have selected TreeDB as Kyoto Cabinet backend in hope that it will scale to huge values. Unfortunately, there's a problem:

# ./kyotobench
Generated string length: 1024
1000 records, type t 74.008887ms throughput: 13511 /sec
2000 records, type t 145.390096ms throughput: 13756 /sec
4000 records, type t 290.13486ms throughput: 13786 /sec
8000 records, type t 584.46691ms throughput: 13687 /sec
16000 records, type t 1.150792756s throughput: 13903 /sec
32000 records, type t 2.134860729s throughput: 14989 /sec
64000 records, type t 4.378002268s throughput: 14618 /sec
128000 records, type t 9.41012632s throughput: 13602 /sec
256000 records, type t 20.457090225s throughput: 12513 /sec
512000 records, type t 45.934115353s throughput: 11146 /sec
1024000 records, type t 1m39.120917207s throughput: 10330 /sec
2048000 records, type t 3m41.720146906s throughput: 9236 /sec
4096000 records, type t 15m26.041653712s throughput: 4423 /sec
8192000 records, type t 5h5m31.431477812s throughput: 446 /sec


I open a TreeDB, generate 2 random string of random length (0) and use them as key and value, respectively. The code:

http://pastebin.com/0HwHPXFq

What's the reason for this?

UPDATE:

I should have clarified before that I'm not after precise measurement of KyotoDB throughput, but tried to test the scalability of KDB, that is, how r/w throughput behaves with growing number of keys in the db, that is the amortized cost of adding/reading a record.

Creation of 1 random string is amortized O(1), creation of N random strings is amortized O(N). As long as there's constant number of random string creations per 1 DB operation, the penalty it imposes is constant in terms of combined operations per second, and so it has no amortized impact on number of DB operations per second.

I have measured the throughput of random string creation:

1000 strings, type t 65.380289ms throughput: 15295 /sec
2000 strings, type t 130.345234ms throughput: 15343 /sec
4000 strings, type t 259.886865ms throughput: 15391 /sec
8000 strings, type t 519.380392ms throughput: 15402 /sec
16000 strings, type t 1.040323537s throughput: 15379 /sec
32000 strings, type t 1.855234924s throughput: 17248 /sec
64000 strings, type t 3.709873467s throughput: 17251 /sec
128000 strings, type t 7.371360742s throughput: 17364 /sec
256000 strings, type t 14.705493792s throughput: 17408 /sec
512000 strings, type t 29.488131398s throughput: 17362 /sec
1024000 strings, type t 59.46313568s throughput: 17220 /sec
2048000 strings, type t 1m58.688153868s throughput: 17255 /sec
4096000 strings, type t 3m57.415585291s throughput: 17252 /sec
8192000 strings, type t 7m57.054025376s throughput: 17172 /sec


Code: http://pastebin.com/yfVXYbSt

As it could be expected, the cost is O(n). Compare the times as well, e.g. ~8min for 8192000 records when creating random strings and 5h5m when writing them to db. 

UPDATE #2:

This seems to have something to do with unique/colliding keys. In this code: http://pastie.org/8906676  I have used keys and values in a manner analogous to the approach used here: http://blog.creapptives.com/post/8330476086/leveldb-vs-kyoto-cabinet-my-findings (http://www.pastie.org/2295228), i.e. generate ""key"" with linearly incrementing integer suffix (""key1"", ""key2"", etc).

(the updated code also uses transactions every 50,000 writes, this seems to have some impact)

Now the throughput degradation is slow (if actually present at all):

4000 records, type t 10.220836ms throughput: 391357 /sec
8000 records, type t 18.113652ms throughput: 441655 /sec
16000 records, type t 36.6948ms throughput: 436029 /sec
32000 records, type t 74.048029ms throughput: 432151 /sec
64000 records, type t 148.585114ms throughput: 430729 /sec
128000 records, type t 303.646709ms throughput: 421542 /sec
256000 records, type t 633.831383ms throughput: 403892 /sec
512000 records, type t 1.297555153s throughput: 394588 /sec
1024000 records, type t 2.471077696s throughput: 414394 /sec
2048000 records, type t 5.970116441s throughput: 343041 /sec
4096000 records, type t 11.449808222s throughput: 357735 /sec
8192000 records, type t 23.142591222s throughput: 353979 /sec
16384000 records, type t 46.90204795s throughput: 349323 /sec


Once again, pls look at the trend in throughput, not at absolute values.

Theoretically TreeDB is B+ tree so writing a record to it should be ~O(log n).

But it's not. It looks as if there were hash collisions in there somewhere.
",2,
149,22351780,Use package file to write to Cloud Storage?,"Golang provides the file package to access Cloud Storage.

The package's Create function requires the io.WriteCloser interface. However, I have not found a single sample or documentation showing how to actually save a file to Cloud Storage.

Can anybody help? Is there a higher level implementation of io.WriteCloser that would allow us to store files in Cloud Storage? Any sample code? 

We've obviously tried to Google it ourselves but found nothing and now hope for the community to help.
",1,
150,22591198,Eval piece of code stored in DB as string,"I'm moving part of my application from PHP to Go. I'm storing some pieces of code to eval in MySQL, for example: checkGeo('{geo:[""DE"",""AU"",""NL""]}') && check0s('{os:[""android""]}'). In PHP it is easy, just eval($stringToEval), but how can this be done in Go lang?
",3,22591419.0
151,22800353,SQL relationships to json with golang,"Still learning Go.  

If I have a posts and comments table relationship in a mysqp/pg database eg

Post  id, title
Comments  id, post_id, comment


I'd like to have a json representation of this:

{
  id: 1
  title: ""A blog post""
  comments: [
      {id: 1, comment: ""This is comment 1""},
      {id: 2, comment: ""This is comment 2""}
  ]
}


I am able to grab the posts and show the json, just not the comments.  I think I need to have an array of Comment structs in the Post struct.  Just not sure how to tie it all together, particularly the scanning of the rows.

An example showing outputting json from a relationship like this would be great.
",1,22800641.0
152,22824917,Go - Duplicate case in switch statement,"I am new to Go, and while attempting to remove some duplicate code across switch statements I added a case with fallthrough like so:

i := 1
switch i {
case 0, 1:
    fmt.Println(""common code"")
    fallthrough
case 0:
    fmt.Println(""aux for 0"")
case 1:
    fmt.Println(""aux for 1"")
default:
    fmt.Println(""other number"")

}


However, I received an error about the duplicate cases such as:

prog.go:13: duplicate case 0 in switch
    previous case at prog.go:10
prog.go:15: duplicate case 1 in switch
    previous case at prog.go:10


Why is this an error? Is there some way to instruct the compiler to allow such code?
",2,22825063.0
153,22881549,Does delete() instantly frees memory or runtime.GC() is required to free it up?,"I have a map

myMap := map[string]string
myMap['hello'] = 'world'
myMap['foo'] = 'bar'


When I delete an element from myMap like,

delete(myMap['hello'])


Does it instantly frees up memory or does it frees memory after garbage collector is run. 
If it frees up memory after garbage collector is run, Does running runtime.GC() will clean up the memory instantly.

Also is runtime.GC() resource hungry ? or Its okay to run runtime.GC() after every delete() function

Update 2:
Forget what my program does (basically update 1)  
Check this link http://play.golang.org/p/Wb8-4qWyf4 
There is a subroutine to add to a Map every 10 Microsecond 
There is a subroutine to delete from map every 1 Microsecond (10 times faster that adding) 
Run this program in your local machine, you will find that its keeps on occupying more and more RAM slowly. (Slowly because I added a sleep time, otherwise computer will hang)


Update 1

My program fetches 5000 rows of data from database every minute and stores it in a map called datastore.
There are 100 subroutines running which processes each rows from datastore. It takes much time to process one row (less than a second)
If data is successfully processed it is deleted ""delete()"" from datastore, but within next minute next 5000 is fetched and added to datastore.
I am keeping maximum of 20,000 rows in datastore. Which is not much (200 MB at max) 
After processing millions of rows, application start taking 100% of RAM and gets Killed by kernal at the end.
It should not happen if delete() was clearing the memory instantly.
",1,
154,22882934,why does my go channel get blocked ? (deadlock),"It seems that the ""complex"" (getC) function is blocked. I assume the channel is destroyed once it is read therefore I'm wondering how can I share the sC channel with both getC function and the main function without  get into deadlock ( current snippet ) 

package main

func main() {

//simple function and complex function/channel

    sC := make(chan string)
    go getS(sC)

    cC := make(chan string)
    go getC(sC, cC)

//collect the functions result 

        s := <-sC
//do something with `s`. We print but we may want to use it in a `func(s)`
print(s)
//after a while we do soemthing with `c`
        c := <-cC


    print(c)
}

func getS(sC chan string) {
    s :=  "" simple completed ""
    sC <- s
}

func getC(sC chan string, cC chan string) {
//we do some complex stuff
  print(""complex is not complicated\n"")
//Now  we need the simple value so we try wait for the s channel.
    s := <-sC

    c := s + "" more ""
    cC <- c //send complex value
}

",3,
155,22960592,"How do I set up a slot (event handler) that takes parameters, using gtk.go.Connect()?","I am using GTK bindings for Go.

Trying to connect a gtk.RadioButton toggle signal to a function. This code works fine:

...

radioButton.Connect(""toggled"", doRadioToggle)

func doRadioToggle() {
    fmt.Println(""toggled"")
}

...


When radioButton is toggled, doRadioToggle is called - Good.



But I want to connect to a function that takes a parameter, for example:

func doRadioToggle(button *gtk.RadioButton) {
    fmt.Println(button.GetState())
}


The gtk.go.Connect() function has this signature:

func (v *Widget) Connect(s string, f interface{}, datas ...interface{})


Based on what I know from gtkmm, I tried code like this (the go binding has apparently greatly simplified the call to connect())

radioButton.Connect(""toggled"", doRadioToggle, radioButton)


The third argument passed inconnect() - radioButton - corresponding todatasin

gtk.Connect(s string, f interface{}, datas ...interface{})

which I understood to mean data arguments to be passed to the slot.

But with this code, the doRadioToggle() handler never gets called, and I immediately exit with a panic:

panic: reflect: Call using *glib.CallbackContext as type *gtk.RadioButton


My question: How do I set up slot (event handler) that takes parameters using gtk.go.Connect()?
",2,23002384.0
156,23009221,Does Go support type casting/conversion for functions?,"I am writing a library named ""GoRequest"" which wraps around net/http package and is meant for making an easy http client.

Now, I am having a problem with function conversion which has similar types as its parameters. Here is my problem snippet.

type Request *http.Request
type Response *http.Response

func (s *SuperAgent) RedirectPolicy(policy func(req Request, via []Request) error) *SuperAgent {
   s.Client.CheckRedirect = policy
   return s
}


s.Client.CheckRedirect is a member in http.Client struct and should receive func(req *http.Request, via []*http.Request) error

As you might see, I want to convert func(req Request, via []Request) error --> func(req *http.Request, via []*http.Request) which has similar types of parameters.

But it returns me an error:

./main.go:142: cannot use policy (type func(Request, []Request) error) as type func(*http.Request, []*http.Request) error in assignment


I cannot find any document for this kind of conversion and if it's possible, please suggest.
If not, please suggest some other good way to do this. Thanks!
",1,23010085.0
157,23025694,Is there no XOR operator for booleans in golang?,"Is there no XOR operator for booleans in golang?

I was trying to do something like b1^b2 but it said it wasn't defined for booleans.
",2,23025720.0
158,23144556,How to build a C dependency of go project in a subdirectory,"I am writing a Go wrapper for a C library in Go. The problem is, that the C library is not available on many Linux distributions, so I want a solution where i ""go get github.com/me/mylibrary"" does not require anybody to have the library installed.

One solution would be to just add the source of the library into a sub directory. Then when my project is build with go get I need to automatically build this library, too. But I have no idea how I can automate this.

Alternatively I could have a script that downloads the source, extracts and builds it

But I have no Idea how to connect these build steps with the go build tool.

linking a static library is also not the easiest.

#cgo linux LDFLAGS: ./MyLib/lib/libMyLib.a -lstdc++ -lm -lX11


works as long as i build from my library, but as soon as I want to build from another project the relative path is from that project and not from my library, so it fails.
",1,
159,23211648,Polymorphism in Go - does it exist?,"I am trying to make something real simple on Go: to have an interface with getter and setter methods. And it seems setter methods are not allowed. 

Given this code:

package main

import ""fmt""

type MyInterfacer interface {
    Get() int
    Set(i int)
}

type MyStruct struct {
    data int
}

func (this MyStruct) Get() int {
    return this.data
}

func (this MyStruct) Set(i int) {
    this.data = i
}

func main() {
    s := MyStruct{123}
    fmt.Println(s.Get())

    s.Set(456)
    fmt.Println(s.Get())

    var mi MyInterfacer = s
    mi.Set(789)
    fmt.Println(mi.Get())
}


Set method does not work, because in func (this MyStruct) Set(i int),  this MyStruct is not a pointer, and the changes are lost as soon at the function exits. But making it this *MyStruct would not compile. Is there any workaround?
",4,
160,23252387,Threaded CGO using Go 1.2,"Edit: This question is moot.  I misread the date on the commit, it is included in existing versions of the Go tools.  Thanks, James!

It seems that the upcoming release of Go (1.3) will allow non-Go threads to call CGO callbacks.

I'm wondering what people have typically done to get around this restriction to date.

That is, I have a third party library that creates threads on its own, and I would like to get some information from those threads into the Go code.

Some sort of a handoff mechanism from a C thread to a Go thread on the ""C"" side of the code?  Some way to get a message onto a queue without calling into Go?  Other ideas?
",1,23258993.0
161,23255748,Go - Idiomatic way to return (potentially shadowed) variables which have been defined as part of a separate multiple variable return,"Normal Situation

When writing a function with a named return value, you can typically use naked returns (whether or not you should is a separate discussion). They might look something like the following:

func add(x, y int) (z int) {
    z = x + y
    return
}


return here meaning the same as return z

Problematic Situation

However with the abridged snippet below...

func loadModule(moduleName, fileRoot string) (module []byte) {
    if strings.HasSuffix(moduleName, "".md"") {
        module, err := readConvertMDFile(fileRoot + ""htdocs/md/"" + moduleName)
        if err != nil {
            log.Println(err)
        }
        return module
    } else {
        module = []byte{}
        return
    }
}


(This snippet runs fine, and is my current solution to the problem)

... the compiler will complain that module is shadowed if instead of return module there is just return. This is because module was declared (a second time) along with err, which has to be declared as it doesn't exist yet in this scope.

Possible Solutions


Do as I have done and explicitly name the return variable. While this isn't a terrible solution, I feel as though there should be a way to arrange the code so that it runs as it should with a naked return. Others have commented that this explicit return leads to 'code smell'.
Add a var err error at the beginning and use a multiple assignment rather than declaration. Probably a better solution, but I would prefer to use implicit assignment where possible for the sake of consistency and to reduce unnecessary lines.
Use a temporary moduleT variable then assign module = moduleT... this just feels messy and redundant.


While I can get the compiled result I'm looking for, I'm hoping someone can suggest a clear, idiomatic way of writing this.
",2,
162,23561379,How can I post multipart image without to save on disk?,"I need to download an image and upload it on another service. Is it possible to upload it without to save it on disk ? I checked the go docs but I couldn't find any straightforward method not even to upload/post multi part from disk. 
So far I have this non-working code

func upf(file []byte) (url string, err error) {

    URL := ""http:///max.com/upimg""
    b := bytes.Buffer
    writer := multipart.NewWriter(b)

    part, err := writer.CreateFormField(file)
    if err != nil {
        return nil, err
    }

    err = writer.Close()
    if err != nil {
        return nil, err
    }

    return http.NewRequest(""POST"", URL, b)
}

",1,
163,23656621,Mismatched types float64 and int,"I'm trying to create random grades and adding them to a test_scores array. Then calculate the average.

This program:

package main

import (
    ""fmt""
    ""math/rand""
)

func main() {
    i := 0
    var test_scores [5]float64
    for i < len(test_scores) {
        test_scores[i] = rand.Float64()
        i++
    }
    fmt.Println(test_scores)

    var total float64 = 0
    i = 0
    for i < len(test_scores) {
        total += test_scores[i]
        i++
    }
    fmt.Println(total)
    fmt.Println(total / len(test_scores))
}


produces:

main.go:24: invalid operation: total / 5 (mismatched types float64 and int)


This one works fine:

package main

import (
    ""fmt""
    ""math/rand""
)

func main() {
    i := 0
    var test_scores [5]float64
    for i < len(test_scores) {
        test_scores[i] = rand.Float64()
        i++
    }
    fmt.Println(test_scores)

    var total float64 = 0
    i = 0
    for i < len(test_scores) {
        total += test_scores[i]
        i++
    }
    fmt.Println(total)
    fmt.Println(total / 5)
}




The only difference being that in the final line, I'm using a fixed 5 and on the non-working one, I'm using the len(test_scores) call.

Len returns an integer as well, so what's up?
",3,23658470.0
164,23664069,Golang tour distributed pattern,"According to this article, the app-engine front-end and the playground back-end communicate through RPC calls. Each one of app-engine front-end instance and playground instance can be created to support scaling.



I am asking myself what is/are the patterns (solutions) to load balance works between front-end request and back-end instance while keeping RPC.

One solution may be to use one global working queue where tasks are puts inside it with a 'Reply-To' header. This header should point to a per front-end instance queue where responses are put. Something like the following schema (from RabbitMQ tutorial) with rpc_queue shared between back-end instances :


I am not sure this would be a good way to do especially the fact that if the shared queue is offline, the whole system fail (but how to take care of this?).

Thank you.
",1,23747151.0
165,23755985,How to insert multi-value properties on GAE-Datastore in Go?,"I can't find how to work with multiple valued properties on go, in my case I have defined the next struct: 

type trans struct {
    Phone   []string `datastore:""phone""`
    Name    string `datastore:""name,noindex""`
    Manager string `datastore:""manager,noindex""`
    Mail    string `datastore:""email,noindex""`
}


but I want Phone to be multivalued and I don't know how to do it :(

What I want to get is to be able to filter on the multivalued property like this:

datastore.NewQuery(""trans"").Filter(""phone ="", ""+33699999999"").GetAll(c, &mtrans)


but this returns a null from the datastore as if it weren't any entity that matches the filter. But there is an entity that has that phone (among others).
",1,23760913.0
166,24197011,Go ioutil using too many file descriptors/leak?,"I am going through a list of files and Unmarshalling the xml data in them into an array of structs rArray. I intend to process about 18000 files. When I get to about 1300 files processed, the program panics and says that too many files are open. If I limit the amount of files processed to a safe amount of 1000, the program does not crash. 

As seen below, I am using ioutil.ReadFile to read the file data. 

for _, f := range files {

    func() {
        data, err := ioutil.ReadFile(""./"" + recordDir + ""/"" + f.Name())
        if err != nil {
            fmt.Println(""error reading %v"", err)
            return
        } else {
            if (strings.Contains(filepath.Ext(f.Name()), ""xml"")) {

                //unmarshal data and put into struct array
                err = xml.Unmarshal([]byte(data), &rArray[a])
                if err != nil {
                    fmt.Println(""error decoding %v: %v"",f.Name(), err)
                    return
                }
            }
        }
    }()
}


I am not sure if Go is using too many file descriptors or not closing the files fast enough. 

After reading https://groups.google.com/forum/#!topic/golang-nuts/7yXXjgcOikM and viewing the ioutil source in http://golang.org/src/pkg/io/ioutil/ioutil.go, the code for ioutil.ReadFile shows that it uses defer to close the file. defer runs when calling function is returned and ReadFile() is the calling function. Am I correct in this understanding?
I also tried wrapping the ioutil.ReadFile part of my code in a function, but it makes no difference. 

My ulimit is set to unlimited. 

UPDATE: 
I believe that the error of too many files is actually occurring during my Unzip function. 

func Unzip(src, dest string) error {
    r, err := zip.OpenReader(src)
    if err != nil {
        return err
    }

    for _, f := range r.File {
        rc, err := f.Open()
        if err != nil {
            panic(err)
        }

        path := filepath.Join(dest, f.Name)
        if f.FileInfo().IsDir() {
            os.MkdirAll(path, f.Mode())
        } else {
            f, err := os.OpenFile(
                path, os.O_WRONLY|os.O_CREATE|os.O_TRUNC, f.Mode())
            if err != nil {
                panic(err)
            }

            _, err = io.Copy(f, rc)
            if err != nil {
                panic(err)
            }
            f.Close()
        }
        rc.Close()
    }
    r.Close()
    return nil
}


I initially got the Unzip function from https://gist.github.com/hnaohiro/4572580, but upon further inspection, the use of defer in the gist author's function seemed wrong as the file would only be closed after the Unzip() function returned which is too late becuase then 18000 file descriptors will be open. ;) 

I replaced the deferred Closes with explicit Close() as shown above, but am still getting the same ""too many open files"" error. Is there a problem with my modified Unzip function?

UPDATE # 2
Oops, I was running this on Heroku and was pushing to the wrong app with my changes this entire time. Lesson learned: verify target app in heroku toolbelt.

Unzip code from https://gist.github.com/hnaohiro/4572580 does not work as it does not close files until all files processed. 

My unzip code with explicit close above works and so does the defer version in @peterSO's answer. 
",1,24200239.0
167,24292133,Go project with 2 executables,"Hi all I am fairly new to Golang, I am writing a toy client and server app just to learn the libraries.

But I have the project folder:

philipherron@Philips-iMac {~/workspace/gospace/src/github.com/redbrain/station} $ echo $GOPATH
/Users/philipherron/workspace/gospace


I wanted to have 2 binaries:


client.go
server.go


But when I build I get:

philipherron@Philips-iMac {~/workspace/gospace/src/github.com/redbrain/station} $ go build github.com/redbrain/station/
# github.com/redbrain/station
./server.go:5: main redeclared in this block
    previous declaration at ./client.go:5


I guess this is because it looks like I am making to mains in the same package.

So I tried creating a client and a server subdir and have the binaries in each of those, but I get:

philipherron@Philips-iMac {~/workspace/gospace/src/github.com/redbrain/station} $ go build github.com/redbrain/station/client
go install github.com/redbrain/station/client: build output ""client"" already exists and is a directory


I guess this is because I have the layout of:

$ tree
.
├── client
│   └── client.go
└── server
    └── server.go

2 directories, 4 files


Not sure how to get around this, it would just be nice to have the same client and server in the same directory but maybe this is against how I should be doing things in go?
",2,24292325.0
168,24311575,Why does the Go function EncryptOAEP in the crypto/rsa library require a random io.Reader?,"I'm writing a file server that encrypts data on the client side, sends the data over TCP, and decrypts it on server side using asymmetric RSA-OAEP encryption. There are two main functions I have been trying to use, which take the following arguments per the documentation:

EncryptOAEP(hash hash.Hash, random io.Reader, pub *PublicKey, msg []byte, label []byte) (out []byte, err error)
DecryptOAEP(hash hash.Hash, random io.Reader, priv *PrivateKey, ciphertext []byte, label []byte) (msg []byte, err error)


Each requires a random io.Reader, and the test file uses rand.Reader from crypto/rand. However, whenever I encrypt a message with rand.Reader on the client side, the message never is decrypted properly on the server side which has a separate instance of rand.Reader.


What is the purpose of the random io.Reader?
How can I ensure that the encrypted message is transferred and decrypted properly by the server? Would I also need to transfer some information about the rand.Reader used by the client as well to the server for the message to be properly decrypted?

",1,
169,24421326,"What is the point of ""examples"" in the go (golang) testing framework?","I was recently reading on testing and examples in the go testing framework and did not really understand what they were for. I see that the documentation says:


  The package also runs and verifies example code. Example functions may include a concluding line comment that begins with ""Output:"" and is compared with the standard output of the function when the tests are run. (The comparison ignores leading and trailing space.)


However, I don't really appreciate the reason that this would exist. As I write my tests, it seems that it should be more than clear how to use the code just by reading the unit tests and the benchmarks. What additional motivation does the example section provide? It seems redundant to me, however, I am sure that the inventors of go put it for a good reason, specially because they seem to empathizes good programming practice by the design of their language. I hope to understand either their motivation or how this part of language can be used in a positive way in a golang project! :) 
",1,24421402.0
170,24425987,Why is my goroutine not executed?,"I'm learning Go and I wanted to try goroutines and channels.

Here's my code:

package main
import ""fmt""
func main(){

messages := make(chan string,3)

messages <- ""one""
messages <- ""two""
messages <- ""three""

go func(m *chan string) {
    fmt.Println(""Entering the goroutine..."")
    for {
        fmt.Println(<- *m)
    }
}(&messages)

fmt.Println(""Done!"")
}


And here's the result:

Done!


I don't understand why my goroutine is never executed. The ""Entering the goroutine"" is not printed and I don't have any error message.
",2,24426151.0
171,24491325,Equivalent of freopen in Go,"In C I can read and write files using scanf and printf by piping them as follows:

freopen (""input.txt"", ""r"", stdin);
freopen (""output.txt"", ""w"", stdout);


In Java you can do the same with

System.setIn


And friends.

This it very convenient if you need to swap between using a file and stdin/stdout often, and if to keep your code free from file pointers.

Does Go have something similar?
",1,24491458.0
172,24519347,Why doesn't godoc skip examples in golang?,"I was trying to make a documentation and provide examples but I didn't understand how to because godoc was skipping my examples.

when I go to localhost:8080/pkg/hello_example on the browser it print on the terminal:

2014/07/01 15:54:29 skipping example 'ExampleAuthenticate' because 'Authenticate' is not a known function or type
2014/07/01 15:54:29 skipping example 'ExampleGetAllowAllDriver' because 'GetAllowAllDriver' is not a known function or type
2014/07/01 15:54:29 skipping example 'ExampleGetAndUseAllowAllDriver' because 'GetAndUseAllowAllDriver' is not a known function or type
2014/07/01 15:54:29 skipping example 'ExampleGetAndUseDenyAllDriver' because 'GetAndUseDenyAllDriver' is not a known function or type
2014/07/01 15:54:29 skipping example 'ExampleGetDenyAllDriver' because 'GetDenyAllDriver' is not a known function or type
2014/07/01 15:54:29 skipping example 'ExampleGetRedisDriver' because 'GetRedisDriver' is not a known function or type
2014/07/01 15:54:30 skipping example 'ExampleAuthenticate' because 'Authenticate' is not a known function or type
2014/07/01 15:54:30 skipping example 'ExampleGetAllowAllDriver' because 'GetAllowAllDriver' is not a known function or type
2014/07/01 15:54:30 skipping example 'ExampleGetAndUseAllowAllDriver' because 'GetAndUseAllowAllDriver' is not a known function or type
2014/07/01 15:54:30 skipping example 'ExampleGetAndUseDenyAllDriver' because 'GetAndUseDenyAllDriver' is not a known function or type
2014/07/01 15:54:30 skipping example 'ExampleGetDenyAllDriver' because 'GetDenyAllDriver' is not a known function or type
2014/07/01 15:54:30 skipping example 'ExampleGetRedisDriver' because 'GetRedisDriver' is not a known function or type
^C%


I don't understand, so I cannot make arbitrary names of examples? Do the names have to match function names of my package or of my file? This is in my test package, so I am probably trying to test function in a different package and file. How do I do this?
",1,
173,24640352,accessing objects from other files in go program,"The goji microframework for Go has a fully functional example app with three files, main.go, models.go and middleware.go. I installed the framework using the go get command

go get github.com/zenazn/goji


and therefore have the example app availabl in my GOPATH like this

src/github.com/zenazn/goji/example


if I navigate to /example/ and run go run main.go, it gives me errors which indicate that the main.go file is isn't accessing the objects from the middleware.go and models.go files, like this

./main.go:39: undefined: PlainText
./main.go:47: undefined: SuperSecure
./main.go:73: undefined: Greets
./main.go:74: undefined: Greets
./main.go:85: undefined: Greet
./main.go:98: undefined: Greets
./main.go:99: undefined: Greets
./main.go:107: undefined: Users
./main.go:116: undefined: Greets
./main.go:116: too many errors


There is no code in main.go that imports middleware.go or models.go, only the regular import statements for libraries. 

How are these files supposed to be tied together so that the objects from one are available in the other?

from main.go

package main

import (
    ""fmt""
    ""io""
    ""net/http""
    ""regexp""
    ""strconv""

    ""github.com/zenazn/goji""
    ""github.com/zenazn/goji/param""
    ""github.com/zenazn/goji/web""
)

// Note: the code below cuts a lot of corners to make the example app simple.

func main() {
    // Add routes to the global handler
    goji.Get(""/"", Root)
    // Fully backwards compatible with net/http's Handlers
    goji.Get(""/greets"", http.RedirectHandler(""/"", 301))
    // Use your favorite HTTP verbs
    goji.Post(""/greets"", NewGreet)
    // Use Sinatra-style patterns in your URLs
    goji.Get(""/users/:name"", GetUser)
    // Goji also supports regular expressions with named capture groups.
    goji.Get(regexp.MustCompile(`^/greets/(?P\d+)$`), GetGreet)

    // Middleware can be used to inject behavior into your app. The
    // middleware for this application are defined in middleware.go, but you
    // can put them wherever you like.
    goji.Use(PlainText)

    admin := web.New()
    goji.Handle(""/admin/*"", admin)
    admin.Use(SuperSecure)

    // Goji's routing, like Sinatra's, is exact: no effort is made to
    // normalize trailing slashes.
    goji.Get(""/admin"", http.RedirectHandler(""/admin/"", 301))


    admin.Get(""/admin/"", AdminRoot)
    admin.Get(""/admin/finances"", AdminFinances)

    // Use a custom 404 handler
    goji.NotFound(NotFound)

    goji.Serve()
}


middleware.go

package main

import (
    ""encoding/base64""
    ""net/http""
    ""strings""

    ""github.com/zenazn/goji/web""
)

// PlainText sets the content-type of responses to text/plain.
func PlainText(h http.Handler) http.Handler {
    fn := func(w http.ResponseWriter, r *http.Request) {
        w.Header().Set(""Content-Type"", ""text/plain"")
        h.ServeHTTP(w, r)
    }
    return http.HandlerFunc(fn)
}

// Nobody will ever guess this!
const Password = ""admin:admin""

// SuperSecure is HTTP Basic Auth middleware for super-secret admin page. Shhhh!
func SuperSecure(c *web.C, h http.Handler) http.Handler {
    fn := func(w http.ResponseWriter, r *http.Request) {
        auth := r.Header.Get(""Authorization"")
        if !strings.HasPrefix(auth, ""Basic "") {
            pleaseAuth(w)
            return
        }

        password, err := base64.StdEncoding.DecodeString(auth[6:])
        if err != nil || string(password) != Password {
            pleaseAuth(w)
            return
        }

        h.ServeHTTP(w, r)
    }
    return http.HandlerFunc(fn)
}

func pleaseAuth(w http.ResponseWriter) {
    w.Header().Set(""WWW-Authenticate"", `Basic realm=""Gritter""`)
    w.WriteHeader(http.StatusUnauthorized)
    w.Write([]byte(""Go away!\n""))
}


models.go

package main

import (
    ""fmt""
    ""io""
    ""time""
)

// A Greet is a 140-character micro-blogpost that has no resemblance whatsoever
// to the noise a bird makes.
type Greet struct {
    User    string    `param:""user""`
    Message string    `param:""message""`
    Time    time.Time `param:""time""`
}

// Store all our greets in a big list in memory, because, let's be honest, who's
// actually going to use a service that only allows you to post 140-character
// messages?
var Greets = []Greet{
    {""carl"", ""Welcome to Gritter!"", time.Now()},
    {""alice"", ""Wanna know a secret?"", time.Now()},
    {""bob"", ""Okay!"", time.Now()},
    {""eve"", ""I'm listening..."", time.Now()},
}

// Write out a representation of the greet
func (g Greet) Write(w io.Writer) {
    fmt.Fprintf(w, ""%s\n@%s at %s\n---\n"", g.Message, g.User,
        g.Time.Format(time.UnixDate))
}

// A User is a person. It may even be someone you know. Or a rabbit. Hard to say
// from here.
type User struct {
    Name, Bio string
}

// All the users we know about! There aren't very many...
var Users = map[string]User{
    ""alice"": {""Alice in Wonderland"", ""Eating mushrooms""},
    ""bob"":   {""Bob the Builder"", ""Making children dumber""},
    ""carl"":  {""Carl Jackson"", ""Duct tape aficionado""},
}

// Write out the user
func (u User) Write(w io.Writer, handle string) {
    fmt.Fprintf(w, ""%s (@%s)\n%s\n"", u.Name, handle, u.Bio)
}

",2,24640489.0
174,24702774,how to write image to request body,"I have a jpeg image.Image and I want to decode to a request body. Simplified below, it doesn't seem to finish the request ever. The program hangs. 

  r, w := io.Pipe()
  jpeg.Encode(w, img, &jpeg.Options{ 80 })

  req, e := http.NewRequest(""PUT"", myUrl, r)
  if e != nil {
    return nil, e
  }
  http.DefaultClient.Do(req)


How can I write an image to the request body?
",2,24703499.0
175,24706034,Golang jsonable pointers to different structs in slice,"My golang program have this structure of structs:

type JSONDoc struct {
     Count  int         `json:""count""`
     Objects []uintptr  `json:""objects""`
}

type ObjectA struct {
     FieldA string
}

type ObjectB struct {
     FieldB string
}


I don't know what object types can be in JSONDoc.Objects, i'm need to store multiple structs in json array. Reflect returns pointers to structs, i'm appending them to struct, but encoding/json package in result json replace pointer with integer address. 
Also unsafe.Pointer cannot be parsed by encoding/json too. 

Just want result json to look as 

{
     ""count"":2, 
     ""objects"":
     [
         {""FieldA"":""...""}, 
         {""FieldB"":""...""}
     ]
}


How can i store pointers to structs that will be correctly encoded to json?
",1,24706229.0
176,24762418,Pointers and debugging in golang,"I'm stuck in a situation and cannot figure out what I messed up. Easiest way to explain is probably some minimal example: http://play.golang.org/p/14lbOBsCCo

I am tying to modify a value of a struct via its pointer but end up modifing some memory other the part I want. Line 92 is where my issue is.

How would you debug a situation like this (tools etc.), and how do I get the broker.Port set?

Thanks for hints/suggestions! 
",1,24762569.0
177,24775306,how defer statement works exactly,"i try to learn golang and use effective go as lecture. I stuck on capital defer, look at the following code 

package main

import ""fmt""

func trace(s string) string {
    fmt.Println(""entering:"", s)
    return s
}

func un(s string) {
    fmt.Println(""leaving:"", s)
}

func a() {
    defer un(trace(""a""))
    fmt.Println(""in a"")
}

func b() {
    defer un(trace(""b""))
    fmt.Println(""in b"")
    a()
}

func main() {
    b()
}


as output i've got

entering: b
in b
entering: a
in a
leaving: a
leaving: b


I know, that defer statement will be execute after return statement in the function. But here, why entering: b is the first output? I am expected in b as the fist output!
",2,24775499.0
178,24836696,How to get the variable name as in the source code (using reflect )?,"I'm trying to build an easy to use templating system. Basically I just want to create a slice with different variables ( strings ) and then loop through the slice and replace the markup {{}} with the actual values. So if the variable 'name' is onevar it will look in the template for {{onevar}} and replace that with the actual value of the variable . 

Question: how do I get the variable name? Basically  what's in the source code. Is it possible ? I've tried something with reflect but seems I couldn't get it right. See belowg

onevar := ""something""
other := ""something else""

var msg string
    sa := []string{onevar, other}
    for _, v := range sa {
        vName := reflect.TypeOf(v).Name()
        vName = fmt.Sprintf(""{{%s}}"", vName)
        msg = strings.Replace(msg, vName, v, -1)
    }

",2,
179,24838846,Golang: declare a single constant,"Which is the preferred way to declare a single constant in Go?

1)

const myConst


2) 

const (
        myConst
)


Both ways are accepted by gofmt. Both ways are found in stdlib, though 1) is used more.
",1,24838866.0
180,24854410,Do flags in Golang absolutely need values?,"With the flag package in golang, can I have flags that I only need to know the presence of them? Like rails -s, the flag ""s"" does not have any value, but program can know the presence of the flag s.
",1,24854488.0
181,24855081,How do I import a specific version of a package using go get?,"coming from a Node environment I used to install a specific version of a vendor lib into the project folder (node_modules) by telling npm to install that version of that lib from the package.json or even directly from the console, like so:

$ npm install express@4.0.0


Then I used to import that version of that package in my project just with:

var express = require('express');


Now, I want to do the same thing with go. How can I do that?
Is it possible to install a specific version of a package? If so, using a centralized $GOPATH, how can I import one version instead of another?

I would do something like this:

$ go get github.com/wilk/uuid@0.0.1
$ go get github.com/wilk/uuid@0.0.2


But then, how can I make a difference during the import?
",6,
182,24855388,Go + Angular ui-router,"I'm a new Gopher trying to do a Go backend to serve my Angularjs frontend and also serve an API.

This is what I have so far.

package main

import (
    ""github.com/gorilla/mux""
    ""log""
    ""net/http""
)

func main() {
    rtr := mux.NewRouter()
    srtr := rtr.PathPrefix(""/api"").Subrouter()
    srtr.HandleFunc(""/hello"", hello).Methods(""GET"")
    rtr.PathPrefix(""/"").Handler(http.FileServer(http.Dir(""./static/"")))

    http.Handle(""/"", rtr)

    log.Println(""Listening..."")
    http.ListenAndServe("":3000"", nil)
}

func hello(w http.ResponseWriter, r *http.Request) {
    w.Write([]byte(""Hello World""))
}


Everything works fine. /api/hello return ""Hello World"" and if I go to / it will serve my index.html. However since I'm trying to use angular ui-router so I need my go server to send all non-registered routes to angular so angular ui-router can handle them. 

For example: If I go /random right now it will return a 404 since I don't have any file under ./static named random. But what I want is Go to forward that request to Angular so ui-router can handle the /random
",1,26299816.0
183,24863585,How do I parse variables outside the range in Go templates?,"I have two structs as below and I need to render the data on a template using the templates pack. I get this error  

: Email is not a field of struct type Notes.

The issue seems to be that only fields of the range struct seem to be available within the range loop so I'm wondering how I can import fields from outside the range struct (e.g. the Email string).

The behavior is quite unexpected.

type notes struct{
    Note string
    sf string
}

type uis struct{
    notes []Note
    Email string
}

var ui uis


HTML 

{{range .notes}}
    {{.Email}} {{.sf}}
    {{end}}

Email {{.Email}}


I've checked the godocs but they seem quite useless. 
",1,24863769.0
184,24877566,Create a slice of type from a pointer to a type,"Trying to create a slice in which the type is set dynamicaly based on a pointer to a specific type, so i made the following sample

func main() {
    var chicken *Chicken
    //create a slice of chickens
    chickens:=GetaDynamiclyTypedSlice(chicken)

    //this throws  cannot range over chickens (type *[]interface {}) and i cant figure how to create a slice using my above chicken pointer
    for _,chicken := range chickens{
        fmt.Println(chicken)
    }

}

type Chicken struct{
    Weight float64
}

func GetaDynamiclyTypedSlice(ptrItemType interface{})*[]interface {}{
    var collection []interface{}
    itemtyp := reflect.TypeOf(ptrItemType).Elem()
    for i:=0;i<1000;i++{
        //create an item of the wanted type
        item := reflect.New(itemtyp)
        //set a random float to the weight value
        item.Elem().FieldByName(""Weight"").SetFloat(rnd.ExpFloat64())
        collection = append(collection,&item)
    }
    return &collection
}



what should i do to be able to use range on the returned slice?
how can i use the itemtyp as the type of my slice?

",2,24877925.0
185,24952983,Golang function call on template fails on a single struct,"i have following code

func (w *Warehouse) GetId() string {
  return w.Id.Hex()
}


view multiple works perfect

{{ range .Data }}
   
   {{ .Name }}
   {{ .City }}
   {{ .Manager }}
   view
   
{{ end }}


in single show warehouse i do this but that fails while .Data.Name return the name correctly

{{ .Data.GetId }}


any idea what i am missing here?
",2,
186,24958569,Go: (operator + not defined on slice),"Im trying to write a program that takes user input flags, reads an input file containing data (testInput.txt), then appends the user's flags to the input data and exports it all to an output file (testOutput.txt). I am getting an error in func employeeReadWrite() when trying to append the two together. ""invalid operation: contents + cnvUserProfile (operator + not defined on slice)"". I'm new to programming with go being my 1st language, and I don't have a great handle on slices yet. What do I need to do to resolve that error?   

package main

import (
""flag""
""fmt""
""io/ioutil""
""os""
)

var targetEmployee *string
var targetUsername *string
var targetLocation *string
var targetDepartment *string
var targetManager *string
var targetTitle *string
var userProfile string

func getFlagVariables() {
    targetEmployee = flag.String(""employee"", """", ""What is there name? (-employee)"")
    targetUsername = flag.String(""username"", """", ""What is there username? (-username)"")
    targetLocation = flag.String(""location"", """", ""Where are the working from? (-location)"")
    targetDepartment = flag.String(""department"", """", ""What is there department? (-department)"")
    targetManager = flag.String(""manager"", """", ""Who is there manager? (-manager)"")
    targetTitle = flag.String(""title"", """", ""What is there job title? (-title)"")

    flag.Parse()

    fmt.Println(""-----------------------------------"")
    userProfile = *targetEmployee + ""\n"" + *targetUsername + ""\n"" + *targetUsername + ""@genericCompany.com"" + ""\n"" + *targetLocation + ""\n"" + *targetDepartment + ""\n"" + *targetManager + ""\n"" + *targetTitle
    fmt.Println(userProfile)
    fmt.Println(""-----------------------------------"")

}

func employeeReadWriteFile() {
    contents, _ := ioutil.ReadFile(""testInput.txt"")
    cnvrtUserProfile := []byte(userProfile)
    ioutil.WriteFile(""testOutput.txt"", contents+cnvrtUserProfile, 0x777)
}

",1,24958673.0
187,24977231,Importing and parsing a large CSV file with go and app engine's datastore,"Locally I am successfully able to (in a task):


Open the csv
Scan through each line (using Scanner.Scan)
Map the parsed CSV line to my desired struct
Save the struct to datastore


I see that blobstore has a reader that would allow me toread the value directly using a streaming file-like interface. -- but that seems to have a limit of 32MB. I also see there's a bulk upload tool -- bulk_uploader.py -- but it won't do all the data-massaging I require and I'd like to limit writes (and really cost) of this bulk insert.

How would one effectively read and parse a very large (500mb+) csv file without the benefit of reading from local storage?
",2,24980225.0
188,24980927,GO: Serve static pages,"I'm trying to display a static page with GO. 

GO:

package main

import ""net/http""

func main() {
    fs := http.FileServer(http.Dir(""static/home""))
    http.Handle(""/"", fs)
    http.ListenAndServe("":4747"", nil) 
}


Directory:

Project
    /static
        home.html
        edit.html
    project.go


When I run it, the web page displays the links to edit.html and home.html instead of displaying the static page from home.html. What am I doing wrong. Is this the best way to serve files? I know there are other ways eg. from the html/templates package but I'm not sure what the difference is and when to use each of these methods. Thanks!
",2,
189,25002575,Don't read unneeded JSON key-values into memory,"I have a JSON file with a single field that takes a huge amount of space when loaded into memory. The other fields are reasonable, but I'm trying to take care not to load that particular field unless I absolutely have to.

{
    ""Field1"": ""value1"",
    ""Field2"": ""value2"",
    ""Field3"": ""a very very long string that potentially takes a few GB of memory""
}


When reading that file into memory, I'd want to ignore Field3 (because loading it could crash my app). Here's some code that I would assume does that because it uses io streams rather than passing a []byte type to the Unmarshal command.

package main

import (
    ""encoding/json""
    ""os""
)

func main() {
    type MyStruct struct {
        Field1 string
        Field2 string
    }
    fi, err := os.Open(""myJSONFile.json"")
    if err != nil {
        os.Exit(2)
    }
    // create an instance and populate
    var mystruct MyStruct
    err = json.NewDecoder(fi).Decode(&mystruct)
    if err != nil {
        os.Exit(2)
    }
    // do some other stuff
}


The issue is that the built-in json.Decoder type reads the entire file into memory on Decode before throwing away key-values that don't match the struct's fields (as has been pointed out on StackOverflow before: link).

Are there any ways of decoding JSON in Go without keeping the entire JSON object in memory?
",1,25002758.0
190,25090797,Golang lib/pq postgresql create a dynamic update statement,"I get a JSON from a client on the successful submit of user details.

Some element in the JSON can be skipped since they were not updated.

On the Golang server side, I have an equivalent struct defined.

The server successfully marshals the JSON bytes into the struct.

type user struct {
    Id       *int64  `json:"",omitempty""`
    Name     *string `json:"",omitempty""`
    Age      *int64  `json:"",omitempty""`
}


How do I create a dynamic update statement depending on the available JSON elements?

For example, I might get the Id and Age alone.
How can I create a update statement dynamically, like update user set age = $1 where id = $2
Another time it might be Id and Name.

Appreciate your response.
",1,
191,25094243,How do i format time in Go Language,"I need to format time like this

Mon, 16 Jun 2014 09:19:01 +0200 


following code

a := time.RFC1123Z


give me

Mon, 02 Jan 2006 15:04:05 -0700


which seem correct but need current time and use now() somehow i guess. but havent figured out how.
",1,25094332.0
192,25180509,Go: Comparison in maps of interface types,"Let's say I have a lot of different struct types which all satisfy an interface, Food. 

type Food interface {
    Name() string
    Tastiness() int
}

type fruit struct {
    species  string
    numSeeds int
}

type vegetable struct {
    commonName string
    weight  int
}

func (f *fruit) Name() string       { return f.species }
func (f *fruit) Tastiness() int     { return 100 - f.numSeeds }
func (v *vegetable) Name() string   { return v.commonName }
func (v *vegetable) Tastiness() int { return 1 }


The structs that satisfy the Food interface do so with functions that are pointer receivers because I pass them around often, which is unwieldy without pointers.

Often, I want to make comparisons between food1 and food2, and so I construct maps that look like foodmap := map[Food]bool. What I really want to check is if the underlying structs are the same thing. But, because it's always pointers that are satisfying the interface, I can't do equality or presence tests using maps or lists if I create two of the same kind of fruit or vegetable, for example.

Is the best way to compare Foods to not use map[Food]bool and instead use something like map[FoodKey], where any struct that satsifies Food provides a FoodKey() comparisonStruct method that returns a struct meant strictly for comparison?
",3,25181475.0
193,25248534,Golang flag parsing after an argument on command line,"I am parsing command-line arguments. I use the following code:

var flagB = flag.Bool(""b"", false, ""boolflag"")

func main() {
    flag.Parse()

    fmt.Println(flag.NArg())
    fmt.Println(""-b"", *flagB)
}


When I execute the binary like this:

> test -b ""random""


I get the expected output, becuase there is one argument, and the flag is set:

1
-b true


However, when I execute the binary the other way around:

> test ""random"" -b


I get this:

2
-b false


Now, the flag isn't recodnized any more as flag, but as another argument.

Why is it that way? Is there a definition that flags come first and then the arguments? I always thought that the ""GNU-way"" of passing and parsing arguments is: The first places after the binary are reserved for mandatory arguments. And after that you can put optional arguments and flags.
",1,25249682.0
194,25266304,Go Global Variables and Scopes of slices,"I am starting out with GO language, and getting an error I cannot figure out.  How do I create a global slice that all functions within the module can use?  Here is what I have:

package main

import (
    ""fmt""
)

type Req struct {
    Req     int
    Name    string
}

var Reqs []Req

func ReadReqs(fp string) {
    var CReq Req;
    CReq.Req = 1
    CReq.Name = ""first""
    Reqs := append(Reqs, CReq)
}

func main() {
    Reqs := make([]Req, 0)

    if len(Reqs) > 0 {
        fmt.Println(Reqs[0])
    }

    fmt.Println(Reqs)
}


This code will not compile because of the following error:

./question.go:18: Reqs declared and not used


I was thinking that declaring var Reqs []Req should declare the variable, but it does not seem to be aware of it inside the ReadReqs function.  I do realize that globals are BAD but I would like to use global var for this simple program.
",3,25266750.0
195,25289593,bulk upserts within a sql transaction in golang,"I've been messing around with golang's sql package with transactions, and I'm trying to understand how to do bulk upserts without the ""per insert"" round trip communication for each row.  The examples here don't really show how any bulk queries would be done.

updateMoney, err := db.Prepare(""INSERT INTO balance set money=?, id=? ON DUPLICATE UPDATE balance SET money=money+? WHERE id=?"")
...
tx, err := db.Begin()
...
res, err := tx.Stmt(updateMoney).Exec(123.45, 1, 123.45, 1)
res, err := tx.Stmt(updateMoney).Exec(67.89, 2, 67.89, 2)
res, err := tx.Stmt(updateMoney).Exec(10.23, 3, 10.23, 3)
...
tx.Commit()


Ideally, I'd be able to take a prepared query, and build up a list of upserts to be sent at the same time... but here, we get a result back from the database after each execution.  Any suggestions on how to go about this?

Edit:
My coworker found this open ticket that describes the problem... it looks to be a larger concern than strictly within the context of a transaction.
",2,
196,25325114,Are database/sql transaction objects safe for concurrent access?,"I need to execute several SQL queries (select, update, delete) concurrently and roll back if any goroutine errors out. Thus the question: are DB transactions safe for concurrent access?
",2,
197,25325229,Runtime panic when copying texture in SDL Go program,"I have an SDL2 go program which tries to write a pixel array to the screen. When I try and update the texture with the new pixels the program panics with a runtime error:

fatal error: unexpected signal during runtime execution


Unfortunately I can find little to no documentation about how to pass around unsafe pointers in Go and I'm not sure if I'm approaching this correctly, here is some example code that exhibits the problem:

func main() {
    window := sdl.CreateWindow(""test"", sdl.WINDOWPOS_UNDEFINED, sdl.WINDOWPOS_UNDEFINED,
        800, 600, sdl.WINDOW_SHOWN)
    renderer := sdl.CreateRenderer(window, -1, 0)
    texture := sdl.CreateTexture(renderer, sdl.PIXELFORMAT_ARGB8888,
        sdl.TEXTUREACCESS_STATIC, 800, 600)

    defer renderer.Destroy()
    defer texture.Destroy()
    defer window.Destroy()

    for {
        pixels := make([]uint32, 800*600)

        texture.Update(nil, unsafe.Pointer(&pixels), int(800*unsafe.Sizeof(pixels)))
        window.UpdateSurface()

        renderer.Clear()
        renderer.Copy(texture, nil, nil)
        renderer.Present()
    }

    sdl.Delay(1000)
    sdl.Quit()
}


This code will compile with no errors, but when ran it will produce a runtime panic, but I can't see what would cause that in this code.

I am using these SDL2 Go bindings: https://github.com/veandco/go-sdl2
",1,25326736.0
198,25333683,Go 1.0.2 How to improve speed when compressing with zlib,"I'm working on a little program with Go (v1.0.2). I'm trying to load lines into memory, which I can recall by index (the first column of a line).
To save space, I compress every line with zlib. Lines are grouped by blocks.

Items are loaded from a file. An item is represented by a line. This line has many properties separated by tabulation.

It's working just fine, but it's currently really slow. It took me almost 50 sec to just load a 40 Mb file! (Note that if I disable the ""compress"" part, it takes only 0.87 sec). I'm obviously doing something wrong, but I can't find what. Please note that I'm a beginner in this language.

Note: I'm stuck with Go 1.0.2 and can't update.

package main

import (
    ""bytes""
    ""compress/zlib""
    ""encoding/json""
    ""flag""
    ""fmt""
    ""gotwcc/mylib""
    ""io""
    ""net/http""
    ""os""
)

type Block struct {
    data []byte
}

type Row struct {
    offset, len uint32
    block       *Block
}

type Cache struct {
    blocks          []Block
    indexes         map[string]*Row
    enable_compress bool
    maxRowGroup     uint
}

func (this *Cache) dump() {
    for key, value := range this.indexes {
        fmt.Printf(""[%s] = \""%s\""\n"", key, value.block)
    }
}

func (this *Cache) search(item_id string) string {
    row := this.indexes[item_id]
    if row == nil {
        return ""(Not found)""
    }
    block := this.uncompress(row.block.data)
    slice := block[row.offset : row.offset+row.len]
    return string(slice)
}

func (this *Cache) compress(data []byte) []byte {
    if !this.enable_compress {
        return data
    }

    var b bytes.Buffer
    w := zlib.NewWriter(&b)
    w.Write(data)
    w.Close()
    return b.Bytes()
}

func (this *Cache) uncompress(data []byte) []byte {
    if !this.enable_compress {
        return data
    }

    var res bytes.Buffer
    b := bytes.NewReader(data)
    r, err := zlib.NewReader(b)
    if err != nil {
        panic(err)
    }
    io.Copy(&res, r)

    r.Close()
    return res.Bytes()

}

func (this *Cache) loadFile(s string) {
    type TempRowBuf struct {
        item_id     []byte
        offset, len uint32
    }

    file, err := os.Open(s)
    if err != nil {
        panic(err.Error())
    }
    defer file.Close()

    scanner := mybufio.NewScanner(file)
    scanner.Split(mybufio.ScanLines)

    var tmp_buf bytes.Buffer
    var buffer bytes.Buffer
    var tmp_list []TempRowBuf
    this.indexes = make(map[string]*Row)

    var offset uint32 = 0
    nb := this.maxRowGroup
    for scanner.Scan() {
        nb--
        tmp_buf.Reset()
        tmp_buf.Write(scanner.Bytes())
        line := tmp_buf.Bytes()
        item_id, _ := tmp_buf.ReadBytes('\t')
        item_id = item_id[0 : len(item_id)-1]
        size := uint32(len(line))
        buffer.Write(line)
        tmp_list = append(tmp_list, TempRowBuf{item_id, offset, size})
        offset += size
        if nb <= 0 {
            compressed := this.compress(buffer.Bytes())
            buff := make([]byte, len(compressed))
            copy(buff, compressed)
            var block *Block = &Block{buff}
            for _, tmp := range tmp_list {
                this.indexes[string(tmp.item_id)] = &Row{tmp.offset, tmp.len, block}
            }
            nb = this.maxRowGroup
            offset = 0
            tmp_list = nil
            buffer.Reset()
        }
    }
    if nb > 0 {
        compressed := this.compress(buffer.Bytes())
        buff := make([]byte, len(compressed))
        copy(buff, compressed)
        var block *Block = &Block{buff}
        for _, tmp := range tmp_list {
            this.indexes[string(tmp.item_id)] = &Row{tmp.offset, tmp.len, block}
        }
    }
}

func wsCacheHandler(cache *Cache, writer http.ResponseWriter, request *http.Request) {
    var value map[string]string = make(map[string]string)

    item_id := request.FormValue(""item_id"")
    value[""item_id""] = item_id
    value[""raw""] = cache.search(item_id)
    jsonResp, err := json.Marshal(value)
    if err != nil {
        fmt.Println(""error:"", err)
    } else {
        fmt.Fprintf(writer, ""%s"", string(jsonResp))
    }
}

func main() {
    filename := flag.String(""data"", ""default.txt"", ""The data filename"")
    no_http := flag.Bool(""no-http"", false, ""Do not start an http server"")
    dumpMap := flag.Bool(""dump"", false, ""If we should dump the map to stdout"")
    noCompression := flag.Bool(""no-compress"", false, ""Disable compression"")
    maxRowGroup := flag.Uint(""max-row-group"", 100, ""How much line to group when doing compression"")

    flag.Parse()
    var cache Cache
    cache.enable_compress = !*noCompression
    cache.maxRowGroup = *maxRowGroup

    cache.loadFile(*filename)

    if *dumpMap {
        cache.dump()
        fmt.Println(cache.search(""100001""))
        fmt.Println(cache.search(""100002""))
        fmt.Println(cache.search(""100003""))
        fmt.Println(cache.search(""100004""))
        fmt.Println(cache.search(""100005""))
        fmt.Println(cache.search(""100006""))
        fmt.Println(cache.search(""100007""))
        fmt.Println(cache.search(""100008""))
        fmt.Println(cache.search(""100009""))
        fmt.Println(cache.search(""100010""))

    }

    if !*no_http {
        http.HandleFunc(""/"", func(writer http.ResponseWriter, request *http.Request) {
            wsCacheHandler(&cache, writer, request)
        })
        fmt.Println(""Cache loaded, now listening on port 8585..."")
        http.ListenAndServe("":8585"", nil)
    }
}


This is the test file I use (I'm not pasting the 40 Mo file here :p):

data.txt:

100001  bar
100002  foo
100003  bob
100004  nuts
100005  gogopowran
100006  green
100007  test
100008  alongwordwithlotofletters
100009  
100010  space space space


I launch my application like this:

time ./mybin -data=data.txt -no-http -no-compress => ok (0.6 sec to load)
time ./mybin -data=data.txt -no-http --max_row_group=100 => slow (12.1 sec to load)
time ./mybin -data=data.txt -no-http --max_row_group=1000 => still slow (10.9 sec to load)
time ./mybin -data=data.txt -no-http --max_row_group=10000 => still slow (10.6 sec to load)


Edit: Apply go fmt on the code. Add an option to choose the size of the packing. Test 3 different sizes.
",1,
199,25342806,Proper pattern to encapsulate log setup in golang,"When trying to move log setup code into a separate function I ran into inability to hide the destination file object from the main function. In the following INCORRECT simplified example the attempt is made to setup log writing to both Stderr and a file via a single function call:

package main

import (
    ""io""
    ""log""
    ""os""
)

func SetupLogging() {
    logFile, err := os.OpenFile(""test.log"", os.O_APPEND|os.O_CREATE, 0666)
    if err != nil {
        log.Panicln(err)
    }
    defer logFile.Close()

    log.SetOutput(io.MultiWriter(os.Stderr, logFile))
}

func main() {
    SetupLogging()
    log.Println(""Test message"")
}


Clearly is does not work because defer closes the log file at the end of the SetupLogging function.

A working example below adds extra code and IMHO looses some clarity if repeated in a larger application as a pattern:

package main

import (
    ""io""
    ""log""
    ""os""
)

func SetupLogging() *os.File {
    logFile, err := os.OpenFile(""test.log"", os.O_APPEND|os.O_CREATE, 0666)
    if err != nil {
        log.Panicln(err)
    }

    log.SetOutput(io.MultiWriter(os.Stderr, logFile))
    return logFile
}

func main() {
    logf := SetupLogging()
    defer logf.Close()

    log.Println(""Test message"")
}


Is there a different way to fully encapsulate open file management into a function, yet still nicely release the handle?
",4,32469214.0
200,25350710,"If maps can't be sorted in Go lang, what is the right way to do it?","Let's say I have a string and I would like to count each letter's frequency and then sort the table by the frequency. Desired output of ""hello larry"" would be:

+--------+-----------+
| Letter | Occurence |
+--------+-----------+
| l      |         3 |
| r      |         2 |
| h      |         1 |
| e      |         1 |
| o      |         1 |
| a      |         1 |
| y      |         1 |
+--------+-----------+


First I thought I'll deal with this easily using map having the letters as keys. This is really easy. However, map items don't have an order hence can't be sorted.

I guess I could deal with this using a structure:

type Letter struct {
    Value string
    Score int
}
type LetterList []Letter


However that brings bunch of other problems:


I need to check if the Letter is not already present in LetterList because I can't use the letters as keys
There's no direct way to sort them (using Int.sort() or so)


Using the structures just doesn't feel elegant at all. Is there a better solution?
",1,25351051.0
201,25376313,Good example how use to context,"Has somebody a good example application, how to use the go library http://blog.golang.org/context. 
",1,25376707.0
202,25391051,Unable to run go install: no install location for directory outside GOPATH,"When I try to run go install I get the following:

go install golang-book/chapter11/math: mkdir /Users/Swanros/Go/pkg/darwin_amd64: permission denied


Then I try sudo go install and get the following:

go install: no install location for directory /Users/Swanros/Go/src/golang-book/chapter11/math outside GOPATH


Here's my go env:

GOARCH=""amd64""
GOBIN=""""
GOCHAR=""6""
GOEXE=""""
GOHOSTARCH=""amd64""
GOHOSTOS=""darwin""
GOOS=""darwin""
GOPATH=""/Users/Swanros/Go""
GORACE=""""
GOROOT=""/usr/local/go""
GOTOOLDIR=""/usr/local/go/pkg/tool/darwin_amd64""
CC=""clang""
GOGCCFLAGS=""-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fno-common""
CXX=""clang++""
CGO_ENABLED=""1""


echo $GOPATH outputs:

/Users/Swanros/Go


What am I missing? I've been dealing with this all morning.
",1,25391509.0
203,25475003,blank page or runtime error when serving page after handling form submission,"I am able to load a html page ( index.html ) who's  contents looks like the following:


    



What I am trying to so is render index.html and then on submission of the ask render a copy of index.html except have some of the contents come from my golang code as a results page.

When I submit the form in index.html, I get a blank page.

But I am getting no data received when going to localhost:8000/view or
localhost:8000/view?q=hello+world in the browser. And in the terminal, I get this and a lot more, but this is the first line:

http: panic serving [::1]:53803: runtime error: invalid memory address or nil pointer dereference

what does it mean and how can I fix it?

WhenI go to /ask or /ask?q=hello+world, which is what I am trying to do, I get the blank page with no errors.

I am trying to handle ask on the initial page that is loaded and on the results page once that ask form has been submitted.

index.html, view.html, and edit.html all have this:



    




Here is my code now:

package main

import (

    ""fmt""
    ""net/http""
    ""github.com/zenazn/goji""
    ""github.com/zenazn/goji/web""

    ""html/template""
    ""io/ioutil""
)

type Page struct {

    Title string

    Body []byte

}

func (p *Page) save() error{

    filename := p.Title + "".txt""

    return ioutil.WriteFile(filename, p.Body, 0600) 

}

func loadPage(title string) (*Page, error){

    filename := title + "".txt""

    body, err := ioutil.ReadFile(filename)

    if err != nil{

        return nil, err

    }

    return &Page{Title: title, Body: body}, nil 

}

func renderTemplate(w http.ResponseWriter, tmpl string, p *Page){

    t, err := template.ParseFiles(tmpl + "".html"")

    if err != nil{
        fmt.Println(err)
    }
    t.Execute(w, p)

}

func viewHandler(w http.ResponseWriter, r *http.Request){

    //title := r.URL.Path[len(""/view/""):]

    title := r.FormValue(""q"")

    p, err := loadPage(title)

    if err != nil{
        fmt.Println(err)
    }

    renderTemplate(w, ""view"", p)

}

func editHandler(w http.ResponseWriter, r *http.Request){

    //title := r.URL.Path[len(""/edit/""):]

    title := r.FormValue(""q"")

    p, err := loadPage(title)

    if err != nil{

        p = &Page{Title: title}
        fmt.Println(err)

    }

    renderTemplate(w, ""edit"", p)

}

func response(c web.C, w http.ResponseWriter, r *http.Request){

}

func serveSingle(filename string) func(w http.ResponseWriter, r *http.Request) {

    return func(w http.ResponseWriter, r *http.Request) {

        http.ServeFile(w, r, filename)

    }

}

func main() {

    goji.Get(""/"", serveSingle(""Projects/Go/src/web/site/index.html""))

    goji.Handle(""/ask"", response)

    http.HandleFunc(""/view/"", viewHandler)

    http.HandleFunc(""/edit/"", editHandler)

    goji.Serve()

}


So I want to handle ask from the index.html and the results page and run response, which will render the results page on submission of the ask form from index.html and the results page.
",1,25476750.0
204,25484122,Map with TTL option in Go,"I need to build a data-structure like this:

map[string]SomeType 


But it must store values for about 10 minutes and then clear it from memory.
Second condition is records amount - it must be huge. This data-structure must add at least 2-5K records per second.

So, what is the most correct way in Go to make it?

I'm trying to make goroutine with timeout for each new elemnt. And one(or more) garbage-collector goroutine with channel to receive timeouts and clear elements.
But I'm not sure it's the most clear way. Is it Ok to have millions of waiting goroutines with timeouts?

Thanks.
",1,25487392.0
205,25496170,How to understand this Go makefile?,"COVERPROFILE=cover.out

default: test

cover:
    go test -coverprofile=$(COVERPROFILE) .
    go tool cover -html=$(COVERPROFILE)
    rm $(COVERPROFILE)

dependencies:
    go get -d .

test:
    go test -i ./...
    go test -v ./...

.PHONY: coverage dependencies test


I don't understand this golang makefile. Is there any tutorial for golang makefiles? I searched Google and didn't find any complete one. For example, I don't see any explanation for what is ""cover,"" etc.
",2,25496227.0
206,25498505,"golang function with leading ""type ***""","type ApplyFunc func(commitIndex uint64, cmd []byte) []byte


For this declaration. My understanding is,this is a function pointer. Its name is ApplyFunc. 
And this function takes commitIndex and cmd as inputs. It returns []byte.

Is my understanding right?
thanks!
",1,25498741.0
207,25499670,GOPATH value setting,"I'm install the go with the go1.3.1.windows-amd64.msi, after installation  GOROOT is default setting, I found the 
D:\Programs\Go\bin in the PATH,then I create a GOPATH environment variant,
when using the 'go get' command, error occurs:

package github.com/coreos/etcd: cannot download, $GOPATH must not be set to $GOROOT. For more details see: go help gopath

OS: windows 7 

GOPATH will conflict with GOROOT?

How can I set these two PATH values?
",3,
208,25519638,Go method parameter and float64 array giving unexpected errors,"When compiling the following code...

package camera

type camera struct {
    position [3]float64
    viewWidth int
    viewHeight int
}

func (c camera) SwitchToCartesianThreeSpace(x, y int) [3]float64 { // LINE 9
    var x3 float64 = 0 // view is set to the origin
    var y3 float64 = float64(x) - (float64(c.viewWidth) / 2)
    var z3 float64 = float64(-y) + (float64(c.viewHeight) / 2)
    result := [3]float64{x3, y3, z3}                               // LINE 13
    return result
}


...the following errors occur.

camera/camera.go:9: undefined: x
camera/camera.go:9: undefined: y
camera/camera.go:11: undefined: x
camera/camera.go:12: undefined: y
camera/camera.go:13: cannot use x3 (type float64) as type [3]float64 in array element
camera/camera.go:13: cannot use y3 (type float64) as type [3]float64 in array element
camera/camera.go:13: cannot use z3 (type float64) as type [3]float64 in array element


I've written a fair amount of Go code so far and do not understand why the errors on line 9 or the errors on line 13 are occurring! Anyone able to explain?
",1,25519765.0
209,25595011,How to install Hugo?,"I have downloaded and unzipped the hugo_0.11_linux_amd64.tar.gz file from the releases page, and I cannot figure out how to run the binary. I took a few stabs at using go run, and sh, but no luck. Can anyone offer a few more details?
",3,25596117.0
210,25651501,Is there java.io.Reader equivalent in Go?,"Go has very nice io.Reader and io.Writer interfaces, that roughly correspond to java.io.InputStream and java.io.OutputStream classes in Java (i.e. io.Reader = stream of bytes, io.Writer = sink for bytes).

I'm wondering, if Go also has some equivalent of java.io.Reader (stream of characters) and java.io.Writer (sink for characters) classes.

What I want is to read/write string from/to stream, without thinking about the encoding all the time + support for different encodings than just UTF8 (which is what combination of io.Reader + string typecasting gives me almost for free).

Update: so I guess my description is confusing, and I should have avoided comparison to Java stuff. What I want is something like this:

Reader part, read next 128 bytes, and return Go string by decoding bytes using ISO-8859-2 charset.


stringReader := NewStringReader(reader, ""iso-8859-2"")
stringReader.read(128)


Writer part, convert stuff to UTF16-BE bytes, and write it to the writer:


stringWriter := NewStringWriter(writer, ""utf16be"")
stringWriter.write(""馞鮂 擙樲橚 褗褆諓"");

",1,25652169.0
211,25668980,Change linux namespace in go,"I want to change namespace in go. When I'm compiling and running code in C it works fine, but in go I got errno 22 on netns syscall. Any Idea why this could occur?

go)

$ go build main.go ; ./main
setns mnt: Invalid argument
panic: -1

goroutine 1 [running]:
runtime.panic(0x423b80, 0xffffffffffffffff)
    /usr/local/go/src/pkg/runtime/panic.c:266 +0xb6
main.main()
    main.go:81 +0x86
$


c)

$ grep ^// main.go | sed 's/\/\///' | sed 's/__main/main/' > main.c; gcc main.c -o main; ./main
$


The code below:

package main

//
// #define _GNU_SOURCE
// #include 
// #include 
// #include 
// #include 
// #include 
// #include 
// #include 
//
// #define NETNS_RUN_DIR ""/run/netns""
// #define MNTNS_RUN_DIR ""/run/mntns""
//
// #ifndef HAVE_SETNS
//
// int
// setns(int fd, int nstype) {
// #ifdef __NR_setns
//   return syscall(__NR_setns, fd, nstype);
// #else
//   errno = ENOSYS;
//   return -1;
// #endif
// }
//
// #endif /* HAVE_SETNS */
//
//
// int
// ChangeNamespace(char *name)
// {
//   char net_path[MAXPATHLEN];
//   char mnt_path[MAXPATHLEN];
//   int fd;
//
//   snprintf(net_path, sizeof(net_path), ""%s/%s"", NETNS_RUN_DIR, name);
//   snprintf(mnt_path, sizeof(mnt_path), ""%s/%s"", MNTNS_RUN_DIR, name);
//
//   fd = open(net_path, O_RDONLY);
//   if (fd < 0) {
//     perror(""open net"");
//     return -1;
//   }
//
//   if (setns(fd, 0) < 0) {
//     perror(""setns net"");
//     return -1;
//   }
//
//   fd = open(mnt_path, O_RDONLY);
//   if (fd < 0) {
//     perror(""open mnt"");
//     return -1;
//   }
//
//   if (setns(fd, 0) < 0) {
//     perror(""setns mnt"");
//     return -1;
//   }
//
//   return 0;
// }
//
// int
// __main(int argc, char *argv[]) {
//     ChangeNamespace(""ns"");
//     return 0;
// }
//
import ""C""
import ""unsafe""
func main() {
    name := C.CString(""ns"")
    defer C.free(unsafe.Pointer(name))
    i := int(C.ChangeNamespace(name))
    if i < 0 {
        panic(i)
    }
}

",1,
212,25715581,Go ODBC to an iSeries: SQL0104 - Message can not be translated successfully,"I am attempting to use ODBC to query an IBM iSeries server (IBM i) using
https://code.google.com/p/odbc/.  I seem to think I had this working a while back when first testing but the
server has since been updated, iSeries Access updated, and I am using Go 1.3.1

It seems to connect fine, but the query causes an error.  I am guessing I am missing something with either the driver or the query being in the correct
encoding but I am not sure how to address it or if it is perhaps a bug with the odbc library and I should open an issue there.

My code is as follows:

package main

import (
    _ ""code.google.com/p/odbc""
    ""database/sql""
    ""fmt""
    ""log""
)

func main() {
    db, err := sql.Open(""odbc"", `
        Driver=iSeries Access ODBC Driver;
        System=myhost;
        Uid=myuserid;
        Pwd=mypassword`)
    if err != nil {
        log.Fatal(err)
    }
    defer db.Close()

    rows, err := db.Query(""SELECT 1 FROM sysibm.sysdummy1"")
    if err != nil {
        log.Fatal(err)
    }

    var number int
    for rows.Next() {
        rows.Scan(&number)
    }
    fmt.Println(number)
}


When running the above, I am getting the following error message:

SQLPrepare: {42000} [IBM][System i Access ODBC Driver][DB2 for i5/OS]SQL0104 - Error message text unavailable.
Message can not be translated successfully.


Any ideas what is going wrong, what I can check, or how I can get this to work?

Update

I did a test on a Linux VM and this works with that exact code.  I am able to use pyodbc with Python to connect on my Windows machine just fine using equivalent code, so this must be some sort of issue with this ODBC library on Windows.  I think at this point unless there are other ideas, I'm going to try some other libraries or open a bug report with the library author.
",1,
213,25745374,How to prevent deadlock when change map data,"I try to write a function that validate data. Look at the following code:

func Create(name, email, password, local string, termOf bool) map[string]string {

    wait := new(sync.WaitGroup)
    mutex := new(sync.Mutex)
    errMsg := make(map[string]string)

    if !termOf {
        mutex.Lock()
        errMsg[""termOf""] = translate(local, ""text06"")
        mutex.Unlock()
    }

    wait.Add(1)
    go func() {
        err := ValidateName(name, local)
        mutex.Lock()
        errMsg[""name""] = err.Error()
        mutex.Unlock()
        wait.Done()
    }()

    wait.Add(1)
    go func() {
        err := ValidateEmail(email, local)
        mutex.Lock()
        errMsg[""email""] = err.Error()
        mutex.Unlock()
        wait.Done()
    }()

    wait.Add(1)
    go func() {
        err := ValidatePassword(password, local)
        mutex.Lock()
        errMsg[""password""] = err.Error()
        mutex.Unlock()
        wait.Done()
    }()

    wait.Wait()

    // If errors appear
    if len(errMsg) > 0 {
        return errMsg
    }

    return nil
}


As you can see here, I use three goroutines and in the goroutine I lock it to change errMsg variable map type. When I run the function, I've got compiler error

runtime error: invalid memory address or nil pointer dereference
[signal 0xc0000005 code=0x0 addr=0x14 pc=0x44206a]


But when I remove in the goroutine all errMsg inserts, then the function works. I do not know the reason what I do wrong.
",1,25745513.0
214,25806133,Can this Go code be refactored?,"Using only 1 'if' statement and no 'else' & no switch & no shorthand notation for if-else?

    // Original function
    func Wheel(WheelPos uint32) {
        if WheelPos < 85 {
            fmt.Println(""WheelPos < 85"",Color(WheelPos*3, 255-WheelPos*3, 0))
        } else if WheelPos < 170 {
            WheelPos -= 85
            fmt.Println(""WheelPos >= 85"",Color(0, WheelPos*3, 255-WheelPos*3))
        } else {
            WheelPos -= 170
            fmt.Println(""WheelPos > 170"",Color(0, 255-WheelPos*3, WheelPos*3))
        }
    }


The above function is called in the main inside a for loop like so:

    func main() {
        var i uint32
        for i = 0; i < 255; i++ {
            Wheel(i)
        }
    }


The Color function is defined as such:

    func Color(r uint32, g uint32, b uint32) uint32 {
        return (r << 16) | (g << 8) | b
    }


I have started off with something like so:

    func Wheel(WheelPos uint32) {
        if (WheelPos = 85) || (WheelPos > 170) {
         // logic....
        }
    }

",2,
215,25837030,Find index in string with startIndex,"I am new to go and trying to find to find the index of a string in a string, but I want to pass in the start index. 

I know there is strings.Index and strings.LastIndex, but they just find the first and last. Is there any function I can use, where I can specify the start index? Something like the last line in my example.

Example:

s := ""go gopher, go""
fmt.Println(strings.Index(s, ""go"")) // Position 0
fmt.Println(strings.LastIndex(s, ""go"")) // Postion 11
fmt.Println(strings.Index(s, ""go"", 1)) // Position 3 - Start looking for ""go"" begining at index 1

",2,25837141.0
216,25861389,The argument in golang RPC call,"In the RPC handler function, I omit the first argument like:

func (self Handler) GetName(int, reply *StructObj) {
}


and in the calling side

var reply StructObj
client.Call(""Handler.GetName"", 0, &reply)


Because I do not need the first argument in the GetName Method, I omit its name,
HOWEVER, I got:

gob: type mismatch in decoder: want struct type


I changed the GetName method to GetName(id int, reply *StructObj) and it works.
I want to know why this happened? 
",1,25861731.0
217,25941791,why are those two structs not equal?,"I have a struct in go:

type header struct {
    dataLength    uint16
    optDataLength uint8
    packetType    uint8
}
type packet struct {
        syncByte  uint8
        header    *header
        headerCrc uint8
        data      []byte
        optData   []byte
        dataCrc   uint8
}


If i have created an Encode and Decode function for creating packages and for encoding them into binary. However why does those two instances.header differ? 

&{syncByte:85 header:0xc2080004b8 headerCrc:112 data:[2] optData:[] dataCrc:14}
&{syncByte:85 header:0xc2080004f8 headerCrc:112 data:[2] optData:[] dataCrc:14}


If i run Println on those two header's i get:

&{dataLength:1 optDataLength:0 packetType:5}
&{dataLength:1 optDataLength:0 packetType:5}


which to mee seems equal. But why do they look like 0xc2080004f8 vs 0xc2080004b8 when i cannot see the difference when i check on packet.header directly? 
",2,25942472.0
218,25999714,How to connect to Amazon RDS using go-sql-driver,"I can connect to the RDS instance using mysql -h ... command so I know it's not a security group problem. 

I've tried to use:

sql.Open(""mysql"", ""id:password@tcp(your-amazonaws-uri.com:3306)/dbname"")


in the readme file of go-sql-driver(https://github.com/go-sql-driver/mysql), but it doesn't seem to work.

I'm using my username under the RDS instance instead of id here though.

Edit:
The error returned is: panic runtime error: invalid memory address or nil pointer deference [signal 0xb code=0x1 addr=0x20 pc=0x5b551e]
goroutine 16 [running]
runtime.panic(0x7d4fc0, 0xa6ca73)...database/sql.(*Rows).Next...

It works fine with my local DB.
",1,
219,26008004,Go type for purchasing/financial calculations,"I'm building an online store in Go.  As would be expected, several important pieces need to record exact monetary amounts.  I'm aware of the rounding problems associated with floats (i.e. 0.3 cannot be exactly represented, etc.).

The concept of currency seems easy to just represent as a string.  However, I'm unsure of what type would be most appropriate to express the actual monetary amount in.

The key requirements would seem to be:


Can exactly express decimal numbers down to a specified number of decimal places, based on the currency (some currencies use more than 2 decimal places: http://www.londonfx.co.uk/ccylist.html )
Obviously basic arithmetic operations are needed - add/sub/mul/div.
Sane string conversion - which would essentially mean conversion to it's decimal equivalent.  Also, internationalization would need to be at least possible, even if all of the logic for that isn't built in (1.000 in Europe vs 1,000 in the US).
Rounding, possibly using alternate rounding schemes like Banker's rounding.
Needs to have a simple and obvious way to correspond to a database value - MySQL in my case.  (Might make the most sense to treat the value as a string at this level in order to ensure it's value is preserved exactly.)


I'm aware of math/big.Rat and it seems to solve a lot of these things, but for example it's string output won't work as-is, since it will output in the ""a/b"" form.  I'm sure there is a solution for that too, but I'm wondering if there is some sort of existing best practice that I'm not aware of (couldn't easily find) for this sort of thing.

UPDATE: This package looks promising: https://code.google.com/p/godec/
",1,26011449.0
220,26015235,How to limit file size in multipart file upload?,"In an HTTP service implementation, I'm allowing multipart http file upload with the PUT method. 

However, before writing everything into the hard drive, I'd like to check if the size of the file is OK. E.g. has to be under 50MB. 

How to do this in go?
",1,26016960.0
221,26058133,what's the Virtual Inheritance in go lang?,"
How to realize ""Virtual Inheritance"" in go?
go lang compiler version: ""1.3.1 windows/amd64"", does it support ""Virtual Inheritance"" for go lang?


I never heard a C like language could support ""Virtual"",so I really misunderstand.
",2,26058668.0
222,26143091,How can I explicitly empty a channel?,"The short version:
Is there a way to empty a go channel without recreating it, or looping through it? 

The why:
I'm using two channels to send and receive data, and I have an extra channel to signal that a reconnect is needed.

Now when the transport has been reset/reconnected I want to 'empty' the extra channel to make sure that there is not any lingering other reset requests which would cause the thing to reconnect again.
",4,26143528.0
223,26146081,Adding a string to an existing text file in Go,"I have a text file that i'd like to add an a block of text to using Go. The text file looks like this (without the numbering)


blah 
blah2 
] 
blah3 
blah4


and i want it to look like this


blah 
blah2 
MY INSERTED TEXT HERE 
]
blah3 
blah4


Assume I've already opened the file and created a string array of each line in the file called 'lines'.

 //find line with ] 
 for i, line := range lines {
     if(strings.ContainsRune(line, ']')) {
         //take the line before ']'... and write to it somehow 
         lines[i-1] (?)

     }
 }


How do I do this?
",2,26146146.0
224,26150553,How do I run a function until the expected value is returned?,"I want to run a function until it returns 0.

value, _ := FuncX()

if value != 0 {
                    value, _ := FuncX()
                  if(value != 0) {
                     value, _ := FuncX()
                      if(value != 0) ....
                  }
}


seems like a pretty ugly way to do it. Whats a possible better way?
",3,26150590.0
225,26185201,gorilla session invalid key size,"When I create new cookie store and do like:

var store = sessions.NewCookieStore(securecookie.GenerateRandomKey(1), securecookie.GenerateRandomKey(2))


I've got the the error message 

crypto/aes: invalid key size 2


Why what do I wrong? When I look at the function definition

// NewCookieStore returns a new CookieStore.
//
// Keys are defined in pairs to allow key rotation, but the common case is
// to set a single authentication key and optionally an encryption key.
//
// The first key in a pair is used for authentication and the second for
// encryption. The encryption key can be set to nil or omitted in the last
// pair, but the authentication key is required in all pairs.
//
// It is recommended to use an authentication key with 32 or 64 bytes.
// The encryption key, if set, must be either 16, 24, or 32 bytes to select
// AES-128, AES-192, or AES-256 modes.
//
// Use the convenience function securecookie.GenerateRandomKey() to create
// strong keys.
func NewCookieStore(keyPairs ...[]byte) *CookieStore {
    return &CookieStore{
        Codecs: securecookie.CodecsFromPairs(keyPairs...),
        Options: &Options{
            Path:   ""/"",
            MaxAge: 86400 * 30,
        },
    }
}


I think pass the right parameter.
",1,26185296.0
226,26332292,how to using C++ library in Golang?,"I google for a while, it seems to that the cgo is support C++ now.
but when I call C++ function like C in Golang, it failed.
so I wanna know how can let cgo know that the function I call is a C++ function, not C function?

I appreciate any help.
",1,
227,26415117,Golang regex cant match byte 10,"Try the following:

func main(){
    r := regexp.MustCompile(`(.)`)
    for i := 0; i < 255; i++{
        d := []byte{byte(i)}
        all := r.FindAll(d, -1)
        fmt.Println(all)
    }
}


The wildcard cannot match byte 10 (ie the new line character). Looks like a bug. I suppose regex was never really meant to work with []byte, but golang offers the []byte functions, so this is kind of an oversight.
",1,26415155.0
228,26526736,Invalid receiver type []T ([]T is an unnamed type) workaround?,"I would like to define a method on []T, where T is a type I defined.
It looks like i have to define a new type to do this, but that stops me from using all the builtin functions for slices on this new type (such as len).

Is the go way of doing this to just make ordinary functions, rather than methods? (Kinda like how append() could be a method, but isn't?)
",1,26526822.0
229,26565794,How to visualize code coverage information on Go GAE apps?,"I am developing a server with the latest Go GAE SDK. I am running tests after every change:

goapp test -test.v=true


I am using -cover to record coverage as described by goapp help testflag:

goapp test -cover -test.v=true -test.coverprofile=c.out
[..]
coverage: 53.8% of statements
ok      _/var/lib/jenkins/jobs/loyalty/workspace    30.464s


This completes successfully and prints the percentage of lines covered by tests. However, attempting to visualize the results fails:

goapp tool cover -html=c.out
cover: can't find ""app.go"": cannot find package ""_/home/ingo/git/loyalty/"" in any of:
/home/ingo/Downloads/go_appengine_sdk_linux_amd64-1.9.10/go_appengine/goroot/src/pkg/_/home/ingo/git/loyalty (from $GOROOT)
/home/ingo/git/loyalty/src/_/home/ingo/git/loyalty (from $GOPATH)


Does Go's cover tool only work on non-GAE apps? Do I have to package my app differently in order to visualize the coverage results?

I unsuccessfully asked this on golang-nuts before.
",1,26610702.0
230,26573394,Go and Gorilla Mux NotFoundHandler not working,"I just can't get this NotFoundHandler to work. I'd like to serve a static file on every get request, given that it exists, otherwise serve index.html. Here's my simplified router at the moment:

func fooHandler() http.Handler {
  fn := func(w http.ResponseWriter, r *http.Request) {
    w.Write([]byte(""Foo""))
  }
  return http.HandlerFunc(fn)
}

func notFound(w http.ResponseWriter, r *http.Request) {
  http.ServeFile(w, r, ""public/index.html"")
}

func main() {
  router = mux.NewRouter()
  fs := http.FileServer(http.Dir(""public""))

  router.Handle(""/foo"", fooHandler())
  router.PathPrefix(""/"").Handler(fs)
  router.NotFoundHandler = http.HandlerFunc(notFound)

  http.ListenAndServe("":3000"", router)
}


/foo works ok

/file-that-exists works ok

/file-that-doesnt-exist doesn't work
- I get 404 page not found instead of index.html

So what am I doing wrong here?
",1,
231,26575662,“user: Current not implemented on linux/amd64” with fresh golang on fedora,"user.Current() doesn't work on a fresh Fedora golang. No cross-compiling involved. Just straight go install and run. Works fine on Ubuntu and a custom slackware dist. Any ideas?
",2,
232,26646802,How golang build lib to protect source code?,"By now,I can't find any way to build a package as static lib.
Because in my next project I really want some code to be protected, so I think I can build a static lib for that issue, and other golang app can easily link this lib by putting that lib in to the pkg folder.But some tests tell me it won't work.
So I really want to know if golang just not support my requirement. If so,can some one tell me why...T_T
",1,
233,26832168,go get gopkg.in/gomail.v1 cannot get gomail module,"I am trying to get gomail via gopkg.in/gomail.v1 but my connection just stays hanging. In other words, on my console, when I type:

[developer@machine gocode]$ go get gopkg.in/gomail.v1


I get nothing
However in the /gocode/src/gopkg.in directory, I see a directory named gomail.v1 with nothing inside..
",2,26832979.0
234,26889287,use gob to package recursively defined structs,"I mostly use Python, but am playing around with Go.  I wrote the following to do something that is quite simple in python, and im hoping it can be accomplished in Go as well.

package main

import (
    ""bytes""
    ""encoding/gob""
    ""fmt""
    ""io/ioutil""
)

type Order struct {
    Text string
    User *User
}

type User struct {
    Text  string
    Order *Order
}

func main() {
    o := Order{}
    u := User{}
    o.Text = ""order text""
    u.Text = ""user text""

    // commenting this section prevents stack overflow
    o.User = &u
    u.Order = &o
    fmt.Println(""o.u.text:"", o.User.Text, ""u.o.text:"", u.Order.Text)
    // end section

    m := new(bytes.Buffer)
    enc := gob.NewEncoder(m)
    enc.Encode(o)
    err := ioutil.WriteFile(""gob_data"", m.Bytes(), 0600)
    if err != nil {
        panic(err)
    }
    fmt.Printf(""just saved gob with %v\n"", o)

    n, err := ioutil.ReadFile(""gob_data"")
    if err != nil {
        fmt.Printf(""cannot read file"")
        panic(err)
    }
    p := bytes.NewBuffer(n)
    dec := gob.NewDecoder(p)
    e := Order{}
    err = dec.Decode(&e)
    if err != nil {
        fmt.Printf(""cannot decode"")
        panic(err)
    }
    fmt.Printf(""just read gob from file and it's showing: %v\n"", e)

}


As you can see, there are two custom structs, each containing a reference to the other, recursively.  When I try to package one up into a file using gob, it compiles, but i get a stack overflow, I am assuming this is caused by the recursion.  In my experience, pickle handles things like this without a gasp.  What am I doing wrong?
",1,26889480.0
235,26906323,GoLang Pointer Performance,"The following code shows two benchmarks. The first one creates a struct by value in each iteration, while the second one does use a pointer to the struct.

Why is the latter 20x slower ?? I know about GC issues with GoLang, but shouldn't escape analysis handle those situations ?

I'm using go1.4beta1, but 1.3.3 gave me the [same - wrong] different results.

Any idea ?

package main

import ""testing""

type Adder struct {
    vals []int
}

func (a *Adder) add() int {
    return a.vals[0] + a.vals[1]
}

func BenchmarkWithoutPointer(b *testing.B) {
    accum := 0
    for i := 0; i < b.N; i++ {
        adder := Adder{[]int{accum, i}}
        accum = adder.add()
    }
    _ = accum
}

func BenchmarkWithPointer(b *testing.B) {
    accum := 0
    for i := 0; i < b.N; i++ {
        adder := &Adder{[]int{accum, i}}
        accum = adder.add()
    }
    _ = accum
}


Benchmark go1.4.1:

 $ go test -bench=.                                                                                                                             

testing: warning: no tests to run
PASS
BenchmarkWithoutPointer 1000000000           2.92 ns/op
BenchmarkWithPointer    30000000            57.8 ns/op
ok      github.com/XXXXXXXXXX/bench/perf    5.010s


Benchmark go1.3.3:

testing: warning: no tests to run
PASS
BenchmarkWithoutPointer 500000000            7.89 ns/op
BenchmarkWithPointer    50000000            37.5 ns/op
ok      


EDIT: 

Conclusion: 

As Ainar-G said, the []int does escape to heap in the second benchmark. After reading a bit more about 1.4beta1 it seems, that new write barriers are introduced when accessing the heap caused by the new GC plans. But raw execution seems to have increased. Looking forward to 1.5 =).  
",1,26906705.0
236,26909443,Idiomatic golang: accessing and updating an item in a struct,"So I am trying to write some code that allows me to edit values in an array in a struct.  This example uses ""Status"" as a possible value to alter, but this is just a simplification to try to get my intent across.

package main

import(
  ""fmt""
)

type Parent struct {
  Children []Child
}

type Child struct {
  Status string
}

func (p *Parent) Add() *Child {
  var child Child
  child.Status = ""1""
  p.Children = append(p.Children, child)
  return &p.Children[len(p.Children)-1]
}

func main() {
  var p Parent
  child := p.Add()
  child.Status = ""2""
  fmt.Println(p)
  fmt.Println(child)
}


This doesn't feel ""proper"".  How should I do this in golang?  Certainly I could pass the value in as a parameter, but in my particular case I would like to edit function pointers that are inside the Child struct (not in this code to keep it short) after having added the child.  That feels nicer, but maybe I just need to pass them as parameters to the Add method?

eg

func (p *Parent) Add(fn1 func(), fn2 func()) *Child {


Anyway just wondering if anybody has any thoughts on this type of situation.
",3,26909828.0
237,26960243,Go: Pointer to interface{} loses underyling type,"I'm working with some ""generic"" functions in Go that operate on interface{} and send things around channels, etc. Slimmed down, let's say I have something like:

type MyType struct {
    // Fields
}

func (m *MyType) MarshalJSON() ([]byte, error) {
    // MarshalJSON
    log.Print(""custom JSON marshal"")
    return []byte(""hello""), nil
}

func GenericFunc(v interface{}) {
    // Do things...
    log.Print(reflect.TypeOf(v))
    log.Print(reflect.TypeOf(&v))
    b, _ = json.Marshal(&v)
    fmt.Println(string(b))
}

func main() {
    m := MyType{}
    GenericFunc(m)
}


This outputs:

2014/11/16 12:41:44 MyType 
2014/11/16 12:41:44 *interface {}


Followed by the default json.Marshal output, rather than the custom one. As far as I can tell, that's because the call to Marshal sees a value of type pointer-to-interface rather than pointer-to-MyType.

Why do I lose type information when I take &v? I would expect the second line of the output to be *MyType and not *interface {}.

Is there any way for me have the custom JSON Marshaller called without explicitly casting?
",2,
238,27098062,How can I define variadic fields on a struct? Go,"I need a data structure which accepts name / value pairs in addition to custom fields. How can I define a such structure ? 

e.g. 

type mybasket struct {
    Coupons string
    Amount int
    ....... // string or int
}

",1,
239,27115076,Golang html/templates : ParseFiles with custom Delims,"Using templates with delimiters works fine when using template.New(""..."").Delims(""[["", ""]]"").Parse()
However, I cannot figure out how to get to the same result with template.ParseFiles()

tmpl, err := template.ParseFiles(""base.tmpl"", ""homepage/inner.tmpl"")
if err != nil { panic(err) }
tmpl.Delims(""[["", ""]]"")
p := new(Page) 
err = tmpl.Execute(os.Stdout, p)
if err != nil { panic(err) }


I have no errors, but the Delimiters are not changed.

tmpl, err := template.ParseFiles(""base.tmpl"", ""homepage/inner.tmpl"")
t := tmpl.Lookup(""base.tmpl"").Delims(""[["", ""]]"")
p := new(Page) 
err = t.Execute(os.Stdout, p)
if err != nil { panic(err) }


This leads to the same result.

In case this is relevant, my need is to embed a small angular app in a particular page of my site.

Also, I have a base template with a common HTML structure that I combine with a page-specific template with ParseFiles(), leading to this layout :

/templates/base.tmpl
/templates/homepage/inner.tmpl
/templates/otherpage/inner.tmpl


Is this possible at all ? If so, what am I doing wrong ?
",1,27140645.0
240,27187617,How would I limit upload and download speed from the server in golang?,"How would I limit upload and download speed from the server in golang?

I'm writing a golang server to allow users to upload and download files. And file is big, about 1GB bytes. I want to limit the upload and download speed to (for instance) 1MB/s (configurable of course).

below is my upload code:

func uploadFile(w http.ResponseWriter, r *http.Request) {
    file, _, err := r.FormFile(""file"")

    if err != nil {
        http.Error(w, err.Error(), 500)
        return
    }

    defer file.Close()

    os.MkdirAll(`e:\test`, os.ModePerm)
    out, err := os.Create(`e:\test\test.mpg`)
    if err != nil {
        http.Error(w, err.Error(), 500)
        return
    }

    defer out.Close()

    _, err = io.Copy(out, file)
    if err != nil {
        http.Error(w, err.Error(), 500)
    }
}

",2,27190130.0
241,27201256,"Pass map, slice over channel and over network?","What is the best way to pass slice and map structure over channel that is distributed over network? I need to distribute the application running over several EC2 instances and wonder how I can achieve this by communicating each application by Go channel.

Here's the workflow that I would like to run:

1. Process data in one application
2. Distribute the data into 10 replica applications
3. Each 10 application does its job in a separate EC2 instance
4. Once they are all done, they send the result back to the original program
5. This is sent over the channel


Please let me know. Thanks!
",1,27201340.0
242,27210030,out of memory in golang when parsing Freebase RDF,"I'm parsing through the triples of the Freebase RDF compressed and streaming with the XML package in Golang. However, I'm getting an out of memory error. 

Do I have to garbage-collect? How can I do that? How can I clear the memory after I'm doing writing that triple to the XML file?

Here's my code: http://play.golang.org/p/dWvbtcs7wy

package main

import(
    ""bufio""
    ""flag""
    ""fmt""
    ""io""
    ""net/url""
    ""os""
    ""regexp""
    ""strings""
 )

 var inputFile = flag.String(""infile"", ""freebase-rdf"", ""Input file path"")
 var filter, _ = regexp.Compile(""^file:.*|^talk:.*|^special:.*|^wikipedia:.*|^wiktionary:.*|^user:.*|^user_talk:.*"")
type Redirect struct {
     Title string `xml:""title,attr""`
}

type Page struct {
    Title    string `xml:""title""`
    Abstract string `xml:""""`
}

func CanonicaliseTitle(title string) string{
     can := strings.ToLower(title)
     can = strings.Replace(can, "" "", ""_"", -1)
     can = url.QueryEscape(can)
     return can
 }

 func convertFreebaseId(uri string) string{
     if strings.HasPrefix(uri, """") {
        var id = uri[1 : len(uri)-1]
        id = strings.Replace(id, ""http://rdf.freebase.com/ns"", """", -1)
        id = strings.Replace(id, ""."", ""/"", -1)
        return id
     }
     return uri
 }

 func parseTriple(line string) (string, string, string){
     var parts = strings.Split(line, ""\t"")
     subject := convertFreebaseId(parts[0])
     predicate := convertFreebaseId(parts[1])
     object := convertFreebaseId(parts[2])
     return subject, predicate, object
 }

 var (
     validRegexp = regexp.MustCompile(""^[A-Za-z0-9][A-Za-z0-9_-]*$"")
     englishRegexp = regexp.MustCompile(""@en"")
 )

 func validTitle(content []string) bool{
     for _, v := range content{
         if !englishRegexp.MatchString(v) && len(v) > 1 && strings.Index(v, ""[]"") != -1{
         }  
     }
     return true
  }

 func validText(content []string) bool{
     for _, v := range content{
         if !validRegexp.MatchString(v) && len(v) > 1 && strings.Index(v, ""[]"") != -1{
             return false
         }
     }
     return true
 }

 func processTopic(id string, properties map[string][]string, file io.Writer){
     if validTitle(properties[""/type/object/name""]) && validText(properties[""/common/document/text""]){
         fmt.Fprintf(file, ""\n"")
         fmt.Fprintf(file, ""\""%s\""\n"", properties[""/type/object/name""])
         fmt.Fprintf(file, ""\""%s/%s\""\n"", ""https://usercontent.googleapis.com/freebase/v1/image"", id)
         fmt.Fprintf(file, ""\""%s\""\n"", properties[""/common/document/text""])
         fmt.Fprintf(file, ""\n"")
         for k, v := range properties{
             for _, value := range v{
                  fmt.Fprintf(file, ""%s\n"", k, value)
             }
         }
         fmt.Fprintf(file, ""\n"")
         fmt.Fprintf(file, ""\n"")
     }
 }

 func main(){
     var current_mid = """"
     current_topic := make(map[string][]string)
     f, err := os.Open(*inputFile)
     if err != nil {
         fmt.Println(err)
         return
     }
     r := bufio.NewReader(f)
     xmlFile, _ := os.Create(""freebase.xml"")
     line, err := r.ReadString('\n')
     for err == nil{
         subject, predicate, object := parseTriple(line)
         if subject == current_mid{
             current_topic[predicate] = append(current_topic[predicate], object)
         }else if len(current_mid) > 0{
              processTopic(current_mid, current_topic, xmlFile)
              current_topic = make(map[string][]string)
         }
         current_mid = subject
         line, err = r.ReadString('\n')
     }
     processTopic(current_mid, current_topic, xmlFile)
     if err != io.EOF {
         fmt.Println(err)
         return
     }
 }

",1,
243,27370217,What's the best way to maintain a list of open websocket connections?,"I want to send a stream (channel in Go) of messages to every client that connects to me through a websocket. There's a new message to send every ~100ms. How do I maintain a list of open connections with connections being opened and closed all the time while having to do some sort of iteration over that list to send out the messages for >50,000 connections? Right now I'm storing connections in a map that synchronizes with a single mutex, but I'm not sure if that can scale.
",2,
244,27397306,How to use RelatedSel() method on beego framework properly,"I know this is very basic, but i think the official documentation at [beego website][1]

[1]: http://beego.me/docs/mvc/model/query.md doesn't give clear direction.

I made a RESTful API using beego framework. As it promised, it generates basic CRUD code for my app. The problem is READ method doesn't return all data. By all data  I mean data in a table including data from all tables related to it. 

this is the output from the generated code (i'm using swagger to call it):

{
  ""data"": [
    {
      ""Id"": 1,
      ""CustomerId"": {
        ""Id"": 2,
        ""Name"": """",
        ""Phone"": """",
        ""Email"": """",
        ""CreatedAt"": ""0001-01-01T00:00:00Z"",
        ""UpdatedAt"": ""0001-01-01T00:00:00Z""
      },
      ""Saldo"": 2500000,
      ""CreatedAt"": ""2014-12-10T08:10:10+07:00"",
      ""UpdatedAt"": ""2014-12-10T08:10:10+07:00""
    }
  ],
  ""totals"": 1
}


see, it doesn't return the Name, Phone, and Email.
so i look into documentation and found this method RelatedSel() but still I have no idea how to use it properly.

here's my code:

func GetAllCustomerSaldo(query map[string]string, fields []string, sortby []string, order []string,
    offset int64, limit int64) (ml []interface{}, err error, totals int64) {
    o := orm.NewOrm()
    qs := o.QueryTable(new(CustomerSaldo))
    qs.RelatedSel(""CustomerId__Customers"").All(&CustomerSaldo{})
...


after trying many parameter possibilities, i still get this error:

Handler crashed with error unknown model/table name `Customers`


Anyone here have same problem with me? any solution guys?
",1,
245,27447305,"os.IsNotExist but getting ""not a directory""","I can not understand, why I am not able to create a folder and write to a file, and then read it in again - with the same path in same func, just for testing? 
When I run ""go test myio_test.go"" on the file. I get

myio_test.go

...
func TestMyIo(t *testing.T) {

    myio.CreateTempJsonFile()
}
....


myio.go

package myio

import (
    ""fmt""
    ""io/ioutil""
    ""path""
    //""syscall""
    // ""os""
    ""bitbucket.org/kardianos/osext""
    ""os""
)

func CreateTempJsonFile() {

    exePath, _ := osext.Executable()
    filePath := path.Dir(exePath + ""/json/"")
    fmt.Println(""create: "", filePath)

    _, errx := os.Stat(filePath)
    if os.IsNotExist(errx) {
        errm := os.Mkdir(filePath, 0644)
        if errm != nil {
            fmt.Println(""error creating dir..."")
            panic(errm)
        }
    }

    writeError := ioutil.WriteFile(filePath+""/user.txt"", []byte(`{""user"": ""Mac""}`), 0644) // os.ModeTemporary)// 0644)
    if writeError == nil {
        fmt.Println(""Ok write"")
    } else {
        fmt.Println(""Error write"")
    }

    _, err := ioutil.ReadFile(filePath + ""/user.txt"")
    if err == nil {
        fmt.Println(""Reading file"")
    } else {
        fmt.Println(""Error reading file"")
    }
}


It is like the os.Stat(filePath) thinks the folder is already there. If I then remove the check for os.Stat() and just go and create the folder I get a panic ""not a directory
""?

fmt.Println(""create: "", filePath) prints:

/private/var/folders/yj/jcyhsxxj6ml3tdfkp9gd2wpr0000gq/T/go-build627785093/command-line-arguments/_test/myio.test/json


It is all strange, as each test creates a new ""/go-buildxxx/"" folder and therefore the folder should never actually be there?

Any ideas?
",1,27448765.0
246,27468281,"html/template: ""layout"" is undefined","I try to use martini framework with layout template:

package main

import (
    ""github.com/go-martini/martini""
    ""github.com/martini-contrib/render""
)

func main() {
    m := martini.Classic()

    m.Use(render.Renderer(render.Options{Directory: ""./templates"",
        Layout:     ""layout"",
        Extensions: []string{"".tmpl""},
    }))

    m.Get(""/"", func(r render.Render) {
        r.HTML(200, ""mainPage"", map[string]interface{}{""Title"": ""some title"", ""H1"": ""some h1""})
    })

    m.Run()
}


In the same folder as this main.go  file I got folder templates with layout.tmpl file:



  
    
        {{template ""left"" .}}
    
    
        {{template ""right"" .}}
    



and mainPage.tmpl file:

{{define ""left""}}
  left content
{{end}}

{{define ""right""}}
    right content
{{end}}


When I open http://localhost:3000/ in browser I see error:
html/template: ""layout"" is undefined
",2,27469986.0
247,27485256,golang json marshal converts tags to utf symbols,"How to prevent converting   to \u003cp\u003e in json.Marshal ?

package main

import (
    ""encoding/json""
    ""fmt""
)

type User struct {
    Name string
}

func main() {
    user := User{Name: ""Frank""}
    b, err := json.Marshal(&user)
    if err != nil {
        fmt.Println(err)
        return
    }
    fmt.Println(user)
    fmt.Println(string(b))
}


It outputs:

{Frank}
{""Name"":""\u003cp\u003eFrank\u003c/p\u003e""}


playground
",1,27485744.0
248,27528430,Application running using os.exec doesn't load java libraries properly,"I would really appreciate if you helped me. I'm rewriting a simple Minecraft launcher from Java to Go. Everything is good, in exception of one thing.
I have a start function which executes using os.Exec this command:

java -Xincgc -Xmx1024M -Djava.library.path=""/minecraft/bin/natives/"" -cp ""/minecraft/bin/*"" -Dfml.ignoreInvalidMinecraftCertificates=true -Dfml.ignorePatchDiscrepancies=true net.minecraft.launchwrapper.Launch --username user --session session --version 1.6.4 --gameDir ""/minecraft"" --assetsDir ""/minecraft"" --tweakClass cpw.mods.fml.common.launcher.FMLTweaker


Everything is fine running this through bash or cmd, but when executed with Go function it returns the following:

Could not find or load main class net.minecraft.launchwrapper.Launch


I think os.exec(Command) cannot properly interpet this part of command:

-cp ""/minecraft/bin/*""


Maybe that's because I quoted string ""/minecraft/bin/*"" with strconv.Quote() function or because of asterisk. I really don't know what's heppening. Ah, btw, the command os.exec has run is correct, though (I read it in stdout with fmt for debugging purposes).

program:

func start(login string, session string, ram string) {
//start game

app := ""java""
arg0 := ""-Xincgc""
arg1 := ""-Xmx"" + ram + ""M""
arg2 := ""-Djava.library.path="" + strconv.Quote(filepath.FromSlash(client+""bin/natives/""))
arg3 := ""-cp""
arg4 := strconv.Quote(filepath.FromSlash(client + ""bin/*""))
arg5 := ""-Dfml.ignoreInvalidMinecraftCertificates=true""
arg6 := ""-Dfml.ignorePatchDiscrepancies=true""
arg7 := ""net.minecraft.launchwrapper.Launch""
arg8 := ""--username""
//arg9 is login
arg10 := ""--session""
//arg11 is session
arg12 := ""--version 1.6.4""
arg13 := ""--gameDir""
arg14 := strconv.Quote(filepath.FromSlash(client))
arg15 := ""--assetsDir""
arg16 := strconv.Quote(filepath.FromSlash(client + ""assets""))
arg17 := ""--tweakClass cpw.mods.fml.common.launcher.FMLTweaker""

cmd := exec.Command(app, arg0, arg1, arg2, arg3, arg4, arg5, arg6, arg7, arg8, login, arg10, session, arg12, arg13, arg14, arg15, arg16, arg17)
cmd.Stdout = os.Stdout
cmd.Stderr = os.Stderr
cmd.Run()
fmt.Println(app, arg0, arg1, arg2, arg3, arg4, arg5, arg6, arg7, arg8, login, arg10, session, arg12, arg13, arg14, arg15, arg16, arg17)
}

",1,
249,27658081,Vim-go - Indent with tabs not whitespaces,"I'd like to have my go files indented with tabs not whitespaces. 
When I run :set expandtab then :retab I get what I want but it automatically switches back to an indentation with whitespaces everytime I save the file.

I am using the vim-go plugin but I couldn't find anything in the doc/code which could lead to this issue. I have tried changing to setlocal noexpandtab in ftplugin/go.vim but it didn't work

How can I change this?

Many thanks
",1,
250,27686338,Not able to find function Marshal(),"I am writing small code for generating the ICMP packet. For that I am following the code from golang net package.

I identified the following code to use for ICMP packet generation: 

   109          c, err := Dial(tt.net, tt.raddr)
   110          if err != nil {
   111              t.Fatalf(""Dial failed: %v"", err)
   112          }
   113          c.SetDeadline(time.Now().Add(100 * time.Millisecond))
   114          defer c.Close()
   115  
   116          typ := icmpv4EchoRequest
   117          if net == ""ip6"" {
   118              typ = icmpv6EchoRequest
   119          }
   120          xid, xseq := os.Getpid()&0xffff, i+1
   121          wb, err := (&icmpMessage{
   122              Type: typ, Code: 0,
   123              Body: &icmpEcho{
   124                  ID: xid, Seq: xseq,
   125                  Data: bytes.Repeat([]byte(""Go Go Gadget Ping!!!""), 3),
   126              },
   127          }).Marshal()
   128          if err != nil {
   129              t.Fatalf(""icmpMessage.Marshal failed: %v"", err)
   130          }
   131          if _, err := c.Write(wb); err != nil {
   132              t.Fatalf(""Conn.Write failed: %v"", err)
   133          }


I am not able to understand followings in this code :


Marshal() is not included in the net package documentation, please let me know how to find this function and why it is not included in the net package. 
please explain me line #121 (icmpMessage struct and function calling as these are not defined in this file). 

",1,27690792.0
251,27795036,Create chan for func with two return args,"Is it posible to create channel for function boolInt without redefining it?

package main

func boolInt() (bool, int) {
    return false, 1
}

func main() {
    chanBool := make(chan bool)
    chanInt := make(chan int)
    go func() {
        // chanBool <- boolInt() // error: multiple-value boolInt() in single-value context
        chanBool, chanInt <- boolInt() //  syntax error: unexpected semicolon or newline, expecting := or = or comma
    }()

}


When I try to use it in single value context
chanBool  I get an error:  multiple-value boolInt() in single-value context.

In 2-value context: 
chanBool, chanInt  got error: syntax error: unexpected semicolon or newline, expecting := or = or comma.

playground
",2,27795117.0
252,27819137,Why do these two float64s have different values?,"Consider these two cases:

fmt.Println(912 * 0.01)
fmt.Println(float64(912) * 0.01)


(Go Playground link)

The second one prints 9.120000000000001, which is actually fine, I understand why that is happening.

However, why does the first line print 9.12, without the …01 at the end? Does Go multiply the two untyped constants and simply replace them with a 9.12 literal when compiling?
",2,27819483.0
253,27852940,How can I use zlib in golang to cooperate with zlib in c?,"I found that, for the same string, the result of using zlib in golang is different with that in c. How can I compress in golang and decompress in c by zlib ? Which version does go use?
",2,
254,27869858,Limiting bandwidth of http get,"I'm a beginner to golang. 

Is there any way to limit golang's http.Get() bandwidth usage? I found this: http://godoc.org/code.google.com/p/mxk/go1/flowcontrol, but I'm not sure how to piece the two together. How would I get access to the http Reader?
",2,27871599.0
255,27933739,"What ""|="" operator means in Go?","I've found this operator |= and I'm wondering what it means

func getPageInfoMode(r *http.Request) (mode PageInfoMode) {
    for _, k := range strings.Split(r.FormValue(""m""), "","") {
        if m, found := modeNames[strings.TrimSpace(k)]; found {
            mode |= m
        }
    }
    return
}

",1,
256,27948469,Why use prepared statements instead of Query / Exec with go sql package?,"In the go sql package, I understand that each statement should be closed after execution.
Why would someone use prepared statements instead of just the raw Query or Exec methods?
",2,27949612.0
257,27984992,Kth from the last element in a list using golang,"I have the code to find the kth from the last element in a list in golang. I wrote a recursive function. When it reaches the end of the list, it will return the count as 1 and increments in further returns. When the count == k then return the node value. But I am getting 'nil pointer dereference' error. Could anyone help me in this?

package main    
import (
    ""container/list""
    ""fmt""
)

var sMap map[int]bool

func main() {
    l := list.New()
    for i := 1; i < 100; i++ {
        l.PushBack(i)
    }    
    kFromLastElemRec := findKFromLastRecr(l.Front(), 3, WrapObj{0})
    fmt.Println(kFromLastElemRec.Value.(int))    
}
//Object to store the count 
type WrapObj struct {
    count int
}
//ERROR
//recursive function to find the kth from last element
func findKFromLastRecr(head *list.Element, k int, wrapper WrapObj) *list.Element {
    if head == nil {
        return nil
    }

    resNode := findKFromLastRecr(head.Next(), k, wrapper)
    wrapper.count = (wrapper.count) + 1
    if wrapper.count == k {
        return head
    }
    return resNode
}

",1,27985538.0
258,27986534,Range over `type x []struct` or `type y struct`?,"It seems that there is no Ranger interface for ranging over custom types. Is there anything similar? Or do I have to make a method that converts the type to a slice or map?

Edit: of course I could cast x to []struct, but that would make it harder to change the underlying type of x.
",1,27986874.0
259,27995531,How to construct a loop in a list in golang,"I wrote a function to find the loop in a list using golang. But I am not able to construct a loop in a list as input.

Please find below the code,   

package main
    import (
        ""container/list""
        ""fmt""
    )
    func main() {
        l := list.New()
        l.PushBack(0)
        l.PushBack(1)
        l.PushBack(2)
        l.PushBack(3)
        l.PushBack(4)
        l.PushBack(5)

        e6 := l.PushBack(6)
        l.PushBack(7)
        e8 :=l.PushBack(8)
        e9 := l.InsertAfter(9,e8)
        l.InsertBefore(e9, e6)

        for e:=l.Front() ; e !=nil ; e=e.Next() {
            fmt.Println(e.Value)
        }
    }


could anyone help me on this?
",1,27995703.0
260,28008164,What kind of encoding does posFlag requires?,"How can I encode the position of the form /pathto/file.go:40:32 which is returned by token.Position.String() to a posFlag param required by ParseQueryPos which looks like /pathto/file.go:#550.

Why?

I'm using the Oracle tool to do some static analysis. I need to run Oracle.Query which requires a param of type *QueryPos. The only way to get *QueryPos is using ParseQueryPos. 
",1,
261,28023566,Why are string functions not defined on the string type?,"I was just wondering why the string functions in Google Go are defined in a strings package as opposed to on the string data type itself. They could have easily done

func (s string) ToUpper() string {
}


instead of the current

func ToUpper(s string) string {
}


in the strings package.

My guess is that if you want to implement a custom version of ToUpper on a custom type that extends string (i.e., type MyString string), you have no way to access the builtin ToUpper anymore on that type, but I can't find any support on this.
",2,28023872.0
262,28033957,Is there a way to find a process id on windows in Go?,"In OS package there is a FindProcess() that you can pass in the ID of the process to get a process. You can then call kill on the process but is there a way to find a process based off of the name? (In windows) 

For example i would like to be able to do something like this. 

p, perr := os.FindProcessByName(""Itunes"")
if perr != nil {
    fmt.Println(perr)
}
p.Kill()


I only need this to work on Windows.
",1,28034936.0
263,28047311,"In golang, how to iterate two arrays using one `range`","We can use

for _, x := range []int{1, 2, 3} {
  // do something
}


To iterate an array.

How can I iterate two arrays simultaneously?

Is there something like following in python?

for x, y in range([1, 2, 3], [4, 5, 6]):
    print x, y

",3,28047625.0
264,28083629,Unable to complete oauth web workflow for GitHub in golang,"I'm trying to implement oauth-workflow for GitHub in golang and using https://github.com/franela/goreq to perform http(s) requests.

There is a section in which GitHub returns a code and you have to make a POST request to https://github.com/login/oauth/access_token with code, client_id and client_secret.

package main

import ""fmt""
import ""github.com/franela/goreq""

type param struct {
  code string
  client_id string
  client_secret string
}

func main() {
  params := param {code: ""XX"", client_id:""XX"", client_secret: ""XX""}
  req := goreq.Request{
    Method : ""POST"",
    Uri : ""https://github.com/login/oauth/access_token"",
    Body : params,
  }
  req.AddHeader(""Content-Type"", ""application/json"")
  req.AddHeader(""Accept"", ""application/json"")
  res, _ := req.Do()
  fmt.Println(res.Body.ToString())
}


It is giving 404 with {""error"":""Not Found""} message always.
While using Python, I'm getting the correct results with the same input data.
",2,28085169.0
265,28188504,Setting up an App Engine Context in Go,"I post JSON to an app I registered at Google App Engine but I am baffled by the authentication process in my Go code to get it working in appengine:

func init() {
    http.HandleFunc(""/post"", handler)
}

func handler(w http.ResponseWriter, r *http.Request) {

    app := appengine.NewContext(r)
    client := &http.Client{
        Transport: &oauth2.Transport{
            Source: google.AppEngineTokenSource(app, ""https://www.googleapis.com/auth/bigquery""),
            Base: &urlfetch.Transport{
                Context: app,
            },
        },
    }
    log.Print(client)
}


In following the docs, I have reduced my problem to the code above which consistently gives me the following error:

2015/01/28 09:05:32 appengine: NewContext passed an unknown http.Request


I'd love some pointers as to how I can provide appengine with a ""known"" http.Request because ultimately I am trying to get to the storage api which also requires a valid context.
",1,
266,28197443,golang undefined function call on imported library,"I've imported

_ ""github.com/mitchellh/mapstructure""


Into a project of mine. However i'm not able to utilize the Decode function included in that library in order to convert a map interface to struct:

var result Person
err := Decode(input, &result)
if err != nil {
    panic(err)
}


This basic call returns ""undefined: Decode"" error. Is there anything else to be done besides the import?

Thanks in advance!
",1,28197489.0
267,28300581,GOLANG: fatal error: all goroutines are asleep - deadlock,"package main
import (
    ""fmt""
    ""os""
    ""os/exec""
    ""bufio""
    ""reflect""
)

func runTheCommand(ch chan<- string, cmD string)  {
    ouT,_ := exec.Command(""sh"",""-c"",cmD).Output()
    ch <- string(ouT)
}
// Readln returns a single line (without the ending \n) from the input buffered reader. An error is returned iff there is an error with the buffered reader.
func Readln(r *bufio.Reader) (string, error) {
    var (isPrefix bool = true
        err error = nil 
        line, ln []byte
    )   
    for isPrefix && err == nil {
        line, isPrefix, err = r.ReadLine()
        ln = append(ln, line...)
    }   
    return string(ln),err
}



func main() {
    var chans = []chan string{}
    f, _ := os.Open(""../tmpStatus.config"")
    r := bufio.NewReader(f)
    cmD, e := Readln(r)
    for e == nil {
        ch := make(chan string)
        chans = append(chans, ch) 
        go runTheCommand(ch,cmD)
        cmD,e = Readln(r)
    }   

    cases := make([]reflect.SelectCase, len(chans))
    for i, ch := range chans {
        cases[i] = reflect.SelectCase{Dir: reflect.SelectRecv, Chan: reflect.ValueOf(ch)}
    }   

    remaining := len(cases)
    for remaining > 0 { 
        chosen, value, ok := reflect.Select(cases)
        if !ok {
            cases[chosen].Chan = reflect.ValueOf(nil)
            remaining -= 1
            continue
        }
        fmt.Printf(""%s"", value.String())
    }   
}    


This code is correctly printing out all the received values from the channels.
But in the end it is exiting with the below error :


  fatal error: all goroutines are asleep - deadlock!
  
  goroutine 1 [select]: reflect.rselect(0xc200283480, 0x22, 0x22,
  0xffffffffffffffff, 0x0, ...)
          /usr/local/go/src/pkg/runtime/chan.c:1212 +0x10d 
   reflect.Select(0xc200066800, 0x22, 0x22, 0x1, 0x0, ...)
          /usr/local/go/src/pkg/reflect/value.go:1957 +0x1fb


I am a newbee at GO. I referred google and somehow managed to write a working code. I didn't understand fully how this script works especially the reflect package commands. My intention here is to execute the unix commands listed in ../tmpStatus.config file parallely and print out the results. I am excited by the concurrency features offered by GO and hence decided to give it a try. Now it is printing the results so fast. Till now, I was doing this in python one by one.
I ran this script in go version go1.1.2 linux/amd64 installed to a custom location.
Any idea why the deadlock is happening ?
",1,28301545.0
268,28454756,Regex Go mismatch,"I have developed some regex in regexr where it works as expected, but when I use it in Go it seems to be mismatching strings.

(\+|-)?(((\d{1,3}[, ])(\d{3}[ ,])*\d{3})|\d+)( ?[\.,] ?(\d{3}[, ])*\d+)?


For example in regexr the following input does not match:

1.12,4.64


But in Go it does match.
",1,28455077.0
269,28486324,Context of incoming request,"From time to time I am faced with the ""Context"" concept which, as a rule is created for all incoming requests. Recently I've read the Go blog article that describes using the golang.org/x/net/context package. However, after playing with the code and trying to reproduce the logic of the article, I still hardly understand how to use it for every incoming request and even why it is useful for this.

How should I organize my code to create context (and what should it contain, generally) for every incoming request using the golang.org/x/net/context package? Could anybody give a little example and explain what is so useful and why so frequently used?
",1,28506418.0
270,28528060,golang get massive read tcp ip:port i/o timeout in ubuntu 14.04 LTS,"I wrote a golang program which run well in the past several months in ubuntu 12.04 LTS until I upgraded it to 14.04 LTS

My program is focused on sending HTTP requests which send about 2-10 HTTP requests per second. The HTTP request address vary.

When the problem occurs, first, some of the requests shows read tcp [ip]:[port]: i/o timeout, then after several minutes all requests show read tcp [ip]:[port]: i/o timeout, not any request can be sent.

I restart the program, everything become right again.

All of our servers(2 server) have such problem after upgraded from 12.04 to 14.04

I create new goroutine for every request

the problem does not occur in the same interval, sometimes it won't occur one or two day, sometimes It occur twice in an hour

Bellow is my code requesting HTTP Address:

t := &http.Transport{
    Dial:            timeoutDial(data.Timeout),
    TLSClientConfig: &tls.Config{InsecureSkipVerify: true},
}
//req := s.ParseReq(data)
req := data.convert2Request()
if req == nil {
    return
}

var resp *http.Response
if data.Redirect {
    c := &http.Client{
        Transport: t,
    }
    resp, err = c.Do(req)
} else {
    resp, err = t.RoundTrip(req)
}

data.updateTry()

r := s.ParseResp(data, resp, err)


updateTry:

func (d *SendData) updateTry() {
    d.Try++
    d.LastSend = time.Now()
}


timeoutDial:

func timeoutDial(timeout int) func(netw, addr string) (net.Conn, error) {
    if timeout <= 0 {
        timeout = 10
    }
    return func(netw, addr string) (net.Conn, error) {
        deadline := time.Now().Add(time.Duration(timeout) * time.Second)
        c, err := net.DialTimeout(netw, addr, time.Second*time.Duration(timeout+5))
        if err != nil {
            return nil, err
        }
        c.SetDeadline(deadline)
        return c, nil
    }
}


and My dealing with response is:

func (s *Sender) ParseResp(data SendData, resp *http.Response, err error) (r Resp) {
    r = Resp{URL: data.URL}
    if err != nil {
        r.Err = err.Error()
    } else {
        r.HttpCode = resp.StatusCode
        r.Header = resp.Header
        r.URL = resp.Request.URL.String()
        defer resp.Body.Close()
        // we just read part of response and log it.
        reader := bufio.NewReader(resp.Body)
        buf := make([]byte, bytes.MinRead) // 512 byte
        for len(r.Body) < 1024 {           // max 1k
            var n int
            if n, _ = reader.Read(buf); n == 0 {
                break
            }
            r.Body += string(buf[:n])
        }
    }
    return
}


I also found setting in /etc/sysctl.conf which can make the problem happen less frequently:

net.core.somaxconn = 65535
net.netfilter.nf_conntrack_max = 655350
net.netfilter.nf_conntrack_tcp_timeout_established = 1200


I need help for solving this problem.

It seems like this but I don't see any solution https://bugs.launchpad.net/juju-core/+bug/1307434
",2,
271,28591664,Playing audio file with golang,"How one would play audio file in go language?

I have function and want sound to be played as notification when event happens.

I could not find anything about playing sound file in go lang just some web browser based music players but it wasnt helpful too much.
",1,29962554.0
272,28710276,Golang: override an external package's cgo compiler and linker flags?,"Let's say I want to use some awesome go package.  I can include it by:

import ""github.com/really-awesome/project/foobar""


And inside that project's foobar.go file, it defines some cgo instructions like:

#cgo windows CFLAGS: -I C:/some-path/Include
#cgo windows LDFLAGS: -L C:/some-path/Lib -lfoobar


But if I have that foobar C dependency installed somewhere else, I would really need those lines to say:

#cgo windows CFLAGS: -I C:/different-path/Include
#cgo windows LDFLAGS: -L C:/different-path/Lib -lfoobar


Is there a way to override or trump where cgo is looking for these dependencies?  Right now my fix is to manually edit those two lines after running go get ./... which will fetch the github.comreally-awesome/project/foobar code.

NOTE: I'm using the MinGw compiler, though I doubt that matters. 

update:

I have tried adding flags to go build to no avail:

go build -x -gcflags=""-I C:/different/include -L C:/different-path/lib -lfoobar""
go build -x -ccflags=""-I C:/different/include"" -ldflags=""-L C:/different-path/lib -lfoobar""


With the -x argument I see the printout of flags and they don't include the ones I am setting on the command line.  Perhaps the #cgo CFLAGS/LDFLAGS statements at the top of the external go package squash what I am telling it to use...
",2,
273,28719523,Swedish characters in Go Lang,"The following function does not work with Swedish characters, i.e å/Å/ä/Ä/ö/Ö.

func StartsWithUppercase(s string) bool {
    return (string(s[0]) == strings.ToUpper(string(s[0])))
}


How do I proceed to check if a string starts with upper case Swedish character? 

w := ""åÅäÄöÖ""
for i := 0; i < len(w); i++ {
    fmt.Println(i, w[i])
}


Results in:

 1. 195 
 2. 165
 3. 195
 4. 133
 5. 195 
 6. 164
 7. 195
 8. 132
 9. 195
 10. 182 
 11. 195
 12. 150

",1,28719641.0
274,28786190,How to feed a password to SSH?,"I need to use password authenticated scp to download a file from a server. How do I do so using Go? Tried the following code, but it doesn't pass in the password.

package main

import (
    ""os/exec""
    ""time""
)

func main() {
    password := ""password""
    cmd := exec.Command(""scp"", ""admin@192.168.1.150:file"", ""file"")

    in, err := cmd.StdinPipe()
    if err != nil {
        panic(err)
    }

    defer in.Close()

    out, err := cmd.StdoutPipe()
    if err != nil {
        panic(err)
    }

    defer out.Close()

    if err = cmd.Run(); err != nil {
        panic(err)
    }

    go func() {
        time.Sleep(10 * time.Second)
        _, err = in.Write([]byte(password + ""\n""))
        if err != nil {
            panic(err)
        }
    }()
}


Edit: I ended up using the gexpect (github.com/ThomasRooney/gexpect) library.

package main

import (
    ""github.com/ThomasRooney/gexpect""
    ""log""
)

func main() {
    child, err := gexpect.Spawn(""scp admin@192.168.1.150:file file"")
    if err != nil {
        log.Fatalln(err)
    }
    child.Expect(""password:"")
    child.SendLine(""password"")
    child.Interact()
    child.Close()
}

",1,
275,28791568,Compile error when comparing between named type and unamed type,"package main

import (
    ""fmt""
    ""html/template""
)

func main() {
    fmt.Println(template.HTML(""test"") == ""test"")

    htmlString := ""test""
    fmt.Println(template.HTML(""test"") == htmlString)
}


http://play.golang.org/p/dON4eLpGN8

document for template.HTML:
http://golang.org/pkg/html/template/#HTML

The first comparison is true. However, the second comparison yield following error :


  invalid operation: ""html/template"".HTML(""test"") == htmlString
  (mismatched types ""html/template"".HTML and string)


Can someone explain what happened under the hood ?
",1,28791744.0
276,28885109,How do I verify publisher acknowledge behavior,"I am writing a go program with publisher confirms, and I want to verify the behavior when a message can be delivered/not be delivered to the broker.

I am doing this from an integration test that sets up a queue, and asks my system code to send to that queue name. Verifying the behavior for publisher ack is no problem, but I cannot provoke a situation that results in a publisher nack.

I try to send a message to a non-existing queue with the following piece of code:

connection, err := amqp.Dial(""amqp://localhost"")
if err != nil {
    panic(err)
}
defer connection.Close()
channel, err := connection.Channel()
if err != nil {
    panic(err)
}
err = channel.Confirm(false)
if err != nil {
    panic(err)
}
pubAck, pubNack := channel.NotifyConfirm(make(chan uint64, 1), make(chan uint64, 1))
fmt.Println(""Publish to queue: "", queueName)
msg := amqp.Publishing{
    Body: []byte(""Hello"")}
err = channel.Publish("""", queueName, true, true, msg)
if err != nil {
    panic(err)
}
select {
case <-pubAck:
    fmt.Println(""Ack"")
case <-pubNack:
    fmt.Println(""NAck"")
}


The queue name is indeed a non existing queue, and executing sudo rabbitmqctl list_queues shows that the list of queues is empty.

But it still prints ""Ack""

I have set both mandatory and immediate to true


  Publishings can be undeliverable when the mandatory flag is
  true and no queue is bound that matches the routing key, or when the
  immediate flag is true and no consumer on the matched queue is ready
  to accept the delivery


Is my approach for sending to a non-existing queue a wrong approach, and is there another way I can send a message that will provoke a publisher nack?
",1,
277,28901604,Mongodb got stack overflow by unmarshal,"I want to use mongodb in golang and wrote an sample application:

package main

import (
    ""fmt""
    ""labix.org/v2/mgo""
    ""labix.org/v2/mgo/bson""
    ""os""
)

type Session struct {
    Id   bson.ObjectId          `bson:""_id""`
    Data map[string]interface{} `bson:""data""`
}

func (rcv *Session) SetBSON(raw bson.Raw) error {
    return raw.Unmarshal(rcv)
}


type Authen struct {
    Name  string `bson:""name""`
    Email string `bson:""email""`
}

func main() {
    uri := ""mongodb://localhost/""
    if uri == """" {
        fmt.Println(""no connection string provided"")
        os.Exit(1)
    }

    sess, err := mgo.Dial(uri)
    if err != nil {
        fmt.Printf(""Can't connect to mongo, go error %v\n"", err)
        os.Exit(1)
    }
    defer sess.Close()

    sess.SetSafe(&mgo.Safe{})
    collection := sess.DB(""test"").C(""sess"")

    a := &Authen{Name: ""Cormier"", Email: ""cormier@example.com""}
    s := &Session{}
    s.Id = bson.NewObjectId()
    s.Data = make(map[string]interface{})
    s.Data[""logged""] = a

    err = collection.Insert(s)
    if err != nil {
        fmt.Printf(""Can't insert document: %v\n"", err)
        os.Exit(1)
    }

    c := &Session{}
    c.Id = bson.NewObjectId()
    c.Data = make(map[string]interface{})

    err = sess.DB(""test"").C(""sess"").Find(bson.M{}).One(c)
    if err != nil {
        fmt.Printf(""got an error finding a doc %v\n"")
        os.Exit(1)
    }

}


Insert into mongodb works like a charm, but to unmarshal back to reference I've got following panic:

runtime: goroutine stack exceeds 1000000000-byte limit
fatal error: stack overflow

runtime stack:
runtime.throw(0x6d84d9)
        c:/go/src/runtime/panic.go:491 +0xad
runtime.newstack()
        c:/go/src/runtime/stack.c:784 +0x5ef
runtime.morestack()
        c:/go/src/runtime/asm_amd64.s:324 +0x86


What am I doing wrong?
",1,28902682.0
278,28983831,golang: read text file line by line of int strings,"I am dealing with an input file containing a list of integers as a string

10
..


I have choosen to read it line by line with ReadString('\n') method

The following code 

line, error := inputReader.ReadString('\n')
lineStr := string(line)


console output (length and value)

lineStr %v 4
lineStr %v 10


lineStr as a length of ""4"", maybe because of rune encoding.

Then I have tried several way to convert it to simple integer but with no success.

Ex1

num, _ := strconv.ParseUint(lineStr, 0, 64)


ouputs a num of 0 (should be 10)

Ex2

num, _ := strconv.Atoi(lineStr)


ouputs a num of 0 (should be 10)

Ex3

num, _ := strconv.Atoi(""10"")


ouputs a num of 10 (ok)

Ex4

num, _ := strconv.ParseUint(""10"", 0, 64)


ouputs a num of 10 (ok)

string in literal are ok but string from file do not work, what is wrong ?

thanks in advance
",3,28984161.0
279,29165973,Golang converting hash table to JSON,"How to convert a Hashtable into JSON in GoLang ? I want to convert a hash table  into a JSON to be able to send it as POST request payload 

data := make(map[string]string)
data[""a""] = ""b""
data[""c""] = ""d""


How do i convert this to JSON ?
",1,29166419.0
280,29190333,Golang Goroutine leak,"// Copyright 2012 The Go Authors.  All rights reserved.
// Use of this source code is governed by a BSD-style
// license that can be found in the LICENSE file.

// +build ignore

package main

import (
    ""fmt""

    ""code.google.com/p/go-tour/tree""
)

func walkImpl(t *tree.Tree, ch chan int) {
    if t == nil {
        return
    }
    walkImpl(t.Left, ch)
    ch <- t.Value
    walkImpl(t.Right, ch)
}

// Walk walks the tree t sending all values
// from the tree to the channel ch.
func Walk(t *tree.Tree, ch chan int) {
    walkImpl(t, ch)
    // Need to close the channel here
    close(ch)
}

// Same determines whether the trees
// t1 and t2 contain the same values.
// NOTE: The implementation leaks goroutines when trees are different.
// See binarytrees_quit.go for a better solution.
func Same(t1, t2 *tree.Tree) bool {
    w1, w2 := make(chan int), make(chan int)

    go Walk(t1, w1)
    go Walk(t2, w2)

    for {
        v1, ok1 := <-w1
        v2, ok2 := <-w2
        if !ok1 || !ok2 {
            return ok1 == ok2
        }
        if v1 != v2 {
            return false
        }
    }
}

func main() {
    fmt.Print(""tree.New(1) == tree.New(1): "")
    if Same(tree.New(1), tree.New(1)) {
        fmt.Println(""PASSED"")
    } else {
        fmt.Println(""FAILED"")
    }

    fmt.Print(""tree.New(1) != tree.New(2): "")
    if !Same(tree.New(1), tree.New(2)) {
        fmt.Println(""PASSED"")
    } else {
        fmt.Println(""FAILED"")
    }
}


In this code, a solution for http://tour.golang.org/concurrency/8

Why is there a comment on Same() func Same(t1, t2 *tree.Tree) bool saying that it leaks goroutines? How so? It also mentions a second file that fixes this: 

// Copyright 2015 The Go Authors.  All rights reserved.
// Use of this source code is governed by a BSD-style
// license that can be found in the LICENSE file.

// +build ignore

package main

import (
    ""fmt""

    ""code.google.com/p/go-tour/tree""
)

func walkImpl(t *tree.Tree, ch, quit chan int) {
    if t == nil {
        return
    }
    walkImpl(t.Left, ch, quit)
    select {
    case ch <- t.Value:
        // Value successfully sent.
    case <-quit:
        return
    }
    walkImpl(t.Right, ch, quit)
}

// Walk walks the tree t sending all values
// from the tree to the channel ch.
func Walk(t *tree.Tree, ch, quit chan int) {
    walkImpl(t, ch, quit)
    close(ch)
}

// Same determines whether the trees
// t1 and t2 contain the same values.
func Same(t1, t2 *tree.Tree) bool {
    w1, w2 := make(chan int), make(chan int)
    quit := make(chan int)
    defer close(quit)

    go Walk(t1, w1, quit)
    go Walk(t2, w2, quit)

    for {
        v1, ok1 := <-w1
        v2, ok2 := <-w2
        if !ok1 || !ok2 {
            return ok1 == ok2
        }
        if v1 != v2 {
            return false
        }
    }
}

func main() {
    fmt.Print(""tree.New(1) == tree.New(1): "")
    if Same(tree.New(1), tree.New(1)) {
        fmt.Println(""PASSED"")
    } else {
        fmt.Println(""FAILED"")
    }

    fmt.Print(""tree.New(1) != tree.New(2): "")
    if !Same(tree.New(1), tree.New(2)) {
        fmt.Println(""PASSED"")
    } else {
        fmt.Println(""FAILED"")
    }
}


How does it accomplish that? Where was this leak? (to test the code you will have to run it on http://tour.golang.org/concurrency/8). Very confused and would appreciate some help, thanks!
",2,29190369.0
281,29269850,Why do I receive values from a closed channel?,"I'm investigating the channels behaviour and I'm quite confused by their behaviour. The spec say After calling close, and after any previously sent values have been received, receive operations will return the zero value for the channel's type without blocking. However it seems I still get the values in the range statement even if by that time the channel is closed. Why is that?

package main

import ""fmt""
import ""sync""
import ""time""

func main() {
    iCh := make(chan int, 99)
    var wg sync.WaitGroup
    go func() {
        for i := 0; i < 5; i++ {
            wg.Add(1)
            go func(i int) {
                defer wg.Done()
                iCh <- i
            }(i)

        }
        wg.Wait()
        close(iCh)
    }()
    time.Sleep(5 * time.Second)
    print(""the channel should be closed by now\n"")
    for i := range iCh {
        fmt.Printf(""%v\n"", i)
    }
    print(""done"")
}


Edit: It seems that if I move the close statement just before the channel range it closes it for good. So I'm wondering why it's not working with the ""time.Sleep"" trick too . By that time (5 seconds) all the go routines should have been completed and the channel closed, isn't it ?
",1,29269960.0
282,29282728,Slice of structs to unsorted list with mustache,"I have a struct.

type DataKey struct {
    Id        int64     `db:""id""`
    UserId    string    `db:""user_id""`
    Data      string    `db:""data""`
    CreatedAt time.Time `db:""created_at""`
}


I create a slice of structs.

data := []DataKey{}


After doing a sql query and filling the slices I try to pass to mustache to build my list.

mustache.RenderFileInLayout(""templates/datakeys.html.mustache"", ""templates/layout.html.mustache"", user, data)))


datakeys.html.mustache



    
        #
        UserID
        DataKey
        CreatedAt
    

{{#DataKey}}
    
        {{Id}}
        {{UserId}}
        {{Data}}
        {{CreatedAt}}
    
{{/DataKey}}



The only thing I get is the table header. This function does not return an error so I don't know why it didn't like the data. I have also tried passing it in as a reference.
",1,29284050.0
283,29285670,Google App Engine Golang no such file or directory,"I am developing a Google App Engine project in go and got stuck at reading files.
In fact app works perfectly locally. However when deployed, it panics telling me that there is no such file or directory.

Here is my fileValue method:

func fileValue(path string) string {
    content, err := ioutil.ReadFile(path)
    if err != nil {
        panic(err)
    }
    return string(content)
}


And I call it like this:

secondPart := fileValue(""./console/page/secondPart.html"")


And this is what I can se under logs in developers console:

panic: open ./console/page/firstPart.html: no such file or directory

goroutine 11 [running]:
console.fileValue(0x19582f0, 0x1d, 0x0, 0x0)
    console/console.go:191 +0xbd
console.generateUnsignedHtml(0xc01043a780, 0x0, 0x0)
    console/console.go:68 +0x69
console.consoleHandler(0x7f180fa61830, 0xc01042f380, 0xc0105640d0)
    console/console.go:58 +0x37e
net/http.HandlerFunc.ServeHTTP(0x1a21210, 0x7f180fa61830, 0xc01042f380, 0xc0105640d0)
    go/src/net/http/server.go:1265 +0x56
net/http.(*ServeMux).ServeHTTP(0xc01048a8a0, 0x7f180fa61830, 0xc01042f380, 0xc0105640d0)
    go/src/net/http/server.go:1541 +0x1b4
appengine_internal.executeRequestSafely(0xc01042f380, 0xc0105640d0)
    go/src/appengine_internal/api_prod.go:280 +0xb7
appengine_internal.(*server).HandleRequest(0x1be76f0, 0xc010540000, 0xc0104ba000, 0xc010430b60, 0x0, 0x0)
    go/src/appengine_internal/api_prod.go:214 +0x102b
reflect.Value.call(0x1842640, 0x1be76f0, 0x113, 0x18d1380, 0x4, 0xc010533f78, 0x3, 0x3, 0x0, 0x0, ...)
    /tmp/appengine/go/src/reflect/value.go:419 +0x10fd
reflect.Value.Call(0x1842640, 0x1be76f0, 0x113, 0xc010533f78, 0x3, 


Any idea why this happens and how to fix it?

Thanks in advance :)
",1,29288854.0
284,29323560,"Bug detect, go channels with select","There is supposed to be a bug in this bit of code. My mate told me that it contains a memory leak and it occurs when the time out case happens in the select statement before the go function has finished and he also told me that adding a buffer of size one to ch would solve the problem. But i have a hard time understanding why it would solve the problem and would appreciate if someone could explain if for me? I've tried to search for the answer myself but with no success.

Thanks.

func Read(url string, timeout time.Duration) (res *Response) {
    ch := make(chan *Response)
    go func() {
        time.Sleep(time.Millisecond * 300)
        ch <- Get(url)
    }()
    select {
    case res = <-ch:
    case <-time.After(timeout):
        res = &Response{""Gateway timeout\n"", 504}
    }
}

",1,29323726.0
285,29377477,Loop over array of items that implement an interface,"Suppose I have an array of items that implement an interface Reader:

var items []Foo


How would I pass these items into a function that takes readers?

func (items []Reader) { ... }


I can't use the type []Reader because I get an error like:

Cannot use type `[]Foo` as type `[]Reader`...

",2,29378153.0
286,29422602,Golang: reflect.DeepEqual returns false,"I'm curious why this DeepEqual check is false:

package main

import (
    ""encoding/json""
    ""fmt""
    ""log""
    ""reflect""
    ""strings""
)

type Result struct {
    Topic string `json:""topic,omitempty""`
    Id    int    `json:""id,omitempty""`
}

// Result represents the returned collection from a topic search.
type ResultResponse struct {
    Result []Result `json:""results""`
}

func main() {
    want := ResultResponse{
        []Result{{Topic: ""Clojure"", Id: 1000}},
    }

    input := `{""results"": [ {""topic"": ""Clojure"", ""id"": 1000} ]}`
    p := ResultResponse{}

    err := json.NewDecoder(strings.NewReader(input)).Decode(&p)

    if err != nil {
        panic(err)
    }

    fmt.Println(p, want)

    if !reflect.DeepEqual(input, want) {
        log.Printf(""returned %+v, want %+v"", p, want)
    }


}

",2,
287,29444817,Go - How can I check for type equality?,"Say I have the following code:

var x interface{}
y := 4
x = y
fmt.Println(reflect.TypeOf(x))


This will print int as the type. My question is how can I test for the type? I know there is the type switch which does this, so I could do:

switch x.(type) {
case int:
    fmt.Println(""This is an int"")
}


But if I only want to check for just one specific type the switch seems like the wrong tool. Is there a more direct method of doing this like

reflect.TypeOf(x) == int


or is the type switch the way to go?
",3,29444890.0
288,29445173,How to limit download speed with Go?,"I'm currently developing a download server in Go. I need to limit the download speed of users to 100KB/s.

This was my code:

func serveFile(w http.ResponseWriter, r *http.Request) {
    fileID := r.URL.Query().Get(""fileID"")
    if len(fileID) != 0 {
        w.Header().Set(""Content-Disposition"", ""attachment; filename=filename.txt"")
        w.Header().Set(""Content-Type"", r.Header.Get(""Content-Type""))
        w.Header().Set(""Content-Length"", r.Header.Get(""Content-Length""))

        file, err := os.Open(fmt.Sprintf(""../../bin/files/test.txt""))
        defer file.Close()
        if err != nil {
            http.NotFound(w, r)
            return
        }
        io.Copy(w, file)
    } else {
        io.WriteString(w, ""Invalid request."")
    }
}


Then I found a package on github and my code became the following:

func serveFile(w http.ResponseWriter, r *http.Request) {
    fileID := r.URL.Query().Get(""fileID"")
    if len(fileID) != 0 {
        w.Header().Set(""Content-Disposition"", ""attachment; filename=Wiki.png"")
        w.Header().Set(""Content-Type"", r.Header.Get(""Content-Type""))
        w.Header().Set(""Content-Length"", r.Header.Get(""Content-Length""))

        file, err := os.Open(fmt.Sprintf(""../../bin/files/test.txt""))
        defer file.Close()
        if err != nil {
            http.NotFound(w, r)
            return
        }
        bucket := ratelimit.NewBucketWithRate(100*1024, 100*1024)
        reader := bufio.NewReader(file)
        io.Copy(w, ratelimit.Reader(reader, bucket))
    } else {
        io.WriteString(w, ""Invalid request."")
    }
}


But I'm getting this error:


  Corrupted Content Error
  
  The page you are trying to view cannot be shown because an error in
  the data transmission was detected.


Here's my code on the Go playground: http://play.golang.org/p/ulgXQl4eQO
",2,29447927.0
289,29476611,Go simple API Gateway proxy,"I've been searching all over the internet how to do this, but I haven't been able to find it. I'm trying to build a simple API gateway using Go and Martini for my system that has a few microservices with REST interfaces running. For example, I have my users service running on 192.168.2.8:8000, and I want to access it through /users

So my API gateway would look something like this:

package main

import (
    ""github.com/codegangsta/martini""
    ""net/http""
)

func main(){
    app := martini.Classic()
    app.Get(""/users/:resource"", func(req *http.Request, res http.ResponseWriter){
        //proxy to http://192.168.2.8:8000/:resource
    })
    app.Run()
}



edit



I've got something working, but all i see is [vhost v2] release 2.2.5:

package main

import(
    ""net/url""
    ""net/http""
    ""net/http/httputil""
    ""github.com/codegangsta/martini""
    ""fmt""
)

func main() {
    remote, err := url.Parse(""http://127.0.0.1:3000"")
    if err != nil {
        panic(err)
    }

    proxy := httputil.NewSingleHostReverseProxy(remote)
    app := martini.Classic()
    app.Get(""/users/**"", handler(proxy))
    app.RunOnAddr("":4000"")
}

func handler(p *httputil.ReverseProxy) func(http.ResponseWriter, *http.Request, martini.Params) {
    return func(w http.ResponseWriter, r *http.Request, params martini.Params) {
        fmt.Println(params)
        r.URL.Path = ""/authorize""
        p.ServeHTTP(w, r)
    }
}



edit 2



This only seems to be a problem when using it directly through the browser, XMLHttpRequest works just fine
",1,
290,29620344,How to get google e-mail using OAuth2 in Golang correctly,"I've already tried to authenticate using OAuth sucessfully with golang.com/x/oauth2 library.

// provider variable is oauth2.Config
// scope is: https://www.googleapis.com/auth/userinfo.email
url := provider.AuthCodeURL(``) // redirect URL


after getting redirected back from the client, I send the auth_code successfully

auth_code := ctx.Request.URL.RawQuery // code=XXXX
if len(auth_code) > 5 {
    auth_code = auth_code[5:] // XXXX
}
tok, err := provider.Exchange(oauth2.NoContext, auth_code)
if err == nil {
    client := provider.Client(oauth2.NoContext, tok)
    email_url := `https://www.googleapis.com/auth/userinfo.email`
    //Log.Describe(client)
    response, err := client.Get(email_url) 
    if err == nil {
        ctx.Render(`login_oauth`, response)
        //handled = true
    }
}
//Log.Describe(err)


I found nothing that tells the e-mail part on the response (the Body is empty):

{
    ""Status"": ""200 OK"",
    ""StatusCode"": 200,
    ""Proto"": ""HTTP/1.1"",
    ""ProtoMajor"": 1,
    ""ProtoMinor"": 1,
    ""Header"": {
        ""Alternate-Protocol"": [
            ""443:quic,p=0.5""
        ],
        ""Cache-Control"": [
            ""private, max-age=0""
        ],
        ""Content-Type"": [
            ""text/plain""
        ],
        ""Date"": [
            ""Tue, 14 Apr 2015 05:52:17 GMT""
        ],
        ""Expires"": [
            ""Tue, 14 Apr 2015 05:52:17 GMT""
        ],
        ""Server"": [
            ""GSE""
        ],
        ""X-Content-Type-Options"": [
            ""nosniff""
        ],
        ""X-Frame-Options"": [
            ""SAMEORIGIN""
        ],
        ""X-Xss-Protection"": [
            ""1; mode=block""
        ]
    },
    ""Body"": {}, // empty!!!
    ""ContentLength"": -1,
    ""TransferEncoding"": [
        ""chunked""
    ],
    ""Close"": false,
    ""Trailer"": null,
    ""Request"": {
        ""Method"": ""GET"",
        ""URL"": {
            ""Scheme"": ""https"",
            ""Opaque"": """",
            ""User"": null,
            ""Host"": ""www.googleapis.com"",
            ""Path"": ""/auth/userinfo.email"",
            ""RawQuery"": """",
            ""Fragment"": """"
        },
        ""Proto"": ""HTTP/1.1"",
        ""ProtoMajor"": 1,
        ""ProtoMinor"": 1,
        ""Header"": {
            ""Authorization"": [
                ""Bearer ya29.VQFRHDe21t7g2cUhN8sUwjpRRi10XldgLe0RFhMe2ZxgyRo7q90HoKES5WmcucwKqtjZdq_KvYjKiQ""
            ]
        },
        ""Body"": null,
        ""ContentLength"": 0,
        ""TransferEncoding"": null,
        ""Close"": false,
        ""Host"": ""www.googleapis.com"",
        ""Form"": null,
        ""PostForm"": null,
        ""MultipartForm"": null,
        ""Trailer"": null,
        ""RemoteAddr"": """",
        ""RequestURI"": """",
        ""TLS"": null
    },
    ""TLS"": {
         // really long output
    }
}


First question, how to get the e-mail correctly? without using Google+ API.

edit #2 I've tried using another scope for oauth2.Config:

https://www.googleapis.com/auth/plus.profile.emails.read
https://www.googleapis.com/auth/plus.login
https://www.googleapis.com/auth/plus.me


and try to retrieve the e-mail using newer API:

https://www.googleapis.com/plus/v1/people/me


but it gives 403 Forbidden

edit #3 I've tried using another scope:

openid
profile
email


and try to retrieve the e-mail using this URL:

https://www.googleapis.com/oauth2/v3/userinfo


but it still give empty Body as before.

Second question, can I reuse the oauth2.Config (provider) variable for another user? or should I create a copies for each user?
",1,29621608.0
291,29654175,Does Go optimize out unreachable if-statements?,"Go has a very unfortunate lack of built-in assertions. I want to implement them this way:

const ASSERT = true

func SomeFunction() {
        if ASSERT && !some_condition_that_should_always_be_true() {
                panic(""Error message or object."")
        }
}


My question is will the if-statement be optimized out if I define const ASSERT = false?
",1,29654409.0
292,29659626,Setting package path in Go,"Getting started with Go and going through the docs here: https://golang.org/doc/code.html

The part entitled Package paths recommends using my Github account as a base path. However, with the forward slashes in the GH url, when I run mkdir -p $GOPATH/src/github.com/user it creates a sub-folder. So the example of github.com/user creates:

src/
    github.com/
        user/


but I don't think this is what's intended.

What can I do here?
",2,29659664.0
293,29669835,regexp get matches by group,"I want to parse a string and get the substring inside two quotes

subject

query=""tag1 tag2""


pattern

query=""([a-z ]*)""


result

tag1 tag2


code

package main

import (
  ""fmt""
  ""regexp""
)

var re = regexp.MustCompile(`query=""([a-z ]*)""`)

func main() {
  match  := re.FindStringSubmatch(`query=""tag1 tag2""`)
  result := make(map[string]string)
  for i, name := range re.SubexpNames() {
     result[name] = match[i]
  }
  fmt.Printf(""by name: %v\n"", result)
}


http://play.golang.org/p/voKpOlcc8J

update

string

query=""tag1 tag2 tag3"" foo=""wee""


matches
tag1 tag2 tag3

package main

import ""fmt""
import ""regexp""

func main() {
    var str string = `query=""tag1 tag2 tag3"" foo=""wee""`
    re := regexp.MustCompile(`query=""(([a-z0-9]+) ?)*""`)
    match := re.FindStringSubmatch(str)
    if len(match) == 0 {
        fmt.Print(""no matches"")
    } else {
        result := make(map[string]string)
        for i, name := range re.SubexpNames(){
            result[name] = match[i]
        }
        fmt.Print(result)
    }
}


http://play.golang.org/p/8vieH4eDd1
",3,29674185.0
294,29670462,golang - extract elements in xml string,"I want to extract all loc element value but I am getting an empty array

My code:

package main

import (
    ""fmt""
    ""encoding/xml""
)

type Query struct {
    XMLName xml.Name `xml:""urlset""`
    locs []Loc `xml:""url>loc""`
}

type Loc struct {
    loc string 
}

var data = []byte(`

   http://www.konga.com/mobile-recharge
   2015-04-14
   daily
   0.5


   http://www.konga.com/beauty-health-personal-care
   2015-04-14
   daily
   0.5

`)


func main() {

    var q Query
    xml.Unmarshal(data, &q)
    fmt.Println(q.locs)
}

",1,29670705.0
295,29738391,Creating a map from an array of struct pointers,"I have an array of pointers to structs. The structs have a name field. I want to create a map from names to pointers to structs. 

Why are all of the values in the registry map identical?

package main

import ""fmt""

type Thing struct {
    Name  string
    Value int
}

type Registry map[string]*Thing

func toRegistry(things *[]Thing) Registry {

    registry := make(Registry)

    for _, thing := range *things {
        registry[thing.Name] = &thing
    }
    return registry
}

func main() {

    things := []Thing{{""thingA"", 1}, {""thingB"", 2}}
    registry := toRegistry(&things)
    fmt.Println(registry)

}


Sample output: map[thingB:0x10436180 thingA:0x10436180]

GO

EDIT

Per @tvblah's suggestion, things was already a slice, so there's no need to point to it:

package main

import ""fmt""

type Thing struct {
    Name  string
    Value int
}

type Registry map[string]*Thing

func toRegistry(things []Thing) Registry {

    registry := make(Registry)

    for _, thing := range things {
        registry[thing.Name] = &thing
    }
    return registry
}

func main() {

    things := []Thing{{""thingA"", 1}, {""thingB"", 2}}
    registry := toRegistry(things)
    fmt.Println(registry)


GO
",2,29738472.0
296,29840375,"Figure source of ""invalid memory address ... "" with http.client","I learning the go and struggling with this panic error... it working for some time, but soon end up with such exception panic: runtime error: invalid memory address or nil pointer dereference

The function simply iterate over map of proxies until it successfully get the content of the ""address"". It must be not very idiomatic, especially using map instead of slice and the last return, but I hope that is not the reason of panic crush... 
if I omitted something possible important please, let me know, I will update the post, I just do not want to flood it with unnecessary info. 
proxies is a struct with map field with methods for concurrent safe read/delete. 

func getContent(address string) string {
localProxies := proxies.Get()
for proxy := range localProxies {
    proxyUrl, _ := url.Parse(""http://"" + proxy)

    transport := http.Transport{
        Dial:  dialTimeout,
        Proxy: http.ProxyURL(proxyUrl),
    }
    httpClient := http.Client{Transport: &transport, Timeout: timeout}
    req, err := http.NewRequest(""GET"", address, nil)
    if err != nil {
        fmt.Println(""Request error: "", err.Error())
    }
    req.Header.Set(""User-Agent"", ""Mozilla/5.0 (Windows NT 6.1; WOW64; rv:34.0) Gecko/20100101 Firefox/34.0"")
    res, err := httpClient.Do(req)
    defer res.Body.Close()

    if err != nil {
        //          fmt.Println(""Broken "", proxy)
        fmt.Println(""Response error: "", err.Error())
        proxies.Del(proxy)
        continue
    }
    if res.StatusCode != 200 {
        //          fmt.Println(""Status error: "", res.Status)
        proxies.Del(proxy)
        continue
    }
    out, err := ioutil.ReadAll(res.Body)
    if err != nil {
        fmt.Println(""Read error: "", err.Error())
        proxies.Del(proxy)
        continue
    }
    return string(out)
}
return ""error""


}

go version go1.4.2 linux/amd64
",1,29840479.0
297,29871585,how do you log function call return values in golang,"I want to know the return values at time of exit from a golang function. The golang defer mechanism is helpful, but it evaluates arguments at the time the defer statement is registered rather than when it is executed. I can work with this using an anonymous function which accesses the return values:

func try() (int i) {
  defer func() {fmt.Printf(""%d"", i)}()
  i = 10
  return i+1
}

func main() {
  try()
}


This would work ok, i think, but I would like to handle this in a generic manner, perhaps something like:

func try(in string) (out int) {
  enter(""%s"", in);exit(""%d"", out)
}


or, even better, use reflection to output the arguments/return values at time of entry/exit. I'm assuming runtime performance isn't critical :). 

Is there a good way to do this? Shaba Abhiram's handy Tracey lib does go a long way towards this but stops short of printing the return values.
",2,
298,29871954,GOLANG HTTP Basic-Auth with Google App Engine URLFetch,"How can I add an Authorization header to urlfetch client with Go?

There is a similar question answered for java and python, but not Go.
",2,
299,29929750,Go - Golang openpg - Create Key pair and create signature,"I'm currently working on openpgp in combination with golang. I use the following code to generate a new keypair and create a self-signature on the resulting public key:

package main

import (
    ""bytes""
    ""crypto""
    ""time""
    ""golang.org/x/crypto/openpgp""
    ""golang.org/x/crypto/openpgp/armor""
    ""golang.org/x/crypto/openpgp/packet""
    ""fmt""
)

//Create ASscii Armor from openpgp.Entity
func PubEntToAsciiArmor(pubEnt *openpgp.Entity) (asciiEntity string) {
    gotWriter := bytes.NewBuffer(nil)
    wr, errEncode := armor.Encode(gotWriter, openpgp.PublicKeyType, nil)
    if errEncode != nil {
        fmt.Println(""Encoding Armor "", errEncode.Error())
        return
    }
    errSerial := pubEnt.Serialize(wr)
    if errSerial != nil {
        fmt.Println(""Serializing PubKey "", errSerial.Error())
    }
    errClosing := wr.Close()
    if errClosing != nil {
        fmt.Println(""Closing writer "", errClosing.Error())
    }
    asciiEntity = gotWriter.String()
    return
}


func main() {

    var entity *openpgp.Entity
    entity, err := openpgp.NewEntity(""itis"", ""test"", ""itis@itis3.com"", nil)
    if err != nil {
        fmt.Println(""ERROR"")
    }

    usrIdstring := """"
    for _, uIds := range entity.Identities {
        usrIdstring = uIds.Name

    }

    var priKey = entity.PrivateKey
    var sig = new(packet.Signature)    
    //Prepare sign with our configs/////IS IT A MUST ??
    sig.Hash = crypto.SHA1
    sig.PubKeyAlgo = priKey.PubKeyAlgo
    sig.CreationTime = time.Now()
    dur := new(uint32)
    *dur = uint32(365 * 24 * 60 * 60)
    sig.SigLifetimeSecs = dur //a year
    issuerUint := new(uint64)
    *issuerUint = priKey.KeyId
    sig.IssuerKeyId = issuerUint
    sig.SigType = packet.SigTypeGenericCert


    err = sig.SignKey(entity.PrimaryKey, entity.PrivateKey, nil)
    if err != nil {
        fmt.Println(""ERROR"")
    }
    err = sig.SignUserId(usrIdstring, entity.PrimaryKey, entity.PrivateKey, nil)
    if err != nil {
        fmt.Println(""ERROR"")
    }

    entity.SignIdentity(usrIdstring, entity, nil)

    var copy = entity
    var asciiSignedKey = PubEntToAsciiArmor(copy)
    fmt.Println(asciiSignedKey)
}


1.) When I serialize the public key (to get an armored version of it), I get the following error message: 


  Serializing PubKey  openpgp: invalid argument: Signature: need to call Sign, SignUserId or SignKey before Serialize


I thought I just used every possible way to create a signature on that key?

2.) I still receive an output from problem 1, when I upload the key to a keyserver, than the available information are incomplete. Only the key-id and the creation date are listed. All additional information like, self-signature, user-id-string and so on are missing (example: https://pgp.mit.edu/pks/lookup?search=0xbe6ee21e94a73ba5&op=index). What went wrong? Is it related to error 1?

PS: I am new to golang, started today.
",3,29948833.0
300,30041461,Which design pattern to use to store streams of objects of different types to disk in go?,"Consider a function that saves streams of objects of different types to disk:

func Save(fill func(c chan BaseType), file string) {}


This function is used in the following way throughout the code:

// Here we've got different data structures data1, data2, ...
// that must be stored to disk
Save(
  func(c chan BaseType) {
    // SaveChildren1 generates objects of type Child1 based
    // on the data1 data structure
    SaveChildren1(c, data1) 
  },
  filename1)

Save(
  func(c chan BaseType) {
    // SaveChildren2 generates objects of type Child2 based
    // on the data2 data structure
    SaveChildren2(c, data2)
  },
  filename2)


And so on. There are a lot of different child types and each requires it's own generator -- a function SaveChildren1, SaveChildren2 etc. These functions actually fill the channels with objects.

The question is how would you refactor these ""binders"" -- the functions that transform SaveChildren (a function of 2 args) into a function of 1 argument? Currently this code doesn't look like a well written go-style code.
",1,
301,30105798,Go - constructing struct/json on the fly,"In Python it is possible to create a dictionary and serialize it as a JSON object like this:

example = { ""key1"" : 123, ""key2"" : ""value2"" }
js = json.dumps(example)


Go is statically typed, so we have to declare the object schema first:

type Example struct {
    Key1 int
    Key2 string
}

example := &Example { Key1 : 123, Key2 : ""value2"" }
js, _ := json.Marshal(example)


Sometimes object (struct) with a specific schema (type declaration) is needed just in one place and nowhere else. I don't want to spawn numerous useless types, and I don't want to use reflection for this. 

Is there any syntactic sugar in Go that provides a more elegant way to do this? 
",2,30106057.0
302,30217782,Failing to List.PushBack,"Take a look at the following source code:

import ""container/list""

type Stream struct {
    list list.List
}

func (s Stream) Append(value interface{}) {
    log.Println(s.list.Len())
    s.list.PushBack(value)
    log.Println(s.list.Len())
}


This code will keep on printing 0 and 1 all the time. Am I doing it wrong?
",1,30217870.0
303,30233217,Serve json file from GO server to javascript client,"I have a go server which has to respond to a javascript request by serving a json file. The json file is an array of objects. 

My code :

Server side

package expt

import (
    ""net/http""
)


func init() {
    http.HandleFunc(""/"", handleStatic)
    http.HandleFunc(""/loadTrials"", handleloadJson)
}

func handleStatic(w http.ResponseWriter, r *http.Request) {
    w.Header().Set(""Cache-Control"", ""no-cache"")
    http.ServeFile(w, r, ""static/""+r.URL.Path)
}


func handleloadJson(w http.ResponseWriter, r *http.Request) {
    http.ServeFile(w, r, ""static/trial.json"")
}


Client side

loadTrials : function loadTrials() {

            var _this = this,
                load = this.shadowRoot.querySelector('#load-trial');

            load.url=""http://url:8080/loadTrials"";
            load.go()
            load.addEventListener('core-response', function(ev) {
                console.log(ev.detail.response)
            }, false);
        }


Json

{
  ""trial-data"" : [
    {
      ""trial"" : {
        ""index"": 0,
      }
    },
    {
      ""trial"" : {
        ""index"": 1,
      }
    }
  ]
}


If I do that I get the JSON object in JavaScript, but if I try to look into the JSON to get the array- i.e. console.log(ev.detail.response['trial-data']) then this doesn't work. 
",1,30233728.0
304,30234610,Filtering by date in GORM,"I'm using GORM to access the records in my database. Now I want to retrieve all records that are not deleted which means, that the attribute DeletedAt must be NULL.

I tried the following command chains with WHERE(), but they returned no results.

users := []*models.User{}
db.Where(""deleted_at"", nil).Find(&users)


and

db.Where(""deleted_at"", ""NULL"").Find(&users)


My database model is defined by the following structs:

type Model struct {
    ID        uint `gorm:""primary_key""`
    CreatedAt time.Time
    UpdatedAt time.Time
    DeletedAt *time.Time
}

type User struct {
    gorm.Model
    Username string `sql:""size:32; not null; unique""`
    Password string `sql:""not null""`
    Locale   string `sql:""not null""`
}

",1,30237486.0
305,30242905,How to use external .c files with CGO?,"To write some C code in a comment above import ""C"" is straightforward:

// foo.go
package main

/*
int fortytwo() {
    return 42;
}
*/
import ""C""
import ""fmt""

func main() {
    fmt.Printf(""forty-two == %d\n"", C.fortytwo())
    fmt.Printf(""forty-three == %d\n"", C.fortythree())
}


And it works fine:

$ go install
$ foo
forty-two == 42


However, C code in it's own .c file:

// foo.c
int fortythree() {
  return 43;
}


...referenced from Go:

// foo.go
func main() {
    fmt.Printf(""forty-two == %d\n"", C.fortytwo())
    fmt.Printf(""forty-three == %d\n"", C.fortythree())
}


...does not work:

$ go install
# foo
could not determine kind of name for C.fortythree

",1,30242906.0
306,30287218,casting to struct type in go lang,"I have some c macros in the form of 

#define VARATT_IS_4B(PTR) \
    ((((varattrib_1b *) (PTR))->va_header & 0x80) == 0x00)


and want to convert it to Go lang. I am doing something like 

func varAttIs1B(ptr uintptr) bool {
    return (*varAttrib1b(ptr).vaHeader & 0x01) == 0x01
}


but yeah, it is not working and I am getting compiler error ""cannot convert ptr (type int) to type varAttrib1b"".

varAttrib1b is a struct with two fields and ptr is a uintptr(could be some other type also). 

type varAttrib1b struct {
    vaHeader uint8
    vaData   []string
}


How can I do this?
",1,30290367.0
307,30339877,Why isn't my GoLang POST request being populated with data?,"func forwarderHandlerFunc(w http.ResponseWriter, r *http.Request) {
    client := &http.Client{}
    u, _ := url.Parse(r.RequestURI)
    req, _ := http.NewRequest(r.Method, fmt.Sprintf(""%s%s"", apiUrl, u.Path), r.Body)
    fmt.Printf(fmt.Sprintf(""%s\n"", nutils.ReaderToString(req.Body)))
    resp, _ := client.Do(req)
    resp.Write(w)
}


I am trying to forward an incoming HTTP request to another endpoint, while copying the body, including POST/PUT form data into the new request.

However, it doesn't seem to work, even if the Body seems to print out correct with data.

Print output is:


  email=meh%!g(MISSING)mail.com


How can I fix it?



Edit: Added more debug info, this time, printing out the output of resp

func forwarderHandlerFunc(w http.ResponseWriter, r *http.Request) {
    client := &http.Client{}
    u, _ := url.Parse(r.RequestURI)

    req, _ := http.NewRequest(r.Method, fmt.Sprintf(""%s%s"", apiUrl, u.Path), r.Body)
    fmt.Printf(fmt.Sprintf(""%s\n"", nutils.ReaderToString(req.Body)))

    resp, _ := client.Do(req)
    b,_ := ioutil.ReadAll(resp.Body)
    fmt.Printf(fmt.Sprintf(""%s\n"", nutils.BytesToString(b)))

    resp.Write(w)
}



$ go install && gom-proxy-forwarder run --listen localhost:5002 --api-url http://localhost:5001
email=meh2%!g(MISSING)mail.com
{
  ""email"": null
}



It should not be null. It should be meh@gmail.com
",3,30340366.0
308,30369575,Golang HTTP POST using HTTP/1.0,"Is it possible to send HTTP requests using HTTP/1.0 with golang?

I tried the following:

req, _ := http.NewRequest(""POST"", url, buffer)
req.Proto = ""HTTP/1.0""
client := &http.Client{}
resp, err = client.Do(req)


But it seems req.Proto is ignored. The message is sent out using HTTP/1.1.
",1,
309,30391141,Store 2 values in one variable,"Is this Go code correct and portable, I need to store 2 counters (each call only one counter will be updated) in one variable to avoid locks in actual code where I am going to use single atomic.AddUint64() instead of locking whole struct.

package main

import ""fmt""

var long uint64 // Actual counters storage

func main() {
    left := uint32(100) // First counter
    right := uint32(200) // Second counter
    long = uint64(left)
    long = long << 32 | uint64(right)
    fmt.Println(left, right)

    long += uint64(1 << 32) // Increment left
    long += 1 // Increment right

    xLeft := uint32(long >> 32) // Get left
    xRight := uint32(long) // Get right
    fmt.Println(xLeft, xRight)
}


http://play.golang.org/p/aBlp-Zatgn
",1,30392103.0
310,30424935,Why is the factored import statement better?,"The official tour of Go, after exhibiting a factored import like this...

import (
    ""fmt""
    ""math""
)


... contains the following slightly unclear remark:


  You can also write multiple import statements, like:

import ""fmt""
import ""math""

  
  But it is good style to use the factored import statement.


Is there actually any concrete advantage to using one approach over the other - such as a difference in behaviour or an easy-to-make typo that is only a danger with one of the two syntaxes - or is this just an arbitrary style convention?
",2,
311,30428926,Go Web app on AWS with Elastic Beanstalk not showing output in logs,"This is sort of an in-depth question, so I'll try to explain it as best I can.

I've built a small API service in Go that I'm trying to deploy to AWS using the relatively new AWS Elastic Beanstalk Docker support.

Here's what I've done (the code is all open source, so you can follow along if you'd like):

$ git clone https://github.com/rdegges/ipify-api.git
$ cd ipify-api
$ git fetch origin aws:aws
$ git checkout aws
$ eb init
$ eb create
$ eb deploy


This will use elastic beanstalk to create a new app (with docker), and deploy it.

If I then run eb open
to open my web app, I'll see my public IP address displayed (this is the correct behavior), so I know that my application is running / functional.

Now, in my source code, I've got several lines of debugging output:

fmt.Println(""WOOOOOOOOOOOO"")


The above statement just prints ""WOO…"" to the console. This is run every time a new request is made.

Unfortunately, when I run eb logs to view my instance logs, this debug line never shows up – and I can't figure out why.

I've tried printing to STDERR, printing to STDOUT, etc. – but I'm absolutely unable to get any output.

I've scoured the internet looking for solutions, but have yet to find any.
",2,30489243.0
312,30474313,How to use regexp get url pattern in golang?,"How to use regular expression matching URL, which does decide to use the corresponding function processing

package main

import(
  ""fmt""
  ""net/http""
)

func main() {
  http.HandleFunc(""/pattern"", resolve)
  http.ListenAndServe("":8080"", nil)
}

func resolve(w http.ResponseWriter, r * http.Request) {
  fmt.Println(r.URL.Host)
}

",2,30474723.0
313,30502933,Function override,"I found something interesting in Go. Let's say I have my package name is mypkg, inside mypkg, I have two functions:

package mypkg
func MyFunc0(){
    //...
}
var MyFunc1 = func(){
    //...
}


Now in my main package, it is possible to override MyFunc1, like this:

mypkg.MyFunc1 = func(){
   // new logic
}


However, it is not possible to override MyFunc0 the same way. So now a question is raised. What are the differences between the two ways of declaring a function? Is this behavior difference intended?
",2,30503061.0
314,30744205,Calling a method of a WMI Class,"I'm attempting to call the following method: https://msdn.microsoft.com/en-us/library/dn469242(v=vs.85).aspx

The corresponding powershell is:

wmic /namespace:\\ROOT\Microsoft\Windows\DesiredStateConfiguration class MSFT_DSCLocalConfigurationManager call GetConfigurationStatus


I can't quite figure out how to do it correctly using go-ole. Here's what I have so far. It fails with: invoke_test.go:47: wmi: error calling method GetConfiguration: Exception occurred. Generic failure )

When I try using GetConfigurationStatus instead of GetConfiguration, I get a Unknown name error, so I suspect this method exists I'm just invoking it wrong.

package wmi

import (
    ""testing""

    ""github.com/go-ole/go-ole""
    ""github.com/go-ole/go-ole/oleutil""
)

func TestMethod(t *testing.T) {
    err := ole.CoInitializeEx(0, ole.COINIT_MULTITHREADED)
    if err != nil {
        t.Fatal(err)
    }

    unknown, err := oleutil.CreateObject(""WbemScripting.SWbemLocator"")
    if err != nil {
        t.Fatal(err)
    }
    defer unknown.Release()

    wmi, err := unknown.QueryInterface(ole.IID_IDispatch)
    if err != nil {
        t.Fatal(err)
    }
    defer wmi.Release()

    serviceRaw, err := oleutil.CallMethod(wmi, ""ConnectServer"", nil, `ROOT\Microsoft\Windows\DesiredStateConfiguration`)
    if err != nil {
        t.Fatal(err)
    }
    service := serviceRaw.ToIDispatch()
    defer serviceRaw.Clear()

    typeName := ""MSFT_DSCLocalConfigurationManager""
    typeRaw, err := oleutil.CallMethod(service, ""Get"", typeName)
    if err != nil {
        t.Fatalf(""wmi: error fetching type %v: %v"", typeName, err)
    }
    typeResult := typeRaw.ToIDispatch()
    defer typeRaw.Clear()

    methodName := ""GetConfiguration""
    methodRaw, err := oleutil.CallMethod(typeResult, methodName)
    if err != nil {
        t.Fatalf(""wmi: error calling method %v: %v"", methodName, err)
    }
    item := methodRaw.ToIDispatch()
    defer methodRaw.Clear()
    _ = item
}

",1,
315,30856454,Golang: How to unmarshall both 0 and false as bool from JSON,"Currently am mapping the output of a service that, lets say, liberally interchanges 0 and false (and 1 and true) for its boolean types. Is there a way to use a more permissive parser for the built in encoding/json unmarshal function? I've tried adding ,string to the json tags to no avail. 

An example of what I'd want:

type MyType struct {
    AsBoolean bool `json:""field1""`
    AlsoBoolean bool `json:""field2""`
}


then, given input json:

{
    ""field1"" : true,
    ""field2"" : 1
}


the resulting struct would be:

obj := MyType{}
json_err := json.Unmarshal([]byte(input_json), &obj)
fmt.Printf(""%v\n"", obj.AsBoolean) //""true""
fmt.Printf(""%v\n"", obj.AlsoBoolean) //""true""

",2,
316,30947534,Reading a YAML file in Golang,"I have an issue with reading a YAML file.  I think it's something in the file structure but I can't figure out what.

YAML file:

conf:
  hits:5
  time:5000000


code:

type conf struct {
    hits int64 `yaml:""hits""`
    time int64 `yaml:""time""`
}


func (c *conf) getConf() *conf {

    yamlFile, err := ioutil.ReadFile(""conf.yaml"")
    if err != nil {
        log.Printf(""yamlFile.Get err   #%v "", err)
    }
    err = yaml.Unmarshal(yamlFile, c)
    if err != nil {
        log.Fatalf(""Unmarshal: %v"", err)
    }

    return c
}

",1,30950396.0
317,30956244,Golang Base64 encoded SHA256 digest of the user’s password,"I am attempting to complete the Top Code Go Learning Challenges as a vehicle to learn go.  I'm currently working on their Simple API Web Server problem.  Part of that problem calls for you to encrypt a password string as such ""‘{SHA256}’ + Base64 encoded SHA256 digest of the user’s password""

I've used the following code to do this, but the results don't match the test case provided.  

import (
    ""encoding/base64""
    ""crypto/sha256""
)

func encrtyptPasswords(password string) string {
    h := sha256.New()
    return ""{SHA256}"" + 
       string(base64.StdEncoding.EncodeToString(h.Sum([]byte(password))))
}


For an input of abcd1234 it should encrypt to: {SHA256}6c7nGrky_ehjM40Ivk3p3-OeoEm9r7NCzmWexUULaa4=

But I get {SHA256}YWJjZDEyMzTjsMRCmPwcFJr79MiZb7kkJ65B5GSbk0yklZkbeFK4VQ== instead.  I suspect I'm using the encryption libraries wrong, but I'm not sure what I should be using as this seems to be the standard library method of encryption to SHA256.
",1,30956460.0
318,31102871,How do you run the Google App Engine Dev Server with Client for Google Cloud Storage where everything is simulated locally?,"I'm running Google App Engine dev_appserver (golang) and have it working with the production Google Cloud Storage (GCS) such that it can read and write files via HTTPS to an actual GCS bucket.  But how do I get the local dev_appserver to simulate GCS locally?  I keep seeing people mention it's possible but can't find any documentation on how to set it up so that you can use the same cloud storage client library for development where all cloud files are stored locally.

Even Google's documentation seems to imply it is possible with the devserver in that you can change the storage path for ""Google Cloud Storage Files"": https://cloud.google.com/appengine/docs/go/tools/devserver

So if I can specify where to save Google Cloud Storage files then how do I setup the Client for Google Cloud Storage (https://cloud.google.com/appengine/docs/go/googlecloudstorageclient/) to work locally? 
",1,31688970.0
319,31285215,Goroutines don't work in parallel,"Given following code:

package main

import (
    ""fmt""
    ""runtime""
    ""time""
)


func f(from string) {

    for i := 0; i < 3; i++ {
        fmt.Println(from, "":"", i)
        //runtime.Gosched()
    }
}

func main() {

    runtime.GOMAXPROCS(runtime.NumCPU()*2)
    time.Sleep(100)

    go f(""i am not parallel"")

    go f(""neither me"")

    var input string
    fmt.Scanln(&input)
}


The output in most cases is:


  i am not parallel : 0
  i am not parallel : 1
  i am not parallel : 2
  neither me : 0 
  neither me : 1 
  neither me : 2


And sometimes:


  neither me : 0 
  neither me : 1 
  neither me : 2
  i am not parallel : 0
  i am not parallel : 1
  i am not parallel : 2


When runtime.Gosched() is uncommented all seems to be OK. 
I have tried changing GOMAXPROCS number from 2 to NumCPU, number of goroutines, cycles: none could get it to work in parallel. 
Why so strange behaviour?

Edit:
Ok, seems to be context-switching is heavy work and is not done very often without reasonable matters. One thing I still can't understand - why people get it to work without any sleep instructions? 
",1,
320,31327124,How can I exclude weekends golang,"I have this so far to count the number of days using http://golang.org/pkg/time/ but I don't know how to exclude weekends and only count business days

package main

import (
    ""fmt""
    ""time""
)

func main() {
    t := time.Now()
    f := time.Date(2015, time.August, 21, 24, 0, 0, 0, time.UTC)
    diff := f.Sub(t)

    // convert diff to days
    days := int(diff.Hours() / 24)

    fmt.Printf(""days  %d\n"", days)
}

",4,31327554.0
321,31411555,"syntax error: unexpected name, expecting semicolon or newline","I don't understand why my code has syntax error.

package main

import (
    ""fmt""
    ""os/exec""
    ""time""
)

func ping(curl_out string) endtime int64 {
    try_curl := exec.Command(""curl"", ""localhost:8500/v1/catalog/nodes"")
    try_curl_out := try_curl.Output()
    for try_curl_out == curl_out {
        try_curl := exec.Command(""curl"", ""localhost:8500/v1/catalog/nodes"")
        try_curl_out := try_curl.Output()
    }
    endtime := time.Now().Unix()
    return endtime
}

func main() {
    run_container := exec.Command(""docker"", ""run"", ""-p"", ""8400:8400"", ""-p"", ""8500:8500"", ""-p"", ""8600:53/udp"", ""-h"", ""node1"", ""progrium/consul"", ""-server"", ""-bootstrap"")
    container_id, err := run_container.Output()
    if err != nil {
        fmt.Println(err)
        return
    }
    run_curl := exec.Command(""curl"", ""localhost:8500/v1/catalog/nodes"")
    curl_out, err := run_curl.Output()
    if err != nil {
        fmt.Println(err)
        return
    }
    endtime := go ping(string(curl_out))
    container_id, err = exec.Command(""docker"", ""stop"", container_id)
    if err != nil {
        fmt.Println(err)
        return
    }
    startime := time.Now().Unix()
    fmt.Println(""delay is"", endtime-startime)
}

# command-line-arguments
./main.go:9: syntax error: unexpected name, expecting semicolon or newline
./main.go:11: non-declaration statement outside function body
./main.go:15: non-declaration statement outside function body
./main.go:16: non-declaration statement outside function body
./main.go:17: non-declaration statement outside function body
./main.go:18: syntax error: unexpected }


This code calculates time between docker start and stop.
I use routine to return end time. 

endtime := go ping(string(curl_out))


I think it's wrong. How can I use keyword go?

In Go, Do I decelerate statement outside function body?
",2,
322,31434554,Efficiently write compressed values to stream,"Currently, I'm trying to translate some compression algorithm from existing C code.

Encoding and decoding doesn't appear difficult to me. It's more about the serialization to and from a stream (be it a file or a socket).

The input is 12 bit and the compressed output is 7 bits. But writing something to a stream always involves writing entire 8 bits.

So as there is always 1 bit remaining for each value, does that mean I would have to buffer 7 bytes just to be able to write 8 values? Which would give the following bytes (whereas all 1s belong to the first value, all 2's to the second one, etc.)

11111112
22222233
33333444
44445555
55566666
66777777
78888888


The real codec or the language being used both don't really matter (actually: the codec is G.711 and the language is Golang). So maybe the go-Tag is inappropriate.

Any clue on this?
",1,31436063.0
323,31473429,GoLang conventions - create custom type from slice,"Is it a good idea to create own type from a slice in Golang?

Example:

type Trip struct {
    From   string
    To     string
    Length int
}

type Trips []Trip // <-- is this a good idea?

func (trips *Trips) TotalLength() int {
    ret := 0
    for _, i := range *trips {
        ret += i.Length
    }

    return ret
}


Is it somehow a convention in Golang to create types like Trips in my example? Or it is better to use []Trip in the whole project? Any pros and cons?
",2,
324,31502195,mgo: Query ObjectId for range of time values,"Ok, say you have a number of posts

type Post struct {
    Id bson.ObjectId `bson:""_id,omitempty""`
}


and each post of course has a unique id that was created at a certain time.

I can get the time value with post.Id.Time().

However how do I query for posts from let's say the year 2015?

And how would I do a range query for posts since 01.01.2014-31.12.2015?

I would assume that I need to iterate over results, check if post.Id.Time() is between 01.01.2014 and 31.12.2015 and if it is add it to a posts slice.

Is there a less complicated way to search for posts made between certain ranges or at a certain date using the mgo driver?

If there isn't I will accept No as an answer. If there is I will accept and answer that shows how, with code example.

I have found this post on Stackoverflow:1

However I don't know how this would apply to a bson.ObjectId since they type isn't time.Time but bson.ObjectId.
",2,31541855.0
325,31567734,How to find a package name from given call in runtime?,"For logging purpose I want to write a function which will print a package name.
I can do it for a directory name:

// file is the full file name
// 4 - how many calls we want to go up in a stack trace.
_, file, line, ok := runtime.Caller(4) 


... but can't find a way for package name (package name can be different from directory name).
",1,31626494.0
326,31689929,How to forbidden vim-go auto build when saving a *.go file,"

I use vim-go, but I don't like it auto build executable file when save a go source file. How to forbidden it?
",1,31714459.0
327,31691193,How can I use interface{} as a wildcard type?,"The scenario is to pass similar structs with common fields and set those to values passed as params:

package main

type A struct {
    Status int
}

type B struct {
    id     string
    Status int
}

// It's okay to pass by value because content is only used inside this
func foo(v interface{}, status int) {
    switch t := v.(type) {
    case A, B:
        t.Status = status // ERROR :-(
    }
}

func main() {
    a := A{}
    foo(a, 0)
    b := B{}
    b.id = ""x""
    foo(b, 1)
}


To my dismay, I am getting this error:

➜  test  go run test.go
# command-line-arguments
./test.go:15: t.Status undefined (type interface {} has no field or method Status)


What am I doing wrong if the typecast converts interface{} to the underlying type?
",1,31691333.0
328,31776584,Converting types for sorting : any runtime cost?,"I'm just getting to grips with Go (started two days ago and wrote less than 1000 lines), and I'm still wondering about some idioms.

I needed to sort a slice of strings by descending length. I did like so :

func ... {
    ... do business ...

    sort.Sort(stringsLongestFirst(severalThousandStrings))

    ... carry on and be happy, because it works ...
}

type stringsLongestFirst []string

func (b stringsLongestFirst) Len() int           { return len(b) }
func (b stringsLongestFirst) Less(i, j int) bool { return len(b[i]) > len(b[j]) }
func (b stringsLongestFirst) Swap(i, j int)      { b[j], b[i] = b[i], b[j] }


First of all I wonder if this is the most idiomatic way to do it.

And then, most of all, I wonder about what happens under the hood when I write stringsLongestFirst(severalThousandStrings). Does the string slice somehow get smartly reinterpreted as a stringsLongestFirst type, or do I have to count with some copying overhead ? 

(edited : removed the excerpt from the specification, that was ill-suited to the case at hand)
",1,31778315.0
329,31788886,Golang JSON Marshaling,"I'm trying to marshal an golang array into a string with each element added separated by newline, yet I'm running out of memory and was trying to think of a more efficient way of doing things.

buffer := """"
for _, record := range all_data {

    body, _ := json.Marshal(record)
    buffer += string(body) + ""\n"" // i run out of memory here


Is there a way to append to a byte array a new line character? Right now I cast via string(body), and I have a feeling that that operation allocates a lot of memory (I may be wrong).
",1,31791886.0
330,31794172,how to install a package in golang,"I try to connect to SQL server in golang, I searched in internet and through this address: https://github.com/denisenkom/go-mssqldb I understood that first I need to install a package for the purpose, but when I want to install this package through git terminal by entering this command:

$ go get github.com/denisenkom/go-mssqldb

I receive this error :

can't load package: package github.com/denisenkom/go-mssqldb: no buildable go source files in C:\Go\src\github.com\dnisenkom\go-mssqldb

my $GOPATH is already set.I don't know how to fix this problem ...
",1,31796112.0
331,31967057,Golang: struct inside an interface?,"So I have an interface, called UserService inside a package service

I have two simple structs representing the body and response of a HTTP call. I have another struct implementing the UserService interface.

I want to put these structs, call them UserResponse and UserRequest inside the interface so other services can use them to make the HTTP call. Furthermore, the request and response should be available (struct UserReponse, not struct userResponse) so other parts of the code can use them.

I define a function in the interface called GetUser(request UserRequest) UserResponse

However, whenever I reference UserRequest I have to use service.UserRequest and not service.UserService.UserRequest. This is bad because I don't want user-related objects to go into the service namespace. I want each service related data to organized under its own interface, file, etc. Unfortunately, I get an error if I put UserResponse inside the UserService interface. So I put it at the same level as UserService, which is why they are showing up as service.UserResponse. How do I go about accessing UserResponse as service.UserService.UserResponse?
",2,31967977.0
332,31987018,Having trouble decoding JSON response,"This is my first attempt at Go and I feel I'm missing something important here. Trying to decode a JSON message from a webservice but the output I'm getting is:

{response:{requests:[]}}

All I'm really interested in is the data within the request node. My for-loop obviously isn't getting called because the array is empty. I feel like my structs need to be declared exactly as they appear in the webservice?

Sample JSON:

{
""response"": {
""requests"": [
{
""request"": {}
},
{
""request"": {
  ""id"": 589748,
  ""image_thumbnail"": """",
  ""description"": ""Blah blah"",
  ""status"": ""received"",
  ""user"": ""test""
 }
}
],
""count"": ""50"",
""benchmark"": 0.95516896247864,
""status"": {},
""debug"": {}
}
}


type Request struct {
    id           int         `json:""id""`
    description  string      `json:""description""`
    user         string      `json:""user""`
}

type Requests struct {
    request      Request     `json:""request""`
}

type Response struct {
    requests     []Requests  `json:""requests""`
 }

 type RootObject struct {
    response     Response    `json:""response""`  
}

url := """"

req, err := http.NewRequest(""GET"", url, nil)
req.Header.Set(""Content-Type"", ""application/json"")

client := &http.Client{}
resp, err := client.Do(req)
if err != nil {
    panic(err)
}

defer resp.Body.Close()

var r RootObject

decoder := json.NewDecoder(resp.Body)
decoder.Decode(&r)


fmt.Printf(""%+v"", r)

for _, req := range r.response.requests {
    fmt.Printf(""%d = %s\n"", req.request.id, req.request.user)

}

",1,31987081.0
333,32033369,Inherit Controller From Module in Revel Framework,"I am trying to use a shared controller from a module in my app, but I'm not really sure how to do it. Here's what I want to do:


I have two revel apps, a frontend and backend app. The frontend app is used to show the user-facing site, and the backend app is for admin stuffs.
I created a special controller to connect to database as per the booking sample.
I want both the frontend and backend app to use the same controller, to minimize redundancy.


From the sample, when you want to have one controller database, it roughly translate to this:

type DBController {
     *revel.Controller
}

type App {
    DBController
}


This works when I want to have only 1 app, but when I want to share the controller to another app, I can't import DBController to the app. 

Things I've Tried

I tried moving DBController to its own package, and then importing that and inherit from it directly:

// in db.go
package controllers

// import and stuffs

type DBController {
    *revel.Controller
}

// in app.go
package controllers
import (
    dbc ""site.com/modules/controllers""
)

type App struct {
    dbc.DBController
    // *dbc.DBController
}


This gives me a panic error stating that the route is not found:

panic: Route validation error (in /app/path/routes:7):
       revel/controller: failed to find controller App


in both inheriting with and without pointer.

I've also tried Revel's module, with the same code, but different directory and importing via config:

// app.conf
modules.dbcontroller=site.com/modules/dbcontroller


And then in app.go:

type App struct {
    DBController
}


But it still didn't work with the same error as before. I'm pretty convinced that the right route is by using module, since the documentation said (emphasis mine):


  Modules are packages that can be plugged into an application. They allow sharing of controllers, views, assets, and other code between multiple Revel applications or from third-party sources.
  
  A module should have the same layout as a Revel application’s layout. The “hosting” application will merge it in as follows:
  
  
  Any templates in module/app/views will be added to the Template Loader search path
  Any controllers in module/app/controllers will be treated as if they were in your application.
  
  
  etc..


But I'm not sure how I can share and derive my controller from here.

TL; DR

How do I share controller in Revel so that I can inherit a controller from other module, roughly like:

import dbc ""site.com/modules/dbcontroller""

type App struct {
    dbc.DBController
}


so that DBController can be used with several revel apps? Thank you very much.
",1,
334,32066978,Go: Best way to get time in format of YYYYMMWDDHHMMSS,"I have a PHP API that takes time in format of YYYYMMWDDHHMMSS. Here W is weekday(Sunday=0, Monday = 1 ...). I am trying to generate the it like following:

package main

import ""fmt""
import ""time""

func main() {
    fmt.Println(""Hello, playground"")
    t := time.Now()
    time := t.Format(""20060102030405"")
    fmt.Println(time)
}


http://play.golang.org/p/Tdamoxi3bE

But it does not have weekday in it and i couldn't find any format to get from time.Format.
Is there any way to get the desired result from time.Format() or any other go 
api.
",1,32067013.0
335,32114128,Go v 1.5 with -linkshared option produces linking error,"Go v 1.5.

1) Compile the package worker:

go build -buildmode=shared -linkshared


2) Install this package

3) Try to compile another package, which imports worker:

go build -linkshared
go/pkg/tool/linux_amd64/link: running gcc failed: exit status 1
gcc: error: missing argument to ‘-l’


The same command with '-x --compiler=gccgo' option produces the following:

/usr/bin/gccgo -o $WORK/godev/testgo/_obj/exe/a.out $WORK/godev/testgo/_obj/_go_.o -Wl,-( -m64 -Wl,-) -L/home/user/dev/godev/pkg/gccgo_linux_amd64_fPIC/shlibs -Wl,-rpath=/home/user/dev/godev/pkg/gccgo_linux_amd64_fPIC/shlibs -l -Wl,-E -fPIC

",1,32143928.0
336,32180434,"go 1.5 : Is ""go install"" behaviour changed? Removing stale executables?","Till Go 1.4.2 when i run go install after running go build, i could find binary file in my current folder. Hence following Linux command was working


  $ go build && go install && ./executable


But after installing go 1.5, when i run same command i get,


  -bash: ./executable: No such file or directory


and when i checked, there is no executable to find. Did go install behavior changed in Go 1.5?
",1,32180800.0
337,32215509,Using Go code in an existing C project,"Ever since Go 1.5 came out, I started taking another look at how I could integrate it into an existing project of mine.

The project's codebase is written entirely in C for low level access to to hardware and other fun stuff. However, some of the higher level things are tedious, and I would like to start writing them in a higher level language (Go)

Is there any way I can call Go code from a C program? I installed Go 1.5, which added -buildmode=c-archive (https://golang.org/s/execmodes) which I am trying to get working.

However, I can't seem to get Go to generate the appropriate header files to allow my project to actually compile. When I generate the archive, I see the function in the exported symbols (using objdump), but without the header files to include gcc complains about the function not existing (as expected)

I'm quite new to Go - however, I love the language and would like to make use of it. Is there any idiomatic way (""idiomatic"" gets used a lot in the world of Go I see...) to get this to play nicely with each other?

The reason I asked this question and specifically mentioned Go 1.5 is that according to this document, https://docs.google.com/document/d/1nr-TQHw_er6GOQRsF6T43GGhFDelrAP0NqSS_00RgZQ/edit?pli=1#heading=h.1gw5ytjfcoke
Go 1.5 added support for non-Go programs to call Go code. Specifically, mentioned under the section ""Go code linked into, and called from, a non-Go program""
",1,32217287.0
338,32216985,How to access YCbCr color attributes in Go,"I'm iterating over an image's pixels trying to get the individual color values and average them out. When I do this:

bounds := img.Bounds()

for y := bounds.Min.Y; y < bounds.Max.Y; y++ {
  for x := bounds.Min.X; x < bounds.Max.X; x++ {
    fmt.Println(reflect.TypeOf(img.At(x, y)))     
  }
}


I get color.YCbCr a billion times. If I print it without reflect.TypeOf, I get a result like this:

{154 135 124}   
{153 135 124}   
{152 135 124}   
{152 135 124}   
{151 135 124}   
{149 135 124}   
{147 135 124}   


I need to be able to access the individual Y, Cb and Cr colors, but when I try img.At(x, y).Cb or img.At(x, y)['Y'] or even img.At(x, y)[0], I get various compile-time errors telling me that color.Color doesn't have those methods or doesn't support indexing.
",2,
339,32250277,How to set fields of a struct inside a slice?,"I declared a type like this

type Klabel struct {
    values []float64
    label  string
}


Then, I created a slice of this type like this

kdata := []Klabel


How can I set the label variable or append a slice of floats to values?

I tried 

kdata[0].label = ""test""


and

kdata := make([]Klabel, 10)

kdata[0].label = ""test""


and

kdata = append(kdata[0], kdata[0].label = ""test"")


Well, with no success...

So any help is appreciated! Thanks in advance!
",2,32250399.0
340,32253768,Does convertion between alias types in Go create copies?,"Example:

type MyString string 
var s = ""very long string""
var ms = MyString(s)
var s2 = string(s)


Are ms or s2 a full copy of s (as it would be done with []byte(s))? Or they are just a string struct copies (which keeps the real value in a pointer)?
What if we are passing this to a function? Eg:

func foo(s MyString){
  ...
}
foo(ms(s))  // do we copy s here?

",1,32253871.0
341,32273218,Issue with channel / go routine synchronization in Go,"Here is a small example program with the basic architecture/flow that I am trying to get working.  How do I get all the numbers and ""end"" messages to print out?  I have tried putting close statements here and there, but it either doesn't work, or I get panics about trying to close an already closed channel...

package main

import (
    ""fmt""
    ""time""
)

func main() {
    d := make(chan uint)

    go bar(d)

    c1 := make(chan uint)
    c2 := make(chan uint)
    c3 := make(chan uint)

    go foo(c1, d)
    go foo(c2, d)
    go foo(c3, d)

    c1 <- 1
    c2 <- 2
    c3 <- 3

    c1 <- 4
    c2 <- 5
    c3 <- 6

    c1 <- 7
    c2 <- 8
    c3 <- 9
}

func foo(c chan uint, d chan uint) {
    fmt.Println(""foo start"")

    for stuff := range c {
        time.Sleep(1)
        d <- stuff * 2
    }

    fmt.Println(""foo end"")
}

func bar(d chan uint) {
    fmt.Println(""bar start"")

    for stuff := range d {
        fmt.Printf(""bar received %d\n"", stuff)
    }

    fmt.Println(""bar end"")
}


The output I am getting looks like this.  Notice the last set of numbers and the ""end"" outputs are missing.

foo start
bar start
foo start
foo start
bar received 6
bar received 2
bar received 4
bar received 12
bar received 8
bar received 10


In my actual program, each ""foo"" function is doing filtering and a bunch of heavy string regexp stuff.  And I need the ""bar"" function, because it has the job of reordering based on a timestamp, and serializing printing, so output doesn't get interlaced.
",2,32273463.0
342,32322013,How to write a Go function to accept different structs?,"I am writing a function that parses a config JSON file and using json.Unmarshal stores its data in a struct. I've done some research and it's gotten me the point where I have a Config struct and a Server_Config struct as a field in config to allow me to add more fields as I want different config-like structs. 

How can I write one parseJSON function to work for different types of structs? 

Code:

Server.go

type Server_Config struct {
    html_templates string
}

type Config struct {
    Server_Config
}

func main() {
    config := Config{}
    ParseJSON(""server_config.json"", &config)
    fmt.Printf(""%T\n"", config.html_templates)
    fmt.Printf(config.html_templates)
}


config.go

package main
import(
    ""encoding/json""
    ""io/ioutil""
    ""log""
)

func ParseJSON(file string, config Config) {
    configFile, err := ioutil.ReadFile(file)
    if err != nil {
        log.Fatal(err)
    }
    err = json.Unmarshal(configFile, &config)
    if err != nil {
        log.Fatal(err)
    }
}


Or if there is a better way to do all this let me know that as well. Pretty new to Go and I have Java conventions carved into my brain. 
",1,32322125.0
343,32330631,How to find number of flags coming from console in Golang,"I'm passing argument from console. There are some flags too. Like:

go run test.go ""-IP=10.10.10.10"" ""-db=kite"" ""-wv=45"" ""-cv=75"" ""A = value1"" ""B = value2"" ""C = 100"" ""D := ((A-B)/A)*C"" ""D ?""


Here, -IP, -db, -wv, -wc these four are flags and others are passing as normal argument as I know.

Number of flags can be variable.

How can I know how many flags are passed to my program. In this case 4 flags are passed.
",1,32330783.0
344,32345760,Accept function in argument with empty interface return type in Go,"I'm new to Go and I would like to understand why the code snippet below does not compile. What is the Go way of accepting a function as a function argument that may have any return type? Thanks!

package main

func main() {
    test(a) // Error: cannot use a (type func() string) as type func() interface {} in argument to test
    test(b) // Error: cannot use b (type func() int) as type func() interface {} in argument to test
}

func a() string {
    return ""hello""
}

func b() int {
    return 1
}

func test(x func() interface{}) {

    // some code...
    v := x()
    // some more code....
}


Play: https://play.golang.org/p/CqbuEZGy12

My solution based on Volker's answer:

package main

import (
    ""fmt""
)

func main() {

    // Wrap function a and b with an anonymous function
    // that has an empty interface return type. With this
    // anonymous function, the call signature of test
    // can be satisfied without needing to modify the return
    // type of function a and b.

    test(func() interface{} {
        return a()
    })

    test(func() interface{} {
        return b()
    })
}

func a() string {
     return ""hello""
}

func b() int {
    return 1
}

func test(x func() interface{}) {
    v := x()
    fmt.Println(v)  
}


Play: https://play.golang.org/p/waOGBZZwN7
",2,32346212.0
345,32416778,LiteIDE for Go: Playground Errors,"I am using Mac OS X version X27.2.1of liteIDE.

I am able to build and run .go files fine however when I try to run code in the playground, I get the error:

""Error: Process failed to start""




Here is my setup, which works great when building and running .go files:



How can I fix?

Thanks

Thanks
",1,32423688.0
346,32486252,"LiteIDE with gvm. Build, run, and fmt won't work. Environment issues?","I've set up go (golang) on my Linux Mint (Ubuntu) box using gvm (Go Version Manager).

I've started a project, but I can't get it to build from within LiteIDE. 

go build -i [/home/username/go/src/projectname]
Error: process failed to start.


If I open a terminal and cd to the project's location and do a go build it works just fine.  My go env seems to work just fine outside of liteide.
",1,
347,32715166,Golang and not working function bytes.Contains(),"I have strange problem with function bytes.Contains(b, subslice []byte) bool. It doesn't find characters in byte array which was received in function (c *IPConn) Read(b []byte) (int, error). Application is a simple server. 
So I have byte array, which was received via server to variable buf

buf := make([]byte, 1024)
Len, err := c.conn.Read(buf)
// below received content in buf
//{""abc"":[{""b"":5,""bca"":14,""xyz"":0}]}{""abc"":[{""b"":7,""hjk"":14,""qwe"":0}]}


Now I wanted use below function to find }{ characters in array  buf

if bytes.Contains(buf, []byte(`}{`) != false {
    fmt.Printf(""I got you"")
}


But function always return false. Why ?

I did some experiment in my program as below:

worker := []byte('{""abc"":[{""b"":5,""bca"":14,""xyz"":0}]}{""abc"":[{""b"":7,""hjk"":14,""qwe"":0}]}')

// try find }{

if bytes.Contains(worker, []byte(`}{`) != false {
    fmt.Printf(""I got you"")
}


is CORRECT !!! I do not understand this... because it fallows that contents must be different between data which was received via server, and data form usually attachment in program.
",2,32717193.0
348,32730794,trying to understand how the Go gob encoder works,"in my ambitions to understand how gob work . i have severals question . 

i know that gob serialize a go type like struct map or interface(we must register it's real type) but : 

func (dec *Decoder) Decode(e interface{}) error
Decode reads the next value from the input stream and stores it in the data represented by the       
empty interface value.
If e is nil, the value will be discarded. 
Otherwise, the value underlying e must be a pointer to the correct type for the next data item received.
If the input is at EOF, Decode returns io.EOF and does not modify e.


i didn't understand nothing in this documentation . what they mean by ( reads the next value from the input stream ) they are one data that we could send it's a struct or a map but not many .what they mean by If e is nil, the value will be discarded.  please expert explain to me i'am disasperate all day and ididn't find nothing
",1,32731118.0
349,32815561,Parsing array form elements with bindings,"I am trying to submit and parse a form in go and I am failing to parse the form fields properly. 
Here is an excerpt of the code I am trying.

formtest.go :
    package main

import (
    ""fmt""
    ""log""
    ""net/http""

    ""github.com/codegangsta/negroni""
    ""github.com/davecgh/go-spew/spew""
    ""github.com/julienschmidt/httprouter""
    ""github.com/mholt/binding""
    ""gopkg.in/unrolled/render.v1""
)

type FormInfo struct {
    Fields    []string
    Action    string
    PageTitle string
    Id        string
}

func (f *FormInfo) FieldMap(*http.Request) binding.FieldMap {
    return binding.FieldMap{
        &f.Fields: ""fields"",
        &f.Action: ""action"",
    }
}

func formtest(
    resp http.ResponseWriter,
    req *http.Request,
    p httprouter.Params) {

    // var ticket Ticket
    info := new(FormInfo)
    tkt := p.ByName(""tkt"")
    info.PageTitle = tkt
    info.Id = tkt

    if req.Method == ""POST"" {
        bind_err := binding.Bind(req, info)
        if bind_err.Handle(resp) {
            log.Println(""Error decoding form contents"")
            return
        }
        spew.Dump(info)
    }

    Render.HTML(resp, http.StatusOK, ""formtest"", info)
    return
}

var Render *render.Render

func main() {

    router := httprouter.New()

    router.GET(""/formtest"", formtest)
    router.POST(""/formtest"", formtest)

    Render = render.New(render.Options{
        Layout:          ""layout"",
        IndentJSON:      true,
        IndentXML:       true,
        HTMLContentType: ""text/html"",
        IsDevelopment:   true,
    })

    n := negroni.New(
        negroni.NewRecovery(),
        negroni.NewLogger(),
        negroni.NewStatic(http.Dir(""static"")),
    )
    n.UseHandler(router)
    n.Run(fmt.Sprintf("":%d"", 3000))

}


templates/layout.tmpl :



  
    {{ .PageTitle }}
    
    
    
    
    <meta name=""viewport"" 
          content=""initial-scale=1.0,width=device-width,user-scalable=no"">
    
    
  

  

      
        {{ yield }}
      

  




templates/formtest.tmpl :

{{ .PageTitle }}



    
      Question 1
      
    

    
      Question 2
      
    

    
      
    




Procedure:


go run formtest.go
Open browser and go to http://127.0.0.1:3000/formtest
Submit the form
Check console for the logs.


Observation :

(*main.FormInfo)(0xc820066c30)({
 Fields: ([]string) ,
 Action: (string) (len=4) ""save"",
 PageTitle: (string) """",
 Id: (string) """"
})


Expectation :

Fields: ([]string) ,


But when I try to print the contents of Fields, it is nil.
What am I doing wrong?
",1,32833605.0
350,32932199,Golang import packages,"I have some problem with Golang and include package. I have that scructure

src/
├── hello_world
│   ├── hello.go
│   └── math
│       └── add.go


hello.go file contains this code:

package main

import (
    ""fmt""
    math ""hello_world/math""
)

func main() {
    fmt.Println(""Hello World"")
    x := math.add(6 + 5)
}


and add.go

package math

func add(x, y int) int {
    return x + y
}


and when I do ""go run hello go"" I see it:

evgen@laptop:~/go/src/hello_world$ go run hello.go 
# command-line-arguments
./hello.go:10: cannot refer to unexported name math.add
./hello.go:10: undefined: ""hello_world/math"".add


GOPATH: 

evgen@laptop:~/go/src/hello_world$ echo $GOPATH
/home/evgen/go


How fix it? Thanks you!
",4,32932233.0
351,32962128,Create iterative JSON directory tree - Golang,"I'm having trouble creating an iterative version of a program I wrote recursively in GoLang. The goal is to take a directory path and return a JSON tree that contains file information from that directory and preserves the directory structure. Here is what I have so far:

I've created a File struct that will contain the information of each entry in the directory tree:

type File struct {
    ModifiedTime time.Time `json:""ModifiedTime""`
    IsLink       bool      `json:""IsLink""`
    IsDir        bool      `json:""IsDir""`
    LinksTo      string    `json:""LinksTo""`
    Size         int64     `json:""Size""`
    Name         string    `json:""Name""`
    Path         string    `json:""Path""`
    Children     []File    `json:""Children""`
}


In my iterative program, I create a stack to simulate the recursive calls.

func iterateJSON(path string) {
    var stack []File
    var child File
    var file File
    rootOSFile, _ := os.Stat(path)
    rootFile := toFile(rootOSFile, path) //start with root file
    stack = append(stack, rootFile) //append root to stack 
    for len(stack) > 0 { //until stack is empty,
        file = stack[len(stack)-1] //pop entry from stack
        stack = stack[:len(stack)-1] 
        children, _ := ioutil.ReadDir(file.Path) //get the children of entry 
        for i := 0; i < len(children); i++ { //for each child
            child = (toFile(children[i], path+""/""+children[i].Name())) //turn it into a File object
            file.Children = append(file.Children, child) //append it to the children of the current file popped
            stack = append(stack, child) //append the child to the stack, so the same process can be run again
        }
    }
    rootFile.Children
    output, _ := json.MarshalIndent(rootFile, """", ""     "")
    fmt.Println(string(output))
}

func toFile(file os.FileInfo, path string) File {
    var isLink bool
    var linksTo string
    if file.Mode()&os.ModeSymlink == os.ModeSymlink {
        isLink = true
        linksTo, _ = filepath.EvalSymlinks(path + ""/"" + file.Name())
    } else {
        isLink = false
        linksTo = """"
    }
    JSONFile := File{ModifiedTime: file.ModTime(),
        IsDir:    file.IsDir(),
        IsLink:   isLink,
        LinksTo:  linksTo,
        Size:     file.Size(),
        Name:     file.Name(),
        Path:     path,
        Children: []File{}}
    return JSONFile
}


Theoretically, the child files should be appended to the root file as we move through the stack. However, the only thing that is returned is the root file (without any children appended). Any idea as to why this is happening?
",1,
352,33111375,Travis CI + Go: creating a specific build flow for different OS,"I have a Go project that I want to build with Travis-CI and deploy it to a specific provider.
I familiar with Gimme project that will use a cross-compilation to do so.
But because Travis already support linux and osx I only need this feature for Windows build. 

The big motivation is, of course, to avoid cross-compilation run time error as there are plenty of it.

My question is how can I create, in the same .travis.yml file, a different build flow: 


Native linux/os build (with ""os"" section).
Windows compilation using Gimmme


The .travis.yml file for the first option will look something like:

language: go

go: 
  - 1.5.1

branches: 
  only: 
    - master

os:
    - osx
    - linux


before_script:
    - go get -d -v ./...

script:
    - go build -v ./...
    # - go test -v ./...

before_deploy: 
  -  chmod +x ./before_deploy.sh
  - ./before_deploy.sh


The .travis.yml file for the second option will look something like:

language: go

go: 
  - 1.5.1

branches: 
  only: 
    - master

env:
    - GIMME_OS=windows GIMME_ARCH=amd64


before_script:
    - go get -d -v ./...

script:
    - go build -v ./...
    # - go test -v ./...

before_deploy: 
  -  chmod +x ./before_deploy.sh
  - ./before_deploy.sh


Is there a nice clean way to combine these two (with Environment variables or any other crazy idea)?
",1,33165892.0
353,33171661,"go build error ""rows.Columns undefined (type *sql.Row has no field or method Columns)""","I want to print multiple rows having multiple columns from my postgresql database using golang.when i tried to build the code

package main

import (
    ""database/sql""
    ""fmt""
    ""github.com/gin-gonic/gin""
    _ ""github.com/lib/pq""
    ""log""
    ""runtime""
)

func main() {

    runtime.GOMAXPROCS(runtime.NumCPU())

    db, err := sql.Open(""postgres"", ""dbname=sample_data user=postgres password=postgres sslmode=disable"")
    defer db.Close()
    if err != nil {
        fmt.Println(""error connecting to DB"")
    }
    r := gin.Default()
    r.GET(""/cin_display"", func(c *gin.Context) {
        rows := db.QueryRow(""SELECT cin FROM companies limit 1;"")

        columns, _ := rows.Columns()
        count := len(columns)
        values := make([]interface{}, count)
        valuePtrs := make([]interface{}, count)

        for rows.Next() {

            for i, _ := range columns {
                valuePtrs[i] = &values[i]
            }

            rows.Scan(valuePtrs...)

            for i, col := range columns {

                var v interface{}

                val := values[i]

                b, ok := val.([]byte)

                if ok {
                    v = string(b)
                } else {
                    v = val
                }

                fmt.Println(col, v)
            }
        }

    })
}

func Connect(connectionString string) *sql.DB {
    db, err := sql.Open(""postgres"", connectionString)
    if err != nil {
        log.Fatal(err)
    }
    return db
}


I am getting the errors  rows.Columns undefined (type *sql.Row has no field or method Columns) and  rows.Next undefined (type *sql.Row has no field or method Next).Anyone have an example of code that I can take a look at?
",1,33171739.0
354,33179876,How to make a map pointer using reflect?,"I need to pass a pointer to a map to another function using the reflect package. Think of encoding/json.Unmarshal which accepts only pointers. Below is some code of what I need to do using reflection:

  myTyp := &MyType{}
  json.Unmarshal(jsonPayload1, myTyp)
  m := make(map[string]*MyType)
  m[""someKey""] = myTyp
  // Dump it again to Unmarshal. It will overwrite it only if 
  // there is a `someKey` key.
  x := json.Unmarshal(jsonPayload2, &m)


So far I have the following:

  ....
  m := reflect.MakeMap(reflect.MapOf(reflect.TypeOf(""""), reflect.TypeOf(typ))
  x := json.Unmarshal(jsonPayload2, m.Interface())


The issue with this code is that it's making a map of map[string]MyType but there is no way I can create a pointer for it. If I try to make the pointer [2] directly it panics with reflect.MakeMap of non-map type. 

Why the map must be allocated:

I need the map allocated so that I can set myTyp on a specific key. myTyp is decoded using multiple decoding sources so I don't know what fields were decoded with each source but I know that Unmarshal overwrites only keys that match the json content/keys so it's safe to use the same variable to multiple Unmarshal functions. 

[2] reflect.MakeMap(reflect.PtrTo(reflect.MapOf(reflect.TypeOf("""")),  reflect.TypeOf(typ))
",1,33180089.0
355,33237126,Writing a CLI: How to avoid showing the typed password on screen,"I'm writing a command line tool with Go and one of the command will query the user for its username and password (and save it to a config file inside the home directory). 

For now I couldn't realize how to replace the typed password to '*' or even not to type anything as a lot of command line tools are doing.

How does can this be done when using golang?
",1,
356,33308887,Golang Mocking - problems with type collision,"I'm mocking out a DataStore and it's Get/Set functionality. The trouble I'm having is: cannot use s (type *MockStore) as type *datastore.Storage in argument to EventHandler

This is caused by my EventHandler function needing to be passed a *datastore.Storage as an argument type. I want to Test (http test) EvenHandler() using the MockStore I've created instead of the real datastore. I'm using the golang testify mock package. 

Some Code Examples

type MockStore struct{
  mock.Mock
}

func (s *MockStore) Get() ... 

func EventHandler(w http.ResponseWriter, r *http.Request, bucket *datastore.Storage){
  //Does HTTP stuff and stores things in a data store
  // Need to mock out the data store get/sets
}

// Later in my Tests
ms := MockStore
EventHandler(w,r,ms)

",1,33308935.0
357,33314790,Equivalent function for url.openStream() in Golang,"import java.net.*;
import java.io.*;

public class URLReader {
    public static void main(String[] args) throws Exception {

    URL oracle = new URL(""http://www.oracle.com/"");
    BufferedReader in = new BufferedReader(
    new InputStreamReader(oracle.openStream()));

    String inputLine;
    while ((inputLine = in.readLine()) != null)
        System.out.println(inputLine);
    in.close();
}
}


I need to do the same in golang i.e read and print the html source code, but cannot find the relation between two, I am a beginner with Go language, thank you in advance
",1,33314888.0
358,33400325,"Golang: fmt, variadic args and %!(EXTRA type=value) error","I'm implementing a wrapper around the standard log package to make a logger with various log levels.

I have the following interface:

type Logger interface {
  Trace(fmt string, args ...interface{})
  Debug(fmt string, args ...interface{})
  Info(fmt string, args ...interface{})
  Warn(fmt string, args ...interface{})
  Error(fmt string, args ...interface{})
  Fatal(fmt string, args ...interface{})
  Panic(fmt string, args ...interface{})
}


In the implementation I have something like this (not the exact code)

func Info(format string, args ...interface{}){
  msg := fmt.Sprintf(format, args...)
  log.Println(msg)
}


Now, assume I call my library like this:

logger.Info(""Hello %s"", ""World"")


I get the printout: ""Hello %!(EXTRA string=WORLD)"", instead of the expected ""Hello World"". There a similar output if I do

msg := fmt.Sprintf(format, args)


This returns ""Hello World%!EXTRA []interface{}=[]"".
",2,33400582.0
359,33604928,How do I get all lines of output when running command with exec.Cmd.Run()?,"I'm using glide to manage dependencies on my project. I created a script that runs go test $(glide novendor) (which tests all directories, excluding the vendor/ one) for me. While it works, the output for the run command doesn't go beyond the 1st line:

ok     my/project/scripts    0.005s

Here is the portion of the script that runs it:

// Get the paths to test (excluding the ""vendor/"" directory)
cmd := exec.Command(""glide"", ""novendor"")
var out bytes.Buffer
cmd.Stdout = &out
err = cmd.Run()
if err != nil {
    log.Fatal(""Could not run `glide novendor`: "", err)
}
glidenovendor := []string{""test""}
// Represents the ""test ./src/... ./scripts/..."" portion of the command
glidenovendor = append(glidenovendor, strings.Split(out.String(), "" "")...)

// Run `go test ./src/... ./scripts/...`
cmd = exec.Command(""go"", glidenovendor...)
cmd.Stdout = os.Stdout
err = cmd.Run()
if err != nil {
    log.Fatal(""Could not run `go test` command with args: "", cmd, err)
}


Running the command directly on my shell gives me all lines of out put as expected.

How do I make my script print the entire output?
",1,33605439.0
360,33632365,How to allocate a slice of floats in Go?,"I'm learning Go programming and try to test the following average function:

func average(xs []float64) float64 {
    total := 0.0
    for _, v := range xs {
        total += v
    }
    return total / float64(len(xs))
}


I tried to generate a slice of random float numbers by:

var xs []float64
for n := 0; n < 10; n++ {
    xs[n] = rand.Float64()
}


however, I got 

panic: runtime error: index out of range


Question:


How to generate a slice of random number in Golang?
Is expression or function call, like xs := []float64 { for ... } allowed in slice literals?

",2,33632446.0
361,33645459,Is there a way to callback a function without creating a new goroutine?,"I am trying to implement Reliable-UDP in golang. 

One of the basic features I need to implement is packet-retransmission.

The naive method is as follows: 


send a packet;
create a timer (also will create a new goroutine) to check if ACK is received before timer fires.


It is simple, but creation a lot of goroutine is NOT FREE. And I do NOT think implementation of packet-retransmission in TCP uses this method.

So, is there a way to callback a function without creating a new goroutine?

I have checked the post from golang-nuts ( https://groups.google.com/forum/#!topic/golang-nuts/ja8j7wQUB-0), and still can not figure out a solution.
",2,
362,33666158,GitHub failing to parse key correctly GoLang API Request,"So the following code recieves a public key that is created then passed into an object that is then marshalled into json. This json is then passed into an http request. Github is parsing the json correctly but returns that the ssh key is invalid. If I copy the contents and go online to paste the key it works fine.

I did edit the key to remove the user@hostname part of the key (I always do even though I know it is unsafe) to see if that was the problem.

func addKeyToGitHub(token string, comment string, publickey []byte) (*http.Response, error) {
    if token == """" {
        fmt.Println(""Please create a token that has 'write:public_key' scope"")
        open.Run(githubAPPURL)
        ir := bufio.NewReader(os.Stdin)
        fmt.Print(""Enter Token: "")
        token, _ = ir.ReadString('\n')
    }
    k := string(publickey)
    //Removes unwanted host at end of file
    array := strings.Split(k, "" "")
    array = array[:len(array)-1]
    k = strings.Join(array, "" "")
    fmt.Println(k)
    b := &githubBody{Title: comment, Key: k}
    body, err := json.Marshal(b)
    if err != nil {
        return nil, err
    }
    req, err := http.NewRequest(""POST"", githubAPIURL+""user/keys"", bytes.NewBuffer(body))
    if err != nil {
        return nil, err
    }
    req.Header.Set(""Authorization"", ""token ""+token)
    req.Header.Set(""Content-Type"", ""application/json"")
    fmt.Println(req)
    client := http.Client{}
    return client.Do(req)
}


Here is what it outputs

Please create a token that has 'write:public_key' scope
Enter Token: 3310b4ef5d0dbbb8687b992e6f78e02cd34e4d6d
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC7zwo/h3mVL2RwOyMeUyGZblLT+nZy9pS6akUMSiOaVkphCdQzoHH/6xbDPiTKNlXC+1JYmQq4DaeglFdVc+FQHp3ZlbhZp6YPemXHnGtKamtQrJHS+HA7zE+F3xPzLQlVTgUdlE4ckU0THRK7WdwXa1sSMO2UNBrn7MGZ4wskU4PO8QFBjFHN0e5SIv2mlF/Oi1FoSRHIEohHAY6JSE8lnxkYFA5XeVkygLFQbZ7dKpVaZg4Y1LvrZUnThmI+e1QxP9ttUj5Ike6wFewBTvTjtPb8hkEHp3GuwjmwN9SKIW4d5bmrJtGxQjYmY4PHhW5DnySBQWBeOnQxhqVQFqlN
&{POST http://github.com/api/v3/user/keys HTTP/1.1 1 1 map[Authorization:[token 3310b4ef5d0dbbb8687b992e6f78e02cd34e4d6d] Content-Type:[application/json]] {{""Key"":""ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC7zwo/h3mVL2RwOyMeUyGZblLT+nZy9pS6akUMSiOaVkphCdQzoHH/6xbDPiTKNlXC+1JYmQq4DaeglFdVc+FQHp3ZlbhZp6YPemXHnGtKamtQrJHS+HA7zE+F3xPzLQlVTgUdlE4ckU0THRK7WdwXa1sSMO2UNBrn7MGZ4wskU4PO8QFBjFHN0e5SIv2mlF/Oi1FoSRHIEohHAY6JSE8lnxkYFA5XeVkygLFQbZ7dKpVaZg4Y1LvrZUnThmI+e1QxP9ttUj5Ike6wFewBTvTjtPb8hkEHp3GuwjmwN9SKIW4d5bmrJtGxQjYmY4PHhW5DnySBQWBeOnQxhqVQFqlN"",""Title"":""dixon@homedesktop""}} 418 [] false github.com map[] map[]  map[]    }
Status 422
Body: {""message"":""Validation Failed"",""documentation_url"":""https://developer.github.com/v3/users/keys/#create-a-public-key"",""errors"":[{""resource"":""PublicKey"",""code"":""custom"",""field"":""key"",""message"":""key is invalid. It must begin with 'ssh-rsa', 'ssh-dss', 'ecdsa-sha2-nistp256', 'ecdsa-sha2-nistp384', or 'ecdsa-sha2-nistp521'. Check that you're copying the public half of the key""}]}


I have deleted the ssh key and token so please no comments on why I should not post those.

I know everything is authorized and parsed correctly before the request (I have tested with wrong token and wrong json format both return a different error) but I do not know why this is not working. I have tried to just build the json string turn it into a byte array and pass that with the same out come. 

I don't know if this matters but I am doing this through a VPN (I changed the address to show github and not the actual address). I have tested this call through PostMan (not using VPN) and it worked, so I know the server has these api calls. 
",2,
363,33688705,Compile glide vendored packages,"Golang's glide downloads dependencies to the project's source. As a result, go build compiles those too, and go plugins that lint/vet the codebase also parse the dependencies.

Assuming those dependencies are stable, how can I compile the dependencies so go build becomes faster?

Also, how can I remove vendor/ from go's tools to lint and check the codebase for errors?
",1,33699213.0
364,33705973,"syntax error: unexpected name, expecting semicolon or newline or }","Just as a precursor I've just barely started learning Go recently. This is probably my 3rd day spending some time on it. I've been working with this error for a couple hours now, and I can't figure out what is wrong.

package main

import ""fmt""

func main () {
  nextFib := fibGenerator();
  fmt.Println(nextFib());
  fmt.Println(nextFib());
  fmt.Println(nextFib());
  fmt.Println(nextFib());
  fmt.Println(nextFib());
}

func fibGenerator () uint {
  var (
    n uint = 0
    back1 uint = 1
    back2 uint = 0
  )

  _computeFib := func () uint {
    if n == 0 {
      n++
      return 0
    } else if n == 1 {
      n++
      return 1
    }
    fib := 1back + 2back // throws compile time error on this line
    2back = 1back
    1back = n
    n++
    return fib
  }

  return _computeFib
}


This is the error it throws: 
syntax error: unexpected name, expecting semicolon or newline or }

It's probably something simple, but with my limited knowledge in Go I can't put my finger on it. Any help would be appreciated.

EDIT:
This is the final working function besides renaming my variables like the accepted answer says I also had to make the generator return a function that returns an int. I also had an error w/ Fibonacci logic.

func fibGenerator () func() uint {
  var (
    n uint = 0
    back1 uint = 1
    back2 uint = 0
  )

  _computeFib := func () uint {
    if n == 0 {
      n++
      return 0
    } else if n == 1 {
      n++
      return 1
    }
    fib := back1 + back2
    back2 = back1
    back1 = fib
    n++
    return fib
  }

  return _computeFib
}

",2,33705989.0
365,33722090,cURL works but none of the rest clients with Go sebserver,"Having a simple GO WebServer which accepts an image as part of POST request. 

Code snippet - Request is mapped to this function

 func UploadFile(w http.ResponseWriter, r *http.Request, p httprouter.Params) {
        successResponse := models.HTTPResponse {
            FileURL:""http://testing.com"",
        }
        WrapResponse(w, successResponse, http.StatusOK)
    }


Response writer function

func WrapResponse(writer http.ResponseWriter, content interface{}, status int) {    
    writer.Header().Set(""Content-Type"", ""application/json"")
    writer.WriteHeader(status)
    // Content is a struct Response { fileURL string }  
    responseJson, err := json.Marshal(content)  
    CheckError(err, ""Error wrapping response"")  
    writer.Write(responseJson) 
    }

    func CheckError(err error, msg string) {    
    if err != nil {         
    panic(fmt.Sprintf(""%s : %s"", msg, err))     
    } 
    }


When i hit the URL using cURL as below the response is 200 OK (as expected)


  curl -X POST -d@ ""Screen Shot 2015-11-15 at 6.09.58 pm.png""
  http://localhost:8000/image/agent123/property --header ""Content-Type:image/png""
  --header ""X-User-Agent:agent-php""  response -->{""fileURL"":""http://testing.com""}%


Entire cURL request & response 


But when i try the same from DHC rest client, have also tried with advanced rest client getting no response. 



Edit 1: Request does reach the server when fired from rest clients
",1,
366,33781161,How to hide loglevel and time in logrus,"I am trying to write the logs in CSV format. I am trying to use logrus to write the CSV as logs. But I see the log level (info) and the time getting added to the CSV content in logs. Like, 

time=""2015-11-18T01:27:38-04:00"" level=info msg=""100,Click,Android"" 

How can I write only my message using logrus?
Or should I use any other loggers available in golang?

Note: I am a newbie to go
",1,33806519.0
367,33835925,"Array of Go structs with the same anonymous filed, but different types","If you imagine I have the following declarations:

type Car struct {
    Vehicle
    engineType string
}

type Bus struct {
    Vehicle
    public     bool
    engineType string
}

type Bike struct {
    Vehicle
    motorbike bool
}

type Vehicle struct {
    NumberWheels     int
    NumberPassengers int
    Owner            string
}

type Vehicles []Vehicle


Playground

I'm trying to have an array of Vehicles. However this is not possible as they each have a different type ( i.e Car, Bus, Bike, etc...)

var myCar = Car{Vehicle{4, 4, ""Me""}, ""Manual""}
var myBike = Bike{Vehicle{2, 0, ""Bob and I""}, false}
var myVehicles = Vehicles{myCar, myBike}
for i := range myVehicles {
    fmt.Println(myVehicles[i])
}


Playground

How would you achieve something like this. Or am I trying to tackle this problem from the wrong angle. I'm new to Go.
",1,33836248.0
368,33872612,Are Golang binaries portable?,"Suppose I'm a primarily Linux user, but I'm developing an application in Go that I want to be cross platform. I've searched around, but I can't seem to find information to absolve the following:


If I go install a binary on my amd64 Ubuntu system, will it also work on anyone else's 64-bit Ubuntu/Debian system?
How can I use go install to build an x86_64 binary that will also run out-of-the-box on 32-bit Debianlikes?
If I must use Windows to make a binary which will run on Windows, how can I also ensure that even if my Windows system is 64-bit the executable will be built for x86_64?


My questions in effect boil down to, ""how static/portable is go's linker/compiler?""
",1,33873000.0
369,33902212,Go Gorilla RecoveryHandler compile error,"Trying to use RecoverHandler, compile from Intellij fails.



r := mux.NewRouter()
r.HandleFunc(""/"", func(w http.ResponseWriter, r *http.Request) {
    panic(""Unexpected error!"")
})

http.ListenAndServe("":1123"", handlers.RecoveryHandler(r))


I get below errors. Above code is from gorilla documenation as-is used and I did run go get github.com/gorilla/handlers.


src/main.go:48: cannot use r (type *mux.Router) as type handlers.RecoveryOption in argument to handlers.RecoveryHandler
src/main.go:48: cannot use handlers.RecoveryHandler(r) (type func(http.Handler) http.Handler) as type *mux.Router in assignment


How do I use RecoveryHandler of Gorilla?
",1,33902991.0
370,33911712,GoLang Sruct to JSON not converting,"I am trying to convert my struct ""Sim"" into JSON, after being filled with data.

When I print the var s, it shows correct information, when I print data, it shows blank.

How do I convert Struct to JSON?

Reduced Code Below:

type Sim struct {
    yr, ag, av, db, wd, st []int
    withdrawal []string
}

func main() {
    // Creating simulation
    var s Sim

    // Filling with data
    s = simulate(15000, 60, 65, 90, 2015, 10.0, 140000.0, true, s)

    // Converting to JSON, for transmission over web
    data, err := json.Marshal(s)
    if err != nil {
        fmt.Println(err)
        return
    }

    // Data is correct
    fmt.Println(s)

    // Prints: {}
    fmt.Println(string(data))
}

",1,33911866.0
371,34100738,How to get releases for golang/go with go-github,"Learning Go and try to get the release list of golang/go with go-github.

Here is my code:

package main

import (
    ""github.com/google/go-github/github""
    ""fmt""
)


func main() {
    client := github.NewClient(nil)

    opt := &github.ListOptions{Page: 2, PerPage: 10}
    releases, rsp, err := client.Repositories.ListReleases(""golang"", ""go"", opt)

    if err != nil {
        fmt.Println(err)
    }

    fmt.Printf(""\n%+v\n"", releases)
    fmt.Printf(""\n%+v\n"", rsp)

}


When I run it, the release list is empty (as below):

[]

github.Rate{Limit:60, Remaining:59, Reset:github.Timestamp{2015-12-05 14:47:55 +1100 AEDT}}


I don't know what I am doing wrong.
",1,
372,34191096,ui routing without urlRouterProvider.otherwise,"Routing doesn't occur if I don't include $urlRouterProvider.otherwise('/'); in the config.

my go app engine setting with gorilla is

r := mux.NewRouter()
r.HandleFunc(/admin, handleAdmin)


and angularjs config is;

angular.module('admin')
    .config(function($stateProvider, $urlRouterProvider) {
      $stateProvider.state('home', {
        url: '/',
        templateUrl: '/admin/index.html',
        controller: 'AdminController as admin'
      });
  //$urlRouterProvider.otherwise('/');
})


when I don't call $urlRouterProvider.othwerwise line, and I open http://localhost:8080/admin I expect to see admin/index.html, but I don't. I see it only if I navigate to http://localhost:8080/admin#/ manually.
But if I add $urlRouterProvider.othwerwise option and go to http://localhost:8080/admin it redirects automatically to http://localhost:8080/admin#/
I don't think this is usual way to do it because I may want ""otherwise"" to route to a custom 404 page. What point do I miss?
",2,
373,34222841,Cycle import issue in gorilla mux routing with multiple sub packages,"Here is my project structure


--main package
--|--child_package1
--|--child_package2
--|--child_package3


I have all the the routes and method call management for API calls listed in main_package

The router Handler from main_package.go looks like this:

func Handlers(db *sql.DB, customeruploadFile string) *mux.Router {
  router := mux.NewRouter()
  router.HandleFunc(""/api1"", child_package1.method )
  router.HandleFunc(""/api2"", child_package2.method)
  router.HandleFunc(""/api3"", child_package3.mehtod)

  fileHandler := http.FileServer(http.Dir(""./client/compiled""))
  router.PathPrefix(""/"").Handler(http.StripPrefix(""/"", fileHandler))
  return router
}


The problem is when I write test cases for child packages, I need this Handlers method to create test server, for that I need to import main_package in child_packages, then as obvious there is cycle imports happening, as child_packages are imported in main_package.
Can any one please suggest me the best approach to tackle this?
",1,34230466.0
374,34232126,Golang order of evaluation,"I recently went through Golang's ""Language Specification"" https://golang.org/ref/spec#Order_of_evaluation but found the order of evaluation being different from what it is explained in this document.

For example, it says:

a := 1
f := func() int { a++; return a }
x := []int{a, f()}            // x may be [1, 2] or [2, 2]: evaluation order between a and f() is not specified


Then I tried with this code:

package main

import ""fmt""

func main() {
    for {
        result := evaluate()
        if result == 1 { 
            break
        }   
    }   
}

func evaluate() int {
    a := 1
    f := func() int { a++; return a } 
    x := []int{a, f()}
    fmt.Println(x)
    return x[0]
}


I found the value of slice x is always [2,2]. Is there anything I misunderstand?

Thanks in advance.
",1,34232264.0
375,34259350,Go headers when fetching URLs,"When I write a programme in Python and post a request using urllib, my header is sent to the server as Python-urllib/3.4

What HTTP headers are sent to a server by default when accessing an API with a Go programme?
",1,34259703.0
376,34285040,Get last inserted id (go + oracle),"I need to insert two records in Oracle database from my go application using sqlx (https://github.com/jmoiron/sqlx) with go-oci8 (https://github.com/mattn/go-oci8) driver.
Second record references previous one by foreign key.
So I need to have primary key of first record (it is assigned from sequence with before insert trigger on first table) before I can insert second record.

So I experimented to get last inserted id:

create table t(x int primary key);
create sequence x_seq;


LastInsertId failed for me:

import(
    ""fmt""
    ""github.com/jmoiron/sqlx""
    _ ""github.com/mattn/go-oci8""
)

func main(){
    db, err := sqlx.Connect(""oci8"", ""integr/integr@localhost:49161/xe"")
    if err != nil {
       fmt.Println(err)
    }
    sql := ""insert into t values(x_seq.nextval)""
    r, err := db.Exec(sql)
    if err != nil {
       fmt.Println(err)
    }
    fmt.Println(r.RowsAffected())
    fmt.Println(r.LastInsertId())
}


Output:

1 
0 LastInsertId not supported


Then I tried to make stored function that inserts record and returns primary key.

create function f(x int) return int as
v int;
begin
    insert into t values(x)
    returning x into v;
    return v;
end;


But I failed to find a way to get its result. PostgreSQL style select fails:

SQL> select f(9) from dual;
select f(9) from dual
       *
ERROR at line 1:
ORA-14551: cannot perform a DML operation inside a query
ORA-06512: at ""INTEGR.F"", line 1


And OCI8 style variable binding does not work:

package main

import(
    ""fmt""
    ""github.com/jmoiron/sqlx""
    _ ""github.com/mattn/go-oci8""
)

func main(){
    db, err := sqlx.Connect(""oci8"", ""integr/integr@localhost:49161/xe"")
    if err != nil {
       fmt.Println(err)
    }
    sql := sqlx.Rebind(sqlx.NAMED,""begin ? := f(?); end;"")
    var a int
    _, err = db.Exec(sql, a, 333)
    if err != nil {
       fmt.Println(err)
    }
    fmt.Println(sql)
    fmt.Println(a)
}


Output:

begin :arg1 := f(:arg2); end;
0


How to get last inserted ID, or how to get value from stored funcion in Go from Oracle?
",1,
377,34376141,Are there uint64 literals in Go?,"I'm looking at the numeric types in Go. I want to use uint64 literals. Is this possible in Go?

Here's an example of how I'd like to use uint64 literals:

for i := 2; i <= k; i += 1 { // I want i to be a uint64
    ...
}

",2,34376163.0
378,34406700,How can I write a function that takes either one of many types in go?,"I'm trying go for a small project and tried to write these functions:

func fatal(reason string) {
    println(reason)
    os.Exit(1)
}

func fatal(err error) {
    fatal(err.Error())
}


After digging about a bit and finding this answer, which referenced the docs on overloading I realised that what I was trying to do was illegal in go.

What I want is a simple api that allows me to call fatal with either a string or an error in order to simplify my logic. How do I achieve this or a similar goal? 

It would feel inelegant to have func fatal(reason string) along with func fatalErr(err error), is that what's needed? Am I missing a different feature of the language that allows me to do what I want?
",3,34406772.0
379,34463793,can a message sent to channel be lost?,"The question is in the title. Let's say I have several goroutines (more than 100) all of which eventually send data to one chan (name it mychan := make(chan int)) One another goroutine does  in an endless for loop Is it okay or the chan can happen to lose some data? Should I use buffered chan instead? Or perhaps I am to create a chan and a ""demon"" goroutine that will extract message for each worker goroutine?
",3,
380,34583722,"Goroutines channels and ""stopping short""","I'm reading/working through Go Concurrency Patterns: Pipelines and cancellation, but i'm having trouble understanding the Stopping short section. We have the following functions: 

func sq(in <-chan int) <-chan int {
    out := make(chan int)
    go func() {
        for n := range in {
            out <- n * n
        }
        close(out)
    }()
    return out
}

func gen(nums ...int) <-chan int {
    out := make(chan int)
    go func() {
        for _, n := range nums {
            out <- n
        }
        close(out)
    }()
    return out
}
func merge(cs ...<-chan int) <-chan int {
    var wg sync.WaitGroup
    out := make(chan int, 1) // enough space for the unread inputs

    // Start an output goroutine for each input channel in cs.  output
    // copies values from c to out until c is closed, then calls wg.Done.
    output := func(c <-chan int) {
        for n := range c {
            out <- n
        }
        wg.Done()
    }
    wg.Add(len(cs))
    for _, c := range cs {
        go output(c)
    }

    // Start a goroutine to close out once all the output goroutines are
    // done.  This must start after the wg.Add call.
    go func() {
        wg.Wait()
        close(out)
    }()
    return out
}

func main() {
    in := gen(2, 3)

    // Distribute the sq work across two goroutines that both read from in.
    c1 := sq(in)
    c2 := sq(in)

    // Consume the first value from output.
    out := merge(c1, c2)
    fmt.Println(<-out) // 4 or 9
    return
    // Apparently if we had not set the merge out buffer size to 1
    // then we would have a hanging go routine. 
}


Now, if you notice line 2 in merge, it says we make the out chan with buffer size 1, because this is enough space for the unread inputs. However, I'm almost positive that we should allocate a chan with buffer size 2. In accordance with this code sample:

c := make(chan int, 2) // buffer size 2
c <- 1  // succeeds immediately
c <- 2  // succeeds immediately
c <- 3  // blocks until another goroutine does <-c and receives 1 


Because this section implies that a chan of buffer size 3 would not block. Can anyone please clarify/assist my understanding? 
",1,34584151.0
381,34644754,How would I select all embedded documents of the same type in mgo Mongodb?,"I have a go application which uses mgo/mongodb. I'm using embedded documents rather than relational ones. 

So I have... (some code redacted for brevity).

type User struct {
    Id          bson.ObjectId `bson:""_id,omitempty"" json:""id""`
    Name        string        `form:""name"" bson:""name"" json:""name""`
    Password    string        `form:""password"" bson:""password,omitempty"" json:""password"" binding:""required""`
    Email       string        `form:""email"" bson:""email,omitempty"" json:""email"" binding:""required""`
    Artists     []Artist      `form:""artists"" bson:""artists,omitempty"" json:""artists"" inline`
    Releases    []Release     `form:""releases"" bson:""releases,omitempty"" json:""releases"" inline`
    ContentFeed []Content     `form:""content_feed"" bson:""content_feed,omitempty"" json:""content_feed"" inline`
    Profile     Profile       `form:""profile"" bson:""profile,omitempty"" json:""profile"" inline`
    TopTracks   []Track       `form:""top_tracks"" bson:""top_tracks"" json:""top_tracks"" inline`
}

type Artist struct {
    Id     bson.ObjectId `bson:""_id,omitempty"" json:""id""`
    Title  string        `form:""title"" bson:""title"" json:""title""`
    Genres string        `form:""genres"" bson:""genres"" json:""genres""`
}

func (repo *ArtistRepo) GetArtists() ([]Artist, error) {
    results := &[]Artist{}
    err := repo.collection.Find(???).All(results)
    return results, err
}


I'm trying to get all of the artists, from all of the users essentially. But I can't figure what I need in my query? I've touched briefly on Map/Reduce, but it didn't seem to apply to what I'm trying to do. 
",1,34645031.0
382,34696852,Go - JSON Decoder not initializing my struct,"I am trying to decode some JSON retrieved via http.Get. However, when I check the structs I initialize with fmt.Println, they are always empty.

I suspect it is because my struct's structure does not agree with the returned JSON, but I am not sure how to fix it. In general, I am not exactly quite sure how the decoder works.

This is the JSON:

{
  ""response"":[
    {
      ""list"": {
        ""category"":""(noun)"",
        ""synonyms"":""histrion|player|thespian|role player|performer|performing artist""
      }
    },
    {
      ""list"": {
        ""category"":""(noun)"",
        ""synonyms"":""doer|worker|person|individual|someone|somebody|mortal|soul""
      }
    }
  ]
}


Here is what i have tried so far:

type SynonymResponse struct {
    lists []SynonymList
}

type SynonymList struct {
    category string
    synonyms string
}

var synonyms SynonymResponse;
dec := json.NewDecoder(response.Body)
err := dec.Decode(&synonyms)
if err != nil {
    log.Fatal(err)
}
fmt.Println(synonyms)


EDIT: Per @Leo's answer and @JimB's hint, there are two issues with my attempt. Below is the proper set of structs, though as Leo pointed out, this will be empty: 

type SynonymResponses struct {
    resp []SynonymResponse
}

type SynonymResponse struct {
    listo SynonymList
}

type SynonymList struct {
    cat string
    syns string
} 

",1,34696916.0
383,34716700,How to print os.args[1:] without braces in Go?,"When I tried to print command line arguments using

    fmt.Println(os.Args[1:])


I got result like 

[Gates Bill]


How can I get rid of the [] around the arguments? And Go seems to eat all the commas in the arguments, how can I get the output like

Last name, First name
Gates, Bill

",2,
384,34724912,go on OS X - Two libraries call system functions,"I am finding it difficult to write something with more or less common UI at least for Mac. My application has to have tray icon and be able to show system notifications

The issue is the goroutines themselves. Any call to UI frameworks on Mac requires that the call is made from main thread, or at least in a thread-safe manner.

The issue arise when I am already running UI (well, for GUI application that is a must, no?) and try to show notification. The reason for this seems to be that systray package Init function has to be locked to main thread using runtime.LockOsThread and never releases it. Then if I try to show notification which also requires runtime.LockOsThread it causes following error:

2016-01-11 22:56:27.973 main[30162:4094392] *** Assertion failure in +[NSUndoManager _endTopLevelGroupings], /Library/Caches/com.apple.xbs/Sources/Foundation/Foundation-1256.1/Misc.subproj/NSUndoManager.m:359
2016-01-11 22:56:27.974 main[30162:4094392] +[NSUndoManager(NSInternal) _endTopLevelGroupings] is only safe to invoke on the main thread.
2016-01-11 22:56:27.977 main[30162:4094392] (
    0   CoreFoundation                      0x00007fff8d42bae2 __exceptionPreprocess + 178
    1   libobjc.A.dylib                     0x00007fff8bb03f7e objc_exception_throw + 48
    2   CoreFoundation                      0x00007fff8d42b8ba +[NSException raise:format:arguments:] + 106
    3   Foundation                          0x00007fff8cb4c88c -[NSAssertionHandler handleFailureInMethod:object:file:lineNumber:description:] + 198
    4   Foundation                          0x00007fff8cad24c1 +[NSUndoManager(NSPrivate) _endTopLevelGroupings] + 170
    5   AppKit                              0x00007fff8514206a -[NSApplication run] + 844
    6   main                                0x0000000004166200 nativeLoop + 128
    7   main                                0x0000000004165bca _cgo_8c6479959095_Cfunc_nativeLoop + 26
    8   main                                0x000000000405a590 runtime.asmcgocall + 112
)
2016-01-11 22:56:27.977 main[30162:4094392] *** Assertion failure in +[NSUndoManager _endTopLevelGroupings], /Library/Caches/com.apple.xbs/Sources/Foundation/Foundation-1256.1/Misc.subproj/NSUndoManager.m:359
2016-01-11 22:56:27.978 main[30162:4094392] An uncaught exception was raised
2016-01-11 22:56:27.978 main[30162:4094392] +[NSUndoManager(NSInternal) _endTopLevelGroupings] is only safe to invoke on the main thread.


Is there a workaround that? All I could think of so far is to put UI and Notifications into separate binaries and make them to communicate with main over some sort of IPC. But I may be missing something.
",2,
385,34823724,Golang - TLS handshake error,"I am running a https web server in go. I am testing it using a angular web app (Chrome browser) that makes ajax calls to the web server. 

If I keep hitting the web server continuously everything seems working. But whenever I leave it idle for sometime and hit the web server the ajax call from browser doesn't get a response. Almost always I see this log line in my server log.

2016/01/16 04:06:47.006977 http: TLS handshake error from 42.21.139.47:51463: EOF

I can confirm that the IP address is my IP address. 

I am starting my https server like this:

r := mux.NewRouter()
r.HandleFunc(""/status"", handleStatus)
setUpLoginEndpoint(&cfg.Session, r)
setUpLogoutEndpoint(cfg.Session.CookieName, r)
setUpChangePasswordEndpoint(cfg.Session.CookieName, r)
setUpMetricSinkEndpoint(cfg.Metric.SinkApiKey, r)
setUpMetricQueryEndpoint(cfg.Session.CookieName, r)
http.ListenAndServeTLS("":443"", ""../cert.pem"", ""../keys.pem"", &Server{r})


I can confirm that I am closing the request body in every handler using defer r.Body.Close().

I am using go 1.5.2. 

Any help would be appreciated.

Regards,

Sathya
",1,34889113.0
386,34829606,Variable floating-point precision format string,"I'm trying to print floating point numbers as percentages, and I'd like for the number of digits after the decimal place to vary as needed. Currently I have:

fmt.Printf(""%.2f%%\n"", 100*(value/total))


The problem is that if my percentage is, say, exactly 50, I will get the following output:

50.00%


While what I want is to get:

50%


Is there any way for the format string to indicate that a maximum of 2 digits of precision should be used, but only if needed?
",3,34829815.0
387,34837805,len(string) == 0 or len(string) < 1,"In Go, to check if a string is empty this can be used:

len(str) == 0


or 

len(str) < 1


or 

str == """"


Basically is just a meter of choosing an operator ==, , !=, but in terms of performance wish option is better ?

My guess is that == just compares and don't iterate through the values like  or either  could do, therefore wondering what is the best approach practice for this.
",2,34837911.0
388,34875888,How to tell whether a tcplistener is closed?,"In Golang, i can close a TCPListener, however, i can not tell whether a TCPListener is closed or not. This info could be used to do some other logic in program.
",1,
389,34926930,Go equivalent of GCD serial dispatch queue,"Is there Go equivalent of Apple's GCD serial dispatch queue? 

So far I have only found a solution that is a channel of functions. 

work := make(chan func()) 


I would have a function receive from this channel and call the received functions. The functions must be executed in FIFO order. 

Is there a better method or structure to do this in Go?

This shouldn't make a difference but I am looking to queue SQL queries to run in FIFO for this. 
",2,35348490.0
390,34947001,How do I generate a unique token (for e-mail verification)?,"I want to implement a system that after user signs up, user will receive an email includes a link to verify this email is for that user.

The way I generate the token for verifying the email is like this:

import (
    ""crypto/rand""
    ""encoding/base64""
)

func generateToken() (string, error) {
    b := make([]byte, 35)
    _, err := rand.Read(b)
    if err != nil {
        return """", err
    }
    return base64.URLEncoding.EncodeToString(b), nil
}


But what I want to ask is if this method is OK? How to make all the token generated by this method is unique ? 

What is the normal way to implement this system ?

Please give me some ideas and tell me if this method of generating token is good.

Thanks.
",3,
391,34995808,'declared and not used' because Go compiler can't consider loops?,"Poor title, but I didn't know how else to describe it within the character limit.

As a learning exercise, I'm trying to write a little Go program that simulates a lottery draw. It draws six random numbers to be the winning set, then continually draws random arrays of random ints until you get that set again.

First I wrote a function which takes a channel and infinitely loops ""add array of 6 random ints to the channel"":

func draw(ch chan<- [6]int) {
    generator := rand.New(rand.NewSource(time.Now().UnixNano()))
    for {
        ch <- [6]int{
            generator.Intn(100),
            generator.Intn(100),
            generator.Intn(100),
            generator.Intn(100),
            generator.Intn(100),
            generator.Intn(100),
        }
    }
}


Then in main() I specify two OS threads, create a channel that can hold 250 arrays of 6 ints, and start my draw() function in a goroutine.

runtime.GOMAXPROCS(2)
ch := make(chan [6]int, 250)
go draw(ch)


Next I take a winning set (eg [4 8 15 16 23 42]) from the channel, then a 'current' set, meaning the most recent draw. I set my game_played counter to 1:

winning := <- ch
current := <- ch
games_played := 1


Here's the tricky bit.

In an infinite loop, I check if the current draw is equal to the winning draw. If it is, I print the number of games played, and break from the loop.

If it isn't, I set current to a new draw, and increment the counter. The loop should then run the if winning == current... check again over and over until there's a match.

for {
    if winning == current {
        fmt.Println(games_played)
        break
    } else {
        current := <- ch
        games_played += 1
    }
}


Here's the problem: that fourth-last line, current := , throws a compiler error, 'current declared and not used'. I want to say ""Yeah, I know it's not used after that point reading downward, but it's declared inside a loop, so its value matters on the next iteration."" But I can't work out how, or if I've done something stupid. I'm totally clueless about Go, obviously. But to me, thinking through it, the logic is sound. Am I messing something up?

(Note: I'm aware of the oversight that a draw of [1 2 3] won't be equal to [2 3 1], ignoring that for now.)
",1,34995923.0
392,35029311,What is the most secure way to upload a file receiving from browser(client)?,"I am writing a web app using Golang, and I am writing the file upload part now, but I don't know what is the most secure way to do it.

Can anyone give me some information? Thanks.

Edit: I mean how to prevent users upload their file to the position other than the position I want. User may modify the filename to cause it to be uploaded to a specific directory. Are there any way to prevent it?

And I want to ask if the hacking technique like web shell workable to the web app written in Golang? I think is not, but I want to check if my thinking is right.
",1,
393,35036951,TimeZone to Offset?,"I want to get the offset in seconds from a specified time zone. That is exactly what tz_offset() in Perl's Time::Zone does: ""determines the offset from GMT in seconds of a specified timezone"".

Is there already a way of doing this in Go? The input is a string that has the time zone name and that's it, but I know that Go has LoadLocation() in the time package, so string => offset or location => offset should be fine.

Input: ""MST""

Output: -25200
",1,
394,35084268,"Within Golang struct shared among multiple goroutines, do non-shared members need mutex protection?","I have one Golang struct shared among multiple goroutines.
For concurrent access to struct members, there is the mutex sync.RWMutex.
For struct member that is accessed by one single goroutine, is there need of mutex protection?

For example, in the code below, one single writer goroutine accesses the member shared.exclusiveCounter, without any lock protection. Is this correct/safe? Or is there need of mutex because the whole struct is accessed by multiple goroutines thru a shared pointer?

package main

import (
    ""fmt""
    ""sync""
    ""time""
)

func main() {
    s := &shared{mutex: &sync.RWMutex{}}

    readerDone := make(chan int)
    writerDone := make(chan int)

    go reader(s, readerDone)
    go writer(s, writerDone)

    <-readerDone
    <-writerDone
}

type shared struct {
    mutex            *sync.RWMutex
    sharedCounter    int // member shared between multiple goroutines, protected by mutex
    exclusiveCounter int // member exclusive of one goroutine -- is mutex needed?
}

func (s *shared) readCounter() int {
    defer s.mutex.RUnlock()
    s.mutex.RLock()
    return s.sharedCounter
}

func (s *shared) setCounter(i int) {
    defer s.mutex.Unlock()
    s.mutex.Lock()
    s.sharedCounter = i
}

func reader(s *shared, done chan<- int) {
    for {
        time.Sleep(2 * time.Second)
        counter := s.readCounter()
        fmt.Printf(""reader: read counter=%d\n"", counter)
        if counter > 5 {
            break
        }
    }
    fmt.Printf(""reader: exiting\n"")
    done <- 1
}

func writer(s *shared, done chan<- int) {
    s.exclusiveCounter = 0
    for {
        time.Sleep(1 * time.Second)
        s.exclusiveCounter++
        fmt.Printf(""writer: writing counter=%d\n"", s.exclusiveCounter)
        s.setCounter(s.exclusiveCounter)
        if s.exclusiveCounter > 5 {
            break
        }
    }
    fmt.Printf(""writer: exiting\n"")
    done <- 1
}


Run it on playground
",2,35085405.0
395,35141669,read int64 from fixed64 protobuf field in golang,"I have a field that is of type fixed64 in a .proto file.

I want to read it as an int64 field:

score := int64(pb_obj.Score)


When I try to compile the line agove I get the error message cannot convert pb_obj.Score (type *uint64) to type int64.  I tried converting the a uint64 as well, and got an almost identical message.
",2,35141771.0
396,35202405,Websocket handshake fails 404 (golang server),"I have a simple go web server which serves on port localhost:8080 an public folder containing both an html file as well as a client script with websocket logic.

in my main.go file

listener, err := net.listen(""tcp"", ""localhost:8080"")
if err != nil {
    log.Fatal(err)
}
//full code in gist https://gist.github.com/Kielan/98706aaf5dc0be9d6fbe


then in my client script 

try {
    var sock = new WebSocket(""ws://127.0.0.1:8080"");
    console.log(""Websocket - status: "" + sock.readyState);

    sock.onopen = function(message) {
    console.log(""CONNECTION opened..."" + this.readyState);
    //onmessage, onerr, onclose, ect...
}


I get the error in chrome

WebSocket connection to 'ws://127.0.0.1:8080/' failed: Error during WebSocket handshake: Unexpected response code: 200


and Firefox

Firefox can't establish a connection to the server at ws://127.0.0.1:8080/.


I found this article referring to node.js indicating to add /websocket to my client websocket string, though it did not solve the problem and resulted in a 404

I thought response code 200 is good, do I need to convert the request to a websocket somehow and maybe it is defaulting to http? If so how can I do this?
",1,35203695.0
397,35250981,Can't get appropriate output while concating string with nested map,"I'm new with galang and I want to concat string with nested map. Below is the dummy code given, point out my mistake. Thanks in advance

    import (
    ""fmt""
    ""strconv""
    )

    func main() {
    str := ""Hello @John martin #sosos &Hi @William ""
    var key string = """"
    var ku int = 0
    var kh int = 0
    var kg int = 0
    var id string
    var col string 
    var retMap = make(map[string]map[string]string)
    retMap[key] = make(map[string]string)    
    for i := 0; i < len(str); i++ {
      //fmt.Println(string(str[i]), "" >> "", str[i])
      if str[i] == 64 || str[i] == 35 || str[i] == 38 {
        if str[i] == 64 {
          ku++
          key = ""user""
          id = strconv.Itoa(ku)
      } else if str[i] == 35 {
        kh++
        key = ""hashTag""
        id = strconv.Itoa(kh)
      } else {
        kg++
        key = ""group""
        id = strconv.Itoa(kg)
      }
      retMap[key] = make(map[string]string) // If not assign here then it gives runtime error ""panic: assignment to entry in nil map""
      for j := i + 1; j < len(str); j++ {
        col = col + string(str[j])
        if str[j] == 32 {
          j = len(str) - 1
          retMap[key][id] = retMap[key][id] + col
          col = "" ""
        }
      }
    }
 }
 fmt.Println(""Final String "",retMap)
}


Output : 
Final String  map[group:map[1: Hi ] user:map[2: William ] hashTag:map[1: sosos ]]

Expected Output : 

Final String  map[group:map[1: Hi ] user:map[1: John, 2: William ] hashTag:map[1: sosos ]] 

It might be duplicate of 

Runtime error: ""assignment to entry in nil map""

Runtime error: assignment to entry in nil map

but not understand kindly provide me a solution. Thanks
",1,35253006.0
398,35252253,Golang session based authentication,"I am trying to authenticate a user (using email and password) in golang but I am having some problems with sessions. It seems like I cant retrieve the session value from /login/ to / (home) page. 

User Registration

hashedPassword, _ := bcrypt.GenerateFromPassword([]byte(r.Form[""passwordSignup""][0]), bcrypt.DefaultCost)

err = c.Insert(&model.UserModel{
  Email:     r.Form[""emailSignup""][0],
  Password:  string(hashedPassword),
  CreatedAt: time.Now(),
})

// TODO : should session management be made in here ???
// you can use gorilla sessions if you want as far it works

http.SetCookie(w, cookie)
http.Redirect(w, r, ""/"", 301) // goes to the homepage(only accessed by authenticated users)


Login

if r.Form[""emailLogin""][0] == result.Email 
&& bcrypt.CompareHashAndPassword([]byte(result.Password), []byte(r.Form[""passwordLogin""][0])) == nil {

  // TODO : Handling the session in here

  http.Redirect(w, r, ""/"", 301) // goes to the home page
} else {
  http.Redirect(w, r, ""/login/"", 301)
}


I checked this links too :
http://shadynasty.biz/blog/2012/09/05/auth-and-sessions/
https://www.youtube.com/watch?v=p0tGnjW_xxI
",1,35256530.0
399,35257784,golang: Getting string from []byte,"I'm new to go (coming from the C++ world)

I've created a new writer, which ""inherits"" from io.writer:

type httpWriter struct {
  io.Writer
}


Next I've implemented the Write() function of the io.Writer interface:

func (w *httpWriter) Write(p []byte) (n int, err, error){...}


Then, I've redirected all output to that writer.

I'm having truble to print the actual string in the Write() implementation.
I've tried all string formatting I could find in the documentation, but none of them give me the original string as an output.

fmt.Printf(""%s\n"",p) \\etc..


Would appreciate assistance
",1,35257894.0
400,35327609,Limiting the number of concurrent tasks running,"So I come accross this issue with go a lot. Let's say I have a text file with 100,000 lines of text. Now I wanna save all these lines to a db. So I would do something like this:

file, _ := iotuil.ReadFile(""file.txt"")

fileLines := strings.Split(string(file), ""\n"")


Now I would loop over all the lines in the file:

for _, l := range fileLines{
  saveToDB(l)
}


Now I wanna run this saveToDB func concurrently:

var wg sync.WaitGroup

for _, l := range fileLines{
  wg.Add(1)
  go saveToDB(l, &wg)
}

wg.Wait()


I don't know if this is a problem or not but that would run 100,000 concurrent functions. Is there any way of saying hey run 100 concurrent functions wait for all of those to finish then run 100 more. 

for i, _ := range fileLine {
  for t = 0; t < 100; t++{
    wg.Add(1)
    go saveToDB(fileLine[i], &wg)
  }
  wg.Wait()
}


Do I need to do something like that or is there a cleaner way to go about this? Or is me running the 100,000 concurrent tasks not an issue?
",1,35327747.0
401,35379378,Go : assignment to entry in nil map,"I'm rather new in go, and I searched for this trouble on this site, and founed answered questions, but cannot implement those answers to my case. I have a code : 

func receiveWork(out <-chan Work) map[string][]ChartElement {

    var countedData map[string][]ChartElement

    for el := range out {
        countedData[el.Name] = el.Data
    }
    fmt.Println(""This is never executed !!!"")

    return countedData
}


there are no troubles with structs outside this method. Also Println not executes(as test that panic is here). I understands that the trouble is in incrementing data to the structure.

There are some goroutines , that are sending data to channel, and receiveWork method rgabs it all and should make a map like this: 

map =>
    ""typeOne"" => 
       [
         ChartElement,
         ChartElement,
         ChartElement,
       ],
    ""typeTwo"" => 
       [
         ChartElement,
         ChartElement,
         ChartElement,
       ]


How to realize this inserting in a proper way?
",1,35379919.0
402,35384033,"In golang my go routines are using all cores, but only between 50 and 75% of each core","I am using version go1.5.3 linux/amd64 of the go language.  I have a go routine that performs a mathematical operation that takes some time.  Each go routine acts independently and does not have to block.

My systems has 12 cores.  If I spawn 12 go routines, it only takes the average use of all cores up to 31%.  If I use 24 go routines, it brings the average use of all cores up to 49%.  If I use 240, i get 77%.  2400 gives me 76%.

Apparently, the rand.Intn(j) operation is what is slowing it down.  Without it, the cores will run at 100%.  

func DoSomeMath() int {
    k := 0
    for i := 0; i < 1000; i++ {
        j := i*i + 2
        k += i * rand.Intn(j)
    }
    return k
}


How can I get the program to use all the cores at 100% while using an RNG?
",2,
403,35432369,go-swagger generate spec for route with path parameter,"I am trying to generate json API documentation compliant with Swagger2.0 specification using go-swagger.

I have a problem generating JSON doc for the route with path param which looks like this:


  PUT /foo/{bar}


Currently my godoc looks like this:

// Update bar in foo
// swagger:route PUT /foo/{bar} updateBar
//     Parameters:
//       bar: barParam
//     Responses:
//       500: myErrorResponse
func (h *handler) update(req *http.Request, params martini.Params) (int, string)


Struct wrapping bar parameter:

// swagger:parameters barParam
type BarParam struct {

    // aaaa
    // in: path
    bar string
}


When I run:

swagger generate spec -o ./swagger.json


The generated JSON currently looks like this:

    ""/foo/{bar}"": {
        ""put"": {
            ""description"": ""bar: barParam"",
            ""operationId"": ""updateBar"",
            ""responses"": {
                ""500"": {
                    ""$ref"": ""#/responses/myErrorResponse""
                }
            },
            ""summary"": ""Parameters:""
        }
    }


But I want to generate the following JSON (compliant with Swagger2.0):

    ""/v2/foo/{bar}"": {
        ""put"": {
            ""operationId"": ""updateBar"",
            ""responses"": {
                ""500"": {
                    ""$ref"": ""#/responses/myErrorResponse""
                }
            },
            ""parameters"": [
                {
                    ""in"": ""path"",
                    ""name"": ""bar"",
                    ""description"": ""aaaa"",
                    ""required"": true,
                    ""type"": ""string""
                }
            ]
        }
    }


How can I modify the doc comments for go-swagger to achieve that? Is there any documentation that describes the exact comments format for go-swagger?
",2,35436450.0
404,35555692,cross platform logging in Golang,"I am developing a Go program on a Mac which has Parallels installed with Windows so that I can test on both platforms.  My program works well.  I can compile a Windows "".exe"" file on my Mac and run it from Windows and it works well except the log file.

I have set the logger to write its output to a file like so:

log.SetOutput(projectsLog)


Where projectsLog is declare above it as shown below:

projectsLog *os.File


I am using log.Printf statements since I want formatted output.  An example is shown below:

log.Printf(""Error: wrong Hra Class value %s in row %v for project/path %s"", hraClass, (rowNum + 1), testDir)


This is working great on Mac.  Each line using log.Printf is logged on a separate line, but on Windows the line breaks do not show and I get one lines without line breaks.  I am well aware of ""\r"" and ""\r\n"" difference between unix and windows.  But I thought that log.Printf will behave appropriately based on the platform it is run on?

If my assumption is wrong then what are some of the options that I have to make sure that the log file is readable on Windows?  If I can, I do not want to pass flags, e.g., -platform windows or some such thing.  Can this be handled in a transparent manner?
",1,
405,35576337,Is there an efficient way to share structure between golang packages?,"I have a short program in Go with the following files part of it.
Program directory structure:

myprogram/
    main.go
    server.go
    routines.go
    structs.go


These different files contain different function. The structs.go file contains a list of structure type defined, and used in several files of my program. What I want to do, now is to split my program into package like in this example :

main/
    main.go // the main program
server/
    server.go // a package imported in main
routines/
    routines.go // a package imported in main


My problem, is that I do not know where to put structs.go because it contains structures used in several package, as in the 'main.go' code.

How to share efficiently this structs.go file ? Should I include it (via a symlink to the file) in each of the package I defined, i.e serverand routines and also in main ?

My method may be awkward because I'm a beginner in Go, and in programming generally. 
",1,
406,35605238,Cannot start golang application exe as a windows services,"I have a application with golang as the backend. 
I can create a service using the sc and nssm as below :
sc create TestService binpath=C:\User\sds\Desktop\test.exe
nssm install TestService C:\User\sds\Desktop\test.exe

The services are created successfully but it doesn not get started. It gives startup timeout error while starting the service.

I need to start the application from windows services.

Thanks in advance.
",1,35607787.0
407,35632942,Crash in go program doing a lot of I/O,"I am trying to write to 100000 files in parallel with Go.

I am not sure why, but this code below crashes ~30% of the time when I call it with the argv parameter ""100000"".

Here is the crash:

goroutine 3749 [chan send]:
main.CallShellCommand(0xc820016180, 0xea1)
        .../parallel.go:13 +0x1bf
created by main.main
        .../parallel.go:22 +0xbd


Here is the code:

package main

import ""fmt""
import ""io/ioutil""
import ""strconv""
import ""os""
import ""runtime""

func CallCommand(ch chan struct{}, id int) {
    ioutil.WriteFile(fmt.Sprintf(""/tmp/my_prefix_%d"", id), []byte(""HELLO\n""), 0644)
    ch <- struct{}{}
}

func main() {
    runtime.GOMAXPROCS(4)
    n, _ := strconv.Atoi(os.Args[1])
    ch := make(chan struct{})
    for i := 0; i < n; i++ {
        go CallCommand(ch, i+1)
    }
    for j := 0; j < n; j++ {
        <-ch
    }
}


For the record:


My computer has 4 cores
This is go 1.5.3

",1,35636889.0
408,35644058,too many arguments in call to Find mgo,"I was trying to search a collection with multiple field conditions using $elemMatch operator. Then I encountered an error ""too many arguments in call to c.Find"". Document structure is as follows:-

{
    ""_id"" : ObjectId(""56cfca4bf23e4e2859257425""),
    ""company_name"" : ""bank"",
    ""admin"" : {
        ""email"" : ""xyz@bank.com"",
        ""fullname"" : ""xyz""
    },
    ""process"" : [ 
        {
            ""process_name"" : ""Enquiry"",
            ""processtype"" : 0,
            ""sortorder"" : 0
        }, 
        {
            ""process_name"" : ""Converted"",
            ""processtype"" : 1,
            ""sortorder"" : 1
        }
    ]
}


My query is as follows:- 

colQuerier := bson.M{""company_name"": ""bank""}
match := bson.M {""process"": bson.M {""$elemMatch"": bson.M{""process.process_name"":""Converted""}}}
err := c.Find(colQuerier,match).Sort(""-id"").All(&results)


What is wrong with my query? Is it any syntax error?
",1,35644397.0
409,35658354,Pointer to loop variable for range over map or slice of interface{},"I'm using go-hdf5 and I'm hitting a problem when trying to write attributes in a loop from a map.

The attributes are created correctly (correct name and datatype) but the written value is garbage.

The same code outside of the loop works fine. I tried both the v := v idiom and wrapping the code in a closure to capture v but it doesn't make a difference.

Here is the gist of the code (error checking intentionally left out for clarity):

m := map[string]interface{""foo"", 42}
for k, v := range m {
    // [...]
    v := v
    attr.Write(&v, dtype)
}


The Write method is using reflection to grab a pointer to the value and forwards it to the C library. The relevant part of the code is just:

func (s *Attribute) Write(data interface{}, dtype *Datatype) error {
    v := reflect.ValueOf(data)
    addr := unsafe.Pointer(v.Pointer())
    return h5err(C.H5Awrite(s.id, dtype.id, addr))
}


If I replace the map by a slice of interface{}, I get the exact same problem so my hunch is that this has to do with the binding of loop variables, but yet v := v doesn't help so I'm not sure.

I'm quite familiar with Go, HDF5 (C library) and go-hdf5 but I'm really stuck here. Any idea?

BTW I'm using go1.5.1 darwin/amd64.
",1,35660410.0
410,35790414,Failed to update vendor deps via godep udpate ... command and godep save -r ./,"Hi I have latest deps available in my $GOPATH. Now i want to update my project Godeps.json with new deps(with latest GOPATH) by calling godep update ./... and then calling godep save ./... . 
however still i am with old deps in Godeps.json . Could somebody please guide me.

i am new to Godep. Thanks 
",2,35791966.0
411,35888817,Load image and css in Golang,"I setup a route in server.js in package main in root directory of project

http.HandleFunc(""/"",route.IndexHandler)

The IndexHandler is implemented in package route like this:

func IndexHandler(w http.ResponseWriter, r *http.Request) {
    data:=struct{
        Name string
    }{
        ""My name"",
    }
    util.RenderTemplate(w, ""index"", data)
}


The RenderTemplate function is implemented in package util like this:

func RenderTemplate(w http.ResponseWriter, tmpl string, data interface{}) {
    cwd, _ := os.Getwd()
    t, err := template.ParseFiles(filepath.Join(cwd, ""./view/"" + tmpl + "".html""))
    if err != nil {
        http.Error(w, err.Error(), http.StatusInternalServerError)
        return
    }
    err = t.Execute(w, data)
    if err != nil {
        http.Error(w, err.Error(), http.StatusInternalServerError)
    }
}


Directory structure in project like this:

/
/public/css
/public/images
/public/js
/route
/view


index.html view is located in folder view, router is in folder route

In index.html I include resources like these:





When request the appropriate path, index.html is still rendered, but images and stylesheet are not loaded. How can I do to include them in Golang html template engine?
",2,35890152.0
412,35904722,"go - Not enough arguments in call to ""html/template"".Must","I write a wrapper function in Golang for rendering template from multiple files like this:

func RenderTemplate(w http.ResponseWriter, data interface{}, tmpl... string) {
    cwd, _ := os.Getwd()
    for _,file:=range tmpl{
        file=filepath.Join(cwd,""./view/""+file+"".html"")
    }
    t, err := template.ParseFiles(tmpl...)
    if err != nil {
        http.Error(w, err.Error(), http.StatusInternalServerError)
        return
    }
    templates:=template.Must(t)
    err = templates.Execute(w, data)
    if err != nil {
        http.Error(w, err.Error(), http.StatusInternalServerError)
    }
}


When I run server from main function, the console throws an error:

not enough arguments in call to ""html/template"".Must

If I write like this:

templates,err:=template.Must(t)

It also throws the same error, plus:

assignment count mismatch: 2 = 1

I intend to use this function for a route handler in server:

func IndexHandler(w http.ResponseWriter, r *http.Request) {
    files:=[]string{""base"",""index""}
    util.RenderTemplate(w, nil, files...)
}


index.html extends from base.html using template nesting

base.html template:

{{define ""base""}}



    
    {{template ""title"".}}
    
    
    
    
    
    


    {{template ""index"".}}


{{end}}


And index.html template:



{{define ""title""}}Homepage{{end}}

    {{define ""index""}}
    
        
            
                
                    
                
                
                    Organize Modern Knowledge for Mankind
                    Consume, Colect and Revisit Knowledge at Your Fingertips
                    
                
            
        
    
    {{end}}




Did I miss something? I checked the prototype of ""html/template"".Must and didn't get what happened
",2,35961173.0
413,35918588,Compatibility of ZeroMQ sockets written on different languages,"I've built an app written on python, based on ZeroMQ, but now I'm facing perfomance issues. So I decided to rewrite some modules of my app using, let's say, Golang. But when I try to establish messaging between sockets, implemented by different languages, anything does not work.I've searched so far, but I didn't find any info about compatibility problems of ZeroMQ using different languages. 

So the question is: Can I use golang for server implementation based on ZeroMQ and client written on python to connect to it?Or do I have to use only one language?

EDIT: here are typical server and client that I'm trying to get working properly

server:

import zmqctx = zmq.Context()
sock = ctx.socket(zmq.REP)
sock.bind(""tcp://*:57000"")
msg = sock.recv()


client:

package main

import (
    zmq ""github.com/pebbe/zmq4""
)

func main() {

    ctx, _ := zmq.NewContext()
    sock, _ := ctx.NewSocket(zmq.REQ)

    sock.Connect(""tcp://localhost:57000"")
    sock.Send(""simple message"", 0)
}


Server stucks at sock.recv()
",2,35918852.0
414,35950072,(Golang) JWT Signature Verification Issue,"I'm trying to get my head around JWT tokens in Golang. I'm using github.com/dgrijalva/jwt-go. 

What caught me off guard is the fact that I can enter multiple valid signatures.

For example, head over to http://jwt.io
- enter MySuperSecretKey for the secret

This token is valid:

eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE0NTc3MzAyODMsInVzZXIiOiJ1c2VyMSJ9.SxshVL42DUH9e7jXUblbB_bTwKxhe4jo70DrvbQMlaU

as well as this one:

eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE0NTc3MzAyODMsInVzZXIiOiJ1c2VyMSJ9.SxshVL42DUH9e7jXUblbB_bTwKxhe4jo70DrvbQMlaV

In fact, if I change the last letter to V, W or X, I get a ""Signature Verfied"" message.

Can anyone tell me what's going on here? 
",1,35985183.0
415,35997995,Golang Mac OSX build for Docker machine,"I need to run Golang application on Docker machine.

I'm working on Mac OSX and Docker is working on top of Linux virtual machine, so binaries builded on Mac are not runnable on Docker. 

I see two ways here:


cross-compile binaries on Mac for linux OS
copy project sources to docker, run 'go get' and 'go build' on it


First one is hard because of CGO (it is used in some imported libraries). 

Second is very slow because of 'go get' operation.

Can you please tell me, which way is the most common in that situation? Or maybe I'm doing something wrong?
",3,44757772.0
416,36027099,Why and when would a ResponseWriter generate raw html?,"I don't understand why the code is generating the view.html and post.html data correctly but displaying it all as raw text. I had been following the guide here and as I was building it, I thought that the generated html from the Execute function would be sent to the ResponserWriter which would handle displaying it, but the error I'm getting seems to indicate my understanding of Execute or the ResponseWriter is wrong.

package main

import (
    ""os""
    ""fmt""
    ""time""
    ""bufio""
    ""net/http""
    ""html/template""
)

type UserPost struct {
    Name string
    About string
    PostTime string
}

func check(e error) {
    if e != nil {
        fmt.Println(""Error Recieved..."")
        panic(e)
    }
}


func lineCounter(workingFile *os.File) int {
    fileScanner := bufio.NewScanner(workingFile)
    lineCount := 0
    for fileScanner.Scan() {
        lineCount++
    }
    return lineCount
}

func loadPage(i int) (*UserPost, error) {
    Posts,err := os.Open(""dataf.txt"")
    check(err)
    var PostArray [512]UserPost = parsePosts(Posts,i)
    Name := PostArray[i].Name 
    About := PostArray[i].About
    PostTime := PostArray[i].PostTime
    Posts.Close()
    return &UserPost{Name: Name[:len(Name)-1], About: About[:len(About)-1], PostTime: PostTime[:len(PostTime)-1]}, nil
}

func viewHandler(w http.ResponseWriter, r *http.Request) {
    tmp,err := os.Open(""dataf.txt"")
    check(err)
    num := (lineCounter(tmp)/3)
    tmp.Close()
    for i := 0; i < num; i++ {
        p, _ := loadPage(i)
        t, _ := template.ParseFiles(""view.html"")
        t.Execute(w, p)
    }
    p := UserPost{Name: """", About: """", PostTime: """"}
    t, _ := template.ParseFiles(""post.html"")
    t.Execute(w, p)
}

func inputHandler(w http.ResponseWriter, r *http.Request) {
    Name := r.FormValue(""person"")
    About := r.FormValue(""body"")
    PostTime := time.Now().String()

    filePaste,err := os.OpenFile(""dataf.txt"", os.O_RDWR | os.O_CREATE | os.O_APPEND | os.SEEK_END, 0666)
    check(err)
    filePaste.WriteString(Name+""~\n"")
    filePaste.WriteString(About+""~\n"")
    filePaste.WriteString(PostTime+""~\n"")
    filePaste.Close()
    fmt.Println(""Data recieved: "", Name,About,PostTime)
    http.Redirect(w, r, ""/#bottom"", http.StatusFound) //Use ""/#bottom"" to go to bottom of html page.
}

//os.File is the file type.
func parsePosts(fileToParse *os.File,num int) [512]UserPost {
    var buffer [512]UserPost
    reader := bufio.NewReader(fileToParse)  

    //This For loop reads each ""forum post"" then saves it to the buffer, then iterates to the next.
    for i := 0;i <= num; i++ {
        currentPost := new(UserPost)
        str, err := reader.ReadString('~')
        check(err)
        currentPost.Name = str

        //I search for '~' because my files save the end of reading line with that, so i can keep formatting saved (\n placement).
        str2, err2 := reader.ReadString('~')
        check(err2)
        currentPost.About = str2

        str3, err3 := reader.ReadString('~')
        check(err3)
        currentPost.PostTime = str3

        buffer[i] = *currentPost
        }   
    return buffer
}

func main() {
    fmt.Println(""Listening..."")
    http.HandleFunc(""/"", viewHandler)
    http.HandleFunc(""/post/"", inputHandler)
    http.ListenAndServe("":8080"", nil)
}   


view.html

{{.Name}}


    {{printf ""%s"" .About}}



    {{.PostTime}}



post.html



{{printf ""%s"" .Name}}

{{printf ""%s"" .About}}







I've currently been reading from an empty dataf.txt file.
",1,36029056.0
417,36098875,Cgo: How to return double array from C to Go,"I got a C function like this

double* c_func(int n_rows) {
  double result[n_rows];
  for (int i = 0; i < n_rows; ++i) {
    result[i] = (double)i;
  }
  return result;
}


And I use this Go function to process the C double:

// convert C double pointer to float64 slice ...
func doubleToFloats(in *C.double, length int) []float64 {
    out := make([]float64, length, length)

    start := unsafe.Pointer(in)
    size := unsafe.Sizeof(C.double(0))
    for i := 0; i < length; i++ {
        val := *(*C.double)(unsafe.Pointer(uintptr(start) + size*uintptr(i)))
        out[i] = float64(val)
    }
    return out
}


This sometimes works but sometimes not. When it not works, it return something like this:


[0 1 2 3 4 5 6 7 8 9 10 2.53e-321 3.32018606e-316 4.24664374149e-312 4.24399158193e-312 1.1383e-320 3.31882387e-316 3.71924634e-316 3.31885594e-316 3.71924634e-316 5e-324 0 4.6950308e-316 4.24664374149e-312 3.7175681e-316 3.3200616e-316]


which looks like somewhat memory issue to me...

I'm not sure if this is the correct way to handle returned double array from C in Go. If yes, how to fix the problem (which occurs ocassionally). If no, what is the correct way to handle returned double array from C?

Thanks.
",2,36103121.0
418,36152294,golang closure(anonymous function)catch wrong parameter`s value,"see test code:

package main

import ""fmt""

func main() {
    i := 10

    closure1 := func() {
        fmt.Printf(""closure, i: %d\n"", i)
        i = 15
    }

    closure1()

    fmt.Printf(""in main, i: %d\n"", i)

    closure2 := func(x int) {
        fmt.Printf(""function call, pass parameter, i: %d\n"", x)
    }

    i = 20

    closure1()
    closure2(i)
}


I think the output of the closure2 should be 20, but the real result is 15, i do not know why????
anybody can help me , please see my comment in my code, thanks in advance.
",2,36153952.0
419,36152939,Why must we declare a variable name when adding a method to a struct in Golang?,"Let's say I have a struct

type Rectangle struct {
    length, width int
}


and I want to add a method to it:

func (r Rectangle) Area() int {
    return r.length * r.width
}


Why must I give it a variable name here r?
",2,
420,36177614,GO Unit testing structured REST API projects,"I am trying to write nice unit tests for my already created REST API. I have this simple structure:

ROOT/
    config/
    handlers/
    lib/
    models/
    router/
    main.go


config contains configuration in JSON and one simple config.go that reads and parses JSON file and fills the Config struct. handlers contains controllers (i.e. handlers of respective METHOD+URL described in router/routes.go). lib contains some DB, request responder and logger logic. models contains structs and their funcs to be mapped from-to JSON and DB. Finally router contains the router and routes definition.

Now I was searching and reading a lot about unit testing REST APIs in GO and found more or less satisfying articles about how to set up a testing server, define routes and test my requests. All fine. BUT only if you want to test a single file!

My problem is now how to set up the testing environment (server, routes, DB connection) for all handlers? With the approach found here (which I find very easy to understand and implement) I have one problem: either I have to run tests separately for each handler or I have to write test suites for all handlers in just one test file. I believe you understand that both cases are not very happy (1st because I need to preserve that running go test runs all tests that succeed and 2nd because having one test file to cover all handler funcs would become unmaintainable).

By now I have succeeded (according to the linked article) only if I put all testing and initializing code into just one func per XYZhandler_test.go file but I don't like this approach as well.

What I would like to achieve is kind of setUp() or init() that runs once with first triggered test making all required variables globally visible and initialized so that all next tests could use them already without the need of instantiating them again while making sure that this setup file is compiled only for tests...

I am not sure if this is completely clear or if some code example is required for this kind of question (other than what is already linked in the article but I will add anything that you think is required, just tell me!
",2,36188366.0
421,36200806,"Go - Do I have one workspace for all projects, or one workspace per project?","When using Go how are projects organized? I'm a bit confused on the workspaces part. I've had a read of the following: https://golang.org/doc/code.html#Workspaces ... and this part has thrown me off a little:


  A typical workspace contains many source repositories containing many packages and commands. Most Go programmers keep all their Go source code and dependencies in a single workspace. 


Does this mean that for each project I create it is a seperate workspace? For example if two projects use the same package, I would have two copies of that package on my computer.

Or, does it mean you have a main workspace and your projects share those packages?

Bit confused.
",2,36200934.0
422,36295343,Parsing email message headers in Go,"How I can read some headers from an email message in Go?

Usually I would use ReadMIMEHeader(), but sadly not everybody has read all the relevant RFCs and for some messages I get output like:


  malformed MIME header line: name=""7DDA4_foo_9E5D72.zip""


I narrowed the culprit to be 

Content-Type: application/x-zip-compressed; x-unix-mode=0600;
name=""7DDA4_foo_9E5D72.zip""


instead of

Content-Type: application/x-zip-compressed; x-unix-mode=0600; 
  name=""7DDA4_foo_9E5D72.zip""


in the source of the message.

Go Playground example

What is the correct way of parsing the headers correctly, regardless if indented or not?
",2,36309240.0
423,36299375,How do I fix my GOROOT and GOPATH variables to run go?,"Operating system: Ubuntu 14.04

lines in the .bashrc (tried both of the following)

# GoPath (without goroot)
export GOPATH=$HOME/gowork


...

# GoPath (with goroot)
export GOROOT=/usr/local/go
export GOPATH=$HOME/gowork


Note: I tried to set the above environment variables, first in .profile and then in .bashrc as suggested by different people in a different way.

Tried to run the following code

package main

import ""fmt""

func main() {
    fmt.Println(""Hello World!"")
}


Error message in the terminal

go run helloworld.go 
helloworld.go:3:8: cannot find package ""fmt"" in any of:
    /usr/local/go/src/pkg/fmt (from $GOROOT)
    /home/arif/gowork/src/fmt (from $GOPATH)
package runtime: cannot find package ""runtime"" in any of:
    /usr/local/go/src/pkg/runtime (from $GOROOT)
    /home/arif/gowork/src/runtime (from $GOPATH)


edit

go env output

GOARCH=""amd64""
GOBIN=""""
GOCHAR=""6""
GOEXE=""""
GOHOSTARCH=""amd64""
GOHOSTOS=""linux""
GOOS=""linux""
GOPATH=""/home/arif/gowork""
GORACE=""""
GOROOT=""/usr/local/go""
GOTOOLDIR=""/usr/local/go/pkg/tool/linux_amd64""
CC=""gcc""
GOGCCFLAGS=""-fPIC -m64 -pthread -fmessage-length=0""
CXX=""g++""
CGO_ENABLED=""1""


go version output

go version go1.3.3 linux/amd64


A hint

I remember that the tar I installed from was go1.6.linux-amd64.tar.gz, which means the go version 1.6 should be shown but my terminal is outputting 1.3.3.
",1,36299472.0
424,36299902,Golang: Unmarshal JSON Object results in empty map,"I've been stuck trying to unmarshal a json object.  I am not getting any errors but I am getting an empty map afterwards.  I'm new to go so I'm still trying to wrap my head around some of the language constructs.  

Here is what my data source looks like

{ 
    ""animationStates"": {
        ""idle"": {
            ""numFrames"": 4,
            ""frames"": [
                {
                    ""frame"": {""x"":43,""y"":106,""w"":12,""h"":15},
                    ""rotated"": false
                },
                {
                    ""frame"": {""x"":1,""y"":143,""w"":12,""h"":14},
                    ""rotated"": false
                },
                {
                    ""frame"": {""x"":71,""y"":132,""w"":12,""h"":14},
                    ""rotated"": false
                },
                {
                    ""frame"": {""x"":15,""y"":126,""w"":12,""h"":15},
                    ""rotated"": true 
                }
            ]
        },
        ""run"": {
            ""numFrames"": 10,
            ""frames"": [
                {
                    ""frame"": {""x"":73,""y"":82,""w"":12,""h"":15},
                    ""rotated"": false
                },
                {
                    ""frame"": {""x"":29,""y"":125,""w"":12,""h"":15},
                    ""rotated"": false
                },
                {
                    ""frame"": {""x"":33,""y"":36,""w"":12,""h"":16},
                    ""rotated"": false
                },
                {
                    ""frame"": {""x"":1,""y"":107,""w"":12,""h"":16},
                    ""rotated"": false
                },
                {
                    ""frame"": {""x"":1,""y"":89,""w"":12,""h"":16},
                    ""rotated"": false
                },
                {
                    ""frame"": {""x"":17,""y"":54,""w"":12,""h"":16},
                    ""rotated"": false
                },
                {
                    ""frame"": {""x"":1,""y"":125,""w"":12,""h"":16},
                    ""rotated"": false
                }
                {
                    ""frame"": {""x"":15,""y"":143,""w"":12,""h"":14},
                    ""rotated"": false
                },
                {
                    ""frame"": {""x"":29,""y"":142,""w"":12,""h"":14},
                    ""rotated"": false
                },
                {
                    ""frame"": {""x"":72,""y"":99,""w"":12,""h"":15},
                    ""rotated"": false
                }
            ]
        },
        ""roll"": {
            ""numFrames"": 5,
            ""frames"": [
                {
                    ""frame"": {""x"":71,""y"":116,""w"":12,""h"":14},
                    ""rotated"": false
                },
                {
                    ""frame"": {""x"":71,""y"":148,""w"":12,""h"":10},
                    ""rotated"": false
                },
                {
                    ""frame"": {""x"":73,""y"":47,""w"":12,""h"":15},
                    ""rotated"": false
                },
                {
                    ""frame"": {""x"":57,""y"":147,""w"":12,""h"":11},
                    ""rotated"": false
                },
                {
                    ""frame"": {""x"":29,""y"":108,""w"":12,""h"":15},
                    ""rotated"": false
                }
            ]
        },
        ""jump"": {
            ""numFrames"": 1,
            ""frames"": [
                {
                    ""frame"": {""x"":45,""y"":54,""w"":12,""h"":16},
                    ""rotated"": false
                }
            ]
        },
        ""fall"": {
            ""numFrames"": 1,
            ""frames"": [
                {
                    ""frame"": {""x"":29,""y"":90,""w"":12,""h"":16},
                    ""rotated"": false
                }
            ]
        },
        ""shoot"": {
            ""numFrames"": 5,
            ""frames"": [
                {
                    ""frame"": {""x"":37,""y"":1,""w"":14,""h"":15},
                    ""rotated"": false
                },
                {
                    ""frame"": {""x"":17,""y"":37,""w"":14,""h"":15},
                    ""rotated"": false
                },
                {
                    ""frame"": {""x"":1,""y"":37,""w"":14,""h"":16},
                    ""rotated"": false
                },
                {
                    ""frame"": {""x"":19,""y"":19,""w"":14,""h"":15},
                    ""rotated"": false
                },
                {
                    ""frame"": {""x"":1,""y"":55,""w"":14,""h"":15},
                    ""rotated"": false
                }
            ]
        }
    }
}


and here is the code that I'm using to unmarshal

package main

import (
    ""encoding/json""
    ""io/ioutil""
)

type AnimationFrame struct {
    Frame struct {
        X int `json:""x""`
        Y int `json:""y""`
        W int `json:""w""`
        H int `json:""h""`
    } `json:""frame""`
    Rotated bool `json:""rotated""`
}

type Animation struct {
    NumFrames int `json:""numFrames""`
    Frames []AnimationFrame `json:""frames""` 
} 

type StateList struct {
    Actions map[string]Animation `json:""animationStates""`
}

func NewAnimation (file string) *StateList {
    list := make(map[string]Animation)
    s := &StateList{list}
    buff, err := ioutil.ReadFile(file)
    check(err)
    json.Unmarshal([]byte(buff), &s)
    return s 
}

func check (e error) {
    if e != nil {
        panic(e)
    }
}


Does anyone see what I'm doing wrong?  Thanks.
",1,36300055.0
425,36310538,Identify non builtin-types using reflect,"I need to differentiate such types as

type A []byte


from a []byte. Using reflect, reflect.TypeOf(A{}).Kind tells me that it is a Slice of byte. How can I differentiate []byte{} from A{}, without having a bounded list of types to check for?

Are there new ways to do it in newer versions of Go?
",1,37292523.0
426,36322527,Error when decoding JSON,"I have been experimenting with GO for the first time, over the last few days.

I have a HTML form that passes it's values to a server. This server in turn extracts the form keys/ values and places them inside a JSON. This JSON is then sent to another server. 

The issue is: I get the following error when the second server attempts to decode the JSON:

Error decoding JSON:  json: cannot unmarshal string into Go value of type main.NewContainerJSON

1: The original HTML form



    
        Container Configuration
    
    
        Container Name
        
    
    
        Base Server
        
            
                Ubuntu 14.04
        
    
    
        Content Management System
        
            
                Wordpress
        
    
    
        Website Name
        
    
    
        New Root Database Password 
        
    
    
        Database Admin Username
        
    
    
        Database Admin Password
        
    
    
        
        
    
    


 

2: The first servers code

package main

import (
""fmt""
""encoding/json""
""net""
""net/http""
 )

type newContainerJSON struct {
    ContainerName string
    BaseServer string
    CMS string
    WebsiteName string
    DBrootPWD string
    DBadminUname string
    DBadminPWD string
}

func newUser(w http.ResponseWriter, r *http.Request) {
    r.ParseForm()

    cName := r.FormValue(""containerName"")
    sName := r.FormValue(""BaseServer"")
    cmsName := r.FormValue(""CMS"")
    wsName := r.FormValue(""websiteName"")
    dbrootPwd := r.FormValue(""dbRootPWD"")
    dbadmName := r.FormValue(""dbAdminUname"")
    dbamdpwdName := r.FormValue(""dbAdminPwd"") 

    c := newContainerJSON {
        ContainerName: cName,
        BaseServer: sName,
        CMS: cmsName,
        WebsiteName: wsName,
        DBrootPWD: dbrootPwd,
        DBadminUname: dbadmName,
        DBadminPWD: dbamdpwdName,
    }

    d, _ := json.Marshal(c)
    s := string(d)
    fmt.Println(s)

    conn, err := net.Dial(""tcp"", ""127.0.0.1:8081"")
    checkError(err)

    encoder := json.NewEncoder(conn)

    encoder.Encode(d) 
}

func main() {
    http.HandleFunc(""/new-user"", newUser)
    err := http.ListenAndServe("":8080"", nil) // setting listening port
    checkError(err)
}

func checkError(err error) {
    if err != nil {
        fmt.Println(""Fatal error "", err.Error())
     }
}


3: The second servers code:

package main

import (
    ""fmt""
    ""net""
    ""encoding/json""
)

type NewContainerJSON struct {
    ContainerName string    `json:"",string""`
    BaseServer string       `json:"",string""`
    CMS string              `json:"",string""`
    WebsiteName string      `json:"",string""`
    DBrootPWD string        `json:"",string""`
    DBadminUname string     `json:"",string""`
    DBadminPWD string       `json:"",string""`
}

func main() {

    service := ""127.0.0.1:8081""
    tcpAddr, err := net.ResolveTCPAddr(""tcp"", service)
    checkError(err)

    listener, err := net.ListenTCP(""tcp"", tcpAddr)
    checkError(err)

    conn, err := listener.Accept()
    checkError(err)

    decoder := json.NewDecoder(conn)

    var b NewContainerJSON
    err = decoder.Decode(&b)
    checkError(err)

    fmt.Println(b)

    conn.Close() // we're finished

}

func checkError(err error) {
    if err != nil {
        fmt.Println(""An error occurred: "", err.Error())

    }
}


The error occurs with following code in the second servers code 

var b NewContainerJSON
err = decoder.Decode(&b)
checkError(err)

fmt.Println(b)


I suspect I am not decoding the JSON properly or I am missing something very obvious.
",2,36322864.0
427,36326870,On the golang call DLL?,"package main

import (
    ""fmt""
    ""syscall""
    ""unsafe""
)

const (
    PROCESS_QUERY_INFORMATION = 1 << 10
    PROCESS_VM_READ           = 1 << 4
)

//defind a struct
type PROCESS_MEMORY_COUNTERS struct {
    cb                         uint32
    PageFaultCount             uint32
    PeakWorkingSetSize         uint64
    WorkingSetSize             uint64
    QuotaPeakPagedPoolUsage    uint64
    QuotaPagedPoolUsage        uint64
    QuotaPeakNonPagedPoolUsage uint64
    QuotaNonPagedPoolUsage     uint64
    PagefileUsage              uint64
    PeakPagefileUsage          uint64
}

func main() {
    //get Process Handle
    current, err := syscall.OpenProcess(PROCESS_QUERY_INFORMATION|PROCESS_VM_READ, false, 728)
    if err != nil {
        return
    }
    //call psapi.ll
    psapi := syscall.NewLazyDLL(""psapi.dll"")
    var process PROCESS_MEMORY_COUNTERS
    process.cb = uint32(unsafe.Sizeof((process)))
    GetProcessMemoryInfo := psapi.NewProc(""GetProcessMemoryInfo"")
    _, _, err = GetProcessMemoryInfo.Call(uintptr(current), uintptr(unsafe.Pointer(&process)), unsafe.Sizeof(&process))
    if err != nil {
        fmt.Println(err)
    } else {
        fmt.Println(process)
    }
}


Reports this error:


  The data area passed to a system call is too small

",3,
428,36341505,"godep: exec: ""go"": executable file not found in $PATH","I trying to deploy my server on heroku and I stuck on step where I should use godep, I spent little time with GO, last two days I had looking how to solve this issue, actually it's a popular issue, but I can't figure out, maybe I did something fundamentally wrong.

I have OS X 10.11.2
My GOPATH  - Users/denis/Programming/Golang
My PATH - $GOPATH/bin
I trying to use godep to my project which is placed in $GOPATH/src/backend

in my PATH I have an executable godep file(not .go).

Whole structure of my workplace.

/Golang/
     .bin/
        godep //executable file
     .pkg/
        .darwin-amd64/
             .//other folders/
     .src/
         .github.com/
         .backend/
         .//other folders// 

",1,36342688.0
429,36344680,go + elastigo panic: runtime error: index out of range,"I'm testing golang with elasticsearch

I'm using the library:
https://github.com/mattbaird/elastigo

My problem is when i run:

go run elastigo_postal_code2.go 


The compiler show something like this:

panic: runtime error: index out of range

goroutine 1 [running]:
panic(0x893ce0, 0xc82000a150)
        /opt/go/src/runtime/panic.go:464 +0x3ff
main.main()
        /home/hector/go/elastigo_postal_code2.go:80 +0xa30
exit status 2


I'm not sure what this means or how I can fix it!

Someone can help me and tell me I'm doing wrong

/*

curl -X PUT ""http://localhost:9200/mx2/postal_code/1"" -d ""
{
    \""cp\""         : \""20000\"",
    \""colonia\""    : \""Zona Centro\"",
    \""ciudad\""     : \""Aguascalientes\"",
    \""delegacion\"" : \""Aguascalientes\"",
    \""location\"": {
        \""lat\"": \""22.0074\"",
        \""lon\"": \""-102.2837\""
    }
}""

curl -X PUT ""http://localhost:9200/mx2/postal_code/2"" -d ""
{
    \""cp\""         : \""20008\"",
    \""colonia\""    : \""Delegacion de La Secretaria de Comercio y Fomento Industrial\"",
    \""ciudad\""     : \""Aguascalientes\"",
    \""delegacion\"" : \""Aguascalientes\"",
    \""location\"": {
        \""lat\"": \""22.0074\"",
        \""lon\"": \""-102.2837\""
    }
}""

*/

package main

import (
    ""encoding/json""
    ""flag""
    ""log""
    elastigo ""github.com/mattbaird/elastigo/lib""
)

var (
    eshost *string = flag.String(""host"", ""localhost"", ""Elasticsearch Server Host Address"")
)


func main() {
    flag.Parse()
    log.SetFlags(log.Ltime | log.Lshortfile)

    c := elastigo.NewConn()
    c.Domain = *eshost

    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    searchJson := `{
        ""size"": 10,
        ""query"": {
            ""match"": {
                ""all"": {
                    ""query"": ""aguascalientes"",
                    ""operator"": ""and""
                }
            }
        },
        ""sort"": [{
            ""colonia"": {
                ""order"": ""asc"",
                ""mode"": ""avg""
            }
        }]
    }`

    /////////////////////////////////////////////////////////////////////////////////////////////////////////////////

    searchresponse, err := c.Search(""mx2"", ""postal_code"", nil, searchJson)
    if err != nil {
        log.Println(""error during search:"" + err.Error())
        log.Fatal(err)
    }

    // try marshalling to ElasticSearchResponse type
    var t ElasticSearchResponse
    bytes, err := searchresponse.Hits.Hits[0].Source.MarshalJSON()
    if err != nil {
        log.Fatalf(""err calling marshalJson:%v"", err)
    }

    json.Unmarshal(bytes, &t)
    log.Printf(""Search Found: %s"", t)
    c.Flush()

}

func (t *ElasticSearchResponse) String() string {
    b, _ := json.Marshal(t)
    return string(b)
}

// used in test suite, chosen to be similar to the documentation
type ElasticSearchResponse struct {
    Cp         string `json:""cp""`
    Colonia    string `json:""colonia""`
    Ciudad     string `json:""ciudad""`
    Delegacion string `json:""delegacion""`
    Location Location `json:""location""`
}

type Location struct {
    Lat string `json:""lat""`
    Lon string `json:""lon""`
}


The code of my scritp is here:

https://gist.github.com/hectorgool/c9e18d7d6324a9ed1a2df92ddcc95c08#file-elastigo_example-go-L80
",1,
430,36356835,Golang Gorilla Websocket with Web Proxy,"I'm working on a POC using Gorilla/Websocket to communicate, through a Web Proxy, with the Websocket Check Website ""echo.websocket.org"".

I'm using the free online Proxy ""hide.me/en/"" for testing.

When I simply try to communicate with ""echo.websocket.org"" (Server side), my client-site Websocket POC reach the response.

But when i try to add the Proxy gesture, everything goes wrong :(

Here is a sample of my code :

package main

import (
    ""flag""
    ""log""
    ""net/url""
    ""os""
    ""os/signal""
    ""time""

    ""github.com/gorilla/websocket""
    ""net/http""
)

var addrWebsocket = flag.String(""addrWebsocket"", ""echo.websocket.org"", ""http service address"")

func main() {
    flag.Parse()
    log.SetFlags(0)

    interrupt := make(chan os.Signal, 1)
    signal.Notify(interrupt, os.Interrupt)

    //Initialize the WebSocket URL and the Path to follow
    uWS := url.URL{Scheme: ""wss"", Host: *addrWebsocket}

    //Initialize the Proxy URL and the Path to follow
    uProxy, _ := url.Parse(""https://hide.me/en/proxy"")

    //Set the Dialer (especially the proxy)
    dialer := websocket.Dialer{
        Proxy: http.ProxyURL(uProxy),
    }
    //dialer := websocket.DefaultDialer ==> with this default dialer, it works !

    c, _, err := dialer.Dial(uWS.String(), nil) // ==> With the proxy config, it fails here !
    defer c.Close()

    done := make(chan struct{})

    go func() {
        defer c.Close()
        defer close(done)
        for {
            _, message, err := c.ReadMessage()
            if err != nil {
                log.Println(""read:"", err)
                return
            }
            log.Printf(""recv: %s"", message)
        }
    }()

    ticker := time.NewTicker(time.Second)
    defer ticker.Stop()

    for {
        select {
        case t := <-ticker.C:
            err := c.WriteMessage(websocket.TextMessage, []byte(t.String()))
            if err != nil {
                log.Println(""write:"", err)
                return
            }
        case <-interrupt:
            log.Println(""interrupt"")
            err := c.WriteMessage(websocket.CloseMessage, websocket.FormatCloseMessage(websocket.CloseNormalClosure, """"))
            if err != nil {
                log.Println(""write close:"", err)
                return
            }
                select {
                case <-done:
                case <-time.After(time.Second):
                }
            c.Close()
            return
        }
    }
}


I'm a very beginner in Go so don't hesitate to correct me if my code un not clear and clean.

Thanks for your help !
",1,
431,36362457,bson.M to struct,"I have a fairly odd question that I have been trying to wrap my head around and am looking of some pointers as to the best approach. I am use mgo to filter a collection that contains a few different types of structs and am trying to cast from bson.M to the proper struct after the fact. Basically I'd like to be able to filter the collection and look at each result and based on a common field cast to the proper struct.

Here is sample of the structs I am trying to use.

  type Action interface {
    MyFunc() bool
  }

  type Struct1 struct {
    Id bson.ObjectId `bson:""_id,omitempty""`
    Type  string `bson:""type""`
    Struct1Only string `bson:""struct1only""`
  }

  func (s Struct1) MyFunc() bool {
    return true
  }

  type Struct2 struct {
    Id bson.ObjectId `bson:""_id,omitempty""`
    Type string `bson:""type""`
    Struct2Only string `bson:""struct2only""`
  }

  func (s Struct2) MyFunc() bool {
    return true
  }


My initial idea was to do something like:

var result bson.M{}
err := c.Find(bson.M{nil}).One(&result)


Then switch on the type field and cast to the proper struct, but honestly I am new to go and mongo and am sure there is better way to do this. Any suggestions? Thanks
",1,
432,36407297,Go - Parse NULL to time.Time in Struct,"I am casting to a struct which has a time.Time type in.

t2 := time.Now()
format := ""2006-01-02 15:04:05""

theTime, _ := time.Parse(format, t2.Format(format))


However, sometimes I don't want to set the time.Time field, how do you define this with the go/mysql db driver?

app_history := &models.AppsHistoryInsert{
    AppId:          response.SetAppData[0].Id,
    LiveDate:       &theTime,
}


Basically, I want 

if(x == true) { 
    include time 
}
else {
    don't include time. 
}


I tried doing an if around the struct declaration itself and leaving the LiveDate field out but I got the error of controllers/apps.go:1068: undefined: app_history
",1,36407524.0
433,36487467,"Golang nested, renamed XML attributes","Given the following struct:

type book struct {
    XMLName xml.Name   `xml:""DailyAct""`
    Symbol     string  `xml:""TradeInstrId,attr""`
    EntityId   string  `xml:""EntityId,attr""`
    AssetClass string  `xml:""AssetClass,attr""`
    Open       int     `xml:""Open""`
    High       int     `xml:""High""`
    Low        int     `xml:""Low""`
    Close      int     `xml:""Close""`
    // Type      string `` //I'll leave this for another question
}


My current XML: 

  
      2
      3
      1
      5
  


But, I need to repurpose certain fields of the struct (or generate xml another way) to achieve:


  
  
  
  



But I get: &errors.errorString{s:""xml: DailyAct>Open chain not valid with Price,attr flag""} (actual) when I try to nest fields like so:

type book struct {
    //...
    Open       int     `xml:""DailyAct>Open,Price,attr>""`
    //...
}


Edit: 
I found this discussion, while googling around so what I'm going for may not be feasible currently 
",1,36489594.0
434,36525757,Golang Logger polymorphism?,"We use a third party library which accepts *log.Logger (stdlib Logger) as a parameter in its New function, but we implement Logger by ourself. It has the same ""interface"" with stdlib Logger.

Is there any hack way to pass our own implementation of Logger to the third library excepting asking the library owner to change the parameter type to interface？
",1,36526059.0
435,36566288,"Which is best way to wait event until expire in golang, timer or goroutine loop?","the state machine's first state is waiting for one event, if the event doesn't happen in certain days, the status machine will switch to the second state. If the event happened in the period, the state machine will switch to the third state. 

I have two option:
1, Use a timer. Set up a timer as certain days. When time is up, checking does the event happened or not. If happened, switch to the third state. If not, switch to the second state. It is possible that thousands of timers will be created in the period.

2, Use a looping with routine. Start a routine to run a loop. Every half hour, the goroutine will check the event happened or not. If the event happened, switch to the third state. Else, keep looping until expired the certain days, then switch to the second state. 

My question is time.Timer vs goroutine, which is more suit for this case?
",1,36566412.0
436,36571917,memory leaks in golang,"Here is the code.
In the golang main function, which in main.go

func main() {
    rgc.GetRgcService()
}


where the rgc is in another golang file, named mrgc.go. The code inside is

package rgc
func GetRgcService() (svc *RgcService, err error) {}


The function GetRgcService is a empty function.

However, when I used valgrind to test the memory, I got the following output

 ==58156== HEAP SUMMARY:
 ==58156==     in use at exit: 1,152 bytes in 4 blocks
 ==58156==   total heap usage: 9 allocs, 5 frees, 1,304 bytes allocated
 ==58156== 288 bytes in 1 blocks are possibly lost in loss record 4 of 4
 ==58156==    at 0x4A27F63: calloc (vg_replace_malloc.c:593)
 ==58156==    by 0x4010DE1: allocate_dtv (in /home/opt/gcc-4.8.2.bpkg-r2/gcc-4.8.2.bpkg-r2/lib64/ld-2.18.so)
==58156==    by 0x40114ED: _dl_allocate_tls (in /home/opt/gcc-4.8.2.bpkg-r2/gcc-4.8.2.bpkg-r2/lib64/ld-2.18.so)
==58156==    by 0x4B36DE2: pthread_create@@GLIBC_2.2.5 (in /home/opt/gcc-4.8.2.bpkg-r2/gcc-4.8.2.bpkg-r2/lib64/libpthread-2.18.so)
==58156==    by 0x4B2937: _cgo_sys_thread_start (gcc_linux_amd64.c:75)
==58156==    by 0x45506C: runtime.asmcgocall (/home/map/.jumbo/lib/go/src/runtime/asm_amd64.s:612)
==58156==    by 0x50619F: ??? (in /home/users/zhanghuaizhi/ttt.38)
==58156==    by 0xC7FFFFFFFF: ???
==58156==    by 0xC820067FFF: ???
==58156==    by 0x42D69B: runtime.allocm (/home/map/.jumbo/lib/go/src/runtime/proc.go:1260)
==58156==    by 0x42DD3A: runtime.newm (/home/map/.jumbo/lib/go/src/runtime/proc.go:1510)
==58156==    by 0x42E071: runtime.startm (/home/map/.jumbo/lib/go/src/runtime/proc.go:1583)
==58156== 
==58156== LEAK SUMMARY:
==58156==    definitely lost: 0 bytes in 0 blocks
==58156==    indirectly lost: 0 bytes in 0 blocks
==58156==      possibly lost: 1,152 bytes in 4 blocks
==58156==    still reachable: 0 bytes in 0 blocks
==58156==         suppressed: 0 bytes in 0 blocks


How can I free these memory? Since I need to used this function to do a lot of process. It causes lots of memory leaks, which can not be freed
",2,36572467.0
437,36614509,golang too many arguments to return,"When I assign a function to variable and try to invoke it . It throws an error 'too many arguments to return'

package main

import ""fmt""

func main() {
  first_name := ""Hello""
  last_name := ""World!""
  full_name := func() {
    return first_name
  }
  fmt.Println(first_name)
  fmt.Println(last_name)
  fmt.Println(full_name)
}

",2,36614590.0
438,36683911,Go slices - capacity/length?,"Trying to learn Go from the tutorial right now, and have a pretty basic question:

 func main() {
  a := make([]int, 5)
  // [0,0,0,0,0] len=5 cap=5

  b := make([]int, 0, 5)
  // [] len=0 cap=5

  c := b[:2]
  // [0,0] len=2 cap=5

  d := c[2:5]
  // [0,0,0] len=3 cap=3
}


Why does c look like [0,0] and have length 2? b was not originally zero'ed hence it being []. So does setting c to b[:2] zero out the first two elements?

Also, why is the capacity of d 3? Very confused.

Thanks in advance.
",1,
439,36688872,Golang test mock functions best practices,"I am developing some tests for my code (using the testing package), and I am wondering what's the best way to mock functions inside the tested function:

Should I pass the function as parameter?
In that case, what if that function calls another function? Should I pass both the first and second function as parameters in the tested one?

Note: some of the functions are called on objects (i.e. someObj.Create()) and use HTTP API calls.

UPDATE for clarification:

Example: functions

func f1() error {
  ... //some API call
}

func (s *SomeStruct) f2() error {
  return f1
}

func f3() error {
  return nil
}

func f4() error {
  ...
  err = obj.f2()
  ...
  err = f3()
  ...
}


For the above: if I want to test f4, what's the best way to mock f2 and f3?

If I pass f2 and f3 to f4 as parameters it would work, but then what for the f2 test? Should I pass f1 to f2 as parameter?

And if that's it, should then f4 have f1 as well in the parameters?
",2,36696853.0
440,36729147,How can I parse this date in Golang?,"I am having some trouble in parsing this date (""APR 19, 3:15p ET""), can anyone please help me in this regard?

This is the code which I have written.

d, err := time.Parse(""JAN 02, 3:04p ET"", date)


Thanks in advance.
",1,36729325.0
441,36770716,"MINGW64 ""make build"" error: ""bash: make: command not found""","I am working on Windows 10. I want to run a ""make build"" in MINGW64 but following error comes up:

$ make build
bash: make: command not found


I want to build Glide for Golang

I tried following:

$ sudo yum install build-essential
bash: sudo: command not found


As well as:

$ yum install build-essential
bash: yum: command not found


And:

$ apt-cyg build-essential
bash: apt-cyg: command not found


How can I ""work-around"" this problem?
",2,36771170.0
442,36822702,Accessing result of a golang yacc generated parser,"I am trying to create a parser using golang's yacc tool. I found nex to simplify creating a lexer to give the parser. My problem now is that the generated parser has no method or field to give me access to the parsing result. I could just store the parse result in a global variable, but that seems wrong.

Currently I've added the following as an initial attempt to the top of my parser.y file:

type ResultParser interface {
  yyParser // Generated parser interface
  Result() s.Expr // s.Expr is an interface for the parsed result
}

func (p *yyParserImpl) Result() s.Expr {
  return p.stack[1].expr
}

func NewResultParser() ResultParser {
  return &yyParserImpl{}
}


Is there a recomended/better way of getting at the result from the parser?
(Since this feels like a bit of an abuse of the generator...)
",2,
443,36861569,Is it possible to export/wrap a complex Go struct to C?,"I own a Go library, gofileseq, for which I would like to try and made a C/C++ binding. 

It is pretty straightforward to be able to export functions that use simple types (ints, strings, ...). It is even easy enough to export data from custom Go types to C by defining a C struct and translating the Go type to it, to be used in the exported functions, since you are allocating C memory to do it. But with the go 1.5 cgo rules I am finding it difficult to figure out how to export functionality from a more complex struct that stores state.

Example of a struct from gofileseq that I would like to export somehow to a C++ binding:

// package fileseq
//

type FrameSet struct {
    frange   string
    rangePtr *ranges.InclusiveRanges
}

func NewFrameSet(frange string) (*FrameSet, error) {
    // bunch of processing to set up internal state
}

func (s *FrameSet) Len() int {
    return s.rangePtr.Len()
}

// package ranges
//

type InclusiveRanges struct {
    blocks []*InclusiveRange
}

type InclusiveRange struct {
    start int
    end   int
    step  int

    cachedEnd   int
    isEndCached bool

    cachedLen   int
    isLenCached bool
}


As you can see, the FrameSet type that I want to expose contains a slice of pointers to an underlying type, each of which stores state. 

Ideally, I would love to be able to store a void* on a C++ class, and make it just a simple proxy for calling back into exported Go functions with the void*. But the cgo rules disallow C storing a Go pointer longer than the function call. And I am failing to see how I could use an approach of defining C++ classes that could be allocated and used to operate with my Go library. 

Is it possible to wrap complex types for exposure to C/C++? 
Is there a pattern that would allow a C++ client to create a Go FrameSet? 

Edit

One idea I can think of would be to let C++ create objects in Go that get stored on the Go side in a static map[int]*FrameSet and then return the int id to C++. Then all the C++ operations make requests into Go with the id. Does that sound like a valid solution? 

Update

For now, I am proceeding with testing a solution that uses global maps and unique ids to store objects. C++ would request a new object to be created and only get back an opaque id. Then they can call all of the methods exported as functions, using that id, including requesting for it to be destroyed when done. 

If there is a better approach than this, I would love to see an answer. Once I get a fully working prototype, I will add my own answer.

Update #2

I've written a blog post about the final solution that I ended up using: http://justinfx.com/2016/05/14/cpp-bindings-for-go/
",1,37064603.0
444,36916504,Parsing XML attributes with GO,"I am pretty new to GO and I am having trouble extracting attribute values from XML documents. The code below produces the following output:

application ID:: """"
application name:: """"

My assumption is that I am missing something when it comes to how to use tagging and I would really appreciate it if someone could point me in the right direction. 

data:=`
    
        
    
     `

type App struct {
    app_id   string  `xml:""app_id,attr""`
    app_name string  `xml:""app_name""`
}

type AppList struct {
    XMLName xml.Name `xml:""applist""`
    Apps  []App      `xml:""app""`
}

var portfolio AppList
err := xml.Unmarshal([]byte(data), &portfolio)
if err != nil {
    fmt.Printf(""error: %v"", err)
    return
}
fmt.Printf(""application ID:: %q\n"", portfolio.Apps[0].app_id)
fmt.Printf(""application name:: %q\n"", portfolio.Apps[0].app_name)

",1,
445,36931742,Golang - Don't escape in HTML templates,"Trying to render HTML templates for sending via email with embedded attachments with cid:. Problem is, that Go does escaping and I cannot do anything.

tplVars := map[string]interface{}{
    ""Dog"": ""cid:dog.png"",
    ""Cat"": ""cid:cat.png"",
}


My testing template looks more less like this:

Dog: 
Cat: {{.Cat}}


Output is:

Dog: 
Cat: cid:cat.png


If text is outside attribute context, it is evaluated correctly, but when it is an src attribute it always become that error string. I tried also change value from string to template.HTMLAttr but nothing happen. Cid value is always evaluated to that error output #ZgotmplZ.
",1,36932024.0
446,36935089,Golang GORM pq too many connections,"I am using GORM golang on my project, everything is good until I got error that said :

pq: sorry, too many clients already


I just use the default configuration. The error happen after I did a lot of test request on my application. 

And the error is gone after I restart my application. So, I am thinking that the GORM connection is not released after done with the query. I don't check it very deep enough on GORM code, I just ask here maybe someone has already experience about it?
",1,36939646.0
447,36972513,How to design a database service class,"I want to create a class that takes a sql connection, and then I can write methods to return data from my database.

func main() {
  db := dbConnect()
  defer db.Close()

  // pass the db to my dbservice.go somehow?
}


Then in my handlers (for a web app) I want to be able to do:

var userKey, err := dbService.getUserKey(123)


Do I just create a file like dbservice.go  and then create structs that represent my return values, and then do:

func (mystruct *MyStruct) GetUserKey(id int64) (key string, err error) {
   //
}


Also, how do I pass the db to this in my main so it can use the database connection?
",1,
448,37083167,Setting GOPATH on Ubuntu - still getting error,"I have set following path on my ~/.bashrc file

export GOPATH=/usr/lib/go
export PATH=$PATH:$GOROOT/bin:$GOPATH/bin


But when i installed ATOM IDE and i tried to install go-plus package, it tired to download something at the end and i got the error that 

package github.com/nsf/gocode: cannot download, $GOPATH not set. For more details see: go help gopath


What I am doing wrong ? Here is my ubunt information as well. 

Distributor ID: Ubuntu
Description:    Ubuntu 15.10
Release:    15.10
Codename:   wily


P.S

I have already tried setting my 

export GOPATH=/home/<username/go
export PATH=$PATH:$GOPATH/bin

",2,37083273.0
449,37096166,why is host missing from my http request header fields?,"I'm printing out all the headers and I get:

map[Cookie:[_ga=GA1.2.843429125.1462575405] User-Agent:[Mozilla/5.0
(Macintosh; Intel Mac OS X 10_11_3) AppleWebKit/601.4.4 (KHTML, like Gecko)
Version/9.0.3 Safari/601.4.4] Accept-Language:[en-us] 
Accept-Encoding:[gzip, deflate] Connection:[keep-alive] 
Accept:[text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8]]


which means my browser is sending ""Cookie"", ""User-Agent"", ""Accept-Language"", ""Accept-Encoding"", ""Connection"", and ""Accept"" but there is no ""Host"" value.

How can I get my https://en.wikipedia.org/wiki/Virtual_hosting working without this value?

I'm using https://github.com/gin-gonic/gin
",1,37096297.0
450,37114313,Passing array of structs to a function in Go,"I have an object parsed from some XML file. It has struct type like this

type Report struct {
    Items []Item `xml:......`
    AnotherItems []AnotherItem `xml:......`
}
type Item struct {
    Name string
}
type AnotherItem struct {
    Name string
}
func (Item *Item) Foo() bool {
    //some code here
}
func (AnotherItem *AnotherItem) Foo() bool {
    //another code here
}


For each item i have to do smth like this:

func main(){
    //some funcs called to get the report object
    doSmth(report.Items)
    doSmth(report.AnotherItems)
}
func doSmth(items ????){
    for _, item : range items {
        item.Foo()
    }
}


Since i have different items with same function i want to have only one doSmth so i can't do just doSmth(items []Item)
And the question is - what should i write instead of ""????"" to get this working?
The only way i made it to pass report.Items into doSmth() was 

func doSmth(items interface{})


But it throws me an error ""cannot range over items (type interface {})""
And if instead of iteration i just put smth like 

func doSmth(items interface{}){
    fmt.Println(items)
}


program print the list of my items
",3,37114445.0
451,37135933,Samples on kubernetes golang client,"I`m trying to create replication controllers, services etc from the golang client. (""github.com/kubernetes/kubernetes/pkg/client/unversioned"") However I cannot find any documentation on how to do so.

I found this: 

r, err := c.ReplicationControllers(api.NamespaceDefault).Create(rep)

But I don`t know where to put the yml data etc. Anyone who found documentation or has some sample code that I could get started with ?
",1,37141582.0
452,37210109,How to avoid deadlock in this golang program?,"Here is my program which is producing deadlock, how do I avoid it and what is the recommended pattern to handle this kind of situation.

The problem is after timeout how do I detect that there is no reader on my channel ? 

var wg sync.WaitGroup

func main() {   
    wg.Add(1)
    c := make(chan int)
    go readFromChannel(c, time.After(time.Duration(2)*time.Second))
    time.Sleep(time.Duration(5) * time.Second)
    c <- 10
    wg.Wait()
}

func readFromChannel(c chan int, ti <-chan time.Time) {
    select {
    case x := <-c:
        fmt.Println(""Read"", x)
    case <-ti:
        fmt.Println(""TIMED OUT"")
    }
    wg.Done()
}

",4,
453,37253717,Golang Passing Function Arguments with Arbitrary Interfaces,"The following code works nicely:

package main

import (
    ""fmt""
)

func WrapperFunc(fn func(int,int) int) int{
    return fn(3,4)
}

func add(a,b int) int{
    return a + b
}

func main(){
    fmt.Println(WrapperFunc(add))
}


I want to pass additional parameters that implements a specific interface.  For instance, I modify the code as follows:

import (
    ""fmt""
)

type RequestBody interface {
    GetDescription() string
}

type LoginRequest struct {
    Username string
    Password string
}

func (lr LoginRequest) GetDescription() string{
    return ""cool function""
}

func WrapperFunc(fn func(int, int, RequestBody) int) int {
    lr := LoginRequest{}
    return fn(3, 4, lr)
}

func add(a, b int, lr LoginRequest) int {
    fmt.Println(lr.GetDescription())
    return a + b
}

func main() {
    fmt.Println(WrapperFunc(add))
}


It fails with the error below:

cannot use add (type func(int, int, LoginRequest) int) as type func(int, int, RequestBody) int in argument to WrapperFunc


However, when I do not implement the GetDescription as below:

package main

import (
    ""fmt""
)

type RequestBody interface {
    GetDescription() string
}

type LoginRequest struct {
    Username string
    Password string
}

func WrapperFunc(fn func(int, int, RequestBody) int) int {
    lr := LoginRequest{}
    return fn(3, 4, lr)
}

func add(a, b int, lr LoginRequest) int {
    return a + b
}

func main() {
    fmt.Println(WrapperFunc(add))
}


It fails with second error, as interface is not implemented (as expected). 

cannot use lr (type LoginRequest) as type RequestBody in argument to fn:
    LoginRequest does not implement RequestBody (missing GetDescription method)
 cannot use add (type func(int, int, LoginRequest) int) as type func(int, int, RequestBody) int in argument to WrapperFunc


So, it understands that, in WrapperFunc body, I can only call fn with int, int and an RequestBody interface that implements the GetDescription, yet I still cannot pass it in the function phase. How can I accomplish this? I want to wrap functions that can have parameters that their type can change.
",1,
454,37268031,unknown http.Transport field 'ExpectContinueTimeout' in struct literal in GO,"In my GO project I am getting an error in transport.go file as,


  mygo/testkit/pkg/http
  
  mygo/testkit/pkg/http pkg\http\transport.go:93: unknown http.Transport field 'ExpectContinueTimeout' in struct literal


Here is my newDefaultTransport() function, which gives the error in transport.go.

func newDefaultTransport() *http.Transport {
    return &http.Transport{

        DisableCompression: disableCompression,    
        DisableKeepAlives:   defaultDisableKeepAlives,
        MaxIdleConnsPerHost: defaultMaxIdleConnsPerHost,
        ResponseHeaderTimeout: defaultResponseHeaderTimeout,

        ExpectContinueTimeout: defaultExpectContinueTimeout,

        TLSHandshakeTimeout: defaultTLSHandshakeTimeout,
        TLSClientConfig:     newTLSClientConfig(),    
        Proxy: http.ProxyFromEnvironment,
        Dial: func(network, addr string) (net.Conn, error) {
            return NewTimeoutConnDial(network, addr, TCPDialTimeout, TCPKeepAlive, defaultIdleTimeout)
        },
    }
}


And I am getting the error at this line,

ExpectContinueTimeout: defaultExpectContinueTimeout,


What will be the reason for this error? How to solve this? I am new to this GO framework.
",1,
455,37280034,Assign DB column in Golang Struct,"I have two tables like Retailers and products in database. Retailer has many Products. 

They following are the structs I have defined in golang.

type Retailers struct {
  Id int 
  Name string
  Products []Product
}

type Product struct {
  Id int 
  Description string
  Url string 
}


The following is the query am using to fetch data from Database.

select r.id, r.name, p.id, p.description, p.url from retailers r JOIN products on r.id = r.retailer_id


Using the above struct and query I wish to form the json as below

{
    ""id"": ""DFT"",
    ""name"": ""Amazon"",
    ""products"":[
        {
            ""id"":""APP0001"",
            ""description"":""Iphone5s"",
            ""url"":""www.Iphone5s.com""
        },
        {
            ""id"":""APP0002"",
            ""description"":""Iphone6s"",
            ""url"":""www.Iphone6s.com""
        }
    ]
}


How can I achieve this using golang?  
",1,37280167.0
456,37368442,Go parsing time string,"I currently have the following date string

May 21 2016, 21:47:08 CEST


So I want to parse it. I tried the following

time, err := time.Parse(""Jan 2 2006, 15:04:05 MST"", date)


But I am getting the following error

parsing time ""May 21 2016, 21:47:08 CEST"" as ""Jan 2 2006, 15:04:05 CEST"": cannot parse "" 21 2016, 21:47:08 CEST"" as "" ""


I think I have checked that all the values are correct on the layout.
",1,37368727.0
457,37404523,Parse MongoDB results Using Go and mgo,"I am trying to parse the results of a MongoDB query from Go. I have document(s) that output from my Database as a result of:

db.getCollection('People').find({})

{
    ""_id"" : ObjectId(""5730fd75113c8b08703b5974""),
    ""firstName"" : ""George"",
    ""lastName"" : ""FakeLastName""
}
{
    ""_id"" : ObjectId(""5730fd75113c8b08703b5975""),
    ""firstName"" : ""John"",
    ""lastName"" : ""Doe""
}
{
    ""_id"" : ObjectId(""5730fd75113c8b08703b5976""),
    ""firstName"" : ""Jane"",
    ""lastName"" : ""Doe""
}


Here is the Go code that I am trying to use:

package main

import (
    ""fmt""
    ""log""
    ""gopkg.in/mgo.v2""
)

type Person struct {
    FirstName string `bson: ""firstName"" json: ""firstName""`
    LastName string `bson: ""lastName json: ""lastName""`
}

func main() {
    session, err := mgo.Dial(""10.0.0.89"")
    if err != nil {
            panic(err)
    }
    defer session.Close()

    // Optional. Switch the session to a monotonic behavior.
    session.SetMode(mgo.Monotonic, true)

    c := session.DB(""PeopleDatabase"").C(""People"")

    var people []Person
    err = c.Find(nil).All(&people)
    if err != nil {
            log.Fatal(err)
    }

    for _, res := range people{
        fmt.Printf(""Name: %v\n"", res)
    }
}


When I run this code I get the following Output:

Name: { }
Name: { }
Name: { }


When using res.FirstName in place of res I just get a space in lieu of the {}.

I have been over the documentation in the following locations:

https://labix.org/mgo

https://godoc.org/gopkg.in/mgo.v2#Collection.Find

https://gist.github.com/border/3489566

I would be extemely grateful for any help that can be given. Thank You.
",1,37405003.0
458,37406075,List the struct fields and methods dynamically,"How to list the fields and methods of a struct, in GoLang dynamically? For eg, I want to get the output as id, name, age, and all the method names.

type Student struct {
    id int
    name string
    age int
}

func (s *Student) setId(i int) {
    s.id = i
}

func (s *Student) getId() int {
    return s.id
}

func (s *Student) setName(n string) {
    s.name = n
}

func (s *Student) getName() string {
    return s.name
}

func (s *Student) setAge(a int) {
    s.age = a
}

func (s *Student) getAge() int {
    return s.age
}

func main() {
    st := Student{1,""Jack"",22}
    fmt.Println(st.getId(),"" "",st.getName(),"" "",st.getAge())

}

",1,
459,37458556,Golang - Unmarshal/rebuild an object in 2 step passing by interface,"I'm working with json and golang. I've made a TCP server and, I need to Unmarshal the message to know which type of service is asked, before  Unmarshal the contained data. It's a bit hard to explain so this is my code:

package main

import (
    ""fmt""
    ""encoding/json""
)

type Container struct {
    Type string
    Object interface{}
}

type Selling struct {
    Surname string
    Firstname string
    //......
    Price int
}

type Buying struct {
    ID int
    Surname string
    Firstname string
    //..........
}

/*
type Editing struct {
    ID int
    ...............
}
Informations, etc etc
*/

func main() {

    tmp_message_json1 := Selling{Surname: ""X"", Firstname: ""Mister"", Price: 10}
    //tmp_message_json1 := Buying{ID: 1, Surname: ""X"", Firstname: ""Mister""}
    tmp_container_json1 := Container{Type: ""Selling"", Object: tmp_message_json1}
    json_tmp, _ := json.Marshal(tmp_container_json1)

/*...........
We init tcp etc etc and then a message comes up !
...........*/

    c := Container{}
    json.Unmarshal(json_tmp, &c)
    //I unmarshal a first time to know the type of service asked

    //  first question: Does Unmarshal need to be used only one time?
    // does I need to pass c.Object as a string to unmarshal it in the called functions?
    if c.Type == ""Buying"" {
        takeInterfaceBuying(c.Object)
    } else if c.Type == ""client"" {
        takeInterfaceSelling(c.Object)
    } else {
        fmt.Println(""bad entry"")
    }
}

func takeInterfaceBuying(Object interface{}) {

    bu := Object

    fmt.Println(bu.Firstname, bu.Surname, ""wants to buy the following product:"", bu.ID)
}

func takeInterfaceSelling(Object interface{}) {

    se := Object

    fmt.Println(se.Firstname, se.Surname, ""wants to sell something for:"", se.Price)
}


I need to handle messages which comes up like it, but I don't know if it's possible? does it possible?

Thank for help !
",2,37459588.0
460,37478857,Firebase Cloud Messaging authorization failure,"I'm currently trying to implement a server in Go working with Firebase Cloud Messaging. I inserted my API key and sender ID (which I both got from the Firebase console at Project Settings -> Cloud Messaging) and did this:

err := gcm.Listen(senderID, apiKey, onMessageReceived, nil)


and all I get is this


  error creating xmpp client>error connecting client>auth failure: not-authorized


I'm using the same library Google's using in it's examples. Is the library maybe not working with FCM yet or am I doing something wrong?

If it's the library, how would I implement this without it?
",1,
461,37484049,Which of the following are valid keywords in Go for controlling a loop?,"I saw this question that for correct answer had 'for and range'.

But the for statement is the only available looping statement in Go,and the range keyword allows you to iterate over items of a list like an array or a map. For understanding it, you could translate the range keyword to for each index of.

//for loop
package main

import ""fmt""

func main() {
for i := 0; i < 5; i++ {
    fmt.Println(""Value of i is now:"", i)
    }
}

 //range is used inside a for loop


a := [...]string{""a"", ""b"", ""c"", ""d""}
for i := range a {
    fmt.Println(""Array item"", i, ""is"", a[i])
}
capitals := map[string] string {""France"":""Paris"", ""Italy"":""Rome"",     ""Japan"":""Tokyo"" }
for key := range capitals {
    fmt.Println(""Map item: Capital of"", key, ""is"", capitals[key])
    }

//range can also return two items, the index/key and the corresponding value 
for key2, val := range capitals {
    fmt.Println(""Map item: Capital of"", key2, ""is"", val)
    }

",1,37503340.0
462,37557763,golang - get interface implementation instance from struct after dereferencing,"Create a struct that implements an interface.
Encapsulate it into another struct.
Fetch the struct / dereference it.


Fetching gets pointer to the implementation of the interface.
Dereferencing the pointer results in another point to the interface.


Why wouldn't dereferencing the pointer to the implementation gives the implementation instance?

package main

import (
    ""fmt""
    ""net/http""

    ""golang.org/x/net/http2""
)

func main() {
    transport := &http2.Transport{}
    client := &http.Client{Transport: transport}

    tmp1 := client.Transport
    tmp2 := &client.Transport
    tmp3 := &tmp1

    fmt.Printf(""%T\n%T\n%T\n"", tmp1, tmp2, tmp3)

    //dialTLS := tmp1.DialTLS
}


This code outputs...

*http2.Transport
*http.RoundTripper
*http.RoundTripper


As well, trying to access a property of the tmp1 (uncommenting dialTLS := tmp1.DialTLS) results in compile error...

tmp1.DialTLS undefined (type http.RoundTripper has no field or method DialTLS)


...even though fmt.Printf(""%+v"", tmp1) outputs...

&{DialTLS: TLSClientConfig:0xc8203ec8c0 ConnPool: DisableCompression:false MaxHeaderListSize:0 t1: connPoolOnce:{m:{state:0 sema:0} done:0} connPoolOrDef:}


What I am attempting to do is access DialTLS in the Transport instance.
",1,37557884.0
463,37595002,HTTP timed request Golang,"I'm new to Go and  trying to generate multiple requests to several http/ https servers to check the response time and the status of each web server. 

I stored the URLs in a text file, afterwards I decided to add a ticker to my code which will keep generating these requests on each URL after a certain amount of time (the amount of time is in seconds typed next to each URL and spaced with a tab). 

When I started scanning the time from the file everything got complicated and I can't manage to find my mistake. Here is my Go code:

package main

import (
    ""fmt""
    ""io/ioutil""
    ""log""
    ""net/http""
    ""strconv""
    ""strings""
    ""sync""
    ""time""
)

func get_resp_time(url string) { //Get time for each URL

    time_start := time.Now()
    fmt.Println(""Start time"", time_start, "" URL "", url)
    resp, err := http.Get(url)
    //fmt.Printf(""resp : %#v \n"", resp)

    if err != nil {
        log.Printf(""Error fetching: %v"", err)
    }
    defer resp.Body.Close()
    fmt.Println(time.Since(time_start), url, "" Status: "", resp.Status)
}

func main() {
    content, _ := ioutil.ReadFile(""url_list.txt"")
    lines := strings.Split(string(content), ""\t"")
    //fields := strings.Split(string(content), ""\t"")
    //fmt.Println(lines[1])
    //fmt.Println(strconv.Atoi(lines[0]))

    const workers = 25
    var nb int

    wg := new(sync.WaitGroup)
    in := make(chan string, 2*workers)

    if _, err := strconv.Atoi(lines[1]); err == nil {
        nb, err = strconv.Atoi(lines[1])
    }

    ticker := time.NewTicker(time.Second * time.Duration(nb))

    for t := range ticker.C {
        fmt.Println(""Time of origin: "", time.Now())
        for i := 0; i < len(lines)-1; i++ {
            wg.Add(1)
            go func() {
                defer wg.Done()
                //for j := 0; j < len(in); j++ {
                if _, err := strconv.Atoi(lines[i]); err == nil {
                    nb, err = strconv.Atoi(lines[i])
                    //get_resp_time(url)
                } else {
                    get_resp_time(lines[i])
                }

                //}
            }()
        }
        for _, url := range lines {
            if url != """" {
                in <- url
            }
        }
        fmt.Println(""Tick at "", t)
    }
    close(in)
    wg.Wait()
}


And the text file:

http://google.com   5   
http://nike.com     10  


This is the error I got:

panic: runtime error: invalid memory address or nil pointer dereference
[signal 0xb code=0x1 addr=0x0 pc=0x2752]

goroutine 9 [running]:
panic(0x313180, 0xc82000a0d0)
    /usr/local/go/src/runtime/panic.go:464 +0x3e6
main.get_resp_time(0xc82006e195, 0x14)
    /Users/Elliott/Desktop/GoTutorial/url-time-response.go:26 +0x712
main.main.func1(0xc820070dc0, 0xc82006e1e0, 0xc8200a0090, 0x9, 0x9, 0xc820070da8)
    /Users/Elliott/Desktop/GoTutorial/url-time-response.go:61 +0x13f
created by main.main
    /Users/Elliott/Desktop/GoTutorial/url-time-response.go:65 +0x4a6
exit status 2


EDIT: Alright, I just changed the file to having only one duration because apparently it's pretty complicated to have multiple duration(according to my project advisor). Thanks for the help!
",1,37596328.0
464,37613823,Html file with script tag only,"I am developing a website crawler using golang. When i tried to crawl some websites, I am getting weird results. Root Url of some website returns script tag as shown below.

window.location=""index.php"";


And it redirects to index.php page. Why people are using this approach to redirect user to index page. Any security vulnerability with this approach? And also, how can i handle this situation in crawler?
",1,
465,37658719,Print function that consumes json.RawMessage directly,"I'm doing some work with Elasticsearch and the query return a Source object which it's type is *json.RawMessage.

I only want to print it to screen without creating struct model for it and doing the obvious json.Marshal.

Is there a print function that will consume *json.RawMessage type and print it to screen?

Code sample: 

 for _, hit := range serachResult.Hits.Hits {
    fmt.Println(hit.Source, ""\n"")
 }


This code run will result in un-readable array of bytes, apparently without the ability to just build a string from the raw message.
",1,37658851.0
466,37734556,How to convert []byte data to uint16 in go?,"I have the following hex data: 0xB01B; its 45083 as uint16; how do I convert this to uint16 in go?
",1,37734617.0
467,37739896,Golang interfaces & casting,"I have the following code:

   func returnTheMap() map[string][]string{
        myThing := getSomeValue()
    }


getSomeValue() returns something of type map[string]interface{}

but it is always internally a map[string][]string.

What is the best way to set myThing equal to the same thing as getSomeValue(), but of type map[string][]string?

I can make a new object like so:

newMap := make(map[string][]string)

// cardTypeList is of type map[string]interface {}, must convert to map[string][]string
for k, v := range myThing {
    newMap[k] = v.([]string)
}


but is there any way to do this in-place, or is there any preferred way to do this?
",2,
468,37759462,How to serve a created directory to a user?,"How do I serve up a directory that is created server side to a user for them to download it? The directory doesn't just contain files, but sub directories as well. 
",1,
469,37759697,Go: How do I turn response body into request body?,"I have a handler that makes a request to elasticsearch.
I cat get the json response from that request:

resp, err := http.Get(getUrl)
defer resp.Body.Close()
bodyString := """"
if resp.StatusCode == 200{
    bodyBytes, err := ioutil.ReadAll(resp.Body) 
    checkForError(err)
       bodyString = string(bodyBytes)

       fmt.Fprintf(w, bodyString)
}


How do I turn that bodyString into something I can pass to an http.Post of this sort:

http.Post(""https://httpbin.org/post"", ""application/json; charset=utf-8"", jsonData)

",1,37759782.0
470,37831477,Is it possible to deallocate memory manually in go?,"After discussion with college, I wonder if it would be possible (even if completely does not make any sense) to deallocate memory manually in go (ie. by using unsafe package). Is it?
",1,37832151.0
471,37885698,GoLang net/smtp sendMail to recipient with plus signs,"I am writing a registration form using GoLang 1.5. I have it all working, but I've noticed if I attempt to sign up using an e-mail with a plus sign in it (someemail+theirlabel@theirdomain.com) I receive the following error:

Transaction failed: Illegal semicolon, not in group

Googling for this hasn't yielded much results, and it seems like Go should handle the plus sign just fine.

import (
  ""net/smtp""
  ""net/mail""
)

func sendEmail(t *Email) bool {
    to := []string{""johndoe+test@gmail.com""}
    err = smtp.SendMail(smtp_url, auth, from_email, to, buff.Bytes())
    if err != nil {
        log.Fatal(err)
        // outputs: Transaction failed: Illegal semicolon, not in group
    }
}


I appreciate any advice I get on this.

Thanks!
",1,37903293.0
472,37899240,EOF error causing termination when handled in using http.Client.Get method and Body.Read() method in golang,"I am using an http client to get a json body, and read it to a byte array like

client := new(http.Client)
client.Timeout = time.Second * 10
GetJobJson, err := client.Get(joblocation.String()) //where joblocation is of type *url.Url
if err != nil {
    errorlog.Err.Println(""Error getting job from"", joblocation.String(), err)
    return false, http.StatusBadRequest, nil
}
buff := make([]byte, GetJobJson.ContentLength)
length, err := GetJobJson.Body.Read(buff) //This returns an EOF error
if err != nil {
    errorlog.Err.Println(""Error reading request body of length"", length, ""vs contentlength"", GetJobJson.ContentLength, err)
    return false, http.StatusBadRequest, nil
}


In the above code, GetJobJson.Body is of type io.ReadCloser, which implements Reader, having Read method, which I am using here as 

length, err := GetJobJson.Body.Read(buff) 


But since I am handling error here, it is returning an error which says EOF. 

The http endpoint to where I am sending the request is running an apache server, mentioning it here since I am not sure if it matters.

If I am not handling the error, I get the complete json body, which is there in the remote server, and the program continues to work as expected. 

What is the best way to handle this? Is the Read method that I use, is bad for this situation? Please advise.

Thank you.
",1,37900615.0
473,37922775,Do multiple goroutine will invoke a method on a Conn simultaneously?,"My program like this:

func handle(conn net.Conn) {
    msg := ""hello, world!""
    for i:= 0; i< 100000; i++ {
        go func() {
            err := write(conn, msg)
        }
    }

}
func write(conn net.Conn, msg string) error {
    mlen := fmt.Sprintf(""%04d"", len(msg))

    _, err := conn.Write([]byte(mlen + msg))
    return err
}


The program will run 100000 goroutines at same time, and all goroutines will send message to the same connection。
I am doubt that server will receive error message like ""hellohelloworldworld"", but there is no problem when the program run in my Ubuntu 14.04LTS.

So, Do multiple goroutine will invoke a method on a Conn simultaneously?

=========================================================================

How can I keep the Write method atomic?
",1,
474,38000646,Concurrently read map entries into a channel,"I have a scenario where I need to range over (as many as possible) map entries and send them into a channel. The operation at the other end of the channel can take a long amount of time and the map is accessed concurrently (and protected by an RWMutex). The map is also rather big and I want to avoid creating a temporary copy of it.

Assume I have a struct like this:

type Example struct {
    sync.RWMutex
    m map[string]struct{}
}


Now I came up with something like this:

func (e *Example) StreamAll() <-chan string {
    toReturn := make(chan string)
    go func() {
        e.RLock()
        defer e.RUnlock()
        for k := range e.m {
            e.RUnlock()
            toReturn <- k
            e.RLock()
        }
        close(toReturn)
    }()
    return toReturn
}


The language specification has this interesting bit about ranging over maps:


  If map entries that have not yet been reached are removed during iteration, the corresponding iteration values will not be produced. If map entries are created during iteration, that entry may be produced during the iteration or may be skipped.


Now, what I'd like to know is this: Is there a guarantee that my method of ranging over the map works even if the map is changed between iterations? Including the case where the key I last read is deleted? I don't need all of the map entries, but most of them.

Here is a complete example:

package main

import (
    ""fmt""
    ""sync""
)

type Example struct {
    sync.RWMutex
    m map[string]struct{}
}

func NewExample() *Example {
    return &Example{
        m: make(map[string]struct{}),
    }
}

func (e *Example) Put(s string) {
    e.Lock()
    defer e.Unlock()
    e.m[s] = struct{}{}
}

func (e *Example) Delete(s string) {
    e.Lock()
    defer e.Unlock()
    delete(e.m, s)
}

func (e *Example) StreamAll() <-chan string {
    toReturn := make(chan string)
    go func() {
        e.RLock()
        defer e.RUnlock()
        for k := range e.m {
            e.RUnlock()
            toReturn <- k
            e.RLock()
        }
        close(toReturn)
    }()
    return toReturn
}

func main() {
    e := NewExample()
    e.Put(""a"")
    e.Put(""b"")

    values := e.StreamAll()
    // Assume other goroutines concurrently call Put and Delete on e
    for k := range values {
        fmt.Println(k)
    }
}

",1,
475,38001650,Give data from MySQL to golang template,"i give a dataset from mysql-database to go-template. the result have multiple rows but all values is one string!?

type Tasks struct {
    tid          int
    pid          int
    uid          int
    del          int
    finisch      int
    open         int
    inprocess    int
    abnahme      int
    fertig       int
    finischdatum string
    erstellt     string
    start        string
    ende         string

    name         string
    beschreibung string
}

type Daten struct {
    Tabledata        []*Tasks
}

d := Daten{}
rows, err := db.Query(""SELECT * FROM tasks WHERE pid=? AND del=0"", pid)
        checkError(err)

        defer rows.Close()

        rs := make([]*Tasks, 0)
        for rows.Next() {
            rst := new(Tasks)
            err := rows.Scan(&rst.tid, &rst.pid, &rst.uid, &rst.del, &rst.finisch, &rst.open, &rst.inprocess, &rst.abnahme, &rst.fertig, &rst.finischdatum, &rst.erstellt, &rst.start, &rst.ende, &rst.name, &rst.beschreibung)
            if err != nil {
                log.Println(err)
            }

            rs = append(rs, rst)
        }

        d.Tabledata = rs


template:

 {{ range $key, $values := .Tabledata }}
                    {{ $key }}: 

                    {{range $values}}


                        {{.}}



                    {{end}}


                 {{ end }}


When I look in the first range and give me the $values as one string and the second range is death. 

What's my Problem?
",1,
476,38079036,Golang. Refactoring || Pattern || any solution,"Problem: There is a list of tables associated keys. It is necessary to implement CRUD for each table + some functional on the specifics of the table (pagination, etc.).
Troubles: duplicated in each of the functional implementation for each table About 50% of the code.
Question: What are the ways on the specifics of the language, of the optimization / refactoring / use similar code patterns?

Example code part


//------------------------------------------------------------------
//  user
//----------------------------------------------------------------------
func (d *Database) UserCreate(email, password, username string, role int) *Answer {
    //variables
    answer := d.initCall(""UserCreate"")
    user := new(User)
    //check exist user
    if userExist := d.DB.Find(&User{}, &User{Email:email}).Error; userExist == nil {
        answer.AnswerJSON.ErrorAnswer.Message = ""[usercreate] user already exist""
        answer.AnswerJSON.Result = nil
        answer.AnswerJSON.Status = false
    } else {

        userinfo := UserInfo{Data:time.Now()}
        session := Session{Data:time.Now()}
        cook := Cook{}

        //make support  tables object
        //userinfo object
        userinfo.Password = password
        userinfo.Username = username
        //cook object
        cook.SessionID = session.ID
        cook.Cookie = d.cookgeneratenew(""somesaltforcooksgenerate"")
        cook.Status = true
        cook.Lastconnect = time.Now()
        cook.CountConnect += 1

        //user object
        user.Email = email
        user.Session = session
        user.UserInfo = userinfo
        user.Cook = cook
        user.Role = int64(role)

        //make request + //serizlizations to json answer
        if err := d.DB.Create(user).Error; err != nil {
            answer.AnswerJSON.ErrorAnswer.Message = err.Error()
            answer.AnswerJSON.Status = false
        } else {
            answer.AnswerJSON.Result = user
            answer.AnswerJSON.Status = true
        }
    }
    d.serilize(answer)
    return answer
}
func (d *Database) UserDelete(userid int64) *Answer {
    answer := d.initCall(""UserDelete"")
    user := new(User)
    //check exists
    if userExists := d.DB.Find(user, ""ID = ?"", userid).Error; userExists == nil {
        if userDelete := d.DB.Delete(user).Error; userDelete != nil {
            answer.AnswerJSON.ErrorAnswer.Message = userExists.Error()
            answer.AnswerJSON.Status = false
        } else {
            answer.AnswerJSON.Status = true
            answer.AnswerJSON.ErrorAnswer = nil
        }
    } else {
        answer.AnswerJSON.ErrorAnswer.Message = userExists.Error()
        answer.AnswerJSON.Status = false
    }
    d.serilize(answer)
    return answer
}
func (d *Database) UserRead(userid int64) *Answer {
    answer := d.initCall(""UserRead"")
    user := new(User)
    if userExists := d.DB.Find(user, ""ID = ?"", userid).Error; userExists != nil {
        answer.AnswerJSON.ErrorAnswer.Message = userExists.Error()
        answer.AnswerJSON.Status = false
    } else {
        if rel := d.DB.Model(user).Related(&user.Session).Error; rel != nil {
            answer.AnswerJSON.Result = nil
            answer.AnswerJSON.ErrorAnswer.Message = rel.Error()
            answer.AnswerJSON.Status = false
        } else if rel = d.DB.Model(user).Related(&user.UserInfo).Error; rel != nil {
            answer.AnswerJSON.Result = nil
            answer.AnswerJSON.ErrorAnswer.Message = rel.Error()
            answer.AnswerJSON.Status = false
        } else if rel = d.DB.Model(user).Related(&user.Cook).Error; rel != nil {
            answer.AnswerJSON.Result = nil
            answer.AnswerJSON.ErrorAnswer.Message = rel.Error()
            answer.AnswerJSON.Status = false
        } else {
            answer.AnswerJSON.Result = user
            answer.AnswerJSON.ErrorAnswer = nil
            answer.AnswerJSON.Status = true
        }
    }
    d.serilize(answer)
    return answer
}
func (d *Database) UserReadAll() *Answer {
    answer := d.initCall(""UserReadAll"")
    users := []User{}

    if usersGet := d.DB.Find(&users).Error; usersGet != nil {
        answer.AnswerJSON.ErrorAnswer.Message = usersGet.Error()
        answer.AnswerJSON.Status = false
    } else {
        for _, user := range users {
            d.DB.Model(user).Related(&user.Session)
            d.DB.Model(user).Related(&user.UserInfo)
            d.DB.Model(user).Related(&user.Cook)
        }
        answer.AnswerJSON.Result = users
        answer.AnswerJSON.ErrorAnswer = nil
        answer.AnswerJSON.Status = true
    }
    d.serilize(answer)
    return answer
}
func (d *Database) UserUpdate(userid int64, uu *UserUpdateStruct) *Answer {
    answer := d.initCall(""UserUpdate"")
    user := new(User)

    if userExists := d.DB.Find(user, ""ID = ?"", userid).Error; userExists != nil {
        answer.AnswerJSON.ErrorAnswer.Message = userExists.Error()
        answer.AnswerJSON.Status = false
    } else {
        //get relevating struct info
        d.DB.Model(user).Related(&user.Session)
        d.DB.Model(user).Related(&user.UserInfo)
        d.DB.Model(user).Related(&user.Cook)

        //update columns
        if uu.Email != """" {
            user.Email = uu.Email
        }
        if uu.Avatar > 0 {
            user.UserInfo.Avatar = uu.Avatar
        }
        if uu.Birthday != """" {
            user.UserInfo.Birthday = uu.Birthday
        }
        if uu.Location != """" {
            user.UserInfo.Location = uu.Location
        }
        if uu.Male != """" {
            user.UserInfo.Male = uu.Male
        }
        if uu.Password != """" {
            user.UserInfo.Password = uu.Password
        }
        if uu.Role > 0 {
            if roleErr := d.DB.Find(&Role{}).Error; roleErr != nil {
                //role not found
                fmt.Printf(""[userupdate] role not found `%d`\n"", uu.Role)
            } else {
                user.Role = uu.Role
            }
        }

        //update
        if errUpdate := d.DB.Save(user).Error; errUpdate != nil {
            answer.AnswerJSON.ErrorAnswer.Message = errUpdate.Error()
            answer.AnswerJSON.Status = false
        } else {
            answer.AnswerJSON.Result = user
            answer.AnswerJSON.ErrorAnswer = nil
            answer.AnswerJSON.Status = true
        }
    }
    d.serilize(answer)
    return answer
}
func (d *Database) UserPaginate(page, countPage int) *Answer {
    answer := d.initCall(""UserPaginate"")
    result := []*User{}
    if errPag := d.DB.Limit(countPage).Offset((page * countPage) - countPage).Find(&result).Error; errPag != nil {
        answer.AnswerJSON.ErrorAnswer.Message = errPag.Error()
        answer.AnswerJSON.Status = false
    } else {
        for _, user := range result {
            d.DB.Model(&user).Related(&user.Session)
            d.DB.Model(&user).Related(&user.UserInfo)
            d.DB.Model(&user).Related(&user.Cook)
        }
        answer.AnswerJSON.Result = result
        answer.AnswerJSON.ErrorAnswer = nil
        answer.AnswerJSON.Status = true
    }
    d.serilize(answer)
    return answer
}
//-------------------------------------------------------------------
//  category
//--------------------------------------------------------------------
func (d *Database) CategoryCreate(name string) *Answer {
    //variables
    answer := d.initCall(""CategoryCreate"")
    cat := new(Category)
    //check exist user
    if catExist := d.DB.Find(&Category{}, &Category{Name:name}).Error; catExist == nil {
        answer.AnswerJSON.ErrorAnswer.Message = ""[categorycreate] category already exist""
        answer.AnswerJSON.Result = nil
        answer.AnswerJSON.Status = false
    } else {
        cat.Name = name
        //make request + //serizlizations to json answer
        if err := d.DB.Create(cat).Error; err != nil {
            answer.AnswerJSON.ErrorAnswer.Message = err.Error()
            answer.AnswerJSON.Status = false
        } else {
            answer.AnswerJSON.Result = cat
            answer.AnswerJSON.Status = true
        }
    }
    d.serilize(answer)
    return answer
}
func (d *Database) CategoryDelete(catid int64) *Answer {
    answer := d.initCall(""CategoryDelete"")
    cat := new(Category)
    //check exists
    if catExists := d.DB.Find(cat, ""ID = ?"", catid).Error; catExists == nil {
        if catDelete := d.DB.Delete(cat).Error; catDelete != nil {
            answer.AnswerJSON.ErrorAnswer.Message = catExists.Error()
            answer.AnswerJSON.Status = false
        } else {
            answer.AnswerJSON.Status = true
            answer.AnswerJSON.ErrorAnswer = nil
        }
    } else {
        answer.AnswerJSON.ErrorAnswer.Message = catExists.Error()
        answer.AnswerJSON.Status = false
    }
    d.serilize(answer)
    return answer
}
func (d *Database) CategoryRead(catid int64) *Answer {
    answer := d.initCall(""CategoryRead"")
    cat := new(Category)
    if catExists := d.DB.Find(cat, ""ID = ?"", catid).Error; catExists != nil {
        answer.AnswerJSON.ErrorAnswer.Message = catExists.Error()
        answer.AnswerJSON.Status = false
    } else {
        if rel := d.DB.Model(cat).Related(&cat.Post).Error; rel != nil {
            answer.AnswerJSON.Result = nil
            answer.AnswerJSON.ErrorAnswer.Message = rel.Error()
            answer.AnswerJSON.Status = false
        } else {
            for x, p := range cat.Post {
                d.DB.Model(&p).Related(&p.Comment)
                d.DB.Model(&p).Related(&p.PostSeo)
                cat.Post[x] = p
            }
            answer.AnswerJSON.Result = cat
            answer.AnswerJSON.ErrorAnswer = nil
            answer.AnswerJSON.Status = true
        }
    }
    d.serilize(answer)
    return answer
}
func (d *Database) CategoryReadAll() *Answer {
    answer := d.initCall(""CategoryReadAll"")
    cats := []Category{}

    if catsGet := d.DB.Find(&cats).Error; catsGet != nil {
        answer.AnswerJSON.ErrorAnswer.Message = catsGet.Error()
        answer.AnswerJSON.Status = false
    } else {
        //categorys
        for _, cat := range cats {
            d.DB.Model(cat).Related(&cat.Post)
            //get relete POST
            for x, p := range cat.Post {
                d.DB.Model(&p).Related(&p.Comment)
                d.DB.Model(&p).Related(&p.PostSeo)
                cat.Post[x] = p
            }
        }
        answer.AnswerJSON.Result = cats
        answer.AnswerJSON.ErrorAnswer = nil
        answer.AnswerJSON.Status = true
    }
    d.serilize(answer)
    return answer
}
func (d *Database) CategoryUpdate(catid int64, name string) *Answer {
    answer := d.initCall(""CategoryUpdate"")
    cat := new(Category)

    if catExists := d.DB.Find(cat, ""ID = ?"", catid).Error; catExists != nil {
        answer.AnswerJSON.ErrorAnswer.Message = catExists.Error()
        answer.AnswerJSON.Status = false
    } else {
        //get relevating struct info
        d.DB.Model(cat).Related(&cat.Post)

        //update columns
        if name != """" {
            cat.Name = name
        }
        //update
        if errUpdate := d.DB.Save(cat).Error; errUpdate != nil {
            answer.AnswerJSON.ErrorAnswer.Message = errUpdate.Error()
            answer.AnswerJSON.Status = false
        } else {
            answer.AnswerJSON.Result = cat
            answer.AnswerJSON.ErrorAnswer = nil
            answer.AnswerJSON.Status = true
        }
    }
    d.serilize(answer)
    return answer
}
func (d *Database) CategoryPaginate(page, countPage int) *Answer {
    answer := d.initCall(""CategoryPaginate"")
    result := []*Category{}
    if errPag := d.DB.Limit(countPage).Offset((page * countPage) - countPage).Find(&result).Error; errPag != nil {
        answer.AnswerJSON.ErrorAnswer.Message = errPag.Error()
        answer.AnswerJSON.Status = false
    } else {
        for _, cat := range result {
            d.DB.Model(&cat).Related(&cat.Post)
            //get relete POST
            for x, p := range cat.Post {
                d.DB.Model(&p).Related(&p.Comment)
                d.DB.Model(&p).Related(&p.PostSeo)
                cat.Post[x] = p
            }
        }
        answer.AnswerJSON.Result = result
        answer.AnswerJSON.ErrorAnswer = nil
        answer.AnswerJSON.Status = true
    }
    d.serilize(answer)
    return answer
}

",2,38079468.0
477,38088721,[CodeEval][GO] CodeEval Error: Process was aborted due to timeout,"I was trying to submit my solution of https://www.codeeval.com/open_challenges/158/ it's a bubble sort. I code in GO lang and on my PC it runs fine and fast! I tried utilize code example of go's input and I tried my own piece of code too.

Anyone can help me ? I tried change the code in somehow, but nothing worked.
Thanks in advance.
",1,38163481.0
478,38229584,how to properly capture all stdout/stderr,"I want to capture and save to a file all the stdout and stderr

For testing purposes I am printing only what I capture using this:

package main

import (
    ""bufio""
    ""bytes""
    ""fmt""
    ""io""
    ""os/exec""
)

func main() {
    cmd := exec.Command(""/tmp/stdout"")
    stdout := new(bytes.Buffer)
    stderr := new(bytes.Buffer)

    cmd.Stdout = stdout
    cmd.Stderr = stderr

    if err := cmd.Start(); err != nil {
        panic(err)
    }

    if err := cmd.Wait(); err != nil {
        panic(err)
    }

    in := bufio.NewScanner(io.MultiReader(stdout, stderr))
    for in.Scan() {
        fmt.Println(in.Text())
    }

}


The /tmp/stdout command can be build using this code:

package main

import (
    ""fmt""
    ""os""
    ""time""
)

func main() {

    for i := 1; i < 1000; i++ {
        if i%3 == 0 {
            fmt.Fprintf(os.Stderr, ""STDERR i: %d\n"", i)
        } else {
            fmt.Printf(""STDOUT i: %d\n"", i)
        }
        time.Sleep(1 * time.Second)
    }

}


For some reason I am not been available to capture anything from the  output, If I run the /tmp/stdout command I get this:

$ /tmp/stdout 
STDOUT i: 1
STDOUT i: 2
STDERR i: 3
STDOUT i: 4
STDOUT i: 5
STDERR i: 6
STDOUT i: 7


I was expecting to be available to get the same output while calling it from go with the previous code, the strange thing is that if I change to command to be something like id, whoami uname I do get the result and can printed, therefore wondering what could be wrong.

Any ideas ?

UPDATE

Found that I have to wait the program to finish, as suggested in the comments in order to get the output, but in case I would like to get the output in realtime how could I achieve this, what could be the best way of doing it, either io.Copy an os.Pipe, etc ?
",1,38234237.0
479,38234029,How do I reverse a case of each letter in a string?,"I know about ToUpper and ToLower from strings package but obviously they won't help here. Is there a built-in function or do I have to write one myself?
",1,38234154.0
480,38262155,Store data generated within nested loop in map or slice,"I am coming from PHP background and trying to build small tool that would allow me to filter the list of keywords against the black list both supplied via CSV file. I managed to do that in PHP but it has some speed limitation. So I decided to try my powers with Golang. I have succeeded to open CSV file fmt.Println the contents of both keywords and blacklist, and managed to compare each of the keywords to each of the blacklists keyword. But the problem I face is that I can figure out how to build dynamic associative array something like that.

   function compareKeywords($keyword, $filters) {
        $matches = [];    
        foreach($filters as $filter) {
            $matches[] = strpos($keyword, $filter);
        }    
        $matches = array_filter($matches);    
        if(empty($matches)) {
            return $keyword
        }
    }


This function simply checks keyword against fully or partially matching the blacklisted keywords if it does not match the blacklisted keywords it returns this keyword and then adds it to CSV file. 

I spent decent amount of time trying to create similar function in Golang but I struggle to mimic the associative array from PHP. 

I came up with slightly different function which accepts keywords rather than single keyword as well as filters and uses nested loop. 

func compare(keywords [][]string, filterKeywords [][]string) (keywordMap //no sure what type it should be) {
    matchFilters := make(map[string]string)
    keywordMap :=  make(map[string]string)

    for _, keyword := range keywords {
        for _, filter := range filterKeywords {
            if convStr(keyword) == convStr(filter) {
                // here i want to store matches filters 
            }
        }
    }

    //Check if matchFilters empty and return filtered keywordMap

    return

}


I know my code may look verbose and look a bit lame. But any advice into direction I should move would be very appreciated. 
",2,
481,38321621,Golang: Router config in json file,"I want to put my router config in an extern json config file like so:

{
  ""routes"": [
    {
      ""name"": ""Index"",
      ""method"": ""GET"",
      ""pattern"": ""/"",
      ""handler"": ""Index""
    },
    {
      ""name"": ""CountsIndex"",
      ""method"": ""GET"",
      ""pattern"": ""/counts"",
      ""handler"": ""CountsIndex""
    }
  ]
}


My related struct looks like so:

type Route struct {
    Name        string      `json:""name""`
    Method      string      `json:""method""`
    Pattern     string      `json:""pattern""`
    HandlerFunc http.HandlerFunc    `json:""handler""`
}

type Routes []Route


The Problem is the handlerFunc. When I get the config it will be a string but how to make it a go value? Can I cast it somehow?

Following error occures:


  json: cannot unmarshal string into Go value of type http.HandlerFunc


Thanks
",2,38322054.0
482,38386762,Running code at noon in Golang,"Is it possible to execute code at a noon everyday? The program is handling user input the rest of its run time but needs to run a function at noon to output some text. What is the most effective way to do this?
",1,38387285.0
483,38420069,variable scope in golang,"I am new in Go language and want to learn basic fundamental  here below I paste example. the problem in this example is I cannot access number variable inside for loop. it shows this error  


  "" number declared and not use ""


. Please help me :(

package main
import(
    ""fmt""
)

func main() {    
    samlestNumber()
}

func samlestNumber()  {
    x := []int{
        48,96,86,68,
        57,82,63,70,
        37,34,83,27,
        19,97, 9,17,
    }

    //x = append(x,6,7)
    var number int = x[0]
    for _,element := range x {

        if element < x[0] {
            number = element
        }    
        fmt.Println("" :::: "",element)    
    }
}

",1,
484,38422600,Scanning ports in goroutines,"I am currently in the proces of learning go. To do that, I am making a relatively simple portscanner.

The issue I am facing is that it takes a considerable amount of time to scan these ports. The behaviour i am having is that, if i scan ports (defined as an array of int32 (protobuf doesnt support int16), NOT using goroutines works, but is quite slow when scanning more then 5 ports as you can imagine, since it is not running in parallel.

To achieve parallelism, I came up with the following bits of code (explanation + issue comes after code):

//entry point for port scanning
var results []*portscan.ScanResult
//len(splitPorts) is the given string (see benchmark below) chopped up in an int32 slice
ch := make(chan *portscan.ScanResult, len(splitPorts))

var wg sync.WaitGroup
for _, port := range splitPorts {
    connect(ip, port, req.Timeout, ch, &wg)
}
wg.Wait()

for elem := range ch {
    results = append(results, elem)
}

// go routine
func connect(ip string, port, timeout int32, ch chan *portscan.ScanResult, wg *sync.WaitGroup) {
    wg.Add(1)
    go func() {
        res := &portscan.ScanResult{
            Port:   port,
            IsOpen: false,
        }
        conn, err := net.DialTimeout(""tcp"", fmt.Sprintf(""%s:%d"", ip, port), time.Duration(timeout)*time.Millisecond)

        if err == nil {
            conn.Close()
            res.IsOpen = true
        }
        ch <- res
        wg.Done()
    }()
}


So protobuf prepared me a struct which looks as follows:

type ScanResult struct {
    Port   int32 `protobuf:""varint,1,opt,name=port"" json:""port,omitempty""`
    IsOpen bool  `protobuf:""varint,2,opt,name=isOpen"" json:""isOpen,omitempty""`
}


As seen in the first line of the code snippet, I have defined a slice, to hold all results, the idea is that my application scans ports in parallel and when that is done, send the results to whoever is interested.

However, using this code, the program gets stuck.

I run this benchmark to test its performance:

func BenchmarkPortScan(b *testing.B) {
  request := &portscan.ScanPortsRequest{
      Ip:        ""62.129.139.214"",
      PortRange: ""20,21,22,23"",
      Timeout:   500,
  }

  svc := newService()

  for i := 0; i < b.N; i++ {
      svc.ScanPorts(nil, request)
  }
}


What is the cause for it to get stuck. Does looking at this code give anything away? 

So in short, what I want my end result to be is that each port is scanned in a different go routine, and when they all finished, everything comes together in a resulting slice of ScanResult.

I hope I have been clear and provided enough information for you guys to help me.

Oh, and im especially looking for pointers, and the learning bit, not persee working code samples.
",2,38422879.0
485,38427250,List of available wireless networks with golang (under Linux),"I would like to get a list of the wireless networks available inside a Go program running under Linux OS. It's pretty easy to get this information from a Linux command line with iwlist but I really want to have it done natively in Go. Any ideas of which package should be used? Thank you.
",1,
486,38494274,Is there a good way to not expose certain struct attributes in json payloads?,"I was really hoping the below code would work, but it doesn't so currently I have to manually set values from one struct to another.

https://play.golang.org/p/yfcsaNJm9M

package main

import ""fmt""
import ""encoding/json""

type A struct {
    Name     string `json:""name""`
    Password string `json:""password""`
}

type B struct {
    A
    Password string `json:""-""`
    Locale   string `json:""locale""`
}

func main() {

    a := A{""Jim"", ""some_secret_password""}
    b := B{A: a, Locale: ""en""}

    data, _ := json.Marshal(&b)
    fmt.Printf(""%v"", string(data))
}


Output...I don't want to show the secret field

{""name"":""Jim"",""password"":""some_secret_password"",""locale"":""en""}

",1,38499181.0
487,38543825,Appending one element to nil slice increases capacity by two,"I have a nil slice:    

var s1 []int // len(s1) == 0, cap(s1) == 0


Which I append one element to:

s2 := append(s1, 1) // len(s2) == 1, cap(s2) == 2


Why is appending one element to a nil slice increases the capacity by 2?

Printing the slices using fmt.Printf shows the following:

[] // s1
[1] // s2


I am also confused about why re-slicing s2[0:2] shows a zero which was not in the original slice nor appended to it:

[1,0] // s2[0:2]

",4,38544172.0
488,38555568,Example in database/sql using sql.ErrNoRows crashes and burns,"I have a small Go program which uses a a postgresql db. In it there is a query which can return no rows, and the code I'm using to deal with this isn't working correctly.

    // Get the karma value for nick from the database.
func getKarma(nick string, db *sql.DB) string {
    var karma int
    err := db.QueryRow(""SELECT SUM(delta) FROM karma WHERE nick = $1"", nick).Scan(&karma)
    var karmaStr string
    switch {
    case err == sql.ErrNoRows:
        karmaStr = fmt.Sprintf(""%s has no karma."", nick)
    case err != nil:
        log.Fatal(err)
    default:
       karmaStr = fmt.Sprintf(""Karma for %s is %d."", nick, karma)
    }
    return karmaStr
}


This logic is taken directly from the Go documentation. When there are no rows corresponding to nick, the following error occurs:

2016/07/24 19:37:07 sql: Scan error on column index 0: converting driver.Value type  ("""") to a int: invalid syntax


I must be doing something stupid - clues appreciated.
",2,38558922.0
489,38612279,How to send a rsa.PublicKey over a tcp connection in go?,"I've been trying to make a simple RSA encrypted chat app. The problem I've come across is having to send the rsa Public key over the tcp connection, as net.Conn , to my knowledge only accepts the type []byte. 

Problem code

 conn.Write([]byte(public_key))


This is the code that is producing my complications.This code is under the function handleRequest. I understand that conn.Write can only accept the type []byte, but is there anywhere around this. How can I deliver the public_key to my client? I have included all my server code just in case. Also if you wish to obtain all server/client code comment so and I will create a github link. Thankyou

Just in case-server code

main.go

package main

import (
    ""fmt""
    ""github.com/jonfk/golang-chat/tcp/common""
    ""io""
    ""log""
    ""net""
    ""os""
)

const (
    CONN_HOST = ""0.0.0.0""
    CONN_PORT = ""3333""
    CONN_TYPE = ""tcp""
)

var (
    connections []net.Conn
)

func main() {
    setUP(3072)
    l, err := net.Listen(CONN_TYPE, CONN_HOST+"":""+CONN_PORT)
    if err != nil {
        fmt.Println(""Error listening:"", err.Error())
        os.Exit(1)
    }
    // Close the listener when the application closes.
    defer l.Close()
    fmt.Println(""Listening on "" + CONN_HOST + "":"" + CONN_PORT)
    for {
        // Listen for an incoming connection.
        conn, err := l.Accept()
        if err != nil {
            fmt.Println(""Error accepting: "", err.Error())
            os.Exit(1)
        }
        // Save connection
        connections = append(connections, conn)
        // Handle connections in a new goroutine.
        go handleRequest(conn)
    }
}

// Handles incoming requests.
func handleRequest(conn net.Conn) {
    //I use the common library but this is how it would look like using go's net library.
    conn.Write([]byte(public_key))
    //Using the import common library this is what the command would be 
    //common.WriteMsg(conn,string(public_key))
    for {
        msg, err := common.ReadMsg(conn)
        if err != nil {
            if err == io.EOF {
                // Close the connection when you're done with it.
                removeConn(conn)
                conn.Close()
                return
            }
            log.Println(err)
            return
        }
        broadcast(conn, msg)
    }
}

func removeConn(conn net.Conn) {
    var i int
    for i = range connections {
        if connections[i] == conn {
            break
        }
    }
    connections = append(connections[:i], connections[i+1:]...)
}

func broadcast(conn net.Conn, msg string) {
    for i := range connections {
        if connections[i] != conn {
            err := common.WriteMsg(connections[i], msg)
            if err != nil {
                log.Println(err)
            }
        }
    }
}


encryption.go

package main
import (
    ""crypto/md5""
    ""crypto/rand""
    ""crypto/rsa""
    ""log""
    )
var private_key *rsa.PrivateKey
var public_key *rsa.PublicKey
var encrypted,decrypted []byte
func setUP(size int) bool{
    var err error
    if private_key,err = rsa.GenerateKey(rand.Reader,size); err != nil {
        log.Fatal(err)
        return false
    }
    private_key.Precompute()
    if err= private_key.Validate();err != nil {
        log.Fatal(err)
        return false
    }
    public_key = &private_key.PublicKey
    return true
}
func encrypt(msg string) string {
    var err error
    var label []byte
    md5h := md5.New()
    if encrypted,err = rsa.EncryptOAEP(md5h,rand.Reader,public_key,[]byte(msg),label); err != nil {
        log.Fatal(err)
    }
    return string(encrypted)
}
func decrypt(msg string) string {
    var err error
    var label []byte
    md5h := md5.New()
    if decrypted,err = rsa.DecryptOAEP(md5h,rand.Reader,private_key,[]byte(msg),label); err != nil {
        log.Fatal(err)
    }
    return string(decrypted)
}

",2,38616355.0
490,38645175,Why have arrays in Go?,"I understand the difference between arrays and slices in Go. But what I don't understand is why it is helpful to have arrays at all. Why is it helpful that an array type definition specifies a length and an element type? Why can't every ""array"" that we use be a slice?
",4,38645895.0
491,38669971,How to pass service pointers from one package to another package in Go?,"I separated different http.HandleFunc in different files according to which page they are related to. I use gorilla/sessions to manage client sessions and user authentication and I use go-sql-driver for accessing a MySQL database. 

Project Layout:


   ->                      // This folder containing html, css, and js
   -> 
         -> 
                -> index.go        // Need to access database and session 
         -> 
                -> projbrwsr.go    // Need to access database and session
   -> main.go


Therefore, I have 1 pointer pointing to the go-sql-driver service

db, err := sql.Open(""mysql"", ""user:password@/dbname"")


and 1 pointer pointing to gorilla/sessions service

var store = sessions.NewCookieStore([]byte(""something-very-secret""))


There are 2 methods to pass the two pointers to other packages in my understanding: 


Wrap the two pointers into two packages (sess, db) and make them exported. And, the package that requires the service needed to import the packages (sess, db). And call the exported pointers.


   ->                      // This folder containing html, css, and js
   -> 
         -> 
                -> index.go        // Need to access database and session 
         -> 
                -> projbrwsr.go    // Need to access database and session
   -> 
          -> sess.go               // Storing the database service pointer
          -> db.go                 // Storing the session service pointer
   -> main.go

Initialize the two pointers in main package and pass them to the another package, that contain the page handle functions, as args. Inside the another package, set the args to a local variable so we can call it locally in the another package.

 
    ->                      // This folder containing html, css, and js
    -> 
          -> 
                 -> index.go        // Need to access database and session
                                    // Containing a func newService(db *DB)
          -> 
                 -> projbrwsr.go    // Need to access database and session
                                    // Containing a func newService(sess *CookieStore)
    -> main.go



What is the best way to pass this two pointers to other packages for other handle function to call them?
",1,38672052.0
492,38704769,Golang import grouping by package,"I see that Go has goimports to help with import grouping, but I'm wondering if anyone has created a package to group imports in groupings by some pattern?

Go imports does this a little by enforcing at least two groupings stdlib and everything else; however, my company has a policy of grouping imports in 4 groups

import (
    stdlib

    current_project

    company

    all others 
)


is there a tool that can automatically do this?
",1,38714480.0
493,38705615,go install: add not-source files to built package,"My $GOPATH looks like this:

src/
  mypkg/
    source.go
    config.txt
bin/
  mypkg
pkg/
  somestuff/


When I build my package with go install (that builds and places the executable in bin), I'd like config.txt to be copied in that folder together with the executable. Is there a way to do so?

Sorry if I didn't find a way that may look obvious to you, but I'm new to programming, especially to Go.
",1,
494,38809347,How to set If-Modified-Since header in AWS S3 using Go,"I have a function to download a file from S3. It works but does not recognize the IfModifiedSince option. The below function looks for the same named file locally, and if present sets a time.Time object to the Modification date and time. That is then used in the request to S3 to only download the file if it has been modified since then.

func DownloadS3Media(filename string, mediaDirectory string, bucket string, c *configuration.Configuration) (dest string, bytes int64, err error) {
    os.Setenv(""AWS_ACCESS_KEY_ID"", c.AWS_ACCESS_KEY_ID)
    os.Setenv(""AWS_SECRET_ACCESS_KEY"", c.AWS_SECRET_ACCESS_KEY)

    // Create the directories in the path
    finalFilePath := filepath.Join(mediaDirectory, filename)
    if err1 := os.MkdirAll(filepath.Dir(finalFilePath), 0775); err1 != nil {
        return """", 0, err1
    }

    //Create the blank file to push the data into
    var t *time.Time
    if fi, err2 := os.Stat(finalFilePath); err2 == nil {
        t1 := fi.ModTime()
        t = &t1
    }
    tempFilePath := filepath.Join(mediaDirectory, filename + "".tmp"")
    tempFile, err3 := os.Create(tempFilePath)
    if err3 != nil {
        log.Println(""Failed to create file"", err3)
        return finalFilePath, 0, err3
    }
    defer tempFile.Close()

    logLevel := aws.LogDebug
    downloader := s3manager.NewDownloader(session.New(&aws.Config{Region: aws.String(""us-east-1""), LogLevel:&logLevel}))
    params := &s3.GetObjectInput{Bucket: aws.String(bucket),
        Key:    aws.String(filename),
        IfModifiedSince: t}
    numBytes, err4 := downloader.Download(tempFile, params)
    if err4 != nil {
        log.Println(""Failed to download file"", err4)
        return finalFilePath, 0, err4
    }

    //if downloader pulled down the file, rename the tmp file to original.
    if _, err5 := os.Stat(tempFilePath); err5 == nil {
        os.Rename(tempFilePath, finalFilePath)
        log.Println(""Renamed "", tempFilePath, ""to"", finalFilePath)
    }

    log.Println(""Downloaded file"", filename, ""to"", finalFilePath, numBytes, ""bytes"")
    return finalFilePath, numBytes, nil
}


When debugging, I see the proper value for &t which is ﻿something like sec: 63606119179. By the time AWS sends the request, the header is present but is set to 1/1/0001.

---[ REQUEST POST-SIGN ]-----------------------------
GET http://*****.s3.amazonaws.com/domenic-test.png HTTP/1.1
Host: *****.s3.amazonaws.com
User-Agent: aws-sdk-go/1.3.1 (go1.6.3; darwin; amd64) S3Manager
Authorization: AWS4-HMAC-SHA256 Credential= *****/20160806/us-east-1/s3/aws4_request, SignedHeaders=host;if-modified-since;range;x-amz-content-sha256;x-amz-date, Signature= *****
If-Modified-Since: Mon, 1 Jan 0001 00:00:00 GMT
Range: bytes=0-5242879
X-Amz-Content-Sha256: *****
X-Amz-Date: 20160806T223302Z

",1,
495,38810507,go install fails if I am outside of the .go file directory,"I installed Golang via the suggestion https://golang.org/doc/install and it seems I cannot run the go install command like they do on the website

If I run the command from any directory besides the directory that is home to the .go file, then it gives me this error. for example:

go install ./src/tutorial/helloworld/hello.go


or 

go install ./path/to/.go/file/hello.go

go install: no install location for .go files listed on command line (GOBIN not set)


but if I run the install from inside the directory that has the .go file everything goes well and it places the final executable in the GOPATH bin folder. 

//In the folder that contains my .go file
go install


I have set GOPATH in my .bash_profile and the go installation added the go root directory in /usr/local/go/bin to my PATH

Any ideas why I cannot run install from outside the directory like the instructions on the golang.org website says?
",1,38810688.0
496,38829469,AppEngine Datastore query with filter never returns results (Go),"If I don't use a filter, I get results. If I use a filter (this record definitely exists), I don't get any results. It might be the lack of an index defined for that property, but, as I understand it, simple indices should automatically be created in the development server (and an index.yaml file created and populated with it). This is not happening.

query = datastore.NewQuery(""UserAccount"").Filter(""email ="", ""test@example.com"")

ua := UserAccount{}
t := query.Run(ctx)
for ; ; {
    if _, err = t.Next(&ua); err == nil {
        log.Debugf(ctx, ""Current: %s"", ua)
    } else if err == datastore.Done {
        break
    } else {
        panic(err)
    }
}


When the development server terminates, it states that it's ""saving search indexes"":

INFO     2016-08-08 05:09:52,894 api_server.py:651] Saving search indexes


However, since an ""index.yaml"" file doesn't appear, I'm assuming that no indices needed to be created, which means that my query must not've had the desired effect?

What am I missing?

Edit:

Note that the record was previously created and the application stopped and started many times since. I sincerely doubt this is a eventual-consistency thing.

Edit 2:

For the purpose of testing, I've created the following model with the following code. They both exhibit the same behavior as my original model and code.

Definition:

type TestEntity struct {
    Email string
}


Code:

log.Debugf(ctx, ""Putting."")

email := ""anothertest@a.b""

te := &TestEntity{
        Email: email,
}

k := datastore.NewKey(ctx, ""TestEntity"", ""123"", 0, nil)
_, err = datastore.Put(ctx, k, te)
if err != nil {
    panic(err)
}

log.Debugf(ctx, ""Waiting."")
time.Sleep(1 * time.Second)

query := datastore.NewQuery(""TestEntity"")

var results []TestEntity
_, err = query.GetAll(ctx, &results)
log.Debugf(ctx, ""GetAll: %s"", results)

log.Debugf(ctx, ""Running query."")

query = datastore.NewQuery(""TestEntity"").Filter(""email ="", email)

te = &TestEntity{}
t := query.Run(ctx)
for ; ; {
    if _, err = t.Next(te); err == nil {
        log.Debugf(ctx, ""Found: [%s]"", te.Email)
    } else if err == datastore.Done {
        log.Debugf(ctx, ""Done."")
        break
    } else {
        panic(err)
    }
}


Results:

2016/08/09 02:11:36 DEBUG: Putting.
2016/08/09 02:11:36 DEBUG: Waiting.
2016/08/09 02:11:37 DEBUG: GetAll: [{anothertest@a.b}]
2016/08/09 02:11:37 DEBUG: Running query.
2016/08/09 02:11:37 DEBUG: Done.


Screenshot of Viewer:


",2,38842871.0
497,38839094,Is there no way to redirect from https://www.. to https://.. in Go?,"I saw this post by someone here but there are no answers: Redirecting https://www.domain.com to https://domain.com in Go

I tried to see if I could find a way to check if the request was made with a www url by checking the variables in *http.Request variable but all I got was relative paths and empty strings """".

I tried to fmt.Println() these variables:

func handleFunc(w http.ResponseWriter, r *http.Request) {
    fmt.Println(r.URL.string())
    fmt.Println(r.Host)
    fmt.Println(r.RequestURI)
}


But none of these variables contained the absolute path with the www part. How can I check if a request was made from a www url? I want to figure this out so that I can redirect from www to non-www.

Is this really not even possible in Go? Some people suggested putting nginx in front of Go, but there has to be a way without nginx right? Do I really need to install and use nginx in front of Go just to do a simple redirect from www to non-www? This does not seem like a good solution to a seemingly small problem.

Is there no way to achieve this?
",1,38839236.0
498,38866952,Streaming commands output progress from Goroutine,"Streaming commands output progress question addresses the problem of printing progress of a long running command.

I tried to put the printing code within a goroutine but the scanner claims  to have already hit the EOF immediately and the for block is never executed.

The bufio.scan code that gets executed on the first execution of the Scan() method is:

    // We cannot generate a token with what we are holding.
    // If we've already hit EOF or an I/O error, we are done.
    if s.err != nil {
        // Shut it down.
        s.start = 0
        s.end = 0
        return false
    }


And if I print s.err the output is EOF.

The code I'm trying to run is:

cmd := exec.Command(""some"", ""command"")
c := make(chan int, 1)

go func(cmd *exec.Cmd, c chan int) {
    stdout, _ := cmd.StdoutPipe()

    <-c

    scanner := bufio.NewScanner(stdout)
    for scanner.Scan() {
        m := scanner.Text()
        fmt.Println(m)
    }
}(cmd, c)

cmd.Start()

c <- 1

cmd.Wait()


The idea is to start the Goroutine, get a hold of the cmd.stdout, wait that the cmd is started, and start processing its output.

The result is that the long command gets executed and the program waits for its completion, but nothing is printed to terminal.

Any idea why by the time scanner.Scan() is invoked for the first time the stdout has already reached EOF?
",2,38870609.0
499,38892436,"Query with an array as parameter, how to convert to GoLang mgo?","I have the following query:

db.getCollection('spawnlocations').find({
    'location': {
        '$geoWithin': {
            '$center': [[-73.94075, 40.789138], 5000]
        }
    }, 
    ""expirationtimems"": { ""$gte"": 1234567890 }, 
    ""_id"": { ""$gte"": ""2a920240836c40d8b374203a798a27fa.16"" }
}).sort({""_id"":1}).limit(50)


I am trying to convert the query to mgo using bson.M but I'm having a hard time with the array part of it. 

I thought this would work, but of course it doesn't

    q = bson.M{
        ""location"": bson.M{
            ""$geoWithin"": bson.M{
                ""$center"": [
                    j.Location.Coordinates,
                    5000
                ],
            },
        },
        ""expirationtimems"": bson.M{
            ""$gte"": time.Now().Unix() * 1000,
        },
        ""_id"": bson.M{
            ""$gt"": p,
        },
    }

",1,38898596.0
500,38923237,Goroutines sharing slices : : trying to understand a data race,"I try to make a program in Go to find some genes in very large files of DNA sequences. I already made a Perl program to do that but I would like to take advantage of the goroutines to perform this search in parallel ;)

Because the files are huge, my idea was to read 100 sequences at a time, then send the analysis to a goroutine, and read again 100 sequences etc.

I would like to thank the member of this site for their really helpful explanations concerning slices and goroutines. 

I have made the suggested change, to use a copy of the slice processed by the goroutines. But the -race execution still detect one data race at the level of the copy() function :

Thank you very much for your comments !

    ==================
WARNING: DATA RACE
Read by goroutine 6:
  runtime.slicecopy()
      /usr/lib/go-1.6/src/runtime/slice.go:113 +0x0
  main.main.func1()
      test_chan006.go:71 +0xd8

Previous write by main goroutine:
  main.main()
      test_chan006.go:63 +0x3b7

Goroutine 6 (running) created at:
  main.main()
      test_chan006.go:73 +0x4c9
==================
[>5HSAA098909 BA098909 ...]
Found 1 data race(s)
exit status 66

    line 71 is : copy(bufCopy, buf_Seq)
    line 63 is : buf_Seq = append(buf_Seq, line)
    line 73 is :}(genes, buf_Seq)




    package main

import (
    ""bufio""
    ""fmt""
    ""os""
    ""github.com/mathpl/golang-pkg-pcre/src/pkg/pcre""
    ""sync""
)

// function read a list of genes and return a slice of gene names
func read_genes(filename string) []string {
    var genes []string // slice of genes names
    // Open the file.
    f, _ := os.Open(filename)
    // Create a new Scanner for the file.
    scanner := bufio.NewScanner(f)
    // Loop over all lines in the file and print them.
    for scanner.Scan() {
          line := scanner.Text()
        genes = append(genes, line)
    }
    return genes
}

// function find the sequences with a gene matching gene[] slice
func search_gene2( genes []string, seqs []string) ([]string) {
  var res []string

  for r := 0 ; r <= len(seqs) - 1; r++ {
    for i := 0 ; i <= len(genes) - 1; i++ {

      match := pcre.MustCompile(genes[i], 0).MatcherString(seqs[r], 0)

      if (match.Matches() == true) {
          res = append( res, seqs[r])           // is the gene matches the gene name is append to res
          break
      }
    }
  }

  return res
}
//###########################################

func main() {
    var slice []string
    var buf_Seq []string
    read_buff := 100    // the number of sequences analysed by one goroutine

    var wg sync.WaitGroup
    queue := make(chan []string, 100)

    filename := ""fasta/sequences.tsv""
    f, _ := os.Open(filename)
    scanner := bufio.NewScanner(f)
    n := 0
    genes := read_genes(""lists/genes.csv"")

    for scanner.Scan() {
            line := scanner.Text()
            n += 1
            buf_Seq = append(buf_Seq, line) // store the sequences into buf_Seq
            if n == read_buff {   // when the read buffer contains 100 sequences one goroutine analyses them

          wg.Add(1)

          go func(genes, buf_Seq []string) {
            defer wg.Done()
                        bufCopy := make([]string, len(buf_Seq))
                        copy(bufCopy, buf_Seq)
            queue <- search_gene2( genes, bufCopy)
            }(genes, buf_Seq)
                        buf_Seq = buf_Seq[:0]   // reset buf_Seq
              n = 0 // reset the sequences counter

        }
    }
    go func() {
            wg.Wait()
            close(queue)
        }()

        for t := range queue {
            slice = append(slice, t...)
        }

        fmt.Println(slice)
}

",4,38923640.0
501,38933957,Dependencies for Go app aren't installed through godep on Heroku,"I want to deploy Go application on Heroku, but I got an error like this:

remote: -----> Go app detected
remote: -----> Checking Godeps/Godeps.json file.
remote: -----> Using go1.6.3
remote:  !!    Installing package '.' (default)
remote:  !!    
remote:  !!    
remote: -----> Running: go install -v -tags heroku . 
remote: main.go:9:2: cannot find package ""github.com/go-martini/martini"" in any of:
remote:     /app/tmp/cache/go1.6.3/go/src/github.com/go-martini/martini (from $GOROOT)
remote:     /tmp/build_3c0222e075a91a3363e590a0169d6fb6/.heroku/go/src/github.com/go-martini/martini (from $GOPATH)


It works on my local environment and I added dependencies to Godeps/Godeps.json with godeps save command. What's the problem? I noticed official go-getting-started repo has vendor folder, so does it mean I have to have all dependencies into my repository?

This is my Godeps/Godeps.json:

{
    ""ImportPath"": ""github.com/mikamikuh/oauth2-server-tester"",
    ""GoVersion"": ""go1.6"",
    ""GodepVersion"": ""v74"",
    ""Deps"": [
        {
            ""ImportPath"": ""github.com/codegangsta/inject"",
            ""Comment"": ""v1.0-rc1-10-g33e0aa1"",
            ""Rev"": ""33e0aa1cb7c019ccc3fbe049a8262a6403d30504""
        },
        {
            ""ImportPath"": ""github.com/go-martini/martini"",
            ""Comment"": ""v1.0-185-gc257c41"",
            ""Rev"": ""c257c412d547ac70fcaf5596c1a50a7cb832c1fc""
        }
    ]
}

",1,38940489.0
502,38942171,How to use TLS 1.2 with appengine/urlfetch from a Go AppEngine app,"I'm writing a go appengine app, which needs to fetch a page from Stripe. 

Basically I'm using these instructions that come with the official Stripe API.  However, when I run this with dev_appserver.py, I get:

2016/08/14 12:03:15 Requesting POST api.stripe.com/v1/customers
2016/08/14 12:03:18 Error encountered from Stripe: {""type"":""invalid_request_error"",""message"":""Stripe no longer supports API requests made with TLS 1.0. Please initiate HTTPS connections with TLS 1.2 or later. You can learn more about this at https://stripe.com/blog/upgrading-tls."",""request_id"":""req_90O6reF1Mwi9yZ"",""status"":401}


I found that Python AppEngine apps can specify the SSL library to use in my app.yaml (see SSL support). However, if I add a libraries section to my app.yaml file, I get:

$ (go_appengine/dev_appserver.py app)
Traceback (most recent call last):
  File ""go_appengine/dev_appserver.py"", line 89, in 
    _run_file(__file__, globals())
  File ""go_appengine/dev_appserver.py"", line 85, in _run_file
    execfile(_PATHS.script_file(script_name), globals_)
  File ""/Users/kchodorow/gitroot/tt/go_appengine/google/appengine/tools/devappserver2/devappserver2.py"", line 1040, in 
    main()
  File ""/Users/kchodorow/gitroot/tt/go_appengine/google/appengine/tools/devappserver2/devappserver2.py"", line 1033, in main
    dev_server.start(options)
  File ""/Users/kchodorow/gitroot/tt/go_appengine/google/appengine/tools/devappserver2/devappserver2.py"", line 758, in start
    options.config_paths, options.app_id)
  File ""/Users/kchodorow/gitroot/tt/go_appengine/google/appengine/tools/devappserver2/application_configuration.py"", line 831, in __init__
    module_configuration = ModuleConfiguration(config_path, app_id)
  File ""/Users/kchodorow/gitroot/tt/go_appengine/google/appengine/tools/devappserver2/application_configuration.py"", line 127, in __init__
    self._config_path)
  File ""/Users/kchodorow/gitroot/tt/go_appengine/google/appengine/tools/devappserver2/application_configuration.py"", line 424, in _parse_configuration
    config, files = appinfo_includes.ParseAndReturnIncludePaths(f)
  File ""/Users/kchodorow/gitroot/tt/go_appengine/google/appengine/api/appinfo_includes.py"", line 82, in ParseAndReturnIncludePaths
    appyaml = appinfo.LoadSingleAppInfo(appinfo_file)
  File ""/Users/kchodorow/gitroot/tt/go_appengine/google/appengine/api/appinfo.py"", line 2191, in LoadSingleAppInfo
    listener.Parse(app_info)
  File ""/Users/kchodorow/gitroot/tt/go_appengine/google/appengine/api/yaml_listener.py"", line 227, in Parse
    self._HandleEvents(self._GenerateEventParameters(stream, loader_class))
  File ""/Users/kchodorow/gitroot/tt/go_appengine/google/appengine/api/yaml_listener.py"", line 178, in _HandleEvents
    raise yaml_errors.EventError(e, event_object)
google.appengine.api.yaml_errors.EventError: libraries entries are only supported by the ""python27"" runtime
  in ""app/app.yaml"", line 25, column 1


Which makes sense, because I'm not using Python.  I really need a way to set this for Go.  

My app.yaml file looks like:

application: app-name
version: alpha-001
runtime: go
api_version: go1

handlers:
...


Changing runtime to python27 gets rid of the library error, but obviously then my go code doesn't work.

Any ideas how to get TLS 1.2 enabled, both with the dev appserver and production?
",3,39059763.0
503,38957169,Go: best practice for safely converting integers to protocol buffer enum values,"I have an enum in a proto file that generates to integer constants in the pb.go file. I now have some integers coming from the an external data source and want to safely map them to the possible constants.

Here is what I currently have: https://play.golang.org/p/-5VZqPbukd

package main

import (
    ""errors""
    ""fmt""
)

//enum in the proto file
//
// enum X {
//    A = 0;
//    B = 1;
//    C = 2;
//    D = 3;
// }

//enum type generated by protoc
type X int32

//enum constants generated by protoc
const (
    X_A X = 0
    X_B X = 1
    X_C X = 2
    X_D X = 3
)

func intToX(v int) (X, error) {
    x := X(v)
    switch x {
    case X_A, X_B, X_C, X_D:
        return x, nil
    }
    return 0, errors.New(""could not convert int to X"")
}

func main() {
    for i := -1; i < 10; i++ {
        if x, err := intToX(i); err != nil {
            fmt.Println(""unhandled error:"", err, ""for input value"", i)
        } else {
            fmt.Printf(""%d => X(%d)\n"", i, x)
        }
    }
}


Question: Is there a better, more idiomatic way to map incoming integer values to protoc-generated constants?

In particular, I would like to avoid listing all constants explicitly in the case A, B, C, D statement.
",2,38958767.0
504,39027998,Difference between main and test recovering from panic?,"I have the following snippet which recovers from index out of range panics

Playground, also pasted below

The error is nil when called from main but not nil in an equivalent test case. What's the difference ?

type Foo struct {
    Is []int
}

func main() {
    fp := &Foo{}
    if err := fp.Panic(); err != nil {
        fmt.Errorf(""Error: %v"", err)
    } 
    fmt.Println(""ok"")
}

func (fp *Foo) Panic() (err error) {
    defer PanicRecovery(&err)
    fp.Is[0] = 5
    return nil
}

func PanicRecovery(err *error) {

        if r := recover(); r != nil {
                if _, ok := r.(runtime.Error); ok {
            //fmt.Println(""Panicing"")
                    *err = r.(error) //panic(r)
                } else {
            *err = r.(error)
        }
    }
}


Test case:

func TestPanic(t *testing.T) {
    fp := &Foo{}
    if err := fp.Panic(); err != nil {
        t.Errorf(""Panic: %v"", err)
    }
}

",1,39028462.0
505,39082404,Golang: how to check if TCP payload bytes contain HTTP request,"I am using the gopacket package and every time I have a TCP packet I want to check if the payload contains an HTTP request. Is there an easy way to do that instead of writing my own parser? There is also a function (see: func ReadRequest(b *bufio.Reader)) which returns a Request struct but I do not know what kind of input I should use. tcp.Payload is the byte[] array that seems to have the information I need to parse (see the following example):

// Get the TCP layer from this packet
if tcpLayer := packet.Layer(layers.LayerTypeTCP); tcpLayer != nil {
    fmt.Printf(""TCP "")
    // Get actual TCP data from this layer
    tcp, _ := tcpLayer.(*layers.TCP)
    srcPort = tcp.SrcPort
    dstPort = tcp.DstPort
    if tcp.SYN {
        fmt.Print(""[SYN] "")
    }
    if tcp.ACK {
        fmt.Print(""[ACK] "")
    }
    if tcp.FIN {
        fmt.Print(""[FIN] "")
    }
    fmt.Printf(""%s:%d > %s:%d "", srcIP, srcPort, dstIP, dstPort)

    fmt.Println(string(tcp.Payload))
}


After sending an HTTP request I get the following output:

PKT [001] TCP [SYN] 192.168.2.6:59095 > 192.168.3.5:80
PKT [002] TCP [SYN] [ACK] 192.168.3.5:80 > 192.168.2.6:59095
PKT [003] TCP [ACK] 192.168.2.6:59095 > 192.168.3.5:80
PKT [004] TCP [ACK] 192.168.2.6:59095 > 192.168.3.5:80 GET /certificates/test.pdf HTTP/1.1
User-Agent: Wget/1.15 (linux-gnu)
Accept: */*
Host: 192.168.3.5
Connection: Keep-Alive


Any suggestions are welcome...
",1,39149407.0
506,39130593,How can I compare struct data and interface data in Golang?,"I am trying to create a generic Binary Tree in Golang. How can I compare data from an interface and input data in the code? Here is an example of what I am trying to do. The comparison that is giving me trouble is this

 } else if cur.data < data {


-

package DSAA

type TreeNode struct {
    data interface{}
    right *TreeNode
    left *TreeNode
}

type BinarySearchTree struct {
    root *TreeNode
}

func BSTCreate() *BinarySearchTree {
    return &BinarySearchTree{nil}
}

func (b *BinarySearchTree) Insert(cur TreeNode, data interface{}) *BinarySearchTree {
    if &cur == nil {
        cur := &TreeNode{data, nil, nil}
    } else if cur.data < data {
        b = b.Insert(*cur.left, data)
    } else {
        b = b.Insert(*cur.right, data)
    }
    return b
}

",1,39130940.0
507,39131886,One method to handle all the struct types that embed one common struct (json marshalling),"I have a gin-gonic web app with somewhat MVC architecture. I created a couple of models, all of them embed one common struct:

type User struct {
   ID int
   Name string
}

type Admin struct {
   User
   Level int
}

... {
   User
}


Now I want to store them in database in json format. The goal I want to accomplish is to code only one function/method that will marshal any model and will save save it into DB. This method must marshal all the fields of current model, not only from User struct, e.g. User must be marshaled into {id: 1, name: ""zhora""}, while Admin will go into {id: 1, name: ""gena"", level: 2}.

Like this one:

func (i *User) Save() {
  data, err := json.Marshal(i)
  check(err)
  if i.ID == 0 {
    _, err = app.DB.Exec(`INSERT INTO users(data) VALUES ($1) `, string(data))
  } else {
    _, err = app.DB.Exec(`UPDATE users SET data = $1 WHERE id=$2`, string(data), i.ID)
  }
  check(err)
}


Right now I have to copy/paste this func to every model file, changing only method receiver. Can this be avoided?
",1,39132056.0
508,39132629,How can you force a dump of a Go program on windows?,"I'm looking to do some kind of debugging on windows where the state of the service appears to be a deadlock.  Perhaps the approach would be to do a dump.  How can you do a program dump of a Go service?  And then analyze that dump?
",2,
509,39143091,Golang: convert struct to embedded at offset 0 struct,"I have some different structs like Big with Small embedded at offset 0. 
How can I access Small's structure fields from code, that doesn't know anything about Big type, but it is known that Small is at offset 0?

type Small struct {
    val int
}

type Big struct {
    Small
    bigval int
}

var v interface{} = Big{}
// here i only know about 'Small' struct and i know that it is at the begining of variable
v.(Small).val // compile error


It seems that compiler is theoretically able to operate such expression, because it knows that Big type has Small type embedded at offset 0. Is there any way to do such things (maybe with unsafe.Pointer)?
",3,39143823.0
510,39151674,Why does Go sha256 give different result than Ubuntu command sha256sum?,"Golang playground link given in a SO question uses the sha256 lib of Go gives a different result than running the following command in Ubuntu linux.

echo ""sha1 this string"" | sha256sum

Go's result: fceab3bb749b11a43b89f21ccd28e3f5d8b38d5b23eeea960fc169ab482ee2cd

Linux result: 62d44fd0392ed998179bfd4a162141d7000d1f9aa4fae26465e2e4f57d3a420e

Is this not the correct way to create a digest in Go? Can someone explain what is going on here?
",1,39151726.0
511,39160807,Default value golang struct using `encoding/json` ?,"How to set default value for Encoding as  ""base64""?

type FileData struct {
    UID string `json:""uid""`                 
    Size int `json:""size""`
    Content string `json:content`
    Encoding string `json:encoding` 
    User string `json:""user""`
}


I tried 

Encoding string `json:encoding`= ""base64"" // Not working

",3,39161250.0
512,39189731,Golang MVC structur,"I searched many sites and I saw a lot of sources in github and i haven't solution.

I created mvc website pattern in Golang:


app


controllers
models
lib (All the features class/functions)
middleware
router.go

resources


views

main.go


My question is: How to inject config to have everywhere settings and other implemented class that will always be needed (like load speed single page)

One more thing(additionally): Can anyone recommend me a good material or transcribe MVC tricks idea works MVC with golang (General useful information)
",1,39192294.0
513,39239977,Why do I get a “cannot assign” error when do assertion?,"req is a interface{} and PostAccountRequest,CreateAccountRequest is struct, when I do this, I get cannot assign *account.PostAccountRequest to v (type *account.CreateAccountRequest) in multiple assignment

v, ok := req.(*account.CreateAccountRequest)                                                         
if ok {
    if v, ok = req.(*account.PostAccountRequest); ok {
        panic(ok)
    }
}

",1,39240034.0
514,39260647,How do you parse date in the format:,"It's not clear to me from the documentation how I would parse a date in this somewhat strange format. It seems like it might not be possible.

2016-07-08T08:34:24+00:00


The following does not work (go play link)

package main

import (
    ""fmt""
    ""time""
)

func main() {
    date := ""2016-07-08T08:34:24+00:00""
    d, err := time.Parse(""2006-01-02T15:04:05+07:00"", date)
    if err == nil {
        fmt.Println(d)
    } else {
        fmt.Println(err)
    }
}


Obviously a regexp could first check for this format and transform the + to a -, but that implies the standard library cant parse this date.
",1,39260680.0
515,39345921,Why does go UnmarshalJSON receives Json Object and not just value,"I got the following custom type:

type TimeWithoutZone struct {
    time.Time
}


The Marshaling works fine: 

const timeWithoutZoneFormat = ""2006-01-02T15:04:05""
func (t *TimeWithoutZone) MarshalJSON() ([]byte, error) {
    stamp := fmt.Sprintf(`""%s""`, t.Time.Format(timeWithoutZoneFormat ))
    return []byte(stamp), nil
}


But here the date can not be parsed:

func (t *TimeWithoutZone) UnmarshalJSON(data []byte) (err error) {
    log.Println(""Parsing: "" + string(data))
    t.Time, err = time.Parse(`""` + timeWithoutZoneFormat + `""`, string(data))

    if err != nil {
        return err
    }
    return nil
}


It logs: Parsing: {""time"":""2016-09-06T11:06:16""} but I would expect it to parse just the value of time

What am I doing wrong? here is the related test:

type TimeTestObj struct {
    Time TimeWithoutZone `json:""time""`
}

func TestParseDataWithoutTimezone(t *testing.T) {
    parsed := TimeWithoutZone{}

    data := `{""time"":""2016-09-06T11:06:16""}`
    err := json.Unmarshal([]byte(data), &parsed)

    if err != nil {
        t.Error(err)
    }

    if parsed.Unix() != 1473152776 {
        t.Error(parsed.Unix(), ""!="", 1473152776)
    }
}


All the examples I find, and even the default parser from the Go time package seem to work that way...
",1,
516,39349612,GO based Mongo Aggregate Query issue,"The regular expression query in $in is not working. It works fine in the mongo shell.

Does not work:

OpMatch := bson.M{""$match"": bson.M{""wordname"": bson.M{""$in"": [...]string{""/^how$/""}}}}


Works:

OpMatch := bson.M{""$match"": bson.M{""wordname"": bson.M{""$in"": [...]string{""how""}}}}

",1,
517,39364133,Golang find a value from a map of nested json data from MongoDB,"I am trying to receive data from my MongoDB using MGO in a map of type []map[string]interface{}

My JSON looks like this -

{
   ""_id"":""string"",
   ""brandId"":123,
   ""category"":{
      ""television"":[
         {
            ""cat"":""T1"",
            ""subCategory"":[
               {
                  ""subCat"":""T1A TV"",
                  ""warrantyPeriod"":6
               }
            ],
            ""warrantyPeriod"":12
         },
         {
            ""cat"":""T2"",
            ""subCategory"":[
               {
                  ""subCat"":""T2A"",
                  ""warrantyPeriod"":18
               },
               {
                  ""subCat"":""T2B"",
                  ""warrantyPeriod"":9
               }
            ],
            ""warrantyPeriod"":15
         },
         {
            ""cat"":""T3"",
            ""subCategory"":[
               {
                  ""subCat"":""T3A"",
                  ""warrantyPeriod"":3
               },
               {
                  ""subCat"":""T3B"",
                  ""warrantyPeriod"":5
               },
               {
                  ""subCat"":""T3C"",
                  ""warrantyPeriod"":7
               },
               {
                  ""subCat"":""T3D"",
                  ""warrantyPeriod"":11
               }
            ],
            ""warrantyPeriod"":4
         }
      ],
      ""television_warrantyPeriod"":24
   },
   ""title"":""BrandName""
}


I would ideally pass in the category name i.e. 'television' and cat and subCat values which could be optional.

For e.g. something like this -

{
""categorySlug"": ""television"",
""brandId"": ""123"",
""model"": ""T2""
}


In which case I would expect to find '15' which is the warrantyPeriod value for T2 if there are no T2A or T2B specified.

My query functions look like this -

var data map[string]string
err := json.NewDecoder(r.Body).Decode(&data)
log.Println(err)
var buffer bytes.Buffer
buffer.WriteString(""category."")
buffer.WriteString(data[""categorySlug""])
brandId, _ := strconv.Atoi(data[""brandId""])
concernedbrandandcategory := database.GetMappedFields(""Brands"", bson.M{""brandId"": brandId, buffer.String(): bson.M{""$exists"": true}}, bson.M{buffer.String(): 1})
categorymap := concernedbrandandcategory[0]
log.Println(categorymap[""category""][""television""], reflect.TypeOf(categorymap))


My GetMappedFields function looks like this -

func GetMappedFields(collectionName string, query interface{}, selector interface{}) (result []map[string]interface{}) {
    MgoSession.DB(Dbname).C(collectionName).Find(query).Select(selector).All(&result)
    return
}


I'm just not able to wrap my head around this nested structure which sometimes returns a map and sometimes an interface!
Any help would be highly appreciated!
",1,39383654.0
518,39438422,Design practices in handling websocket communication in golang,"I am new to go and trying to learn it by replacing a nodejs server.  My nodejs server had the following components:  


It received a websocket message from a client.  The client would provide a unique ID and a key for the message. The server would process the message based on the key (much like a REST interface would) and return a message to the client with the unique ID so that the client would know 
which message the server was responding to.  
For some of the messages, the server would spawn an external process (one for each connection).  The server would then act as a ""client"" to the spawned process, sending JSON messages with unique IDs and receiving back data.  The server in this instance acts as an intermediary between the spawned process and the client.  


On node it was trivial to get this to work generically.  I simply added the spawned process to the connection in my ""main"" and used callbacks in the main.  The websocket server module and the module governing the spawned process communication had no direct interaction and were completely generic. 

However, while I have a websocket package and a spawn package that work well in go, I haven't been able to figure out a good way to generically create a spawned process per websocket connection.  I've thought of passing callbacks and inits but this method seems hackish.  I recognize that node and go probably require different strategies in programming but I can't think of a good ""go"" way of doing this.  I welcome any suggestions!
",1,39442001.0
519,39518237,How to extract and verify token sent from frontend in golang,"Am using ""github.com/dgrijalva/jwt-go"", and able to send a token to my frontend , and what i would like to know how i could retrieve the token sent from the frontend so that i can verify if the token that was sent is valid and if so the secured resource will be delivered.

Here is the token sent from frontend javascript ... 

headers: {
       'Authorization':'Bearer' + localStorage.getItem('id_token')
     }


Here is the code to send token 

    token := jwt.New(jwt.GetSigningMethod(""HS256""))
    claims := make(jwt.MapClaims)
    claims[""userName""] = loginRequest.UserName
    claims[""exp""] = time.Now().Add(time.Minute * 60).Unix()
    token.Claims = claims
    tokenString, err := token.SignedString([]byte(SecretKey))
    tokenByte, err := json.Marshal(data)
    w.WriteHeader(201)
    w.Write(tokenByte)


Here is the code to verify the token

    func VerifyToken(r *http.Request) bool {

    reqToken := r.Header.Get(""Authorization"")
    token, err := jwt.Parse(reqToken, func(t *jwt.Token) (interface{}, error) {
        return []byte(SecretKey), nil
    })
    if err == nil && token.Valid {
        fmt.Println(""valid token"")
        return true
    } else {
        fmt.Println(""invalid token"")
        return false
    }

}


Am getting nil token as a return, my guess is i have sent bearer and i think it might need parsing if so how ?
",1,44700761.0
520,39527700,Data structure to store key-value pairs with duplicate keys,"Which data structure can I use in Go to store key-value pairs with duplicate keys? For eg: 

key | value
 1     one
 2     two
 1     three


and If I try to fetch values corresponding to key 1 I should get an array of values one,three. I tries using map, but it gives me only 1 value.

mapy := make(map[int]interface{})
mapy[1] = ""one""
mapy[2] = ""two""
mapy[1] = ""three""
x := mapy[1]
fmt.Println(x)

output: three

",1,39527767.0
521,39537728,Using a pointer receiver in a goroutine,"I have a method with a pointer receiver, I was wondering if using this pointer receiver is safe to use inside a goroutine within this method? or should I pass this pointer receiver as a parameter?

for example:

func (m *dummyStruct) doSomething {
    /* do a bunch of stuff */
    go func() {
        m.a = x
        m.doSomethingElse()
    }()
    return y
}


I know that I can not go wrong by passing m as a parameter to the goroutine but I was wondering if it is extremely necessary
",3,39537990.0
522,39543356,"Golang, exec and back ticks shell command","I am trying to use os.exec (https://nathanleclaire.com/blog/2014/12/29/shelled-out-commands-in-golang/) with a command like: value=`something`; echo $value

But it appears to the back ticks are messing with the command of the strings.Split I do. 

If I use something it works

How can I use the back ticks? Do I have to find out another way to write my command?

Thanks
",1,
523,39560479,Is there a way to find out if a supplied password matches an actual password for a particular user?,"I have an application that reads a user's name and password over a socket.  I want to determine if the supplied password matches the password that the OS has for that user. If it does, I want to fork a process running as that user. Ideally, the code would be in Go, but I can do C if needed.  Ideally, it would work in Linux, OSX, and BSD.  
",1,
524,39590458,Golang guard (assert) functions naming convention,"I'm wondering if there is a golang naming convention for guard (assert) functions? I've googled a bit but couldn't find anything definitive. I've read in ""The Go Programming Language"" book that using 'must' prefix is a common practice.

Example of the function I need:

package main

func divide(a, b int) int {
    mustNotBeZero(b)
    return a / b
}

func mustNotBeZero(n int) {
    if n == 0 {
        panic(""cannot divide by zero"")
    }
}

func main() {
    println(divide(5, 0))
}

",1,39590815.0
525,39597109,How do I make a PUT request from fetch to my go API?,"I am creating a REST API with Go (using Gorilla mux) and a frontend app with React. The GET requests work fine, but I'm having trouble getting the PUT request to work correctly. It makes the OPTIONS preflight request successfully, but never the PUT request. I may be handling it incorrectly on the backend or making the request incorrectly. I'm created a middleware that will add the CORS headers because the gorilla toolkit's CORS handlers weren't allowing the OPTIONS request at all. I have also tried using axios instead of fetch to make sure it wasn't something I was doing incorrectly in the request. I was getting the exact same behavior with axios.

Here is the router:

var V1URLBase string = ""/api/v1""

func Load() http.Handler {

    r := mux.NewRouter().StrictSlash(true)

    // Status endpoints
    s := r.PathPrefix(fmt.Sprintf(""%s%s"", V1URLBase, ""/statuses"")).Subrouter()

    s.HandleFunc(""/"", handlers.GetStatuses).
        Methods(""GET"")
    s.HandleFunc(""/{status_id}/"", handlers.GetStatus).
        Methods(""GET"")
    s.HandleFunc(""/"", handlers.PostStatus).
        Methods(""POST"")
    s.HandleFunc(""/{status_id}/"", handlers.PutStatus).
        Methods(""PUT"")
    s.HandleFunc(""/{status_id}/"", handlers.DeleteStatus).
        Methods(""DELETE"")

    // Visit endpoints
    v := r.PathPrefix(fmt.Sprintf(""%s%s"", V1URLBase, ""/visits"")).Subrouter()

    v.HandleFunc(""/"", handlers.GetVisits).
        Methods(""GET"")
    v.HandleFunc(""/{visit_id}/"", handlers.GetVisit).
        Methods(""GET"")
    v.HandleFunc(""/"", handlers.PostVisit).
        Methods(""POST"")
    v.HandleFunc(""/{visit_id}/"", handlers.PutVisit).
        Methods(""PUT"")
    v.HandleFunc(""/{visit_id}/"", handlers.DeleteVisit).
        Methods(""DELETE"")

    // Member endpoints
    m := r.PathPrefix(fmt.Sprintf(""%s%s"", V1URLBase, ""/members"")).Subrouter()

    m.HandleFunc(""/"", handlers.GetMembers).
        Methods(""GET"")
    m.HandleFunc(""/{member_id}/"", handlers.GetMember).
        Methods(""GET"")
    m.HandleFunc(""/"", handlers.PostMember).
        Methods(""POST"")
    m.HandleFunc(""/{member_id}/"", handlers.PutMember).
        Methods(""PUT"")
    m.HandleFunc(""/{member_id}/"", handlers.DeleteMember).
        Methods(""DELETE"")

    // GymLocation endpoints
    gl := r.PathPrefix(fmt.Sprintf(""%s%s"", V1URLBase, ""/gym_locations"")).Subrouter()

    gl.HandleFunc(""/"", handlers.GetGymLocations).
        Methods(""GET"")
    gl.HandleFunc(""/{gym_location_id}/"", handlers.GetGymLocation).
        Methods(""GET"")
    gl.HandleFunc(""/"", handlers.PostGymLocation).
        Methods(""POST"")
    gl.HandleFunc(""/{gym_location_id}/"", handlers.PutGymLocation).
        Methods(""PUT"")
    gl.HandleFunc(""/{gym_location_id}/"", handlers.DeleteGymLocation).
        Methods(""DELETE"")

    router := ghandlers.LoggingHandler(os.Stdout, r)
    router = handlers.WriteCORSHeaders(r)

    return router
}


Here is the CORS handler:

func WriteCORSHeaders(h http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        fmt.Println(""HIT"")
        w.Header().Set(""Access-Control-Allow-Origin"", r.Header.Get(""Origin""))
        w.Header().Set(""Access-Control-Allow-Methods"", ""POST, GET, OPTIONS, PUT, DELETE"")
        w.Header().Set(
            ""Access-Control-Allow-Headers"",
            ""Accept, Content-Type, Content-Length, Accept-Encoding, X-CSRF-Token, Authorization"",
        )
        //w.Header().Set(""Access-Control-Allow-Credentials"", ""true"")

        if r.Method == ""OPTIONS"" {
            return
        }

        h.ServeHTTP(w, r)
    })
}


Here is the PUT handler:

func PutVisit(w http.ResponseWriter, r *http.Request) {
    body, _ := ioutil.ReadAll(r.Body)
    r.Body.Close()

    visitId, err := strconv.ParseInt(mux.Vars(r)[VisitId], 10, 64)
    if err != nil {
        WriteJSON(w, http.StatusBadRequest, APIErrorMessage{Message: InvalidVisitId})
        return
    }

    visit := &models.Visit{}
    err = json.Unmarshal(body, visit)
    if err != nil {
        WriteJSON(w, http.StatusBadRequest, APIErrorMessage{Message: err.Error()})
        return
    }

    updated, err := datastore.UpdateVisit(visitId, *visit)
    if err != nil {
        WriteJSON(w, http.StatusInternalServerError, APIErrorMessage{Message: err.Error()})
        return
    }

    WriteJSON(w, http.StatusOK, updated)
}

func WriteJSON(w http.ResponseWriter, statusCode int, response interface{}) {
    encoder := json.NewEncoder(w)
    w.Header().Set(""Content-Type"", ""application/json; charset=UTF-8"")
    w.WriteHeader(statusCode)
    encoder.Encode(response)
}


Here is the main that starts the server:

func main() {
    r := router.Load()

    http.ListenAndServe("":8080"", r)
}


Here is my request from Reactjs:

export function putVisit(visit) {
  return function(dispatch) {
    return fetch(`http://localhost:8080/api/v1/visits/${visit.visit_id}/`, {
      method: 'PUT',
      headers: {
        'Accept': 'application/json; charset=UTF-8',
        'Content-Type': 'application/json; charset=UTF-8'
      },
      body: JSON.stringify(visit)
    })
      .then(response => response.json())
      .then(json =>
        dispatch(updateVisit(json))
      )
      .catch(err =>
        console.log(err)
      )
  }
}

",1,39603015.0
526,39616236,cannot implicitly include runtime/cgo in a shared library,"Following my earlier question, now I'm getting this error when trying to perform all the same steps from this article, since I've upgraded from Go 1.6.1 to Go 1.7.1 (I cannot go back to Go 1.6.1 because the linker crashes when tries to compile some shared libraries).

What I did:


Installed go in ~/.go/go (this is later referred to as GOROOT).
Compiled libstd.so:

GOROOT=~/.go/go GOPATH=~/tests go install -buildmode=shared -linkshared std

Compiled calc library:

GOROOT=~/.go/go GOPATH=~/tests go install -a -x -buildmode=shared -linkshared calc

Tried to compile app:

GOROOT=~/.go/go GOPATH=~/tests go build -a -x -linkshared -o app cashier


and received this error:

~/.go/go/pkg/tool/linux_amd64/link: cannot implicitly include runtime/cgo in a shared library



I tried to repeat the steps with CGO_ENABLED=0 prepended to the environment, but nothing would build this way.  Giving me this error:

imports runtime/cgo: C source files not allowed when not using cgo or SWIG: gcc_fatalf.c gcc_linux_amd64.c gcc_mmap.c gcc_util.c


Is this a known bug?  Is making shared libraries meant to be supported?
",1,
527,39618959,Go : How to reference a field in an inherited struct,"I have 2 structs whereby one inherits values that are common amongst all stucts denoted by type Common struct {...}

type Common struct{
    Id int
    CreatedAt time.Time
    UpdatedAt time.Time
    CreatorId int
}

type Post struct{
  type Post struct{
  Common
  Status
  Title string
  ShortDescription string
  Content string
  CategoryIds []int
  TagIds []int
  Url string
  MainImageId int
  Keywords []string
}


However when I try to create a new instance of the Post struct as in the following.  

post1 := &Post{
    CreatorId:   1,
    Status: 1,
    Title: ""this is the title of the first post"",
    ShortDescription: ""this is the short description of this post"",
    Content: """",
    Url: ""first-post"",
    MainImageId: 1,
}


It does not recognise the CreatorId field.
How would I reference this field in the new instance or modify the struct so that it registers CreatorID as part of the Post struct?
Thanks
",1,39619149.0
528,39632932,How to close a goroutine which runs the flow based logics?,"I have some goroutine logics like this:

go func() {
    do_things_0()
    do_things_1()
    do_things_2()
    do_things_3()
    ...
    ...
} ()


When the service receives a request, it will create such goroutine. And the goroutine maybe memory consuming and needs to run more than 30 minutes.

Sometimes, the service may notice the lack of memory, and needs to terminate some goroutines.

My questions are:


How can I terminate the goroutine in the above example?
Is there any way to know the used memory of each goroutine?


Update


I read other SO answers that goroutine can't be killed outside
I suppose that send a signal to the channel handled by the goroutine to make the goroutine quit is only suitable for the for loop based logics.
I am looking for some best practice to close the goroutine for the flow based logics.

",1,40876262.0
529,39640284,References in go - attribute doesn't change,"I'm having hard time understanding how references in go work. I want to write a really simple in-memory publish-subscribe mechanism. Here's the code:

package sockets

import (
    ""fmt""

    ""github.com/gorilla/websocket""
)

type hubSingleton struct {
    Clients map[string][]*websocket.Conn
}

var instance *hubSingleton

func Hub() *hubSingleton {

    if instance == nil {
        fmt.Println(""New instance created"")
        instance = &hubSingleton{}
    }
    instance.Clients = make(map[string][]*websocket.Conn, 6)
    return instance
}

func (hub *hubSingleton) Subscribe(channel string, socket *websocket.Conn) error {
    if _, ok := hub.Clients[channel]; !ok {
        hub.Clients[channel] = make([]*websocket.Conn, 0)
    }
    hub.Clients[channel] = append(hub.Clients[channel], socket)

    fmt.Println(""Subscribe: "", hub.Clients)
    return nil
}

func (hub *hubSingleton) Publish(channel string, message interface{}) {
    fmt.Println(""Publish: "", hub.Clients)

    if _, ok := hub.Clients[channel]; !ok {
        return
    }
    for i := 0; i < len(hub.Clients[channel]); i++ {
        conn := hub.Clients[channel][i]
        conn.WriteJSON(Message{status: ""ok"", content: message})
    }
}


The problem is that it seems that every time I call Hub().Publish() or Hub().Subscribe() a new hubSingleton.Client is created. Well, I'm not sure what happens, but here's the output of running program: 

Publish:  map[]
Subscribe:  map[chan:[0xc820170000]]
Publish:  map[]
Subscribe:  map[chan:[0xc82008ac80]]
Publish:  map[]
Publish:  map[]
Publish:  map[]
Subscribe:  map[chan:[0xc820170140]]
Publish:  map[]


Subscribers added to the map disapear every time I call Hub().
What can I do, to make the changes in map be preserved between calls?
",1,39641551.0
530,39642189,Goroutines blocked by for loop?,"I have the following code which implements a worker queue:

package main

import (
    ""fmt""
    ""net/http""
    ""io""
    ""time""
)

var (
    linkQueue chan Link
    scraperQueue chan chan Link
)

func CycleDirectory(page int) {
    linkQueue <- Link{Name: ""asd""}
}

type Link struct {
    Name string
}

func (s Scraper) Start() {
    fmt.Println(""Started"")
    go func() {
        for {
            s.ScraperQueue <- s.Link
            select {
            case link := <-s.Link:
                fmt.Println(fmt.Sprintf(""%v"", s.Id) + "": Received "" + link.Name)
            case <-s.QuitChan:
                fmt.Println(""Closed"")
                return
            }
        }
    }()
}

func (s Scraper) Stop() {
    go func() {
        s.QuitChan <- true
    }()
}

type Scraper struct {
    Id int
    Link chan Link
    ScraperQueue chan chan Link
    QuitChan chan bool
}

func InitScraper(id int, scraperQueue chan chan Link) Scraper {
    return Scraper {
        Id: id,
        Link: make(chan Link),
        ScraperQueue: scraperQueue,
        QuitChan: make(chan bool),
    }
}

func HelloServer(w http.ResponseWriter, req *http.Request) {
    io.WriteString(w, ""hello, world!\n"")
}

func main() {
    linkQueue = make(chan Link, 2000)

    numScrapers := 2

    scraperQueue = make(chan chan Link, numScrapers)

    for i := 0; i < numScrapers; i++ {
        s := InitScraper(i+1, scraperQueue)
        s.Start()
    }

    go func() {
        for {
            select {
            case link := <-linkQueue:
                go func() {
                    scraper := <-scraperQueue
                    scraper <- link
                }()
            }
        }
    }()

    CycleDirectory(1)

    // time.Sleep(1 * time.Millisecond)

    for {
        // select {
        // }
    }

    // http.HandleFunc(""/hello"", HelloServer)

    // http.ListenAndServe("":12345"", nil)
}


Running this code using a for loop containing an if statement (or nothing inside), the scraper does not print a received message. Blocking using the ListenAndServe function from net/http, it prints the received message. Blocking using sleep for 1 ms, I receive the message. And putting a select statement in the for loop, I also receive the message.

Why is the for loop without a select statement not allowing for execution of the message sending in the worker queues, and how would I go about handling this. I need an if statement in the for loop to check if all the work has been done so I can exit the loop and end the program.

Update

Amd's suggestion is a solution to this problem. Here is my updated code using sync.WaitGroup
    package main

import (
    ""fmt""
    ""sync""
)

var (
    linkQueue chan Link
    scraperQueue chan chan Link
    wg sync.WaitGroup
)

func CycleDirectory(page int) {
    wg.Add(1)
    linkQueue <- Link{Name: ""asd""}
}

type Link struct {
    Name string
}

func (s Scraper) Start() {
    fmt.Println(""Started"")
    go func() {
        for {
            s.ScraperQueue <- s.Link
            select {
            case link := <-s.Link:
                Scrape(s.Id, link.Name)
                s.Stop()
            case <-s.QuitChan:
                fmt.Println(""Closed"")
                wg.Done()
                return
            }
        }
    }()
}

func (s Scraper) Stop() {
    go func() {
        s.QuitChan <- true
    }()
}

type Scraper struct {
    Id int
    Link chan Link
    ScraperQueue chan chan Link
    QuitChan chan bool
}

func Scrape(id int, name string) {
    fmt.Println(fmt.Sprintf(""%v"", id) + "": Received "" + name)
}

func InitScraper(id int, scraperQueue chan chan Link) Scraper {
    return Scraper {
        Id: id,
        Link: make(chan Link),
        ScraperQueue: scraperQueue,
        QuitChan: make(chan bool),
    }
}

func main() {
    linkQueue = make(chan Link, 2000)

    numScrapers := 2

    scraperQueue = make(chan chan Link, numScrapers)

    for i := 0; i < numScrapers; i++ {
        s := InitScraper(i+1, scraperQueue)
        s.Start()
    }

    go func() {
        for {
            select {
            case link := <-linkQueue:
                go func() {
                    scraper := <-scraperQueue
                    scraper <- link
                }()
            }
        }
    }()

    CycleDirectory(1)

    wg.Wait()

    fmt.Println(""Done"")
}

",1,39642839.0
531,39654312,converting a method to a function with a pointer to the struct in Golang,"I read some strange codes which convert a method to a function whose first argument is a pointer to this method's struct.

I write an example to demonstrate it:

package main

import ""fmt""

type fooS struct{}

func (s *fooS) fooF(fooArg interface{}) {
    fmt.Println(""fooF: "", fooArg)
}

type wowS struct {
    callback func(s *fooS, fooArg interface{})
}

func main() {
    wow := new(wowS)
    wow.callback = (*fooS).fooF // strange
    wow.callback(nil, 123)
}


Golang Playground Link

The example's syntax is strange but has no error.

Can any one tell me how these codes work or give me an official document about them?

Thanks:)
",1,39654604.0
532,39655389,How to render struct to html template?,"i going to render html with data,when render,i don't know how to render struct of other file return for render on controller ,

code :

packages controller

type Index struct {
Title string
Body  string
}

func IndexController(w http.ResponseWriter , r *http.Request){

if r.Method == ""POST""{

    data := &Index{
        Title: ""Hello"",
        Body:  ""Welcome to the WebGo."",
    }

    ff := renders.Sample{Temppath:""templates/index.tmpl"",Data:data}
    ff.Render(w)


my render package:

package renders

import (
   ""html/template""
   ""log""
   ""net/http""
 )

type Sample struct {
  Temppath string
  Data struct{}   ## i don't know how to use pass value of package controller to renders package ?
}

func (obj Sample) Render(w http.ResponseWriter) error {

 var indexTemplate = template.Must(template.ParseFiles(obj.Temppath))
 if err := indexTemplate.Execute(w, obj.Data); err != nil {
    log.Println(err)
    return err
 }
 return nil
}


html code :




    
    
    {{.Title}}
    
        body {
            font-family: sans-serif;
        }
        h1 {
            background: #ddd;
        }
        #sidebar {
            float: right;
        }
    


    {{.Title}}
    
        {{block ""sidebar"" .}}

        

        
        {{end}}
    

    {{block ""content"" .}}
    
        {{.Body}}
    
    {{end}}





how to pass type Index struct to renders package for use indexTemplate.Execute(w, obj.Data) 
",1,39659996.0
533,39678131,How to cross compile go application for FreeBSD within a Raspberry pi 1 model B,"On a Raspberry Pi 1 model B I installed FreeBSD 10.3 using the SD Card Images RPI-B.

I can boot, get network, ssh into it, etc, all seems to be ok and functional. This is part of the dmesg output:

FreeBSD 10.3-RELEASE #0 r297264: Fri Mar 25 08:01:14 UTC 2016
    root@releng1.nyi.freebsd.org:/usr/obj/arm.armv6/usr/src/sys/RPI-B arm
FreeBSD clang version 3.4.1 (tags/RELEASE_34/dot1-final 208032) 20140512
VT: init without driver.
CPU: ARM1176JZ-S rev 7 (ARM11J core)
 Supported features: ARM_ISA THUMB2 JAZELLE ARMv4 Security_Ext
 WB enabled LABT branch prediction enabled
  16KB/32B 4-way instruction cache
  16KB/32B 4-way write-back-locking-C data cache
real memory  = 503312384 (479 MB)
avail memory = 483127296 (460 MB)


On a mac os X (10.11.6) with go 1.7.1:

go version go1.7.1 darwin/amd64


I am cross compile this code:


    package main

import (
        ""fmt""
        ""time""
)

func main() {
        t := time.Now().UTC()
        fmt.Println(""Location:"", t.Location(), "":Time:"", t.Format(time.RFC3339Nano))
}


With:

env GOOS=freebsd GOARCH=arm go build


Running the generated binary on the raspberry-pi generates a coredump:

freebsd@rpi-b:~ % ./time 
Illegal instruction (core dumped)


On the time.core after typing:

$ strings time.core


besides many characters I see this:

fatal error: cgo callback before cgo call


Any idea how what flags to use or how to properly cross-compile for FreeBSD within a Raspberry pi ?
",1,39689964.0
534,39681086,Filter structure with several parameters,"I have an array of a struct and a maps with variable name and some filter values.
I want to filter my array with my maps.

Example Go Playground:

package main

import ""fmt""

type cnts []cnt

type cnt struct {
    ID    int    `json:""Id""`
    Area  string `json:""Area""`
    State string `json:""State""`
    City  string `json:""City""`
}

func main() {
    mycnts := cnts{
        cnt{124, ""Here"", ""South"", ""Home""},
        cnt{125, ""Here"", ""West"", ""Home""},
        cnt{126, """", ""South"", ""Home""},
        cnt{127, ""Here"", ""West"", ""NY""}}
    // my maps with filter
    mapFilter := map[string]string{""Area"": ""Here"", ""City"": ""Home""}
    fmt.Println(mapFilter)

    mycntsFilter := make(cnts, 0)
    for _, val := range mycnts {
        // I want to select only row where the map filter it's ok
        mycntsFilter = append(mycntsFilter, val)
        fmt.Println(val, mycntsFilter)
   }
}


What is the best way to filter my data with dynamic filter (Represente here by a map of string)?
",1,39685362.0
535,39758689,How to capture/log everything after spawning an interactive program,"I have a method that can spawn an interactive process, now how do I log everything (including stdin and stdout) after spawning ?

e.g.,

func execute(cmd1 string, slice []string) {

    cmd := exec.Command(cmd1, slice...)

    // redirect the output to terminal
    cmd.Stdout = os.Stdout
    cmd.Stderr = os.Stderr
    cmd.Stdin = os.Stdin

    cmd.Run()
}


..
The interactive program could be :
execute(ftp) 

I think I have to dup stdin, stdout and read write in separate thread.
",2,
536,39824698,Minimal diffing with golang templates?,"Let's say I have a page, it a header and a body. In the header are links, and on click the body changes, but the header remains.
To build this with the html/template library is easy, but also seems dumb if I just send back a whole new page (fetching the information in the header from the database every time). How to I switch out body templates depending on the url I guess.

Here is what I have:

`

{{template ""GlobalNav""}} 
 {{template ""GroupHeader"" .Header }} 
 {{ if eq .Active """" }}
 {{ template ""GroupBody"" .Body }}
 {{ else if eq .Active ""papers"" }}
 {{ template ""GroupPapers"" .Body }}
 {{ else if eq .Active ""projects"" }}
 {{ template ""GroupProjects"" .Body }}
 {{ end }}`

Server Side:

`http.HandleFunc(""/g/"", Groups)
http.HandleFunc(""/g/papers"", GroupsPapers)
http.HandleFunc(""/g/projects"", GroupsProjects)
func Groups() {
 header := fromDBHeader(id)
body := fromDBMain(id)
render Home template ...
}
func GroupsPapers() {
  header := fromDBHeader(id)
   body := fromDBPapers(id)
   render Paper template ...
   }
func GroupsProjects() {
header := fromDBHeader(id)
body := fromDBProjects(id)
render Project template ...
}


`

Is it time for some JS?
",1,
537,39876914,How to convert a uint16 to a 2 byte string in Go?,"I am dealing with some legacy data where I routinely need to convert a uint16 to a 2 byte string.

Here is what I am using (where i is a uint16):

string([]byte {byte(i >> 8), byte(i & 0xFF)})


https://play.golang.org/p/423CAL-SJv

This seems rather clunky. Is there an existing library function to do this? I have looked at both the strings and binary packages, but nothing seemed immediately obvious.
",2,39877077.0
538,39948383,How to avoid newlines caused by conditionals?,"Given this Go text/template code:

Let's say:
{{ if eq .Foo ""foo"" }}
Hello, StackOverflow!
{{ else if eq .Foo ""bar"" }}
Hello, World!
{{ end }}


We get the following output in case Foo equals ""foo"":

Let's say:

Hello, StackOverflow!


(followed by a newline)

Is there a way to get rid of the extra newlines?

I would expect that this can be accomplished using the {{- and -}} syntax:

Let's say:
{{- if eq .Foo ""foo"" }}
Hello, StackOverflow!
{{- else if eq .Foo ""bar"" }}
Hello, World!
{{- end }}


However, that yields an illegal number syntax: ""-"" error.
",2,39953936.0
539,40130541,How to replace file variable with gzipped version in Go?,"I have the following Go code:

file, err := os.Open(fileName)
if err != nil {
    fatalf(service, ""Error opening %q: %v"", fileName, err)
}

// Check if gzip should be applied
if *metaGzip == true {
    var b bytes.Buffer
    w := gzip.NewWriter(&b)
    w.Write(file)
    w.Close()
    file = w
}


I want to replace the file content of file with a gzipped version if metaGzip = true.

PS:
I followed this advice: Getting ""bytes.Buffer does not implement io.Writer"" error message but I still get the error: cannot use file (type *os.File) as type []byte in argument to w.Write
",1,40132097.0
540,40168086,Vendoring Golang Shared Repository,"Trying to move to the officially supported Golang vendoring solution from legacy Godeps workflow.

Scenario:

Repo A===
         \
           ========> Repo C (shared library code)
         /  
Repo B===


What is the best workflow I can choose for a mid-size (roughly 5-10 member) team of engineers to vendor Repo C for both Repo A and Repo B? Engineers of varying abilities, most of which probably shouldn't need to know the details of this at all?  

I'm currently using govendor for this. I'd prefer not to switch but would if there is a tool that provides a better workflow.

This needs to integrate with a CI server running the builds. I can think of 3 scenarios:

Vendor Repo C into A & B:


Pros:


Reproducible Builds
Easy integration with CI

Cons:


Manual and Error Prone - Can easily vendor incorrect code
Engineers need decent knowledge of vendor tool and methodology



Symlink Repo C trunk branch into vendor folders of A & B:


Pros:


Engineers need no knowledge of vendor tool
Low Developer Maintenance

Cons:


Builds not (easily) reproducible
Possibility of including code in build that shouldn't be released
Less Flexible (Repo A and Repo B can't have differing versions of C)



Include Repo C as a git submodule or subtree in Repo A and Repo B (either utilizing vendor or not):


Pros:   


Engineers need no knowledge of vendor tool   
Easy Setup   
Less Maintenance   
Reproducible Builds

Cons:   


Having to use git submodule or subtree



Finding surprisingly little about this question on the internet.  Is there some idiomatic way of doing this?  I'm sure there are other ways of doing this; what am I missing?
",1,40171150.0
541,40188257,"Deployment Build Using Local Package Fails with ""import path does not begin with hostname""","I'm new to Go, and I imagine this is an obvious situation for anyone who's worked with Go deployment in the past. In the most TL;DR sense, I built out a demo project from Scotch.IO for a simple todo list using Go (https://scotch.io/tutorials/create-a-single-page-app-with-go-echo-and-vue), and it works flawlessly on my machine, but it breaks in CircleCI when it attempts to import locally defined packages:

  import (
     ""database/sql""
     ""net/http""
     ""strconv""

     ""go-todo/models"" // <- This

     ""github.com/labstack/echo""
  )


I know there's no real reason to deploy an app like this, but I'd like to understand it better before diving into larger projects where deployment is essential. The logs at the breakpoint read:

package go-todo/handlers: unrecognized import path ""go-todo/handlers"" (import path does not begin with hostname)
package go-todo/models: unrecognized import path ""go-todo/models"" (import path does not begin with hostname)


And while I grasp that the path is incomplete from a remote environment perspective, I also know that relative paths won't fix it, and I have to assume there's some environmental variable that my ignorance is making me blind to in this context.

It's also worth noting that all of the go get calls for remote packages play nicely as expected.

Any help will be greatly appreciated. Refining my google searches is just bringing back the same stack of seemingly unrelated questions.
",1,40189899.0
542,40207528,Is it bad to use a struct and treat it like a class to solve the dependency in Golang?,"I wrote a lot PHP with the OOP frameworks before, and I'm learning Golang,

When I was using PHP, The class is useful that I could pass a $model in to my class then share it between functions:

class User {
   function __construct(UserModel $model) {
       $this->model = $model
   }

   function delete($id) {
       $this->model->delete($id);
   }

   function update($id) {
       $this->model->update($id);
   }
}

$UserModel = new UserModel();
$User      = new User($UserModel);
$User->delete(1);


But there's no class in Golang, I knew that I could treat structs like a class:

type User struct {
    model *models.User
}

func (u *User) Delete(id int) {
    u.model.Delete(id)
}

func (u *User) Update(id int) {
    u.model.Update(id)
}

userModel := &models.User{}
user      := User{model: userModel}
user.Delete(1)


I felt like the struct is used to store the information, and the method of the struct should be used to modify the value of the struct. 

But right now I made a struct just because I want to treat it like a class and solve the dependency problem, is it bad to use such approach in Golang?
",2,40229629.0
543,40216428,Golang new memory allocation,"I have started programming in Go and I was wondering when new(Object) is used it allocates memory to the size of that object right? If this is the case how do I free this memory once I have finished using the object? 

I ask this because in C++ when new is used on an object you can delete the object once there is no longer any need for the object to be stored.

I have been searching to see if Go does have delete or something similar to C++ but I have been unable to find anything.

Any help is much appreciated.
",3,40216486.0
544,40262971,Is Go vulnerable for buffer overflow,"I know languages like c# aren't vulnerable to buffer overflows unless you marshal or use unsafe code. But is go vulnerable for buffer overflows?
",2,40263029.0
545,40266003,How to assert ast.TypeSpec to int type in Golang?,"I have following code for Golang docs parsing. ""ts"" is ast.TypeSpec. I can check StructType and etc. But, ts.Type is ""int"". How can I assert for int and other basic type?

ts, ok := d.Decl.(*ast.TypeSpec)
switch ts.Type.(type) {
case *ast.StructType:
    fmt.Println(""StructType"")
case *ast.ArrayType:
    fmt.Println(""ArrayType"")
case *ast.InterfaceType:
    fmt.Println(""InterfaceType"")
case *ast.MapType:
    fmt.Println(""MapType"")
}

",1,
546,40288351,Copy a struct into a struct which implement an interface,"I'm currently trying to copy a struct into another structure which implement an interface. My code is the following:

     package main

     import (
         ""fmt""
     )

     type intf interface {
         SaySomething(string)
         LaunchTheDevice(origin)
     }

     type destination struct{
         origin
     }

     func (dest *destination) SaySomething(s string) {
         fmt.Println(""I'm saying --> "",s)
     }

     func (dest *destination) LaunchTheDevice(theOrigin origin) {
        *dest = theOrigin
     }

     type origin struct{
         name string
         value string
         infos string   
     }

     func main() {
         firstValue:= new(origin)
         firstValue.name = ""Nyan""
         firstValue.value = ""I'm the only one""
         firstValue.infos = ""I'm a cat""

         secondValue := new(destination)
         secondValue.LaunchTheDevice(*firstValue)
     }


I want that the function LaunchTheDevice() set the values of destination. But when I run my code I get this error:

cannot use theOrigin (type origin) as type destination in assignment


So how can I do this? And why I can't run my code? I don't understand because I can type

dest.name = ""a value""
dest.value = ""another value""
dest.infos = ""another value""


But dest=theOrigin doesn't work while dest have the same struct as theOrigin.

Thanks in advance!
",1,40288438.0
547,40360936,graphql-go : Use an Object as Input Argument to a Query,"I'm attempting to pass an object as an argument to a query (rather than a scalar). From the docs it seems that this should be possible, but I can't figure out how to make it work.

I'm using graphql-go, here is the test schema:

var fileDocumentType = graphql.NewObject(graphql.ObjectConfig{
Name: ""FileDocument"",
Fields: graphql.Fields{
    ""id"": &graphql.Field{
        Type: graphql.String,
        Resolve: func(p graphql.ResolveParams) (interface{}, error) {
            if fileDoc, ok := p.Source.(data_format.FileDocument); ok {
                return fileDoc.Id, nil
            }
            return """", nil
        },
    },
    ""tags"": &graphql.Field{
        Type: graphql.NewList(tagsDataType),
        Args: graphql.FieldConfigArgument{
            ""tags"": &graphql.ArgumentConfig{
                Type: tagsInputType,
            },
        },
        Resolve: func(p graphql.ResolveParams) (interface{}, error) {
            fmt.Println(p.Source)
            fmt.Println(p.Args)
            if fileDoc, ok := p.Source.(data_format.FileDocument); ok {
                return fileDoc.Tags, nil
            }
            return nil, nil
        },
    },

},
})


And the inputtype I'm attempting to use (I've tried both an InputObject and a standard Object)

var tagsInputType = graphql.NewInputObject(graphql.InputObjectConfig{
Name: ""tagsInput"",
Fields: graphql.Fields{
    ""keyt"": &graphql.Field{
        Type: graphql.String,
    },
    ""valuet"": &graphql.Field{
        Type: graphql.String,
    },
},
})


And here is the graphql query I'm using to test:

{
        list(location:""blah"",rule:""blah"")
        {
            id,tags(tags:{keyt:""test"",valuet:""test""})
            {
                key,
                value
            },
            {
                datacentre,
                handlerData
                {
                    key,
                    value
                }
            }
        }
    }


I'm getting the following error:

wrong result, unexpected errors: [Argument ""tags"" has invalid value {keyt: ""test"", valuet: ""test""}.
In field ""keyt"": Unknown field.
In field ""valuet"": Unknown field.]


The thing is, when I change the type to a string, it works fine. How do I use an object as an input arg?

Thanks!
",1,41230015.0
548,40370006,What are the second pair of braces in this Golang struct?,"var cache = struct    {
    sync.Mutex
    mapping map[string]string
} {
    mapping: make(map[string]string),
}


This looks like a struct with an embedded field sync.Mutex but I can't get my head around the second set of braces. It compiles and executes but what's up? Why does the label on the make instruction matter (it does) and the comma? Thanks...
",2,
549,40389137,Multiple docker container logs,"I'm trying to get the logs from multiple docker containers at once (order doesn't matter). This works as expected if types.ContainerLogsOption.Follow is set to false. 

If types.ContainerLogsOption.Follow is set to true sometimes the log output get stuck after a few logs and no follow up logs are printed to stdout. 

If the output doesn't get stuck it works as expected.

Additionally if I restart one or all of the containers the command doesn't exit like docker logs -f containerName does.

func (w *Whatever) Logs(options LogOptions) {
    readers := []io.Reader{}

    for _, container := range options.Containers {
        responseBody, err := w.Docker.Client.ContainerLogs(context.Background(), container, types.ContainerLogsOptions{
            ShowStdout: true,
            ShowStderr: true,
            Follow:     options.Follow,
        })
        defer responseBody.Close()

        if err != nil {
            log.Fatal(err)
        }
        readers = append(readers, responseBody)
    }

    // concatenate all readers to one
    multiReader := io.MultiReader(readers...)

    _, err := stdcopy.StdCopy(os.Stdout, os.Stderr, multiReader)
    if err != nil && err != io.EOF {
        log.Fatal(err)
    }
}


Basically there is no great difference in my implementation from that of docker logs https://github.com/docker/docker/blob/master/cli/command/container/logs.go, hence I'm wondering what causes this issues.
",1,40392962.0
550,40397781,gometalinter / errcheck returns a warning on deferring a func which returns a variable,"gometalinter and errcheck return me a warning about deferring a function which returns a variable.

Example in a web request:

defer r.Body.Close()


In this case, Close returns an error variable and it's not checked.

Is the best method / idiomatic to defer it inside another function?

defer func() {
    err := r.Body.Close()
    if err != nil {
        // fmt, panic or whatever
    }
}()

",1,40398093.0
551,40411832,WHY is my installation of the beego web framework not working?,"Andres-Air:~ iivri.andre$ go get github.co/beego/bee
package github.co/beego/bee: unrecognized import path ""github.co/beego/bee"" (https fetch: Get https://github.co/beego/bee?go-get=1: dial tcp 199.59.243.120:443: i/o timeout

It keeps showing me this 'error' Is anyone here familiar with the installation process? 
",1,
552,40423461,goroutine asleep - deadlock,"In the following code I am trying to spawn MaxOutstanding number of handlers. Each handler loops over items in the queue queue and prints them out, I also write true to the done channel.

In my main function, I start the handlers and write 9 elements to the queue and wait for the 1st element to be written to the done queue.

package main


import ""fmt""

type Request struct {
        int32
}
var MaxOutstanding = 5
func handle(queue chan *Request, i int, done chan bool) {
    for r := range queue {
        fmt.Println(i, ""---"", r)
        done <- true
    }
}

func Serve(clientRequests chan *Request, quit, done chan bool) {
    // Start handlers
    for i := 0; i < MaxOutstanding; i++ {
        go handle(clientRequests, i, done)
    }
    <-quit  // Wait to be told to exit.
}


func main() {
    clientRequests := make(chan *Request)
    quit := make(chan bool)
    done := make(chan bool)

    go Serve(clientRequests, quit, done)

    clientRequests <- &Request{4}
    clientRequests <- &Request{1}
    clientRequests <- &Request{2}
    clientRequests <- &Request{3}

    clientRequests <- &Request{5}
    clientRequests <- &Request{6}
    clientRequests <- &Request{7}
    clientRequests <- &Request{8}
    clientRequests <- &Request{9}
    fmt.Println( ""...........>"", <- done )
    close(clientRequests)
    close(done)
}


On execution I get the following error. I don't see whats wrong with the implementation, I am even closing the channel.

4 --- &{4}
0 --- &{1}
1 --- &{2}
2 --- &{3}
3 --- &{5}
fatal error: all goroutines are asleep - deadlock!

goroutine 1 [chan send]:
main.main()
        /home/ubuntu/digs-svc/src/digs/go1.go:45 +0x251

goroutine 5 [chan receive]:
main.Serve(0xc82004c060, 0xc82004c0c0, 0xc82004c120)
        /home/ubuntu/digs-svc/src/digs/go1.go:28 +0x92
created by main.main
        /home/ubuntu/digs-svc/src/digs/go1.go:37 +0xb9

goroutine 6 [chan send]:
main.handle(0xc82004c060, 0x0, 0xc82004c120)
        /home/ubuntu/digs-svc/src/digs/go1.go:16 +0x23b
created by main.Serve
        /home/ubuntu/digs-svc/src/digs/go1.go:25 +0x5b


EDIT:

Apparently, the fmt.Println(""...."",  wasn't enough to signify that there is a consumer to the done channel. I moved the code up in the execution order. A consumer needs to be ""listening"" on the channel when data is written to it. In my earlier code, the when the first data was written there were no consumer.

Working code.

https://play.golang.org/p/98l2M4XO9t
",2,40423745.0
553,40468404,golang - open file in an empty bash window,"lets say I have this code:

package main 

import (
     ""io/ioutil"" 
     ""fmt""
)
func check(err error) {
     if err != nil {
         panic(err)
     }
} 
func main() {
     file, err := ioutil.ReadFile(""test.txt"")
     check(err)
     fmt.Print(string(file))
}


when running it with go run I want it to be written in a cleared bash window. Is it possible to do so without using any additional open-source repositories? 

Thanks in advance.
",1,
554,40502309,How can I set the logrus time to UTC,"I am using Go with logrus, however I found the time field is always formatted in local time. How can I change the time to UTC time for logrus?

Thanks
",2,40502637.0
555,40505410,Golang trouble unmarshalling nested json with unknown keys,"I am having trouble unmarshalling a json data of the below format to a struct. The structure of the json looks a bit confusing to me, so apologies for all the dumb things I am doing to unmarshal it.

{
  ""message"": {
    ""Server1.example.com"": [
      {
        ""application"": ""Apache"", 
        ""host"": {
          ""name"": ""/^Server-[13456]/""
        }, 
        ""owner"": ""User1"", 
        ""project"": ""Web"", 
        ""subowner"": ""User2""
      }
    ], 
    ""Server2.example.com"": [
      {
        ""application"": ""Mysql"", 
        ""host"": {
          ""name"": ""/^Server[23456]/""
        }, 
        ""owner"": ""User2"", 
        ""project"": ""DB"", 
        ""subowner"": ""User3""
      }
    ] 
  }, 
  ""response_ms"": 659, 
  ""success"": true
}


I am trying to unmarshal it using the following struct.

type ServerDetails struct  {
  Message  struct{
    Hostname struct{
      Details struct{
        Application string `json:""application""`
        }`json:""-""`
       }`json:""-""`
     }`json:""message""`
}


The fields Server[0-9].example.com will be unknown at the time of generating, and will change, and there is this field 

      {
    ""application"": ""Apache"", 
    ""host"": {
      ""name"": ""/^Server-[13456]/""
    },


just after the server name that doesn't have a key outside, which again looks confusing to me. I tried a good number of combinations to understand how this could be unmarshalled, but I failed.

What is a working approach to get the json fields unmarshal into a struct? Can someone help me understand this please?

Thank you.
",2,40509559.0
556,40540490,Types of specific positions in array of arrays?,"I'm very much a newb in Go and I'm trying to build a function with this general aspect: 

mapOfResults = ThingDoer([
  [""One"",    int,    -1,    true],
  [""Flying"", string, """",    true],
  [""Banana"", bool,   false, true]
])


But I cannot even figure its signature (is signature even the proper term for it in Go? the definition of all its params etc). 

I'm talking about this construct:

func ThingDoer(config ThisIsWhatICannotFigure) map[string]Results {
    // the body of my function
}


How do I define the types for such a parameter?
",1,40540527.0
557,40575033,golang multiple case in type switch,"when I run the code snippet bellow, it raise a error


  a.test undefined (type interface {} is interface with no methods)


It seem the type switch does not take effect.

package main

import (
    ""fmt""
)

type A struct {
    a int
}

func(this *A) test(){
    fmt.Println(this)
}

type B struct {
    A
}

func main() {
    var foo interface{}
    foo = A{}
    switch a := foo.(type){
        case B, A:
            a.test()
    }
}


If I change it to 

    switch a := foo.(type){
        case A:
            a.test()
    }


it's ok now.
",1,40575079.0
558,40586313,Get all substrings inside parentheses in Golang regexp,"I want to get all the substrings inside all parentheses in go using Regex.

As an example for the string ""foo(bar)foo(baz)golang"", i want ""bar"" and ""baz""

in python i can do re.findall(""(?

How to do it in go?
",2,40586418.0
559,40589353,"Golang: Adding hours, minutes, seconds to current time","How do I add hours, minutes, and seconds (defined as ints) to the current time, similar to AddDate?

timein := time.Now().Local().AddDate(Hours, Mins, Sec)


but with hours, minutes, and seconds.
",2,40589596.0
560,40595563,Handle not found when searching string in slice,"Based on this fairly simple code based on the sort package. The response index of o1 is invalid as pointed by @JimB because a bigger or equals operator is required for binary search

l := []string{""o1"", ""o2"", ""o3""} 

i1 := sort.Search(len(l), func(i int) bool { return strings.EqualFold(l[i], ""o1"") })
fmt.Println(""o1:"", i1) //PRINTS 3 - WRONG


https://play.golang.org/p/nUs-ozTYsY

The working solution is:

l := []string{""o1"", ""o2"", ""o3""} 

i1 := sort.Search(len(l), func(i int) bool { return l[i] >= ""o1"" })
fmt.Println(""o1:"", i1)


https://play.golang.org/p/WRsijy_xzV

However this still it's important to bare in mind a important last check. The return value is the index to insert x, which means that you can end up with something like:

o1: 0 (index 0)
o2: 1
o3: 2
o777: 0 (Same 0 index!) 


Therefore it's important as pointed by @JimB to check for data[i] == 23 separately.

if i  data[i] == x <--- {
    x is present at data[i]
} else {
    ...
}

",1,40595743.0
561,40643379,Go race condition in timeout handler,"I can see two main issues in the example code below, but I don't know how to solve them correctly.

If the timeout handler does not get the signal through the errCh that the next handler has completed or an error occured, it will reply ""408 Request timeout"" to the request.

The problem here is that the ResponseWriter is not safe to be used by multiple goroutines. And the timeout handler starts a new goroutine when executing the next handler.

Issues:


How to prevent the next handler from writing into the ResponseWriter when the ctx's Done channel times out in the timeout handler.
How to prevent the timeout handler from replying 408 status code when the next handler is writing into the ResponseWriter but it has not finished yet and the ctx's Done channel times out in the timeout handler.




package main

import (
  ""context""
  ""fmt""
  ""net/http""
  ""time""
)

func main() {
  http.Handle(""/race"", handlerFunc(timeoutHandler))
  http.ListenAndServe("":8080"", nil)
}

func timeoutHandler(w http.ResponseWriter, r *http.Request) error {
  const seconds = 1
  ctx, cancel := context.WithTimeout(r.Context(), time.Duration(seconds)*time.Second)
  defer cancel()

  r = r.WithContext(ctx)

  errCh := make(chan error, 1)
  go func() {
    // w is not safe for concurrent use by multiple goroutines
    errCh <- nextHandler(w, r)
  }()

  select {
  case err := <-errCh:
    return err
  case <-ctx.Done():
    // w is not safe for concurrent use by multiple goroutines
    http.Error(w, ""Request timeout"", 408)
    return nil
  }
}

func nextHandler(w http.ResponseWriter, r *http.Request) error {
  // just for fun to simulate a better race condition
  const seconds = 1
  time.Sleep(time.Duration(seconds) * time.Second)
  fmt.Fprint(w, ""nextHandler"")
  return nil
}

type handlerFunc func(w http.ResponseWriter, r *http.Request) error

func (fn handlerFunc) ServeHTTP(w http.ResponseWriter, r *http.Request) {
  if err := fn(w, r); err != nil {
    http.Error(w, ""Server error"", 500)
  }
}

",1,
562,40646106,how to use Xlinker in cgo? malformed #cgo argument: -(,"env:

gcc3.4.5
go1.3
linux2.6.32
centos4

problem:

I want to pass -Xlinker ""-("" and -Xlinker ""-)"" to cgo LDFLAGS, in order to solve static library order problem.

But it seems that cgo does not support this, failed when compile:

xxx.go: malformed #cgo argument: -(


The cgo directive which sets LDFLAGS in xxx.go:

// #cgo LDFLAGS: -Xlinker ""-("" libyyy.a libzzz.a -lstdc++ -Xlinker ""-)""
import ""C""


question:

how to use -Xlinker in cgo?
",1,
563,40668910,How to unmarshal command line input properly?,"I have written following code snippet in trial.go:

type Mine struct{
    A string `json:""a""`
}

func main(){
    s := Mine{}
    v := os.Args[1]//`{""a"":""1""}`
    fmt.Println(v)
    fmt.Println(reflect.TypeOf(v))
    json.Unmarshal([]byte(v), &s)
    fmt.Println(s)  
}


I am running this file as below:

go run trial.go `{""A"":""1""}`


But I don't get anything in s. It is always a blank struct.

What am I doing wrong here?
",1,40669025.0
564,40688567,Why isn't go build finding Py_None?,"I'm wrapping a Go library for Python. I need to be able to return None, but it's not finding it at compile time:

/*
#cgo pkg-config: python3
#define Py_LIMITED_API
#include 
*/
import ""C""

//export Nothing
func Nothing(self, args *C.PyObject) (status *C.PyObject) {
    C.Py_IncRef(C.Py_None)
    return C.Py_None
}


Here's the output of go build

go build -buildmode=c-shared -o mymodule.so
# example.com/mywrapper
/tmp/go-build293667616/example.com/mywrapper/_obj/_cgo_main.o:(.data.rel+0x0): undefined reference to `Py_None'
collect2: error: ld returned 1 exit status


I'm not understanding how it can be finding all of the other Py* functions and types (PyArgs_ParseTuple and PyLong_FromLong work just fine), but can't find Py_None. The Python library is obviously being loaded. What's going on here?
",1,
565,40708750,Go: cannot create a server in go routine,"When trying to ListenAndServer inside a go routine I get an error:

package main

import (
    ""fmt""
    ""io/ioutil""
    ""net/http""
)

func main() {
    http.HandleFunc(""/static/"", myHandler)
    go func() {
        http.ListenAndServe(""localhost:80"", nil)
    }()

    fmt.Printf(""we are here"")
    resp, _ := http.Get(""localhost:80/static"")

    ans, _ := ioutil.ReadAll(resp.Body)
    fmt.Printf(""response: %s"", ans)
}

func myHandler(rw http.ResponseWriter, req *http.Request) {
    fmt.Printf(req.URL.Path)
}


The error:

panic: runtime error: invalid memory address or nil pointer dereference
[signal 0xc0000005 code=0x0 addr=0x48 pc=0x401102]

goroutine 1 [running]:
panic(0x6160c0, 0xc0420080a0)
        c:/go/src/runtime/panic.go:500 +0x1af
main.main()
        C:/gowork/src/exc/14.go:20 +0xc2
exit status 2


All I want is to create an http server. And then test it and connect to it from the code. What's wrong with Go? (or with me?)
",1,40713267.0
566,40741357,Prevent package import for 3rd parties,"For my current project I am implementing a code (separate package) to be part of binary which (this package) can also be imported by other projects (binaries) as if it was a library. The reason why such package is not a part of shared library is that it's functionality is tied tightly with the mentioned project.

The problem is this package provides an interface with two implementations 


one with direct access to underlying database which should only be used within the current project
another with HTTP request to be imported in other projects (HTTP requests going to current project)


My question is: is there a mechanism in Go how to prevent certain part of package or it's sub-package from being imported by another projects?

It's mostly just an aesthetic issue since the DB-accessing implementation won't work at all (throwing errors) when used outside of current project.
",1,40741632.0
567,40800343,How do I use file descriptor 4 (or its equivalent) on Windows?,"I've been writing a Go server that acts as the child process of a chunk of Node.js.

package main

import (
    ""bufio""
    ""encoding/json""
    ""fmt""
    ""os""
)

// IPC delimiter
const EOT byte = 3

func main() {
    // Listen on stdin for messages sent from the parent process.
    reader := bufio.NewReader(os.Stdin)
    for {
        input, err := reader.ReadString(EOT)
        if err != nil {
            fmt.Printf(""sockets: failed to read from stdin: %v"", err)
            if err == io.EOF {
                return
            }

            continue
        }

        // Strip EOT bye
        input = input[:len(input) - 1]

        var payload Payload
        if err := json.Unmarshal([]byte(input), &payload); err != nil {
            fmt.Printf(""sockets: failed to read from stdin: %v"", err)
            continue
        }
    }
}


However, using stdin/stdout like this prevents this piece of the code from being able to log to console, as the parent process is using stdouts handle. Ideally I'd use file descriptor 4 for this to take advantage of how Node uses it, Only problem with this is I'm clueless with the nitty gritty details of Windows. How might I be able to use the equivalent (if any) of /dev/fd/4 for IPC on Windows?

PS: if there's a better way to handle reading from stdin, that would also help me a lot.
",1,
568,40832472,Converting datetime OctetString to human readable string in GoLang,"How to convert Datetime Octetstring to ASCII. I read through one of the example in python netsnmp but still not able to solve it.

This is what I received from gosnmp as slice of []uint8

[7 224 1 28 20 5 42 0 43 0 0]


or Go-syntax representation of the value

[]byte{0x7, 0xe0, 0x1, 0x1c, 0x14, 0x4, 0x2a, 0x0, 0x2b, 0x0, 0x0}


And output in datetime should be something like this:

2015-10-7,17:23:27.0,+0:0


here is the mibs:oid: HOST-RESOURCES-MIB::hrSWInstalledDate

Can someone give me some idea on how to use binary to decode that into human readable ascii or strings.
",1,40833102.0
569,40843808,Unit test coverage with huge string length in Go?,"In some code I have a test ensuring that a string length is smaller than 2^32. But it is difficult to test since generating a bigger string for testing would probably crash the test program with an out of memory error.

How may I achieve 100% test coverage but still testing for such case just to be safe?
",1,40843976.0
570,40864840,How to get the json field names of a struct in golang?,"What is the way to get the json field names of this struct ?

type example struct {
    Id          int `json:""id""`
    CreatedAt   string `json:""created_at""`
    Tag         string `json:""tag""`
    Text        string `json:""text""`
    AuthorId    int `json:""author_id""`
}


I try to print the fields with this function :

func (b example) PrintFields() {
    val := reflect.ValueOf(b)
    for i := 0; i < val.Type().NumField(); i++ {
        fmt.Println(val.Type().Field(i).Name)
    }
}


Of course I get :

Id
CreatedAt
Tag
Text
AuthorId


But I would like something like :

id
created_at
tag
text
author_id

",4,40865028.0
571,40939261,Golang parse strange date format,"I'm working on a Parser which Parses log files from a game so I can do analysis on auctions made within the game, however the date format that's being written by the logger seems to be causing problems as the format seems to be custom written for the logger, an example datetime stamp looks like: [Wed Nov 23 23:26:10 2016] I try to Parse it with:

func (r *AuctionReader) extractSaleInformation(line string) {
    fmt.Println(""Extracting information from: "", line)

    // Format mask for output
    layout := ""DD-MM-YYYY hh:mm:ss""

    // Replace the square brackets so we're just left with the date-time string
    date := strings.TrimSpace(strings.Replace((strings.Split(line, ""]"")[0]), ""["", """", -1))

    fmt.Println(time.Parse(date, layout))
}


When I attempt to Parse the above date-time string I get the following error:


  0001-01-01 00:00:00 +0000 UTC parsing time ""DD-MM-YYYY hh:mm:ss"" as ""Wed Nov 23 23:26:10 2016"": cannot parse ""DD-MM-YYYY hh:mm:ss"" as ""Wed Nov ""


How am I able to get the parser to recognise this seemingly custom format, I will be saving this data to Mongo so I don't want to store the auction time as a string as I want to query the timestamps individually.
",1,40939364.0
572,40945136,Stop highlighting trailing whitespace for Go files in Vim,"For some reason it seems the default for vim with Go files is to highlight trailing whitespace in red. In a way this is nice, but mostly I find it annoying because every time I type a space it starts as a red highlight. Is there a way to stop this behavior? I've only experienced this with Go files. Below is my vimrc, but I don't think I put anything there that would affect it.

set nocompatible
syntax on
set autoindent
set tabstop=4 softtabstop=0
autocmd FileType go set tabstop=8 softtabstop=0
set formatoptions=tcroql
set relativenumber
set incsearch
set hlsearch
set smartindent
filetype indent on

",1,40945424.0
573,40949178,Where to put shared code for tests in a Go package?,"I have a Go package with multiple files. As of Go standard I am creating an associated test file for each source file in the package. 

In my case the different tests use the same test helping functions. I don't want these functions to be in the package source files because it is only used for testing purpose. I also would like avoiding replicating this code in each test file. 

Where should I put this code shared between all the test source files and not part of the package ?
",1,40949505.0
574,41009376,"""go get golang.org/x/tools/go/gcimporter15"" fails on undefined identifiers","I'm trying to make a program dependent upon gcimporter15 for Go, and so I'm using the command ""go get golang.org/x/tools/go/gcimporter15"", but it fails with the error:

# golang.org/x/tools/go/gcimporter15
../../go/src/golang.org/x/tools/go/gcimporter15/bexport.go:557: undefined: constant.ToFloat
../../go/src/golang.org/x/tools/go/gcimporter15/gcimporter.go:396: pkg.SetName undefined (type *types.Package has no field or method SetName)


That appears to me that there is an error within gcimporter itself, but that doesn't make sense that I would get this when it doesn't appear that others are. Why isn't it working?

I'm using Go 1.5.3.
",2,
575,41028709,Only accept HTTP connections from Localhost in Go?,"I have a simple HTTP Server standing up in Golang: 

h := http.NewServeMux()
h.Handle(""/somepath"", MyHandler)

s := &http.Server{
    Addr:    ""1234"",
    Handler: h,
}   

s.ListenAndServe();


What is the best way to drop connections where the caller is not localhost?  Currently I'm considering inspecting the underlying connection information and ensuring that the IP Address is 127.0.0.1, but this wastes a whole lot of resources (and runs through a whole bunch of Go code) before ultimately dropping the connection.  Ideally, I can instrument the Golang server to drop the initial TCP SYN packet based on IP Address, and not create a TCP connection at all (or reveal that this port is listening).

What's the cleanest path forward here?
",1,41034423.0
576,41061803,App Engine go context.Context has no namespace,"After obtain a context from ctx, ctxErr := appengine.Namespace(ctx, ""MyContext"") I would expect ctx namespace to be populated with MyContext 

Code

import (
...
""golang.org/x/net/context""
""google.golang.org/appengine""
)


ctx := appengine.NewContext(r)
ctx, ctxErr := appengine.Namespace(ctx, ""MyContext"")
if ctxErr != nil {
  log.Errorf(ctx, ""Failed to obtain custom namespace context, error:%s"", ctxErr.Error())
  //use default if all else fails
  ctx = appengine.NewContext(r)
}


However this is not the case, thus causing all namespace aware API to use default namespace.

Dump of ctx produces the following (see yellow bordered output)



Example App

Populate projectID := """" with your project id, ensure you have performed authentication on your development environment and run go run /example/app/main.go

Example App
",1,41132011.0
577,41104049,How to deserialize a non-standard size field?,"I have to deserialize some binary messages coming from another application. I would love to use restruct.io but some fields in the message structure use a ""non-standard"" number of bits ( 5 bits, 3 bits, ... 10 bits ... ).

Is there any way to handle this type of structs? I have been searching for some time without any success so any help will be very welcomed. 

thanks in advance

I wil try to give an example to clarify my question. Given the code: 

package main

import (
    ""encoding/binary""
    ""fmt""

    restruct ""gopkg.in/restruct.v1""
)

type MessageType uint8

const (
    MessageTypeOne MessageType = iota + 1
    MessageTypeTwo
    MessageTypeThree
)

// Message is the data to deserialize from the binary stream
type Message struct {
    Length     uint32      `struct:""uint32""` // message size in bytes (including length)
    Type       MessageType `struct:""uint8""`
    Version    uint8       `struct:""uint8:4""` // Just need 4 bits
    Subversion uint8       `struct:""uint8:2""` // just need 2 bits
    Optional   uint8       `struct:""uint8:1""` // just one bit --> '1' means next field is NOT present
    NodeName   string      ``
    ANumber    uint16      `struct:""uint16:10""` // just need 10 bits
}

// (length(4)+type(1)+(version(4bits)+Subversion(2bits)+Optional(1bit))) = 6 bytes
// need 32bit alignment
func main() {
    var inStream = []byte{0x08, // just 8 bytes needed
        0x01,       // messge type = MessageTypeOne
        0x4a,       // Version=0100 Subversion=10 Optional=1 ANumber = 0 (MSB bit)
        0x00, 0x60, // ANumber(000 0000 011) Padding = 0 0000 for 32 bits alignment
    }
    var msg Message

    err := restruct.Unpack(inStream, binary.BigEndian, &msg)
    if err != nil {
        panic(err)
    }
    fmt.Println(msg)
    // Expected:
    // msg.Length = 8
    // msg.Type = 1
    // msg.Version = 4
    // msg.Subversion = 2
    // msg.Optional = 1
    // msg.NodeName = """"
    // msg.ANumber = 3
}


I will receive inStream from a TCP connection and will want to deserialize the binary data and get a Message struct with the expected values ... 

Hope this will clarify my question.

Thanks again ;)
",2,41721291.0
578,41157259,Unmarshall nested interface{} into user supplied struct pointer,"I've got a Set function that wraps a users object (or variable) in my own struct called sessions. It assigns it to the Value field of my sessions struct. The Set function then marshalls this struct and assigns the string somewhere in storage. 

My problem is that I'm not sure how to implement my Get function to only return the unmarshalled struct stored in the Value field, opposed to the entire sessions wrapper struct.

I've made a very simple example demonstrating what I'm talking about.

I can't use a type assertion in the assignment in my Get func because I don't know what type the user is going to use in advance.

I suspect there may be a way using reflection to accomplish this?

Edit: The two provided answers so far are not what I'm looking for. I do not know what type the user will be using, it could be anything, so coding around that by hard coding their type or trying to ""guess"" what it may contain is not going to work.
",3,
579,41238879,strconv.ParseInt gives 0,"I'm trying to parse a file of this forme:

12
0,1,2,3,1,2,3,4,2,3,4,5
1,0,1,2,2,1,2,3,3,2,3,4
2,1,0,1,3,2,1,2,4,3,2,3
3,2,1,0,4,3,2,1,5,4,3,2
1,2,3,4,0,1,2,3,1,2,3,4
2,1,2,3,1,0,1,2,2,1,2,3
3,2,1,2,2,1,0,1,3,2,1,2
4,3,2,1,3,2,1,0,4,3,2,1
2,3,4,5,1,2,3,4,0,1,2,3
3,2,3,4,2,1,2,3,1,0,1,2
4,3,2,3,3,2,1,2,2,1,0,1
5,4,3,2,4,3,2,1,3,2,1,0
0,5,2,4,1,0,0,6,2,1,1,1
5,0,3,0,2,2,2,0,4,5,0,0
2,3,0,0,0,0,0,5,5,2,2,2
4,0,0,0,5,2,2,10,0,0,5,5
1,2,0,5,0,10,0,0,0,5,1,1
0,2,0,2,10,0,5,1,1,5,4,0
0,2,0,2,0,5,0,10,5,2,3,3
6,0,5,10,0,1,10,0,0,0,5,0
2,4,5,0,0,1,5,0,0,0,10,10
1,5,2,0,5,5,2,0,0,0,5,0
1,0,2,5,1,4,3,5,10,5,0,2
1,0,2,5,1,0,3,0,10,0,2,0


Where the first line give us the size of the matrix: n x n
The n-following lines are the matrix D. Then the n-following lines are the matrix W. So there is 2n + 1 lines.

Here is the code to parse it and put it in variables.

func readFile(path string) (int64, Matrix, Matrix) {
    // open the file
    f, _ := os.Open(path)
    defer f.Close()

    // init the new reader on the opened file
    r := bufio.NewReader(f)

    // we get the n value
    line, _ := r.ReadString('\n')
    splitedLine := strings.Fields(line)
    tmp, _ := strconv.ParseInt(splitedLine[0], 10, 64)
    n := int64(tmp)

    // we init the matrix W and D
    D := Matrix{}
    D.matrix = make([][]int64, n)
    for i, _ := range D.matrix {
        D.matrix[i] = make([]int64, n)
    }

    W := Matrix{}
    W.matrix = make([][]int64, n)
    for i, _ := range W.matrix {
        W.matrix[i] = make([]int64, n)
    }

    // loop on the n first element
    iter := int64(0)
    for iter < n {
        // we get the n following elements
        line, _ = r.ReadString('\n')
        for index, ele := range strings.Split(line, "","") {
            D.matrix[iter][index], _ = strconv.ParseInt(ele, 10, 64)
        }
        iter++
    }

    iter = 0
    for iter < n {
        // we get the n following elements
        line, _ = r.ReadString('\n')
        for index, ele := range strings.Split(line, "","") {
            W.matrix[iter][index], _ = strconv.ParseInt(ele, 10, 64)
        }
        iter++
    }

    return n, W, D

}


The resultat for W should be like:

[ 0.,  1.,  2.,  3.,  1.,  2.,  3.,  4.,  2.,  3.,  4.,  5.],
[ 1.,  0.,  1.,  2.,  2.,  1.,  2.,  3.,  3.,  2.,  3.,  4.],
[ 2.,  1.,  0.,  1.,  3.,  2.,  1.,  2.,  4.,  3.,  2.,  3.],
[ 3.,  2.,  1.,  0.,  4.,  3.,  2.,  1.,  5.,  4.,  3.,  2.],
[ 1.,  2.,  3.,  4.,  0.,  1.,  2.,  3.,  1.,  2.,  3.,  4.],
[ 2.,  1.,  2.,  3.,  1.,  0.,  1.,  2.,  2.,  1.,  2.,  3.],
[ 3.,  2.,  1.,  2.,  2.,  1.,  0.,  1.,  3.,  2.,  1.,  2.],
[ 4.,  3.,  2.,  1.,  3.,  2.,  1.,  0.,  4.,  3.,  2.,  1.],
[ 2.,  3.,  4.,  5.,  1.,  2.,  3.,  4.,  0.,  1.,  2.,  3.],
[ 3.,  2.,  3.,  4.,  2.,  1.,  2.,  3.,  1.,  0.,  1.,  2.],
[ 4.,  3.,  2.,  3.,  3.,  2.,  1.,  2.,  2.,  1.,  0.,  1.],
[ 5.,  4.,  3.,  2.,  4.,  3.,  2.,  1.,  3.,  2.,  1.,  0.]


But when I print it; it gives me :

[0 1 2 3 1 2 3 4 2 3 4 0]
[1 0 1 2 2 1 2 3 3 2 3 0]
[2 1 0 1 3 2 1 2 4 3 2 0]
[3 2 1 0 4 3 2 1 5 4 3 0]
[1 2 3 4 0 1 2 3 1 2 3 0]
[2 1 2 3 1 0 1 2 2 1 2 0]
[3 2 1 2 2 1 0 1 3 2 1 0]
[4 3 2 1 3 2 1 0 4 3 2 0]
[2 3 4 5 1 2 3 4 0 1 2 0]
[3 2 3 4 2 1 2 3 1 0 1 0]
[4 3 2 3 3 2 1 2 2 1 0 0]
[5 4 3 2 4 3 2 1 3 2 1 0]


I don't know why.
Thanks for your reply.
",1,41239174.0
580,41250130,byte[] channel usage in golang,"I am new with golang channels and have a strange behavior I cannot explain.
I am getting a REST command, and want to calculate hash function on it's body.
To do so I read the body using io.TeeReader(request.Body, &writerToHash) where I pass my own class that implements io.Writer:

func (self *WriterToHash) Write(p []byte) (n int, err error) {
    n=len(p)
    fmt.println(""WriterToHash  len=%v, buff=%v"", n, p)  //PRINT 1
    self.BodyChannel <- p
    return n, nil
}


The BodyChannel is defined: BodyChannel chan []byte

I use this class as follows:

    writerToHash := sisutils.WriterToHash{
        BodyChannel:make(chan []byte, 1024)
    }
    writerToHash.StartListen()
    reqnew, _ := http.NewRequest(""PUT"", url, io.TeeReader(request.Body, &writerToHash))


Listening part:

func (wth *WriterToHash) StartListen() {
    wth.OutChannel = make(chan []byte, 1000)
    go func (self *WriterToHash) {
        done := int64(0)
        h := sha1.New()
        for done < MessageSize{
            buff := <- self.BodyChannel

            done += int64(len(buff))
            DPrint(5, ""AccamulateSha1 Done=: %v, buff=%v"", done, buff)  //PRINT 2

            actually_write, err := h.Write(buff)
            if err != nil ||  actually_write != len(buff) {
                log.Println(""Error in sha write:"" + err.Error())
                break
            }
        }
        bs := h.Sum(nil)
        self.OutChannel <- bs
    }(wth)
 }


I send messages of 1000 bytes. In debug mode the message is always split in the same way: 1 byte, 999 bytes - I see it using PRINT 1. In this case everythong works fine.
The problem is that when the message is split to more parts in the Write function. In this case I see in PRINT1:

[first byte] : a

[next ~450 bytes] : b,c,d,...

[last ~550 bytes] : w,x,y,...

but in PRINT 2 I see different picture:

[first byte] : a

[ ~450 bytes but starting where last part starts] : w,x,y...

[last ~550 bytes] : w,x,y,...

I actually get the last past twice but not in the same size.

I have no idea why this is happening and will appreciate any help.
",1,41250437.0
581,41266630,Is there an idiomatic go way to print string pointer contents or nil?,"I have a string pointer that may or may not be nil, and I want to print out either the contents of the string if contents exist, or indicate that the pointer is nil if it is nil.  Is there a clever way to do this that doesn't involve either an if check or a temporary variable (preferably a single line)?

Right now I'm using something like this:

if p == nil {
    fmt.Print(p)
} else {
    fmt.Print(*p)
}


But this is particularly awkward and verbose when there is other formatting and other variables that are intended to be printed before and/or after that value.
",1,41267045.0
582,41297410,Build errors in datastore while using golang/protobuf,"I have an application which uses both bigquery and cloud datastore APIs. I use glide for go package management. I keep seeing build errors with either bigquery or datastore depending upon the version of golang/protobuf that I use. I am not able to find a version that is compatible with both bigquery and datastore. Either one of the packages keeps failing to build.

Build errors in datastore while using golang/protobuf version 7cc19b78d562895b13596ddce7aafb59dd789318:


  ../../vendor/google.golang.org/genproto/googleapis/api/annotations/annotations.pb.go:33:
  undefined: proto.ProtoPackageIsVersion2
  ../../vendor/google.golang.org/genproto/googleapis/api/annotations/annotations.pb.go:41:
  unknown proto.ExtensionDesc field 'Filename' in struct literal
  ../../vendor/google.golang.org/genproto/googleapis/api/annotations/annotations.pb.go:48:
  undefined: proto.RegisterFile
  ../../vendor/google.golang.org/genproto/googleapis/api/annotations/http.pb.go:540:
  undefined: proto.RegisterFile Build errors in bigquery while using
  golang/protobuf version 8ee79997227bf9b34611aee7946ae64735e6fd93:
  
  ../../vendor/cloud.google.com/go/bigquery/params.go:55: undefined:
  bigquery.QueryParameterType
  ../../vendor/cloud.google.com/go/bigquery/params.go:56: undefined:
  bigquery.QueryParameterType
  ../../vendor/cloud.google.com/go/bigquery/params.go:57: undefined:
  bigquery.QueryParameterType
  ../../vendor/cloud.google.com/go/bigquery/params.go:58: undefined:
  bigquery.QueryParameterType
  ../../vendor/cloud.google.com/go/bigquery/params.go:59: undefined:
  bigquery.QueryParameterType
  ../../vendor/cloud.google.com/go/bigquery/params.go:60: undefined:
  bigquery.QueryParameterType
  ../../vendor/cloud.google.com/go/bigquery/params.go:61: undefined:
  bigquery.QueryParameterType
  ../../vendor/cloud.google.com/go/bigquery/params.go:94: undefined:
  bigquery.QueryParameter
  ../../vendor/cloud.google.com/go/bigquery/params.go:110: undefined:
  bigquery.QueryParameterType
  ../../vendor/cloud.google.com/go/bigquery/params.go:178: undefined:
  bigquery.QueryParameter


Opened an issue here - https://github.com/GoogleCloudPlatform/google-cloud-go/issues/475. Any pointers would be appreciated. 
",1,41302818.0
583,41332454,Initializing embedded struct when no control over parent initialization,"I have a struct such:

type Parent struct {
  *WithContext
}

type WithContext struct {
  Ctx context.Context
}

func (wi *WithContext) SetContext(ctx context.Context) {
  // nil pointer
  wi.Ctx = ctx
}


Parent is initialized by some automated process (as apart of unmarshalling flow), so I cannot initialize the embedded WithContext struct,

Is there any way to avoid the nil pointer in the 'SetContext' func ? I tried overriding the pointer receiver but it doesn't have any effect,

Thanks,

Asaf.
",1,
584,41366347,go loadPage issue: invalid memory address or nil pointer dereference,"I'm following the golang.org tutorial on building a wiki page (https://golang.org/doc/articles/wiki/#tmp_4) and everything runs fine until I've gotten the above error message during step ""Using net/http to serve wiki pages"". I've got a text.txt file in src/github.com/user/gowiki/test.txt but loadPage(title) doesn't seem to be accessing the test.txt file. Any help is greatly appreciated.  Thanks!

   package main

import (
    ""fmt""
    ""io/ioutil""
    ""net/http""
)

type Page struct {
    Title string
    Body  []byte
}

func (p *Page) save() error {
    filename := p.Title + "".txt""
    return ioutil.WriteFile(filename, p.Body, 0600)
}

func loadPage(title string) (*Page, error) {
    filename := title + "".txt""
    body, err := ioutil.ReadFile(filename)
    if err != nil {
        return nil, err
    }
    return &Page{Title: title, Body: body}, nil
}

func viewHandler(w http.ResponseWriter, r *http.Request) {
    title := r.URL.Path[len(""/view/""):]
    p, _ := loadPage(title)
    fmt.Fprintf(w, ""%s%s"", p.Title, p.Body)
}

func main() {
    http.HandleFunc(""/view/"", viewHandler)
    http.ListenAndServe("":8080"", nil)
}

",1,41366470.0
585,41422187,Precompiling part of Go program that relies on C for speed,"Part of my Go program relies on a very large C codebase using import ""C"" that takes a few minutes to compile. Is there any way to precompile per-se that C library or create a branch of my Go program that will be precompiled along with the C code so that each time I compile the main program I don't have to wait for the entire C library to re-compile each time?
",1,
586,41423272,golang: optimal sorting and joining strings,"This short method in go's source code has a comment which implies that it's not allocating memory in an optimal way.


  ... could do better allocation-wise here ...


This is the source code for the Join method.

What exactly is inefficiently allocated here? I don't see a way around allocating the source string slice and the destination byte slice. The source being the slice of keys. The destination being the slice of bytes.
",1,41424677.0
587,41456777,How to build a Postgres extension using cgo,"Here is what I'm doing right now,

.
├── helloworld--1.0.sql
├── helloworld.control
├── helloworld.go
└── Makefile


helloworld.go :

package helloworld

/*
#cgo LDFLAGS: -rdynamic
#include ""postgres.h""
#include ""fmgr.h""
#include ""utils/builtins.h""

PG_MODULE_MAGIC;

PG_FUNCTION_INFO_V1(helloworld);
PG_FUNCTION_INFO_V1(hello_text_arg);
PG_FUNCTION_INFO_V1(hello_ereport);

Datum
hello_world(PG_FUNCTION_ARGS)
{
    PG_RETURN_TEXT_P(cstring_to_text(""Hello, World!""));
}

Datum
hello_text_arg(PG_FUNCTION_ARGS)
{
    text *hello     = cstring_to_text(""Hello, "");
    int32 hello_sz  = VARSIZE(hello) - VARHDRSZ;

    text *name      = PG_GETARG_TEXT_P(0);
    int32 name_sz   = VARSIZE(name) - VARHDRSZ;

    text *tail      = cstring_to_text(""!"");
    int32 tail_sz   = VARSIZE(tail) - VARHDRSZ;

    int32 out_sz    = hello_sz + name_sz + tail_sz + VARHDRSZ;
    text *out       = (text *) palloc(out_sz);

    SET_VARSIZE(out, out_sz);

    memcpy(VARDATA(out), VARDATA(hello), hello_sz);
    memcpy(VARDATA(out) + hello_sz, VARDATA(name), name_sz);
    memcpy(VARDATA(out) + hello_sz + name_sz, VARDATA(tail), tail_sz);

    PG_RETURN_TEXT_P(out);
}

Datum
hello_ereport(PG_FUNCTION_ARGS)
{
    ereport(ERROR, (errcode(ERRCODE_NULL_VALUE_NOT_ALLOWED), errmsg(""null value not allowed"")));

    PG_RETURN_VOID();
}
*/
import ""C""


Makefile :

MODULES = helloworld

EXTENSION = helloworld
DATA = helloworld--1.0.sql
PGFILEDESC = ""helloworld - example extension for postgresql""

REGRESS = helloworld

PG_CONFIG = pg_config
PGXS := $(shell $(PG_CONFIG) --pgxs)
INCLUDEDIR = $(shell $(PG_CONFIG) --includedir-server)
include $(PGXS)

helloworld.so:
    CGO_CFLAGS=""-rdynamic -I$(INCLUDEDIR)"" CGO_LDFLAGS=""-rdynamic $(LDFLAGS)"" go build -v -buildmode=c-shared -o helloworld.so .


It produced these errors when making :

/tmp/go-build019341122/github.com/amosbird/rpctest/helloworld/_obj/helloworld.cgo2.o: In function `hello_world':
helloworld.cgo2.c:(.text+0x48): undefined reference to `cstring_to_text'
/tmp/go-build019341122/github.com/amosbird/rpctest/helloworld/_obj/helloworld.cgo2.o: In function `hello_text_arg':
helloworld.cgo2.c:(.text+0x63): undefined reference to `cstring_to_text'
helloworld.cgo2.c:(.text+0x86): undefined reference to `pg_detoast_datum'
helloworld.cgo2.c:(.text+0xa5): undefined reference to `cstring_to_text'
helloworld.cgo2.c:(.text+0xd7): undefined reference to `palloc'
/tmp/go-build019341122/github.com/amosbird/rpctest/helloworld/_obj/helloworld.cgo2.o: In function `hello_ereport':
helloworld.cgo2.c:(.text+0x1a8): undefined reference to `errstart'
helloworld.cgo2.c:(.text+0x1bd): undefined reference to `errmsg'
helloworld.cgo2.c:(.text+0x1c9): undefined reference to `errcode'
helloworld.cgo2.c:(.text+0x1d7): undefined reference to `errfinish'
collect2: ld returned 1 exit status
make: *** [helloworld.so] Error 2


I have no idea if this would work. There are so many black magic happened here. 

So the main question is, what is the correct Makefile that can be used to build a Postgres extension in cgo?

A specific question to these errors is, what can I do to defer those symbol resolution in cgo's linking process?
",1,41466328.0
588,41492793,How get fast multiple rows in Go?,"I have troubles with performance when I get 20k-50k and more rows from SELECT * FROM table in rows.scan(&a, &b...). I don't know how to use concurrency in this case because I need to use rows.Next() for iterating, and I can't do it in concurrency.

Performance drops only when I scan results from rows to structure's fields in rows.Scan. 

The query takes 5-15 ms, but scanning takes (40k rows) 800-2000ms.

Thank you!
",1,41499772.0
589,41521671,AES-CFB from Go to JS forge,"I'm trying to write a little something that is not secure. The purpose is to encrypt server-side mp3s so they can't be just downloaded with wget or ""save as"" and used by the average Joe.

The idea is on the server side, load the mp3, aes-cfb encrypt it, send the key in the header, send the encrypted mp3 in the response body.

Server side is using Go's stdlib and AES-CFB encryption. As first with base64 encoding, then just plain output of the encrypted []byte-s.

Client side I'm using forge to decrypt. I send a xhr, read the arraybuffer, decrypt using forge and write output to the console.

The content of test.txt is ""this is just a test and maybe it's working maybe not.""

main.go

package main

import (
    ""net/http""
    ""io""
    ""crypto/rand""
    ""os""
    ""crypto/aes""
    ""crypto/cipher""
    ""fmt""
)

var (
    key = ""1234567890123456""
    fn = ""test.txt""
)

func main() {

    http.Handle(""/file/"", http.HandlerFunc(serveFile))
    http.Handle(""/"", http.FileServer(http.Dir(""public"")))
    http.ListenAndServe("":8080"", nil)
}

func serveFile(w http.ResponseWriter, r *http.Request) {
    file, e := os.Open(fn)
    if e != nil {
        fmt.Println(e.Error())
        return
    }
    defer file.Close()
    fi, _ := file.Stat()
    b := make([]byte, fi.Size())
    io.ReadFull(file, b)
    o := AESencrypt([]byte(key), b)
    w.Header().Set(""Access-Control-Allow-Origin"", ""*"")
    //w.Header().Set(""Key"", key)
    fmt.Println(o)
    fmt.Println(len(o))
    w.Write(o)
}

func AESencrypt(key []byte, content []byte) []byte {
    block, err := aes.NewCipher(key)
    if err != nil {
        panic(err)
    }
    ciphertext := make([]byte, aes.BlockSize + len(content))
    iv := ciphertext[:aes.BlockSize]
    if _, err := io.ReadFull(rand.Reader, iv); err != nil {
        panic(err)
    }
    stream := cipher.NewCFBEncrypter(block, iv)
    stream.XORKeyStream(ciphertext[aes.BlockSize:], content)
    return ciphertext
}


index.html




    
    MP3 Player Demo


Load







reader.js

function loadFile(filename) {
    //var context = new AudioContext || new webkitAudioContext();
    var request = new XMLHttpRequest();
    var url = ""http://localhost:8080/file/"";
    request.open(""GET"", url + filename, true);
    request.responseType = ""arraybuffer"";
    request.onload = function () {
        var rt = request.response;
        console.log(rt);
        var decipher = forge.cipher.createDecipher('AES-CFB', forge.util.createBuffer('1234567890123456'));
        decipher.start({iv: forge.util.createBuffer('1234567890123456')});
        decipher.update(forge.util.createBuffer(rt));
        decipher.finish();
        console.log(decipher.output);
        console.log(decipher.output.bytes());
        console.log('--------------');
    };

    request.send();
}


The result is weird.

It is ""properly"" decrypted however there's a prefix or garbage of random length with each decrypted result.

3 outputs:

ArrayBuffer { byteLength: 69 }  reader.js:10:9
Object { data: ""3~æÿK¥=®ªÿÂßthis is just a test…"", read: 0, _constructedStringLength: 69 }  reader.js:16:9
3~æÿK¥=®ªÿÂßthis is just a test and maybe it's working maybe not.  reader.js:17:9
--------------  reader.js:18:9
ArrayBuffer { byteLength: 69 }  reader.js:10:9
Object { data: ""ÅJÇ9Ë54«ÚV«this is just a test…"", read: 0, _constructedStringLength: 69 }  reader.js:16:9
ÅJÇ9Ë54«ÚV«this is just a test and maybe it's working maybe not.  reader.js:17:9
--------------  reader.js:18:9
ArrayBuffer { byteLength: 69 }  reader.js:10:9
Object { data: ""ªÕxïÂ`zqA   \cýx#this is just a test…"", read: 0, _constructedStringLength: 69 }  reader.js:16:9
ªÕxïÂ`zqA   \cýx#this is just a test and maybe it's working maybe not.  reader.js:17:9
--------------  reader.js:18:9


The output here is truncated but it's the same is the test.txt . As you can see it's always prefixed with random garbage.

What am I doing wrong? Is the forge implementation of AES-CFB wrong or Go's? Why are they incompatible? Or why is it that the decryption differs? And if AES-CFB is a standard why are there different implementations?

I also tried gopherjs as an alternative and that works just fine but a) the code size is too big (~3.7MB) and b) I wouldn't know how to play back the decrypted audio using gopherjs. But that's just as an aside.
",1,41522547.0
590,41612944,Generalization in structs - golang,"I have this function to read a JSON file into a Driver struct:

func getDrivers() []Driver {
    raw, err := ioutil.ReadFile(""/home/ubuntu/drivers.json"")
    if err != nil {
        fmt.Println(err.Error())
        os.Exit(1)
    }

    var d []Driver
    json.Unmarshal(raw, &d)
    return d
}


How can I change this function to also work with a Pilot struct?
I tried using []interface{} without success.

Thank you 
",1,41613108.0
591,41616043,How to convert bson.Binary to []byte in Go,"I'm writing a small application that receives message in BSON format from network(its not MongoDB) and have to save fields in files on local machine. I'm using gopkg.in/mgo.v2/bson for message unmarshaling and it works fine.

Almost everything works except one. There ""userdefined"" binary field in message and I have to save it to separate file. I tried to use:

var pwr = msg[""pwr""].([]byte)


but got an ""error panic: interface conversion: interface is bson.Binary, not []uint8"".

Can some one point me an example how to convert bson.Binary to []byte, so I can save it to file.
",1,41665303.0
592,41647788,How to replace string in Go template?,"I use ""text/template"" module.

I have struct like this to parse XML from Blogger

type Media struct {
    ThumbnailUrl string `xml:""url,attr""`
}


type Entry struct {
    ID string `xml:""id""`
    Published Date `xml:""published""`
    Updated Date `xml:""updated""`
    Draft Draft `xml:""control>draft""`
    Title string `xml:""title""`
    Content string `xml:""content""`
    Tags Tags `xml:""category""`
    Author Author `xml:""author""`
    Media Media `xml:""thumbnail""`
    Extra string
}


Then I create Go Template like this

[image]
    src = ""{{ replace .Media.ThumbnailUrl 's72-c' 's1600' }}""
    link = """"
    thumblink = ""{{ .Media.ThumbnailUrl }}""
    alt = """"
    title = """"
    author = """"
    license = """"
    licenseLink = """"


The replace function not defined. I want to replace URL from {{ .Media.ThumbnailUrl }}

For example:

from this URL

https://2.bp.blogspot.com/-DEeRanrBa6s/WGWGwA2qW5I/AAAAAAAADg4/feGUc-g9rXc9B7hXpKr0ecG9UOMXU3_VQCK4B/s72-c/pemrograman%2Bjavascript%2B-%2Bpetanikode.png

To this URL

https://2.bp.blogspot.com/-DEeRanrBa6s/WGWGwA2qW5I/AAAAAAAADg4/feGUc-g9rXc9B7hXpKr0ecG9UOMXU3_VQCK4B/s1600/pemrograman%2Bjavascript%2B-%2Bpetanikode.png
",1,41647898.0
593,41725118,Why does this binary tree search take so much longer than an insertion?,"I'm trying to learn/understand some basic algorithms, and today I decided to write a binary tree in Go. This is what the structure looks like:

type Node struct {
  Value int
  Left  *Node
  Right *Node
}


Here's my function to check if the tree contains an int:

func (tree *Node) Contains(val int) bool {
  if val == tree.Value {
    return true
  } else if val > tree.Value {
    if tree.Right != nil {
      return tree.Right.Contains(val)
    } else {
      return false
    }
  } else if val < tree.Value {
    if tree.Left != nil {
      return tree.Left.Contains(val)
    } else {
      return false
    }
  } else { // huh
    return false
  }
}


I wrote a test function to test how long different operations on the tree take. It takes my Insert() function 34ms to insert 100,000 random integers, and it takes my Contains() function 33ms to check if the tree contains 100,000  random integers. If I bump the number of random integers up to 1,000,000, it takes my Insert() function 34ms to run, but my Contains() function suddenly takes 321ms to run.

Why does Contains() run time increase so drastically, while Insert() stays practically the same?
",1,41725497.0
594,41728874,Go language use internal structures from C,"I would like to be able, in Go, to translate one host address (let's use 'www.google.be') to a sockaddr structure and then use it from a C code. 

Translating the host address to a sockaddr_any structure isn't too hard using the http://github.com/jbenet/go-sockaddr module. My code works and is the following: 

ipAddr, _ := net.ResolveIPAddr(""ip"", ""www.google.be"")
sockAddr := sockaddrnet.IPAddrToSockaddr(ipAddr)
rawSockaddr, socklen, _ := sockaddr.SockaddrToAny(sockAddr)
cStruct := sockaddr.AnyToCAny(rawSockaddr)
C.printPointer(cStruct)


But, I'm not able to use this *sockaddr.C.struct_sockaddr_any variable: cStruct, from my C code (it has incomplete definition, so I can't use any of its fields), which is the following: 

// #include 
// void printPointer(struct sockaddr_any *p){
//     printf("":: %p :: "", p); 
//     // How to use P as a sockaddr? 
// }
import ""C""


sockaddr_any is defined in the core of the Go language (from https://golang.org/src/syscall/types_linux.go). So, I believe it should be linked by default with my C code. But, it seems not to be true. Does someone know what line could I use to include headers from the go language itself (here the syscall structures). 

Thank you very much
",2,
595,41733469,build google/gxui samples error on mac,"I git clone code from github.com/google/gxui
and then 


  cd samples/hello_word
  
  GOOS=windows go build


an error  occurred
it says


  /d01/gopath/src/github.com/goxjs/gl/gl_opengl.go:10:2: no buildable Go
  source files in /d01/gopath/src/github.com/go-gl/gl/v2.1/gl
  /d01/gopath/src/github.com/goxjs/glfw/desktop.go:10:2: no buildable Go
  source files in /d01/gopath/src/github.com/go-gl/glfw/v3.2/glfw


I try to 


  go get -u github.com/go-gl/gl/v2.1/gl go get -u
  github.com/go-gl/glfw/v3.2/glfw


no error  occurred

I try to run again


  GOOS=windows go build


The problem has not been solved
",1,
596,41784825,How to add 1 sec to the date in golang?,"How to add 1 sec to the date in golang ? I have: 

t := time.Now().Format(""2006/02/01 03:04:05"")


and want something like below but so far getting mismatched types string and time.Duration error

t1, t2, t3 = t + 1*time.Second, t+3*time.Second, t+2*time.Second

",2,41785015.0
597,41789498,golang gorm many to many back reference,"I have this models, many-to-many, and I'd like to get all the Gifs that matches a list of Tags.

type Tag struct {
    ID      uint    `gorm:""primary_key"" json:""id,omitempty""`
    Name    string  `gorm:""not null;unique"" json:""name,omitempty""`
}
type Gif struct {
    ID      uint    `gorm:""primary_key"" json:""id,omitempty""`
    Url     string `gorm:""not null;unique"" json:""url,omitempty""`
    Tags    []Tag `gorm:""many2many:gif_tags;"" json:""tags,omitempty""`
}


I prepared a playground here.

If I have an array of Tags containing tag1 and tag2, I'd like to get gif1 and gif2 in &gifs.  

I read the documentation many times and found only the opposite of my question, i.e. fetching the tags for a given gif.

Do I need to change my models?
Is it possible to set up two Associations fields in a many-to-many relation?
",1,
598,41858635,Segmentation violation with golang channels,"The below code opens 10,000 go routines, which make HTTP calls, get the response, close the response, and write to a channel with an ID. 

In the second for loop, it prints out from that buffered channel the ID of the previous go routine.

This causes a segmentation violation, and I can't figure out why.

Panic:

panic: runtime error: invalid memory address or nil pointer dereference
[signal SIGSEGV: segmentation violation code=0x1 addr=0x40 pc=0x2293]


Code:

package main

import (
    ""fmt""
    ""net/http""
)

func main() {
    requests := 10000
    ch := make(chan string, requests)
    for i := 1; i <= requests; i++ {
        go func(iter int) {
            fmt.Println(iter)
            resp, _ := http.Get(""http://localhost:8080/api/project"")
            resp.Body.Close()
            ch <- fmt.Sprint(""%i"", iter)
        }(i)
    }
    for i := 1; i <= requests; i++ {
        fmt.Println(<-ch)
    }
}

",1,41858792.0
599,41887596,Golang map sort,"I have this code: https://play.golang.org/p/ubwUH1llxc
This map will be update. Append new var and delete.

Sometime it print:

1 One

6 two

3 Three

5 Four

And can print:

5 Four

6 two

3 Three

1 One

Why it print that?
How I can print by newest? I don't use array for order, because element, that before need element, can be delete earlie. And I worry, that it delete another element.
",1,
600,41894046,How to spawn n-k light-process in erlang or elixir?,"In Go I can create goroutines like this (EDITED as reported by kelu-thatsall's answer):

// test.go
package main

import (
        ""fmt""
        ""os""
        ""strconv""
        ""sync""
        ""runtime""
)

func main() {
        var wg sync.WaitGroup
        if len(os.Args) < 2 {
                os.Exit(1)
        }
        k, ok := strconv.Atoi(os.Args[1])
        if ok != nil {
                os.Exit(2)
        }
        wg.Add(k * 1000)
        for z := 0; z < k*1000; z++ {
            go func(x int) {
                    defer wg.Done()
                    fmt.Println(x)
            }(z)
            if z%k == k-1 {
                // @mattn: avoid busy loop, so Go can start processing like BEAM do 
                runtime.Gosched() 
            }
        }
        wg.Wait()
}


The result in Go 1.8.0 (64-bit):

# shell    
$ go build test.go ; for k in 5 50 500 5000 50000 500000; do echo -n $k; time ./test $k > /dev/null; done

5
CPU: 0.00s      Real: 0.00s     RAM: 2080KB
50
CPU: 0.06s      Real: 0.01s     RAM: 3048KB
500
CPU: 0.61s      Real: 0.12s     RAM: 7760KB
5000
CPU: 6.02s      Real: 1.23s     RAM: 17712KB # 17 MB
50000
CPU: 62.30s     Real: 12.53s    RAM: 207720KB # 207 MB
500000
CPU: 649.47s    Real: 131.53s   RAM: 3008180KB # 3 GB


What's the equivalent code in Erlang or Elixir? (EDITED as reported by patrick-oscity's comment)

What I've tried so far is the following:

# test.exs
defmodule Recursion do
  def print_multiple_times(n) when n <= 1 do
    spawn fn -> IO.puts n end
  end

  def print_multiple_times(n) do
    spawn fn -> IO.puts n end
    print_multiple_times(n - 1)
  end
end

[x]=System.argv()
{k,_}=Integer.parse(x)
k=k*1000
Recursion.print_multiple_times(k)


The result in elixir 1.4.2 (erts-8.2.2):

# shell    
$ for k in 5 50 500 5000 50000 ; do echo -n $k; time elixir --erl ""+P 90000000"" test.exs $k > /dev/null; done

5
CPU: 0.53s      Real: 0.50s     RAM: 842384KB # 842 MB
50
CPU: 1.50s      Real: 0.62s     RAM: 934276KB # 934 MB
500
CPU: 11.92s     Real: 2.53s     RAM: 1675872KB # 1.6 GB
5000
CPU: 122.65s    Real: 20.20s    RAM: 4336116KB # 4.3 GB
50000
CPU: 1288.65s   Real: 209.66s   RAM: 6573560KB # 6.5 GB


But I'm not sure if the two are equivalent. Are they ?

EDIT Shortened version as mudasobwa's comment does not give correct output

# test2.exs
[x]=System.argv()
{k,_}=Integer.parse(x)
k=k*1000
1..k |> Enum.each(fn n -> spawn fn -> IO.puts n end end)


The result for k in 5 50 500 5000 50000 ; do echo -n $k; time elixir --erl ""+P 90000000"" test.exs $k | wc -l ; done:

5
CPU: 0.35s      Real: 0.41s     RAM: 1623344KB # 1.6 GB
2826 # does not complete, this should be 5000
50
CPU: 1.08s      Real: 0.53s     RAM: 1691060KB # 1.6 GB
35062
500
CPU: 8.69s      Real: 1.70s     RAM: 2340200KB # 2.3 GB
373193
5000        
CPU: 109.95s    Real: 18.49s    RAM: 4980500KB # 4.9 GB
4487475
50000
erl_child_setup closed
Crash dump is being written to: erl_crash.dump...Command terminated by signal 9
CPU: 891.35s    Real: 157.52s   RAM: 24361288KB # 24.3 GB


Not testing 500m for elixir because it took too long and +P 500000000 argument is bad number of processes
",1,41908127.0
601,41908120,"Pass filename of the file selected for upload using enctype=""multipart/form-data"" to a struct field in Golang","My application uses the html code snippet for the form to upload a file


        
        {{with .Errors.image}}
        
            {{.}}
        
        {{end}}     

        

        
    


I need to grab the filename of the uploaded file and pass it to a struct field in Golang.

    file, header, err := r.FormFile(""productimage"")
    defer file.Close()
    if err != nil {
        http.Error(w, err.Error(), http.StatusInternalServerError)
    }
    var pimage = header.Filename 

p := &Product{
    Puid:     Puid(),
    Pname:    r.FormValue(""productName""),
    Quantity: r.FormValue(""quantity""),
    Price:    r.FormValue(""price""),
    Image:    pimage,
}


I am trying to pass the name of the file selected for uploaded to 'image' field of the struct 'Product'. Any suggestions on how this can be done?
",1,41914615.0
602,41943744,How to find field's value whose equal any value in array,"I have an array whose contain some ID : 

[""4007fa1c-4e27-4d2e-9429-f3631171760c"",
""a21649a3-1a64-45cf-b92a-e899a7ef4742"",
""1903a571-b166-4f93-9c1c-93dc66067a49"", 
""2845d278-5ec4-45e9-ab9c-999178332c73"",
""4e3ed481-a3d9-4689-8873-5c912668b26f"",
""390e89fd-d680-4264-8806-8295b361d2f1""]


I would like thanks to this array, find all the posts having for ""OriginID"", one of the Ids present in the table.

I've started something like that, but I don't know how to complete to make work this code.

curs, _ =   r.Table(""posts"").
            Filter(r.Row.Field(""Validated"").Eq(false)).
Filter(func(customer r.Term) interface{}{
    for _, id := range listOriginID {
        //I don't know how to finish
    }
})


Thank you for your help
",1,41950775.0
603,42047889,change struct's pointer value in struct's method,"I am trying to wrap my head around pointer in go. I have this code right here

package main

import (
    ""fmt""
)

// LinkedList type
type LinkedList struct {
    data int
    next *LinkedList
}

// InsertList will insert a item into the list
func (node *LinkedList) InsertList(data int) {
    newHead := LinkedList{data, node}
    node = &newHead
}

func main() {
    node := &LinkedList{}
    node.InsertList(4)
    fmt.Printf(""node = %+v\n"", node)
}


and The output is

node = &{data:0 next:}


I would like to understand that why is node = &newHead my InsertList method did not reference the node pointer to a different struct at all
",3,
604,42069615,Too many arguments to return error,"I've been pulling my hair out as to why this code throws the error:

package util

import (
   ""path/filepath""
   ""sync""

   ""github.com/go-ini/ini""
)

// ConfigMap is map for config values
type ConfigMap struct {
    LogPath         string
    PublicDir       string
    SessionName     string
    Debug           bool
    DBUsersHost     string
    DBUsersName     string
    DBUsersUsername string
    DBUsersPassword string
}

var once sync.Once

// Config loads and return config object
func Config() (*ConfigMap, error) {
    once.Do(func() {
        // Find the location of the app.conf file
        configFilePath, err := filepath.Abs(""../build/app.conf"")
        if err != nil {
            return nil, err
        }

        // Load app.conf
        cfg, err := ini.Load(configFilePath)
        if err != nil {
            return nil, err
        }

        // Get app mode
        mode, err := AppMode()
        if err != nil {
            return nil, err
        }

        c := &ConfigMap{}
        err = cfg.Section(mode).MapTo(c)
        if err != nil {
            return nil, err
        }

        return c, err
    })
}


As you can see, the pairing is exactly correct. Each return code returns &ConfigMap and err and the function signature matches it. What am I missing?
",2,42069690.0
605,42197468,go: What is the n parameter in regexp:FindAll(),"I use regexp.FindAll() to get all the matches. I don't understand the parameter of n, and in the office reference, there is no explanation. How can I set the parameter.

// FindAll is the 'All' version of Find; it returns a slice of all successive
// matches of the expression, as defined by the 'All' description in the
// package comment.
// A return value of nil indicates no match.
func (re *Regexp) FindAll(b []byte, n int) [][]byte {}

",1,
606,42357204,Hugo (go static site generator) list for specific URLs,"let's say I have the following structure

content
- blog-folder-1
-- blog-article-1-1.md
-- blog-article-1-2.md
- blog-folder-2
-- blog-article-2-1.md
-- blog-article-2-2.md


Then I also have the layouts/_default/list.html file which will be called every time I visit the URLs example.com/, example.com/blog-topic-1/, and example.com/blod-topic-2/

So the problem I have is that I don't want the layouts/_default/list.html file to generate the same content for these different paths..

I overcame the problem of only displaying certain articles in the homepage by adding ++ displayHomepage = ""true"" ++  to the .md files and {{ range $index, $page := first 50 (where .Site.Pages.ByPublishDate "".Params.displayHomepage"" ""true"") }} to the list.html file, but I can't figure out what to do if I don't want to display blog-article-2-1.md when visiting example.com/blog-folder-1/

Any help would be greatly appreciated 
",1,42365070.0
607,42375121,Range through an arbitrary number of nested slices of structs in an HTML template in Go,"I'm trying to build a web forum kind of like Reddit. There are top level posts with replies and the replies can have replies and so on.

A board looks like this:

var board map[string]*Post


and a Post:

type Post struct {
  Title string
  Body string
  ID string
  PostNum int
  Replies []*Post
}


How would I use a template to range through the nested Replies slices (keeping in mind that each *Post contains a Replies slice that contains *Posts that contains Replies and so on)?

What I have so far:

                                              
  {{ .Title  }}  
  {{ .Body  }}    

                                                          
  {{ range $key, $value := .Replies }}                        
                                             
                                        
        {{ $value.ID }}   
                                                        
      {{ $value.PostNum }}        
              

                                     
  {{ range $key, $value := $value.Replies }}                  
                                             
                                        
        {{ $value.ID }}   
                                                        
      {{ $value.PostNum }}        
                                                         
  {{ end }}                                                   
                                                         

  {{ end }}                                                   
                                                         
                                                        


This only allows me to range through two levels of replies (and as you can see uses duplicate code), I need to be able to range through an arbitrary number of levels of Replies.
",2,42377440.0
608,42377057,Deploy Prometheus to Cloud Foundry,"I want to deploy Prometheus to Cloud Foundry without using Docker container. When I try to deploy it with the standard Cloud Foundry Go Buildpack I get the following error:

can't load package: package prometheus: no buildable Go source files in /tmp/tmp.vv4iyDzMvE/.go/src/prometheus


Which somehow makes sense, because there are actually no sources in the  root directory and the project is compiled with the Prometheus utility tool.

Is there any way to deploy Prometheus to Cloud Foundry, like using another Buildpack or something?
",2,
609,42406445,Docker alpine golang go get error for coding.net private repo,"I created the private repository using the coding.net.
I use docker images alpine and centos.
I can go get git.coding.net/alphayan/orionv2.git successful from docker-centos, but I can't go get git.coding.net/alphayan/test.git from docker-alpine.It returns an error stating:  

/go/src # go get -u -v  git.coding.net/alphayan/test.git
# cd .; git ls-remote https://git.coding.net/alphayan/test
fatal: could not read Username for 'https://git.coding.net': terminal prompts disabled
# cd .; git ls-remote git+ssh://git.coding.net/alphayan/test
Permission denied (publickey).
fatal: Could not read from remote repository.

Please make sure you have the correct access rights
and the repository exists.
# cd .; git ls-remote ssh://git.coding.net/alphayan/test
Permission denied (publickey).
fatal: Could not read from remote repository.

Please make sure you have the correct access rights
and the repository exists.
package git.coding.net/alphayan/test.git: cannot download, git.coding.net/alphayan/test uses insecure protocol


From centos it let me use the username and password:

[root@83fc8067fc95 /]# go get -u -v git.coding.net/alphayan/test.git
Username for 'https://git.coding.net':


finally, I find it caused by the git's version, the centos with git 1.8.3 and the alpine with git 2.11.0.
then I change the centos git's version with 2.11.0, becomes the same wrong with alpine.
I think I can modify golang or git source file solve this problem,
could someone help me? thinks~!
",2,44207768.0
610,42412935,Creating a slice of slice of interfaces in go,"I'm trying to create a function that returns the all the key, value of a map as a slice of slice of tuples (where each tuple is {key, value})

Here's the code:

func ReturnTuples(map_ map[interface{}]interface{}) [][]interface{} {
    toReturn := []([]interface{})
    ...


But I'm getting error for the toReturn line:

type [][]interface {} is not an expression


How should I declare a slice of slice of interfaces? I see this as the only way. I tried without parenthesis like:

[][]interface{}


but it won't work either.

I tried to search for 'golang slice of slice' on google but very few things appear. For example I've only found how to create a simple one made of uint8, which is: [][]uint8.
",2,42412985.0
611,42473897,Exporting a function whose name starts with a lower case letter,"Just curious, is there a way to export a function whose name starts with a lower case character, like ""print"" or ""start""?

A side note: just like you do with JSON:

type T struct {
    FieldA int    `json:""field_a""`
    FieldB string `json:""field_b,omitempty""`
}

",1,
612,42516717,How to stop goroutine,"I have a goroutine that calls a function and with a special parameter i want to start or stop this goroutine. My problem is that this code never stops my goroutine, it creates everytime a new job. 

quit := make(chan bool)
run := make(chan bool)

    go func() {
        for {
            select {
            case <-quit:
                close(run)
            case <-run:
                myFunc(c)
            default:
            }
        }
    }()

    if x == true {
        quit <- true
    } else {
        run <- true
    }


How do I stop my routine? 
",3,
613,42526950,Enforce calling Close() when finished working with the package,"I'm writing a package in go that creates a connection to Kafka.

I create the connection in the init() function in the main file in the package. After the program that uses the package stops, I want to call a function called Close()

Is there a way to enforce it in the package level, instead of giving this responsibility to the user?

Assume that the connection should be available throughout the run of the user's program, I don't want to initialize it every time.
",1,42529742.0
614,42566116,Collision on concurrent read on buffered channel in golang?,"I have a buffered channel that are read by multiple (4 in this example) go routines.

queue := make(chan string, 10000) // a large buffered channel


Each go routine checks the number of elements available in the channel and process them all. 

for i :=0; i< 4; i++{ // spun 4 go routines
    go func() {
        for {
            for elem := range queue {
                // do something with the elem from the channel
            }
         }
     }
  }


Will multiple go routines collide on the reads? In other words, could different go routine grab the same elem in the channel, or while one go routine is reading the buffer, the other go routines already read and processed some of the elements? How to block other go routines from reading while one go routine is reading?
",2,42566899.0
615,42631255,Present content like power point or impress,"I want to build an application that displays the content that user types on the command prompt to the display like a presentation.
I am writing this application in golang. If there are existing libraries that I can use to do this great and if not would need direction how to approach solving this.
I did search on the internet for pointers but found none.
",1,
616,42633651,Better way to use a map within a struct? Go Programming Language Exercise 1.4,"I'm working on Exercise 1.4 from The Go Programming Language. The program reads stdin or files given as arguments and outputs lines that have duplicates.

I have working code, I'm just wondering if there is a better way to use maps within structs?  Right now I have a new map being made in the struct when a unique line is found. But it seems clumsy, and I want to know if I should approach this another way.

type dupCount struct {
        count int
        fileCount map[string]int
}

func main() {
        counts := make(map[string]dupCount)
        files := os.Args[1:]
        if len(files) == 0 {
                countLines(os.Stdin, counts, ""stdin"")
        } else {
                for _, arg := range files {
                        f, err := os.Open(arg)
                        if err != nil {
                                fmt.Fprintf(os.Stderr, ""dup2: %v\n"", err)
                                continue
                        }
                        countLines(f, counts, arg)
                        f.Close()
                }
        }
func countLines(f *os.File, counts map[string]dupCount, filename string) {
        input := bufio.NewScanner(f)
        for input.Scan() {
                var tmp = counts[input.Text()]
                if tmp.count == 0 {
                        tmp.fileCount = make(map[string]int)
                }
                tmp.count++
                tmp.fileCount[filename]++
                counts[input.Text()] = tmp
        }
}


I am using the tmp variable in countLines to get around the inability to assign directly to values in maps as outlined in the Go Github repo.
",1,
617,42705505,golang: strange issue with coroutines and channels,"I wrote a test code, but do not understand why I get this result.

My sub() should update or return counter, based on the channel value

send 1 = counter++
send 0 = return counter


I start 10 go routines con().
They should simply send many 1 to channel (this increase counter)
I wait 1 sec and send 0 to channel. What value should I get?

I think first, I get a ""random"" value,
but i get 100000 (ok 10x 10000 is faster than 1 sec)

Now I change

for i:=0; i < 10; i++ {


to

for i:=0; i < 10000; i++ {


and now my returned value is 1

Why!?

Now uncomment fmt.Println(counter) in main().
As you see counter works and has this ""random"" number

package main

import (
    ""fmt""
    ""time""
)

var ch chan int = make(chan int)
var counter int

func main() {
    go sub()

    for i:=0; i < 10; i++ { //change to 10000
        go con()
    }

    time.Sleep(1000 * time.Millisecond)

    ch <- 0
    fmt.Println(<- ch)
    //fmt.Println(counter) //uncomment this
}

func sub() {
    for c := range ch {
        if c == 0 { ch <- counter }
        if c == 1 { counter++ }
    }
}

func con() {
    for i := 0; i < 10000; i++ {
        ch <- 1
    }
}

",1,42706064.0
618,42726635,|| operator not working as expected,"What is going wrong here? I am 100% sure I am sending a HTTP POST request, but somehow the OR operator is not working as I am expecting. In the first example the server returns a 405 and in the second example the code continues executing.

not working:

if req.Method != http.MethodPost || req.Method != http.MethodDelete {
    http.Error(res, http.StatusText(http.StatusMethodNotAllowed), http.StatusMethodNotAllowed)
    return
}


working:

if req.Method != http.MethodPost {
    http.Error(res, http.StatusText(http.StatusMethodNotAllowed), http.StatusMethodNotAllowed)
    return
}

",2,42726688.0
619,42730854,Is accepting a json directly from the client insecure/bad practice in a Golang app with a json file datastore?,"I have a simple Golang application with a HTTP API that controls the app, the api has a frontend over it powered by a React.js app. The frontend allows users to change settings and  POSTS a json object called settings directly to the API /api/settings endpoint (which has simple JWT authentication builtin). I take that object unmarshal it into a struct for the application to use, in case of an error the application uses the default struct and sends an error to the client. My question is; am I doing this correctly or is this insecure; sending the json directly to the app, without any server side validation, but a simple json.unmarshal? 

PS:I come from a PHP+MySQL web apps background, where accepting client input for the DB without escaping it was a very dangerous thing to do. 
",1,
620,42758054,Read multipart-form data as []byte in GO,"I'm using GIN as GO framework,  im having an issue when uploading file and directly convert image as byte so i can store it in my BLOB field inside db table, so i have my piece of code like this :

func (a *AppHandler) Upload(ctx *gin.Context) {

form := &struct {
    Name    string `form:""name"" validate:""required""`
    Token   string `form:""token"" validate:""required""`
    AppCode string `form:""app_code"" validate:""required""`
}{}
ctx.Bind(form)
if validationErrors := a.ValidationService.ValidateForm(form); validationErrors != nil {
    httpValidationErrorResponse(ctx, validationErrors)
    return
}

file, header, err := ctx.Request.FormFile(""file"")


and im trying to store it in db like this

app.SetFile(file)
a.AppStore.Save(app)


and it returns this kind of error:

cannot use file (type multipart.File) as type []byte 


so how to fix this? im pretty new with Go language
 NOTE: i'm using GORM as well for my db ORM
",1,42758241.0
621,42758392,"Golang error ""not enough arguments in call""","I'm new to golang. Trying to implement a bulk upload to Elasticsearch by golang. I'm using golang library -> https://github.com/olivere/elastic for communication with Elasticsearch.

Also, a piece of sample code which I'm trying but getting following error...

suresh@BLR-245:~/Desktop/tools/golang/src$ go install github.com/crazyheart/elastic-bulk-upload
# github.com/crazyheart/elastic-bulk-upload
github.com/crazyheart/elastic-bulk-upload/main.go:29: not enough arguments in call to bulkRequest.Do
    have ()
    want (""golang.org/x/net/context"".Context)
suresh@BLR-245:~/Desktop/tools/golang/src$ 


My Golang Code(main.go)

package main

import (
    ""fmt""
    ""gopkg.in/olivere/elastic.v5""
    ""strconv""
)

type Tweet struct {
    User    string `json:""user""`
    Message string `json:""message""`
}

func main() {
    client, err := elastic.NewClient()
    if err != nil {
        fmt.Println(""%v"", err)
    }

    n := 0
    for i := 0; i < 1000; i++ {
        bulkRequest := client.Bulk()
        for j := 0; j < 10000; j++ {
            n++
            tweet := Tweet{User: ""olivere"", Message: ""Package strconv implements conversions to and from string representations of basic data types. "" + strconv.Itoa(n)}
            req := elastic.NewBulkIndexRequest().Index(""twitter"").Type(""tweet"").Id(strconv.Itoa(n)).Doc(tweet)
            bulkRequest = bulkRequest.Add(req)
        }
        bulkResponse, err := bulkRequest.Do()
        if err != nil {
            fmt.Println(err)
        }
        if bulkResponse != nil {

        }
        fmt.Println(i)
    }
}


Anybody, help me to understand what that error means & how to solve those?
",1,42758492.0
622,42761820,How to get another branch instead of default branch with go get,"I have 2 repositories. Let say them repo_a and repo_b. I imported repo_a in repo_b

When I ran go get, it will get repo_a master branch.
Is there any way to get develop branch using go get or another command from repo_b?

I do not want to git pull on each specific package (in this case repo_a)
",2,42761887.0
623,42770022,Should err.Error() be used in string formatting?,"This string formatting works just fine:

err := foo()
if err != nil {
  fmt.Printf(""foo returned '%s' when called\n"", err)
}


Is there any merit do calling err.Error() in this context?

fmt.Printf(""foo returned '%s"" when called\n"", err.Error())

",2,42770341.0
624,42798419,How can I set up a http2 server in Go 1.8 without third party libraries?,"I heard that http2 would be supported in the latest Go versions. How can I put up a http2 server without using golang.org/x/net/http2?

In previous versions you could do something like this:

package main

import (
    ""log""
    ""net/http""
    ""os""

    ""golang.org/x/net/http2""
)

func main() {
    cwd, err := os.Getwd()
    if err != nil {
        log.Fatal(err)
    }

    srv := &http.Server{
        Addr:    "":443"",
        Handler: http.FileServer(http.Dir(cwd)),
    }
    http2.ConfigureServer(srv, &http2.Server{})
    log.Fatal(srv.ListenAndServeTLS(""server.crt"", ""server.key""))
}

",1,42798467.0
625,42841854,How to get the type of a parameter on a function,"I'm trying to use the type of a struct as a general parameter on a function i want to get this: 

type comments []struct {
    ID string `json:""id""`
    Author string `json:""author""`
    Text string `json:""text""`
}

handleReadAll(""/getsome"")

func handleReadAll(getPath string){
    var someVar comments 
}


So as you can see i have that someVar as type comments, I need to make a generic use of that type so I can use the handleReadAll with generic type structs this is what I hvae tried so far:

handleReadAll(""/getsome"",comments{})

func handleReadAll(getPath string,structToDecodeArray interface{}){
    var object2 reflect.ValueOf(&structToDecodeArray)
    var object = reflect.ValueOf(&structToDecodeArray)
    fmt.Println(""var"",object)
    fmt.Println(""var"",reflect.ValueOf(&structToDecodeArray).Interface())
    fmt.Println(""var"",reflect.TypeOf(&structToDecodeArray))
    fmt.Println(""var"",reflect.ValueOf(&structToDecodeArray).Type().Elem)
}


I cannot make this work, I am using reflection to try to get the type of the parameter structToDecodeArray, How could I get the same var as.

var someVar comments


but with reflection.
",1,
626,42881328,Go Function Types as Interface Values,"I have been reading about function types as interface values in go and I came across an example that I have not been able to figure out. Here it is:

type binFunc func(int, int) int

func add(x, y int) int { return x + y }

func (f binFunc) Error() string { return ""binFunc error"" }

func main() {
    var err error
    err = binFunc(add)
    fmt.Println(err)
}


You can find it on Go Playground here. 

I understand that you can assign a method to a function type, but I do not understand how Error() is being called. 
",1,42881490.0
627,43039501,connection refused when trying to connect redis using docker compose file,"I have a problem trying to connect to redis using redis-golang driver.
this is my docker-compose.yml file : 

version: ""3""

services:
  driver:
    build: ./API-Golang
    command: go run app.go
    volumes:
     - ./API-Golang:/app
    ports:
      - ""8080:8080""
    depends_on:
      - db
      - redis
    links :
      - redis
      - db
  redis:
    image: redis
    container_name: redis
    ports: [""6379:6379""]
  db:
    image: mongo:3.4.2
    container_name: mongodb
    ports : [""27017:27017""]


and this the code where I try to connect to redis (API-Golang/database/allSystem.go):

redisConn := RedisHost{
    Address:  ""localhost:6379"",
    Password: """",
    DB:       0,
}

redisConnection, err := redisConn.Connect()
if err != nil {
    panic(err)
}


I have tried to change localhost to redis for the host but still it doesn't work. Here is the error :

driver_1  | panic: dial tcp [::1]:6379: getsockopt: connection refused
driver_1  | 
driver_1  | goroutine 1 [running]:
driver_1  | github.com/Gujarats/API-Golang/database.SystemConnection(0x48)
driver_1  |     /go/src/github.com/Gujarats/API-Golang/database/allSystem.go:32 +0x3d3
driver_1  | main.main()
driver_1  |     /go/src/github.com/Gujarats/API-Golang/app.go:24 +0x34
driver_1  | exit status 2


Any idea what's wrong?

Source Code
",2,43042558.0
628,43086360,vim fold cpp and golang code,"vim cannot fold test.cpp, vim prompts E490 no fold found, but rename this file to test.c or test.cc, vim can use zc to fold this same code.

I have set configure in .vimrc 
foldmethod=syntax set foldlevel=0 set foldnestmax=2 VIMRUNTIME=/usr/share/vim/vim80

in /usr/share/vim/vim80/ftplugin, there exits a cpp.vim file.
why vim cannot fold *.cpp and *.go
",1,
629,43284894,Best Practice to go from sphinx db to somewhat complex golang struct,"I am trying to convert a sphinx query via MySQL into a golang struct and am having a hard time. It seems like this should be a common sort of problem, but so far I'm stuck converting it to a map or parsing output myself.  Specifically, I have a schema in sphinx that looks like {Source: {ID:string, subId:string, Campaigns:[]{CampaignID:string, Status:string}}}

I've tried using the simple rows.scan but that doesn't help me parse the repeating field, I just get it as an unparsed string.  In sphinx, the key's aren't in quotation marks, so JSON.unmarshal doesn't seem to help at all.  And using sqlx, I've tried to build up the following struct 

type CampaignStatus struct {
    CampaignId string
    Status string
}
type Source struct {
    Id               string
    SubId    string
    StatusByCampaign []CampaignStatus
}
type Status struct {
    Source
}


and passing in a Status struct to Row.ScanStruct() and I get back either a ""Missing destination Name Source"" error or if I name the source member in Status, I get ""sql: Scan error on column index 0: unsupported Scan, storing driver.Value type []uint8 into type *v1.Source"".  Full disclosure, the sphinx schema has a few other columns as peers with StatusByCampaign, they come after it and I don't care about them in my use case. 

This seems like something that has to have been come across before, but I can't seem to find a solution outside of writing my own parser, which I am loath to do. 
",2,
630,43408646,function Mocking through Interface in golang,"I am trying to write a unit test code form following code which has 3 level of function calling as below:

The main function calls function A() and then function A calls function B() and C() depending upon some condition and function B calls function E() and F(), whereas function C calls function G() and H() on some condition.
The above like the code I have developed, Here I want to mock function E() and F() for function B, and G() and H() for function C. Please suggest me how to do it using interface.
",1,43408894.0
631,43424787,How to use next available port in http.ListenAndServe,"I wrote a simple web server to listen on port 8080. But I don't want to use a hard coded port number. What I want is that my server listen on any available port. And I want to know that on what port number my web server is listening.

My code is given bellow:

package main

import (
    ""net/http""
)

func main() {       
    http.HandleFunc(""/"", handler)
    http.ListenAndServe("":8080"", nil)

}

",1,43425461.0
632,43425594,Serve static files via http with go,"In my html I'm trying to include JS using




I have also tried relative path (from server location)




and relative from the html file 
    

My file structure

-js
    app.js
-templates
    index.html
hub.go
main.go


main.go is the server

func main() {
    http.HandleFunc(""/"", rootHandler)
    http.ListenAndServe("":8080"", nil)
}

func rootHandler(w http.ResponseWriter, r *http.Request) {
    http.ServeFile(w, r, ""Templates/index.html"")
}


Am I missing something do I have to server css/js through server? or should the simple html work
",1,43425767.0
633,43430410,Rune in Golang and UTF-8,"
What does ""rune"" mean?
https://golang.org/pkg/unicode/utf8/#example_Valid Why is the answer is true in the first line?
The function Valid accepts only an array?

",1,43430711.0
634,43437729,Writing a struct's fields and values of different types to a file in Go,"I'm writing a simple program that takes in input from a form, populates an instance of a struct with the received data and the writes this received data to a file. 

I'm a bit stuck at the moment with figuring out the best way to iterate over the populated struct and write its contents to the file.

The struct in question contains 3 different types of fields (ints, strings, []strings).

I can iterate over them but I am unable to get their actual type. 

Inspecting my posted code below with print statements reveals that each of their types is coming back as structs rather than the aforementioned string, int etc.

The desired output format is be plain text.

For example:

field_1=""value_1""
field_2=10
field_3=[""a"", ""b"", ""c""]


Anyone have any ideas? Perhaps I'm going about this the wrong way entirely?

func (c *Config) writeConfigToFile(file *os.File) {

    listVal := reflect.ValueOf(c)
    element := listVal.Elem()

    for i := 0; i < element.NumField(); i++ {
        field := element.Field(i)
        myType := reflect.TypeOf(field)

        if myType.Kind() == reflect.Int {
            file.Write(field.Bytes())
            } else {
                file.WriteString(field.String())
            }
        }
}

",2,43438265.0
635,43458792,Concurrently writing and reading from map causes potential race condition,"I have a very basic Golang application that creates and runs a HTTP server. The server has 2 endpoints, one to send data and one to receive.

Upon each POST request to the server, parse the incoming data from the body and push it onto a channel. I then have a function that reads from the channel and saves the data to a map.

Upon each GET request to the server, JSON marshal the map and send it to the client.

Each request to the HTTP server runs asynchronously and the worker function writes to the map synchronously in its own goroutine.

Basic pseudo code is as follows:

package main

import (
    ""net/http""
)

type dataStore map[string]string

func listenHandler(stream chan string) http.HandlerFunc {
    return func(w http.ResponseWriter, r *http.Request) {
        // JSON unmarshal request body

        // push data onto stream
        stream <- data
    }
}

func serveHandler(store *dataStore) http.HandlerFunc {
    return func(w http.ResponseWriter, r *http.Request) {
        // JSON marshal data store
        // serve to client
    }
}

func worker(stream <-chan string) *dataStore {
    store := make(dataStore)
    go func() {
        for data := range stream {
            // process and write data to map
        }
    }()
    return &store
}

func main() {
    stream := make(chan string)
    store := worker(stream)

    http.HandleFunc(""/listen"", listenHandler(stream))
    http.HandleFunc(""/serve"", serveHandler(store))

    http.ListenAndServe("":8080"", nil)
}


I have tested and ran the application with no problems, however I have been told it has a potential race condition and I am not sure why. Is this true? 
",1,43459894.0
636,43459290,"Submit pull request for changes to packages installed via ""go get""","I have a package I installed via go get github.com//. It was missing some features, so I have been working with the original author to add them to the package.

I made the changes to my local copy and committed them. Then I realized: derp, I don't have authorization to git push these changes.

Is there a way for me to salvage my changes and somehow submit a pull request to him? Or do I have to lose all my changes, fork his repository, re-implement my changes, and then submit a pull request?

And no matter what I do, is there a way for me to retain the ability to do this command?

go get -u 


Or do I have to just become a full-time contributor and continually update my fork with his repository?
",1,43459325.0
637,43485414,GetSpecialFolder equivalent in golang,"I'm trying to get the temp folder of windows, other than a fixed path C:\Windows\Temp, I'd like to use some API similar to GetSpecialFolder in VBScript.

Is there anything like that?
",1,43485517.0
638,43549116,404 Error while using gorilla/mux golang library,"I am fairly new to golang and am finding myself frustrated with a simple file service program. I am suspecting that there is something wrong with my file prefix/ directory in the handler for my router r. I have tried many different formats for the directory. the html file i would like serviced is $HOME/Documents/TEST/Login on my system. Below is my code, note the {address} replaces the ip address.

    package main

    import (
       ""log""
       ""github.com/gorilla/mux""
       ""net/http""
       ""time""
     )

   func main() {
   r := mux.NewRouter()
   r.PathPrefix(""/Login/"").Handler(http.StripPrefix(""/Login/"", 
   http.FileServer(http.Dir(""$HOME/Documents/TEST/Login""))))

   srv := &http.Server{
       Handler:      r,
       Addr:         ""{address}:9999"",
       WriteTimeout: 600 * time.Second,
       ReadTimeout:  600 * time.Second,
   }

   log.Fatal(srv.ListenAndServe())
   }

",1,43549158.0
639,43601858,How can I define an implementation of Go interface method that receives pointer?,"The following program runs fine.

package main

import (
    ""fmt""
)

type Person interface {
    Hello()
}

type Joker struct {
    Name string
}

func (j Joker) Hello() {
    fmt.Println(j.Name, ""says, \""Hello!\"""")
}

func main() {
    var j Joker = Joker{""Peter""}
    invokeHello(j)
}

func invokeHello(p Person) {
    p.Hello()
}


Here is the output.

$ go run foo.go
Peter says, ""Hello!""


But when I change the Hello method to receive a pointer, I get errors.

package main

import (
    ""fmt""
)

type Person interface {
    Hello()
}

type Joker struct {
    Name string
}

func (j *Joker) Hello() {
    fmt.Println(j.Name, ""says, \""Hello!\"""")
}

func main() {
    var j *Joker = &Joker{""Peter""}
    invokeHello(j)
}

func invokeHello(p *Person) {
    p.Hello()
}


Here are the errors.

$ go run bar.go
# command-line-arguments
./bar.go:21: cannot use j (type *Joker) as type *Person in argument to invokeHello:
    *Person is pointer to interface, not interface
./bar.go:25: p.Hello undefined (type *Person has no field or method Hello)


How can I fix the second program?
",2,
640,43607857,Append to slice of interfaces,"I'm writing a document generator. There is a DocumentItem interface - this is part of the document. 

type DocumentItem interface {
    compose() string
}


For example, a document consists of paragraphs and tables.

type Paragraph struct {
    text string
}
type Table struct{}


The Paragraph and Table types correspond to the DocumentItem interface.

func (p *Paragraph) compose() string {
    return """"
}

func (t *Table) compose() string {
    return """"
}


The Document type contains the content []*DocumentItem field. 

type Document struct {
    content []*DocumentItem
}


I'm looking for a way that would allow NewParagraph() and NewTable() functions to create the necessary data types and add them to the content field. 

func (d *Document) NewParagraph() *Paragraph {
    p := Paragraph{}
    d.content = append(d.content, &p)
    return &p
}

func (d *Document) NewTable() *Table {
    t := Table{}
    d.content = append(d.content, &t)
    return &t
}


I use an slice of interface pointers in order to be able to modify the data in the corresponding variables after they are included in the document.

func (p *Paragraph) SetText(text string) {
    p.text = text
}

func main() {
    d := Document{}
    p := d.NewParagraph()
    p.SetText(""lalala"")
    t := d.NewTable()
    // ...    
}


But I get compiler errors:

cannot use &p (type *Paragraph) as type *DocumentItem in append
cannot use &t (type *Table) as type *DocumentItem in append


If I cast the types to an DocumentItem interface, I will lose access to specific functions, which in the case of one type may differ from the other. For example, add text to a paragraph and add a row of cells and then add text to cell for the table.

Is it possible at all?

Full example at https://play.golang.org/p/uJfKs5tJ98
",1,43607941.0
641,43677530,retrieve a nested document with mgo,"I need to retrieve a nested document in mongoDB with mgo.
Here is my document in db:

{
    ""_id"" : ""packing_type_0000"",
    ""name"" : ""packing"",
    ""category"" : ""logistics"",
    ""en"" : {
            ""translatedName"" : ""Packing and Order Prep"",
    },
}


This is my golang structure: 

type jobTypeWording struct {
     translatedName     string `json:""translatedName"" bson:""translatedName""`
}

type jobType struct {
    ID               string         `json:""_id"" bson:""_id""`
    Name             string         `json:""name"" bson:""name""`
    Category         string         `json:""category"" bson:""category""`
    en               jobTypeWording `json:""en"" bson:""en""`
}


And my code:   

result := jobType{}
sessionCopy := session.Copy()
defer sessionCopy.Close()
c := sessionCopy.DB(os.Getenv(""DB_DATABASE"")).C(""jobTypes"")
err := c.Find(bson.M{""_id"": Id}).One(&result)  
fmt.Println(result.en)


My program program output:

{  }


How do I retrieve en.translatedName?

In the same program I get other nested bson from mongo and it's working with same way. I don't understand my mistake.
",1,43681742.0
642,43695832,Pass a reference to a Redis instance to a Gorilla/Mux Handler,"I'm trying to get my hands dirty while playing with some Gorilla/Mux and Go-Redis but I'm facing a little implementation problem here.

Essentially I have a project structured like the following:



Where redismanager.go handles the initialization of a Redis Client:

package redismanager

import (
    ""fmt""
    ""github.com/go-redis/redis""
)

func InitRedisClient() redis.Client {
    client := redis.NewClient(&redis.Options{
        Addr    : ""localhost:6379"",
        Password: """",
        DB      : 0, //default
    })

    pong, err := client.Ping().Result()
    if( err != nil ){
        fmt.Println(""Cannot Initialize Redis Client "", err)
    }
    fmt.Println(""Redis Client Successfully Initialized . . ."", pong)

    return *client
}


Where main.go calls redismanager.InitRedisClient and initializes mux.Handlers:

package main

import (
    ""github.com/gorilla/mux""
    ""github.com/go-redis/redis""
    ""net/http""
    ""fmt""
    ""log""
    ""encoding/json""
    ""io/ioutil""
    ""../redismanager""
    ""../api""
)

type RedisInstance struct {
     RInstance *redis.Client
}

func main() {

    //Initialize Redis Client
    client := redismanager.InitRedisClient()
    //Get current redis instance to get passed to different Gorilla-Mux Handlers
    redisHandler := &RedisInstance{RInstance:&client}

    //Initialize Router Handlers
    r := mux.NewRouter()
    r.HandleFunc(""/todo"", redisHandler.AddTodoHandler).
                                       Methods(""POST"")

    fmt.Println(""Listening on port :8000 . . ."")

    // Bind to a port and pass our router in
    log.Fatal(http.ListenAndServe("":8000"", r))

}


Now, I can easily define and let work properly AddTodoHandler in the same file like:

func (c *RedisInstance) AddTodoHandler(w http.ResponseWriter, r *http.Request) {
  . . . doSomething
}


But, to make things a bit more modular, I'm trying to move all of these RouteHandlers inside their respective files in api package. In order to make that, I need to pass a reference to redisHandler but I'm having some difficulties when trying to make that with an Handler inside api package.

For instance, If in the main I add:

r.HandleFunc(""/todo/{id}"", api.GetTodoHandler(&client)).
                                        Methods(""GET"") 


with gettodo.go

package api

import (
    ""net/http""
    ""github.com/gorilla/mux""
    ""fmt""
    ""encoding/json""
    ""github.com/go-redis/redis""
)

func GetTodoHandler(c *RedisInstance) func (w http.ResponseWriter, r *http.Request) {
    func (w http.ResponseWriter, r *http.Request) {
        . . . doSomething
    }
}


It works nicely.

I'm still pretty new to Go and haven't found any cleaner solution to that even after several researches and reads.

Is my approach correct or are there any better ones?
",2,43696494.0
643,43852529,How are strings stored in a GO array?,"Following the tour of GO, I encountered the following code:

var a [2]string
a[0] = ""Hello""
a[1] = ""World""


So, an array's length is inmutable and set when the array is declared. But then you can store strings of any size in it.

Why can you do this?
",2,
644,43854117,Detecting uninitialized struct fields,"I have a service, written in golang, that can be initialized with some options. Options are passed as a struct to a constructor function. The constructor function uses default values for option fields that weren't included. Here's an example:

type Service struct {
  options Options
}

type Options struct {
  BoolOption bool
  StringOption string
}

const (
  DefaultBoolOption = true
  DefaultStringOption = ""bar""
)

func New(opts Options) *Service {
  if !opts.BoolOption {
    opts.BoolOption = DefaultBoolOption
  }

  if len(opts.StringOption) < 1 {
    opts.StringOption = DefaultStringOption
  }

  return &Service{options: opts,}
}

...

// elsewhere in my code
o := Options{BoolOption: false,}

// sets s.options.BoolOption to true!!!
s := New(o)


My problem is that for bool or int option types, I can't tell whether or not a field value was set in the Options struct. For example, was BoolOption set to false or just not initialized?

One possible solution would be to use strings for all of my Options fields. For instance, BoolOption would be ""false"" rather than false. I could then check the length of the string to check if it was initialized.

Are there better solutions?
",2,43856941.0
645,43936400,How do I parse a nested array in a nested JSON object in Golang?,"I have a JSON:

{
    ""data"": [
        {
            ""id"": 1,
            ""values"": [
                [
                    {
                        ""id"": ""11"",
                        ""keys"": [
                            {
                                ""id"": ""111""
                            }
                        ]
                    }
                ]
            ]
        }
    ]
}


I want to parse ""values"" and ""keys"" into structs, but I don't known what type should i use in ""Data""?:

type Value struct {
    Id   string `json:""id""`
    Keys []Key  `json:""keys""`
}
type Key struct {
    Id string `json:""id""`
}
type Result struct {
    Data []Data `json:""data""`
}
type Data struct {
    Id     int      `json:""id""`
    Values []???? `json:""values""`
}


I would be grateful for any help. Thanks.
",2,43936698.0
646,44067030,How to use Chrome headless with chromedp?,"I'm using chromedp, which has features to focus on elements, fill in text, etc. Chrome 59 has cross-platform headless support. It allows running Chrome in a headless/server environment. To use via the DevTools remote debugging protocol, start a normal Chrome binary with the --headless command line flag (Linux-only for now):


  $ google-chrome --headless --disable-gpu --remote-debugging-port=9222 https://www.google.fr


How can I tell chromedp to send the --headless flag, along with other flags?
",1,44073435.0
647,44078189,How do I kill a http server from another function,"package main

import (
    ""fmt""
    ""log""
    ""net/http""
    ""time""
)


func handlerfunc(w http.ResponseWriter, r *http.Request) {
    fmt.Fprintf(w, ""Hello World"" )
    }

    http.ServeContent(w, r, str , time.Now(), f)
}

func PleaseStart(){
    http.HandleFunc(""/"" , handlerfunc )
    log.Fatal(http.ListenAndServe("":80"", nil))
}

func kill_server() {
    //How do I kill server from here
}


func main() {
    go PleaseStart()

    kill_server()
}


I start a http.server that responds with hello world, how do I kill it from kill_server function
Is this possible without rewritting everything?
",1,44078268.0
648,44102971,How to let Go find library headers?,"I've been searching for a while but cannot find a solution to this issue.

Because libraries like SDL2 are not part of the OpenBSD operating system, they are stored in /usr/local. Go seems to be looking for headers in /usr/include and not /usr/local/include. I see flags in go env  but I'm unable to edit them.

Is there a way to resolve this issue without symlinks? Perhaps a Go equivalent of the -I flag common in C compilers?
",1,44103397.0
649,44177972,Gogland: debugging has redundant parameter '--',"'Program arguments' is empty as below, 



but when I start debugging, there is a '--' parameter at end.

Where does the parameter come from, and how can I avoid it?



When I add some debug parameters, the '--' is still there , just between program name and the real parameters. It will break the debugging, because program doesn't know how to interpret it.

",1,
650,44240806,gosnmp get octetstring from SNMP PDU,"I am trying to get the OctetString value from an SNMP PDU returned by the gosnmp package. Even the bytes would suffice.

Here is my code:

package snmp_abstract

import (
    ""github.com/soniah/gosnmp""
    ""time""
    ""log""
    ""os""
    ""strings""
)

type Switch struct {
    Hostname string
    Connection gosnmp.GoSNMP
}


var ConnectionParams = &gosnmp.GoSNMP{
    Target: """",
    Port: 161,
    Community: ""community"",
    Version: gosnmp.Version2c,
    Timeout: time.Duration(5) * time.Second,
    Logger: log.New(os.Stdout, """", 0),
}

type Mibs struct {
    VtpVlanState,
    Dot1dBasePortIfIndex string
}

var Default = &Mibs{
    VtpVlanState: ""1.3.6.1.4.1.9.9.46.1.3.1.1.2"",
    Dot1dBasePortIfIndex: ""1.3.6.1.2.1.17.1.4.1.2"",
}


func SNMPGet(conn *gosnmp.GoSNMP, host string, mib []string) {
    conn.Target = host
    log.Println(conn)
    err := conn.Connect()
    if err != nil {
        log.Printf(""Unable to connect to %s\n"", host)
    }
    defer conn.Conn.Close()
    res, err := conn.Get(mib)
    if err != nil {
        log.Println(""GET error"")
        log.Print(err)
    }
    log.Println(res)
}


func SNMPWalk(conn *gosnmp.GoSNMP, host string, mib string) []gosnmp.SnmpPDU {
    conn.Target = host
    log.Println(conn)
    err := conn.Connect()
    if err != nil {
        log.Printf(""Unable to connect to %s\n"", host)
    }
    defer conn.Conn.Close()
    res, err := conn.BulkWalkAll(mib)
    if err != nil {
        log.Println(""GET error"")
        log.Print(err)
    }
    return res
}

func (sw *Switch) Vlans() []string {

    res := SNMPWalk(&sw.Connection, sw.Hostname, Default.VtpVlanState)
    var vlans = make([]string, len(res))
    for i, vlan := range res {
        oidSlice := strings.Split(vlan.Name, ""."")
        v := oidSlice[len(oidSlice)-1]
        vlans[i] = v
    }
    return vlans
}

func (sw *Switch) MapBPIIfindex(vlan string)  {
    log.Println(vlan)
    s := *sw
    s.Connection.Community += ""@"" + vlan
    log.Println(s.Connection.Community)
    res := SNMPWalk(&s.Connection, s.Hostname, Default.Dot1dBasePortIfIndex)
    for _, p := range res {
        log.Println(p.Name)
        log.Println(p.Value)
    }
}


When I use the MapBPIIfindex method I get the following output:

OID: [.1.3.6.1.2.1.31.1.1.1.1.10001]
[decodeValue: type is OctetString]
decodeValue: value is []interface {}{[]uint8{0x46, 0x61, 0x30, 0x2f, 0x31}}


Now, this should contain an OctetString. The uint8 bytes should decode to Fa0/1, but I am not able to do this.

When I change log.Println(p.Value) to log.Println(p.Value.([]uint8)), I get the following error:

2017/05/29 12:54:59 .1.3.6.1.2.1.17.1.4.1.2
panic: interface conversion: interface {} is nil, not []uint8


How can I get this value? The documentation is not so clear on this.
",1,
651,44301262,Most efficient way to convert a [][]byte to []string in golang,"To convert [][]byte to []string, I do this 

data, err := ioutil.ReadFile(""test.txt"")
if err != nil {
    return nil, err
}

db := bytes.Split(data, []uint8(""\n""))

// Convert [][]byte to []string
s := make([]string, len(db))
for i, val := range db {
    s[i] = string(val)
}
fmt.Printf(""%v"", s)


I am new to golang, I'm not sure is most efficient way to do this. 
",2,44326496.0
652,44363911,Detect windows version in Go,"Is there anyway to detect if the host operating system is XP, Vista, 7, 8, or 10?
runtime.GOOS just returns ""windows"".

The reason for this is because I'm trying to manipulate files in the startup folder.

On windows vista, 7, 8, 10 it's located at: 

%appdata%\Roaming\Microsoft\Windows\Start Menu\Programs\Startup

On windows XP it's located at:

Documents and Settings\%username%\Start Menu\Programs\Startup
",1,
653,44377492,PowerPC version of Go,"I just got access to a powerful Minski IBM machine (Linux) and intend on running some go scripts on it. I have gone through a lot of the versions of golang and tried installing and using them on the machine but none of them seem to work. Is there some special version of GO that I need that is specially designed to work on this powerful computer.

I have now tried installing about 4 or 5 different versions but still keep getting:

The program 'go' is currently not installed. To run 'go' please ask your administrator to install the package 'golang-go'


I was told that there is no need for an administrator to do a system wide install and to just install golang on my machine.

I have been using this step-by-step to install GO on this machine:
https://www.digitalocean.com/community/tutorials/how-to-install-go-1-6-on-ubuntu-14-04

I do not have root access on this machine, just FYI

EDIT:
Problem solved

Had to use: 

curl -O storage.googleapis.com/golang/go1.8.3.linux-ppc64le.tar.gz

",1,44378550.0
654,44398216,Oauth2 Golang - Own database and users,"I'm building a web application in Golang, and at the moment I'm struggling with the authentication/authorization mechanisms.

I want to deploy this app to different platforms (browsers, androids, etc). To achieve this I chosed to use oauth 2.0, namely this lib: https://github.com/golang/oauth2 .

The problem I'm facing is how to achieve this with my own database and users. The lib has a jwt package (https://github.com/golang/oauth2/tree/master/jwt) and also has a package clientcredentials (https://github.com/golang/oauth2/blob/master/clientcredentials/clientcredentials.go) that can be used for 2-legged Oauth 2.0, but I have no idea how to achieve this, and can't find any example showing it. Which package should I use? The token should be set when user sends a POST with its credentials at http://example.domain/login.

Can someone provide me some hints / show me a simple example?
",1,
655,44424331,Compiling go to Android: invalid signature of pthread_key_create,"CGO_CFLAGS=""--sysroot=android-sdk-linux/ndk-bundle/platforms/android-9/arch-arm/"" CGO_ENABLED=1 CC=android-sdk-linux/ndk-bundle/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/bin/arm-linux-androideabi-g++ CXX=android-sdk-linux/ndk-bundle/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/bin/arm-linux-androideabi-g++ \                
    GOOS=android GOARCH=arm go build -buildmode=c-archive --ldflags=""--sysroot=android-sdk-linux/ndk-bundle/platforms/android-9/arch-arm/""
# runtime/cgo
/usr/lib/go-1.8/src/runtime/cgo/gcc_android_arm.c: In function 'void inittls(void**, void**)':
/usr/lib/go-1.8/src/runtime/cgo/gcc_android_arm.c:30:34: error: invalid conversion from 'void*' to 'void (*)(void*)' [-fpermissive]
  err = pthread_key_create(&k, nil);
                                  ^
In file included from /usr/lib/go-1.8/src/runtime/cgo/gcc_android_arm.c:5:0:
/home/janus/Desktop/android-sdk-linux/ndk-bundle/platforms/android-9/arch-arm/usr/include/pthread.h:265:5: note: initializing argument 2 of 'int pthread_key_create(pthread_key_t*, void (*)(void*))'
 int pthread_key_create(pthread_key_t *key, void (*destructor_function)(void *));


The same issue occurs with recent API levels like 22.

I am using the golang-1.8-go package mentioned on https://github.com/golang/go/wiki/Ubuntu
",1,
656,44480989,First argument to append must be slice; have struct - golang map,"Can't seem to use append for this case. Any help would be appreciated.

First argument to append must be slice:

package main

import (
    ""fmt""
)

type C struct {
    value5 string
    value6 string
}

type B struct {
    value3  string
    value4  C
}

type A struct {
    value1 string
    value2 B
}

type X struct{
    key     int
}
func main() {

    letSee := map[X]A{}
    letSee[X{1}]=A{""T"",B{""T1"",C{""T11"",""T12""}}}
    letSee[X{1}]=append(letSee[X{1}], A{""L"",B{""L1"",C{""L11"",""L12""}}})

    fmt.Println(letSee)
}


https://play.golang.org/p/R4gDO9MPBS
",1,44481041.0
657,44481659,Why does this golang program hang in playground when using for loop with select?,"Consider this playground

    messages := make(chan int, 1)
    done := make(chan bool)
    go func() {
        for {
        select {
            case msg := <- messages:
                fmt.Println(""receiver one"", msg)
            case signal := <-done :
                fmt.Println(signal)
                return
            default:
                fmt.Println(""no message received"")
        } 
        }
    }()
    go func() {
        for {
        select {
            case msg := <- messages:
                fmt.Println(""receiver two"", msg)
            case signal := <-done :
                fmt.Println(signal)
                return
            default:
                fmt.Println(""no message received"")
        } 
        }
    }()
    go func() {
       for i := 0; i < 2; i++ {
           messages<-i
       }
       done<-true
       done<-true
       done<-true
    }()

    <-done


I am trying to simulate communicate from one thread to two other thread, but it seems like the above code is running fine in my local but not in playground.

Is there a trick to make the program work?
",2,44482304.0
658,44515677,How to return valid jsonapi response using google/jsonapi and echo framework,"The code bellow return a two concated JSON strings and a wrong content-type text/plain. Should be application/vnd.api+json

package main

import (
    ""github.com/google/jsonapi""
    ""github.com/labstack/echo""
    ""net/http""
)

type Album struct {
    ID   int    `jsonapi:""primary,albums""`
    Name string `jsonapi:""attr,name""`
}

func main() {
    e := echo.New()
    e.GET(""/"", func(c echo.Context) error {
        jsonapi.MarshalManyPayload(c.Response(), albumList())
        return c.JSON(http.StatusOK, c.Response())
    })
    e.Logger.Fatal(e.Start("":1323""))
}

func albumList() []*Album {
    a1 := Album{123, ""allbum1""}
    a2 := Album{456, ""allbum2""}
    albums := []*Album{&a1, &a2}
    return albums
}


faulty output (two concated jsons). The first is a correct jsonapi structure and I think the second is related to echo-framework:

{
  ""data"": [
    {
      ""type"": ""albums"",
      ""id"": ""123"",
      ""attributes"": {
    ""name"": ""allbum1""
      }
    },
    {
      ""type"": ""albums"",
      ""id"": ""456"",
      ""attributes"": {
    ""name"": ""allbum2""
      }
    }
  ]
}
{
  ""Writer"": {},
  ""Status"": 200,
  ""Size"": 133,
  ""Committed"": true
}


This code fix the problem but is seems awkward. I have the feeling there is a better way to facilitate it using echo.

e.GET(""/"", func(c echo.Context) error {
    var b bytes.Buffer
    body := bufio.NewWriter(&b)
    err := jsonapi.MarshalManyPayload(body, albumList())
    if err != nil {
        fmt.Println(err)
    }
    body.Flush()
    return c.JSONBlob(http.StatusOK, b.Bytes())
})


Any idea?
",1,44528288.0
659,44524774,How can I declare a float-typed Go constant of arbitrary bit pattern?,"In Go I can declare a typed float constant like this:

const foo float64 = 1e100


or a float variable of arbitrary bit pattern like this:

var bar = math.Float64frombits(0x7ff8c0c0ac0ffee1)


But this is an error (""const initializer… is not a constant""):

const baz = math.Float64frombits(0x7ff8c0c0ac0ffee1)


How might I declare a typed float const of arbitrary bit pattern?
",3,
660,44589854,Is it possible to debug go revel framework from Visual Studio Code?,"I'm trying to debug a revel app with visual studio but I can't get it to work.

I've seen this question how to debug revel framework(golang) application in visual studio code(vscode) but no answers yet...

I've tried with this config:



{
  ""version"": ""0.2.0"",
  ""configurations"": [
    {
      ""name"": ""Launch"",
      ""type"": ""go"",
      ""request"": ""launch"",
      ""mode"": ""debug"",
      ""remotePath"": """",
      ""port"": 2345,
      ""host"": ""127.0.0.1"",
      ""program"": ""~/code/go/bin/revel"",
      ""env"": {},
      ""args"": [],
      ""showLog"": true
    }
  ]
}




But I'm getting this error:
Failed to continue: ""The program attribute must point to valid directory, .go file or executable.""

I think it must be the rebel binary the one to be run here, but I don't know how to pass the app path, should it go in ""args""?
",1,44594408.0
661,44594289,Unmarshall both flat and nested jsons in golang,"Say I want to be able to handle both nested and unnested jsons of the following form, as in this example:

source_json_1 := `{""owner"": ""John"", ""nickname"": ""Rose"", ""species"": ""Dog""}`
source_json_2 := `{""owner"": ""Doe"", ""Pet"": [{""nickname"": ""Rose"", ""species"": ""Dog""},
                                          {""nickname"": ""Max"", ""species"": ""Cat""}]}`


If I define Pet as an embedded struct I can easily unmarshal it with:

type Owner struct {
    Name string
    Pet
}

type Pet struct {
    NickName    string
    Species     string
}


Resulting in John's pet getting adequately marshalled.

{John {Rose Dog}}
{Doe { }}


But since Pet can actually also be a slice of Pets, Doe's Pets are not correctly unmarshalled. If instead go with

type Owner struct {
    Name string
    Pet  []Pet
}


Then Doe gets marshalled just fine.

{John []}
{Doe [{Rose Dog} {Max Cat}]}


How can I catch both cases?

I'd prefer to marshall it into a slice of Pets in the end, no matter what.
",1,44594347.0
662,44650198,Unmarshal Dynamic JSON,"I receive dynamic JSON from an API that follows this pattern:

{
    ""ts"": timestamp,
    ""data"": [
        [ code1, payload1 ],
        [ code2, payload2 ],
        ...
    ]
}


For example the raw data will be:

    var streamSnapshot = []byte(

`{ 
   ""ts"": 1496244373.04,
   ""data"":[
      [""xrate"", {""rate"":1.2916,""ccy"":""USD""}],
      [""balance"", 
         {
            ""open_stake"":[""GBP"", 0.0],
            ""balance"":[""GBP"", 0.0]
         }
      ],
      [""event"", 
         {
            ""competition_id"":""545"",
            ""ir_status"":""pre_event"",
            ""start_time"":""2017-09-10T17:00:00+00:00"",
            ""competition_name"":""USA NFL"",
            ""event_id"":""2017-09-10,21617,21635"",
            ""home"":""Buffalo Bills"",
            ""away"":""New York Jets"",
            ""sport"":""af"",
            ""competition_country"":""US""
         }
      ],
      [""sync"", {""Token"":""eb1c57132d004f8d8fb967c076921fac""}]
   ]
}`)


Considering that we want to avoid unmarshalling to a struct like this:

type StreamMessage struct {
    Data [][]interface{} `json:""data""`
    Ts   float64         `json:""ts""`
} 


where we would have to cast the data back like:

    m := raw.(map[string]interface{})

    switch messageType {
    case XRATE:
        xrate := XRate{
            Message: Message{
                Type:      XRATE,
                TimeStamp: msg.Ts,
            },
            rate: m[""rate""].(float64),
            ccy:  m[""ccy""].(string),
        }  
     ...


What would be the better way of unmarshalling this?
",1,
663,44675087,Golang template variable isset,"I have created a function to check if a variable is defined:

fm[""isset""] = func(a interface{}) bool {
        if a == nil || a == """" || a == 0 {
            fmt.Println(""is not set"")
            return false
        }
        fmt.Println(""is set"")
        return false
    }

tmpl :=  template.Must(template.New("""").Funcs(fm).ParseFiles(""templates/header.html""))

err := tmpl.ExecuteTemplate(w, ""header"", templateData)


In the template I have:

{{ if isset .Email }}
    email is set
{{ end }}


This function works if the variable is contained by the templateData (which is a custom struct that contains a map and a string), but it gives me an error if the variable doesn't exist.

The error is: 

executing ""header"" at : can't evaluate field Email in type base.customData


In my case ""base.go"" is the handler and ""customData"" is defined by: type customData struct{..}.

I want to be able to reuse templates and to display some sections only if some variables are sent from the handler. Any idea how can I implement a variable isset check on the template side?

I also tried using: {{ if .Email}} do stuff {{ end }} but this also gives me the same error.

Any idea?
",2,44676179.0
664,44687426,"How to have ZeroMQ to timeout messages that are outbound queued, but haven't been sent within a set time?","I have an application running on a server which takes requests from a phone app and then load balances the request across worker servers. I'm trying to add a timeout in the case that messages on the main server that have been in the outbound queue for the length of the timeout are removed from the queue. More specifically, the application on the main server is written in golang and implements the Paranoid Pirate Pattern of load balancing. The code I currently have is:

import (
    ""fmt""
    zmq ""github.com/pebbe/zmq4""
    ""time""
)

const (
    HEARTBEAT_LIVENESS = 3
    HEARTBEAT_INTERVAL = 1500 * time.Millisecond

    MESSAGE_READY     = ""\001""
    MESSAGE_HEARTBEAT = ""\002""
)

var (
    client *zmq.Socket
    backend *zmq.Socket
    frontend *zmq.Socket
    workerPoller *zmq.Poller
    brokerPoller *zmq.Poller
    workerQueue []Worker
)

type Worker struct {
    Id string
    Expire time.Time
}

type RequestWrapper {
    RequestToSend Request

}

func NewWorker(id string) Worker {
    return Worker{
        Id: id,
        Expire: time.Now().Add(HEARTBEAT_INTERVAL * HEARTBEAT_LIVENESS),
    }
}

func AddReadyWorker(workers []Worker, worker Worker) []Worker {
    fmt.Println(worker.Id, "" joined"")
    for i, w := range workers {
        if worker.Id == w.Id {
            if i == 0 {
                workers = workers[1:]
            } else if i == len(workers)-1 {
                workers = workers[:i]
            } else {
                workers = append(workers[:i], workers[i+1:]...)
            }
            break
        }
    }
    return append(workers, worker)
}

func PurgeInactiveWorkers() {
    now := time.Now()
    for i, worker := range workerQueue {
        if now.Before(worker.Expire) {
            workerQueue = workerQueue[i:]
            return
        }
    }

    workerQueue = workerQueue[0:0]
}

func LoadBalance() {
// Loop:
    heartbeat := time.Tick(HEARTBEAT_INTERVAL)
    for {
        var sockets []zmq.Polled

        // If you have available workers, poll on the both front and backend
        // If not poll on backend with infinite timeout
        if len(workerQueue) > 0 {
            sockets, _ = brokerPoller.Poll(HEARTBEAT_INTERVAL)
        } else {
            sockets, _ = workerPoller.Poll(HEARTBEAT_INTERVAL)
        }

        for _, socket := range sockets {
            switch socket.Socket {
                // backend is a router
                case backend:
                    workerId, _ := backend.Recv(0)
                    workerQueue = AddReadyWorker(workerQueue, NewWorker(workerId))
                    clientId, _ := backend.Recv(0)
                    if clientId != MESSAGE_READY && clientId != MESSAGE_HEARTBEAT {
                        route, _ := backend.Recv(0)
                        message, _ := backend.RecvBytes(0)

                        fmt.Println(""Received response"")
                        RouteResponse(route, message)

                        // frontend.Send(clientId, zmq.SNDMORE)
                        // frontend.Send("""", zmq.SNDMORE)
                        // frontend.SendBytes(message, 0)
                    }
                // frontend is a dealer
                case frontend:
                    clientId, _ := frontend.Recv(0)
                    route, _ := frontend.Recv(0)
                    message, _ := frontend.RecvBytes(0)

                    backend.Send(workerQueue[0].Id, zmq.SNDMORE)
                    backend.Send(clientId, zmq.SNDMORE)
                    backend.Send(route, zmq.SNDMORE)
                    backend.SendBytes(message, 0)

                    workerQueue = workerQueue[1:]
            }
        }

        select {
            case <-heartbeat:
                for _, worker := range workerQueue {
                    backend.Send(worker.Id, zmq.SNDMORE)
                    backend.Send(MESSAGE_HEARTBEAT, 0)
                }
                break
            default:
        }

        PurgeInactiveWorkers()
    }
}


If the backend sends a message, but it is not actually sent to a worker in some period of time, I want it to expire and not ever be sent. Is there a socket option that can accomplish this? If not, what would I have to do to accomplish this?

Two ways I think I can do this without socket options are:

1) Have the backend wrap the message in a wrapper and send to a golang queue and not through zeromq. The wrapper contains the time that the message was ""sent"". The backend concurrently pulls from the front of the golang queue one at a time and checks if the message is expired. If so, don't send, if not, send the message. I could have the backend add the message to the golang queue first and then truly send it out after in the same block of code. That way, I don't need a lock.

2) Send the wrapper message through zeromq to a retriever and the retriever checks if its expired and returns early. I don't like this because it seems like its bad for performance.
",3,44960239.0
665,44759016,Conditional imports golang,"I am quite new with Go, and I am struggling to import a package only if it exists. Is there a way to do this? I tried with ""_"" before the package name, but if the package does not exist the program won't compile. I am aware that I could be on the wrong road, but how else should I treat this case in which I want to import a package only if it exists?
",1,44759792.0
666,44812324,How to avoid a long switch-case statement in Go,"I'm writing a chat bot in Go and wondering how can I avoid a long switch-case statement similar to this one:

switch {

// @bot search me HMAC
case strings.Contains(message, ""search me""):
    query := strings.Split(message, ""search me "")[1]
    return webSearch(query), ""html""

// @bot thesaurus me challenge
case strings.Contains(message, ""thesaurus me""):
    query := strings.Split(message, ""thesaurus me "")[1]
    return synonyms(query), ""html""


Should I define those handlers each in a separate package or should I just use structs and interfaces? Which method will allow me to have a good structure, avoid switch-case and let external developers to easier create handlers?

I think packages will be a better choice but I'm not sure how to register the handlers with the main bot. Would appreciate an example.
",1,44812828.0
667,44833044,Executable files not in path - GO,"I'm trying to call a built in command for the command prompt and I'm getting errors I don't understand.

func main() {
    cmd := exec.Command(""del"", ""C:\trial\now.txt"")
// Reboot if needed
    cmd.Stdout = os.Stdout
    if err := cmd.Run(); err != nil {
        log.Fatal(err)
    }
}


And I'm getting the following error:

exec: ""del"": executable file not found in %PATH%
exit status 1


What am I doing wrong?
",2,44833099.0
668,44847607,golang template.JS to string and template.HTML to string,"I'm using ""html/template"".

How do I convert the value of a template.JS object to a string? What about template.HTML?

I have a struct where I store some js scripts and css code/files, such as: ""HeaderCSS"", ""FooterJS"". I load them to the header/footer of my templates. The problem is that I need to check if they are loaded, so I won't load the same script twice (each reload means a new script load) because I'm using append, in order to be able to insert multiple scripts. In this way, each refresh will append the scripts to the existing scripts.

My idea is to check if they are allready loaded in order to prevent loading them multiple times. I was thinking about using strings.Contains() function. But I can't do that since I don't know to convert templates.HTML and templates.JS to string. 

Any idea?
",1,44847651.0
669,44852289,decrypt with public key,"How can I decrypt a message signed with a private key in golang?

$ openssl genrsa -out ./server/server.key
Generating RSA private key, 2048 bit long modulus
..................+++
.............................................+++

$ openssl rsa -in ./server/server.key -pubout -out ./client/client.pub
writing RSA key

$ echo ""secret"" | openssl rsautl -inkey ./server/server.key -sign > ./secret

# decrypt with public key
$ openssl rsautl -inkey ./client/client.pub -pubin -in ./secret
secret

",2,
670,44889128,Basic Client/Server Architecture & Interactions,"I'm trying to implement a client and server and define their interactions. The client is designed using Golang, the server is designed in Node.js, and they interact using gRPC.

So the basic gist is:


Client contacts server to update backend DB
Client receives success response from server
Client then itself changes the state of the overall system that the DB now reflects


But say something were to happen such that the process dies between steps 2 and 3 (Client process is terminated somehow). What is the best way to ensure that my backend DB doesn't reflect a system state that is inconsistent with reality? I'm sure this isn't a novel problem and would just like a couple pointers to how people typically cope with this type of design.


So I've already thought of redesigning this interaction such that the server is the entity that will handle the system changes— that way everything is handled in the same request and on the backend— but I'm using an open source technology that is designed in Go (so I can easily wrap it in my Go client). In other words, the client must be the entity that performs that system-change operation.

Thanks in advance!
",1,
671,44895535,unmarshal json array into go struct (array is in the middle of the JSON string,"I am new to Go. I am working with a weather API. I have commented out the sections that cause the error. I have seen several other links that have a similar problem, however none of them seem to have the array in the middle of the JSON string. I'm sure there is a way to define the struct with a slice. I can't seem to get get the syntax to allow it. Here is where I'm stuck:

package main

import (
    ""encoding/json""
    ""fmt""
    ""io/ioutil""
    ""log""
    ""net/http""
)

// WeatherData struct to collect data from the API call
type WeatherData struct {
    Wind Wind
    Sys  Sys
    // Weather Weather
    Name string `json:""name""`
}

////////////// ERROR when unmarshalling this struct /////////
// Weather provides basic weather info
// type Weather struct {
//  ID      int    `json:""id""`
//  Descrip string `json:""description""`
//  Icon    string `json:""icon""`
// }
/////////////////////////////////////////////////////////////

// Sys includes sunrise, sunset, country, etc.
type Sys struct {
    Country string `json:""country""`
}

// Wind struct to get specific wind characteristics
type Wind struct {
    Speed  float64 `json:""speed""`
    Degree float64 `json:""deg""`
    Gust   float64 `json:""gust""`
}

func main() {
    res, getErr := http.Get(""http://api.openweathermap.org/data/2.5/weather?zip=REMOVED,us&appid=REMOVEDBUTWILLPOSTJSONData"")
    if getErr != nil {
        log.Fatalln(""http.Get error: "", getErr)
    }
    defer res.Body.Close()
    body, readErr := ioutil.ReadAll(res.Body)
    if readErr != nil {
        log.Fatalln(""Read Error: "", readErr)
    }
//////////// UNABLE TO UNMARSHAL the array that passes through here ////
    var data WeatherData
    if err := json.Unmarshal(body, &data); err != nil {
        panic(err)
    }

    fmt.Println(""Wind gusts: "", data.Wind.Gust)
    fmt.Println(""Wind speed: "", data.Wind.Speed)
    fmt.Println(""Wind degrees: "", data.Wind.Degree)

    fmt.Println(""Country is: "", data.Sys.Country)
    fmt.Println(""City is: "", data.Name)

///////////////// CAN'T ACCESS Description...or anything in Weather
// fmt.Println(""Country is: "", data.Weather.Descrip) // cannot access due to this portion being inside an array

}



/////////////////THIS IS THE JSON DATA THAT IS AVAILABLE ///////////
{
  ""coord"": {
    ""lon"": -97.31,
    ""lat"": 32.94
  },
  ""weather"": [  // CAN'T ACCESS THIS CORRECTLY
    {
      ""id"": 800,
      ""main"": ""Clear"",
      ""description"": ""clear sky"",
      ""icon"": ""01d""
    }
  ],
  ""base"": ""stations"",
  ""main"": {
    ""temp"": 306.46,
    ""pressure"": 1014,
    ""humidity"": 55,
    ""temp_min"": 306.15,
    ""temp_max"": 307.15
  },
  ""visibility"": 16093,
  ""wind"": {
    ""speed"": 5.1,
    ""deg"": 150,
    ""gust"": 7.2
  },
  ""clouds"": {
    ""all"": 1
  },
  ""dt"": 1499120100,
  ""sys"": {
    ""type"": 1,
    ""id"": 2597,
    ""message"": 0.0225,
    ""country"": ""US"",
    ""sunrise"": 1499081152,
    ""sunset"": 1499132486
  },
  ""id"": 0,
  ""name"": ""Fort Worth"",
  ""cod"": 200
}

",1,44895648.0
672,44979398,Golang JSON-RPC Server Control at Shutdown,"I am writing a Shutdown Handler for a Program which uses Golang's built-in JSON-RPC Server and I have faced a difficulty. Could you help me with it?

I stop accepting incomming Connections, stop accepting incoming Requests for existing Connections (send an Error, to be true) but I have a Moment which I can not control or, at least, I do not know how to control.

The Question is:

How do I guarantee that Results of exisiting Requests of existing Connections are given to Clients of Golang's built-in JSON-RPC Server?

I want to control that Structure which calls RPC Methods, but it is not in my Code. For Example, I have an RPC Action 'User.Get'. I have a function named 'Get' which I control. How do I control the Code which starts this 'Get' function? Do I have to modify Google's RPC Server or is there any more effecient way?

Maybe, there is some Variable in RPC Server which holds the Number of active Requests being processed?

I see a NumCalls() and numCalls in the methodType in https://golang.org/src/net/rpc/server.go. The Problem is that this Field is not public... Moreover, the .../rpc/server.go uses sync.Map which does not compile. My Version of Golang is too old? :)

Seems that for now the easiest Way is to manipulate a global Counter from all the RPC Action Functions. :-) If you know a better Solution, please, tell me. Thanks. :-)
",1,44992313.0
673,44986977,Go package with a loaded once set of data,"I am writing a post code location lookup package, it loads in all uk postcodes from a csv, I would like to only load the data once I would like to know what is the best pattern to achieve this with Go.

type Location struct {
    Latitude float64
    Longitude float64
}

var postCodeCache = make(map[string]Location)


These are my data types, currently I have a function called LoadData and LookupPostCode(). Ideally I would want to import my package and it would automatically load the data if it was not already loaded.
",2,
674,45024152,Error when trying to inject dependency,"I'm trying refactor some code to use dependency injection for the Docker client library I use in my code. I created an interface with the method I want to be able to mock


type DockerClient interface {
    Ping(context.Context) (types.Ping, error)
}

func NewDockerUtil() (*DockerUtil, error) {
    var dockerClient *DockerClient
    var err error
    dockerClient, err = client.NewEnvClient() //Reports incompatible types in binary and unary expressions.
    if err != nil {
        return nil, err
    }
    return &DockerUtil{
        Client:        dockerClient,
    }, nil
}

type DockerUtil struct{
    Client        *DockerClient
}


But when I try to assign it I get Reports incompatible types in binary and unary expressions. What exactly do I need to change?
",1,45024418.0
675,45075598,"Azure cosmosDB(mongoDB), how to disable the automatic indexing in a collection in GO lang or via Shell","I tried to delete the DocumentDBDefaultIndex manually through mongo shell and also through my GO code but it still exists. I don't want to have those default indexes lying around which would consume unnecessary space; I actually only need some _id, unique and text indexes.
",1,45098675.0
676,45088229,Generic remove() function for slices,"I have 3 slices (foos, bars, bazs) that are each populated with a different type of struct. In an attempt to remove some boilerplate code, I wanted to create a generic remove(slice, struct) slice function. Similar to being the opposite of append() provided in the standard. 

None of the structs will be pointers so there's no need to nil them. I've flirted with the idea of using interface{} to get the desired result to no avail. Current implementation uses a Type Switch and then has a near copy-pasted remove() (example in playground link below) to delete from the slice. As I continue to expand the project- it will grow to more boilerplate.

Example of what is being attempted:
https://play.golang.org/p/9UPRIIp5M2

Function input: []slices, struct
Expected output: 
    Modified (removed struct) []slices if struct is found
    Or, Unmodified []slices if it isn't.


If it was simple and easy to implement. I imagined it would already exist in the standard. However, it never hurts to get the advice from more seasoned professionals as to if what I am attempting to do is even possible.

Thank you for you time.
",2,45089928.0
677,45108286,How to create sftp client over exist ssh connection on golang,"guys! I need help. I tried to create a new sftp connection over existing ssh client that i made few minutes ago. I can't. And idk why.

Here is a pie of code:

    config := &ssh.ClientConfig{
        User: *loginArg,
        Auth: []ssh.AuthMethod{
            ssh.Password(*passArg),
        },
        HostKeyCallback: func(hostname string, remote net.Addr, key ssh.PublicKey) error {
            return nil
        },
    }

    addr := fmt.Sprintf(""%s:%d"", *ipArg, *portArg)
    client, err := ssh.Dial(""tcp"", addr, config)
    if err != nil {
        fmt.Printf(""Failed to dial: %s"", err)
    }
    fmt.Println(""Successfully connected to "", *ipArg, "":"", *portArg)

    session, err := client.NewSession()
    if err != nil {
        fmt.Printf(""Failed to create a new session: %s"", err)
    }
    defer session.Close()

    b, err := session.CombinedOutput(""/system backup save name=BackUp dont-encrypt=yes"") // /system backup save name=BackUp dont-encrypt=yes
    if err != nil {
        fmt.Printf(""Failed to send output command: %s"", err)
    }
    fmt.Print(string(b))

    //*******************
    var conn *ssh.Client
    sftp, err := sftp.NewClient(conn)
    //sftp, err := sftp.NewClient(conn) //err
    if err != nil {
        log.Fatal(err) //fmt.Printf(""Failed to create new sftp-client: %s"", err)
    }
    defer sftp.Close()

",1,
678,45207920,How does golang type cast internally work? What is the memory utilization for the same?,"How does golang type cast internally work?

What is the memory utilisation for a type cast? 
For example:

var str1 string
str1 = ""26MB string data""
byt := []byte(str1)
str2 := string(byt)


whenever I type cast any variable, will it consume more memory?

Iam concerned about this because when I try to unmarshall, I get ""fatal error: runtime: out of memory""

err = json.Unmarshal([]byte(str1), &obj)


str1 value comes from HTTP response, but read using ioutils.ReadAll, hence it contains the complete response.
",1,45209033.0
679,45299133,Go lang json decode mapping,"How can I map each element to struct or map. Base on the json data that has different types.

{
  profile: {
    execution_time: 34,
    server_name: ""myServer.net""
  },
  result: ""ok"",
  ret: [
    {
      alias: ""asda444444"",
      all_parents: [
        123,
        2433369,
        243628,
        2432267,
        62
      ],
      bankrupt: false,
      block: false,
      card: null
    }
  ]
}


I had tried this already. But not work as expected.

var o map[string]interface{}
err := json.Unmarshal(data, &o)
if err != nil {
        revel.INFO.Println(""Json Decode Error"", err)
    }
fmt.Println(o)


By this way, I can only get o[""ret""]. What I really want is o[""ret""][""alias""] or o[""ret""][""all_parents""].

Any suggestions or tips will helps. Thanks.
",1,45299316.0
680,45308108,HTTPS proxy with caddy,"I am working with a Golang app and Caddy as the HTTP server. The golang app rejects every http connection, it only can be used over HTTPS. This app is a kind of API/service that is consumed by other apps. As, it requires HTTPS I installed Caddy so I can take advantage of the automatic SSL certificate and use proxy to switch between the ports.

The application is running in the port 9000, so, the consumers will only writte mysite.com and caddy should be in charge of redirect that petitions to the port 9000 but maintaining the HTTPS. The configuration in caddy for the site is:

mysite.com {
    proxy / :9000 {
        max_fails 1
    }
    log logfile
}


Nevertheless, it seems like when the proxy is made the HTTPS is lost. I checked the logs for the application (no the logs of caddy) and I get this:

http: TLS handshake error from xxx.xxx.xxx.xxx:xxxx: tls: oversized record received with length 21536


So, based in this error, to me looks like the HTTP proxy  made by caddy is losing the HTTPS. What can I do?
",1,45308172.0
681,45309657,CSS and images from a different folder are not read when rendering template using Golang,"I am trying to render a template using the html/template module of Golang. But only CSS files and images from the same folder as the page i am rendering are executed, those located in a different folder are ignored. Here is my code:

func render(w http.ResponseWriter, filename string, data interface{}) {
    tmpl, err := template.ParseFiles(filename)
    if err != nil {
      http.Error(w, err.Error(), http.StatusInternalServerError)
    }
    if err := tmpl.Execute(w, data); err != nil {
      http.Error(w, err.Error(), http.StatusInternalServerError)
    }
  }


For this page for example:


  
  
  
  
  
  Start Connect
  
  



The one-page.css is executed but not the bootstrap.
",1,
682,45317074,Best practices constructing an empty array in GoLang?,"I'm wondering about best practices when initializing empty arrays.


  i.e.  Is there any difference here between arr1, arr2, and arr3?


myArr1 := []int{}
myArr2 := make([]int,0)
var myArr3 []int


I know that they make empty []int but I wonder, is one syntax preferable to the others? Personally I find the first to be most readable but that's beside the point here. One key point of contention may be the array capacity, presumably the default capacity is the same between the three as it is unspecified. Is declaring arrays of unspecified capacity ""bad""? I can assume it comes with some performance cost but how ""bad"" is it really?


  /tldr



Is there any difference between the 3 ways to make an empty
array? 
What is the default capacity of an array when unspecified?
What is the performance cost of using arrays with unspecified capacity?

",3,45317241.0
683,45333364,Golang unmarshal XML attribute into interface,"I'm trying to unmarshal some XML into a structure with an interface{} type. However whenever I try to run it, the code doesn't pick up anything at all. All of the other elements appear to work fine, and if I set the type to string or []byte it will work, however I need it to be more flexible than that.

The element I am interested in is on line 32 - FloorRefID

https://play.golang.org/p/Ehr8qx1aWf


    
       
          
             
          
          
       
       
          
            
          
          
       
       
          
          
       
    


To give some context; I am working on a project integrating with a vendor in which sometimes we receive the data as XML and sometimes as JSON. I wanted to build something that could unmarshal the structure for both, rather than duplicating the structure set. It has many substructures which means that its a lot more work to keep 2 structures which are almost identical except for this one attribute.

When we receive the JSON data, the field can be given as a string or a number.

I have read that you cannot unmarshal into an interface, but does anyone know of a way around this issue for my scenario?
",1,45333669.0
684,45361846,docker-compose oci runtime error executable file not found (in linked container),"I'm trying to setup docker & compose for running integration tests

I have the following docker-compose.yml

version: '3'
services:
    tests:
        build:
            context: .
            dockerfile: Dockerfile.tests
        links:
            - web
            - maindb
    web:
        build:
            context: .
            dockerfile: Dockerfile.web
        ports:
            - ""8080:8080""
        volumes:
            - .:/code
            - logvolume01:/var/log
        links:
            - maindb
    maindb:
        image: postgres
        environment:
            POSTGRES_PASSWORD: example

volumes:
    logvolume01: {}


web container itself works pretty fine

$ docker-compose  -p wh  run web
Starting wh_maindb_1 ... done
2017/07/27 22:05:34 [I] http server Running on http://:8080


But when I run tests container, I get the error

$ docker-compose  -p wh  run tests
Starting wh_maindb_1 ... done
Starting 6faff07f7671_6faff07f7671_wh_web_1 ... 
Starting 6faff07f7671_6faff07f7671_wh_web_1 ... error

ERROR: for 6faff07f7671_6faff07f7671_wh_web_1  Cannot start service web: oci runtime error: container_linux.go:262: starting container process caused ""exec: \""web\"": executable file not found in $PATH""


Here is my Dockerfile.web

$ cat Dockerfile.web 
FROM ubuntu:xenial
WORKDIR /app
ADD bin/* /app/
CMD [""/app/web""]


/app/web is dynamically linked daemon written in Golang 1.6

And some version info

$ docker version 
Client:
 Version:      17.06.0-ce
 API version:  1.30
 Go version:   go1.8.3
 Git commit:   02c1d87
 Built:        Fri Jun 23 21:23:31 2017
 OS/Arch:      linux/amd64

Server:
 Version:      17.06.0-ce
 API version:  1.30 (minimum version 1.12)
 Go version:   go1.8.3
 Git commit:   02c1d87
 Built:        Fri Jun 23 21:19:04 2017
 OS/Arch:      linux/amd64
 Experimental: false

$ docker-compose version
docker-compose version 1.14.0, build c7bdf9e
docker-py version: 2.4.2
CPython version: 2.7.12
OpenSSL version: OpenSSL 1.0.2g  1 Mar 2016

",1,45379942.0
685,45368284,Wait for a non child Process to end,"Hi I am working on a simple code that will monitor a process and restart the process in case the process crashes. I have written a small sample code.

This is my external process

package main

import (
    ""fmt""
    ""time""
)

func main() {
    for {
        time.Sleep(1000 * time.Millisecond)
        fmt.Println(""hello"")
    }
}


This is the code that monitors it.

package main

import (
    ""fmt""
    ""os""
)

func main() {
    p, e := os.FindProcess()
    fmt.Println(e)
    fmt.Println(p.Wait())
    fmt.Println(""done"")
}


The challenge here is that since the first process is not a child process of the second one, it does not wait and directly exits. 
Please let me know if anyone has any ideas around this.

Thanks.
",1,
686,45388814,A function within a structure. Why?,"What is the use case/advantage of defining a function within a structure in go?

type demo struct {
    F func()
}

",2,
687,45427963,What happens if you read a channel to nothing?,"Can you read a goroutine channel into nothing?  where does this channel read go to in this statement?

go func() {
  <-ctx.Done()
  logger.Errorf(""canceled: %v"", ctx.Err())
}()


Addition:

Would this code be any different than if I used the blank identifier

go func() {
  _ = <-ctx.Done()
  logger.Errorf(""canceled: %v"", ctx.Err())
}()

",1,
688,45443848,How to avoid running into max open files limit,"I'm building an application that will be downloading roughly 5000 CSV files concurrently using go routines and plain ol http get requests. Downloading the files in parallel.

I'm currently running into open file limits imposed by OS X.

The CSV files are served over http. Are there any other network protocols that I can use to batch each request into one? I don't have access to the server, so I can't zip them. I'd also prefer not to change the ulimit because once in production, I probably won't have access to that configuration.
",1,
689,45444880,Goroutine causes interchangable actions in for loop,"I'm very new to go and I'm not sure why this code has this output.  I understand that sleep will cause the new goroutine to start the other thread for the specified amount of time.  I'm trying to sequentially map out the logic and it looks like ""world"" should always print before ""hello"".  

package main

import (
    ""fmt""
    ""time""
)

func say(s string) {
    for i := 0; i < 5; i++ {
        time.Sleep(1 * time.Millisecond)
        fmt.Println(s, i)
    }
}

func main() {
    go say(""world"")
    say(""hello"")
}


Actual Output:

world 0
hello 0
hello 1
world 1
world 2
hello 2
hello 3
world 3
world 4
hello 4


Expected Output:

world 0
hello 0
world 1
hello 1
world 2
hello 2


...etc
",3,
690,45596789,"Fast way of converting a slice of type T, to a slice of byte in Go","I have slices of different types, and I need to send them with TCP. The length of my slices is large, and not a constant value. Is there any way that I can convert the slices into []byte without looping through individual elements? For example, I want something like this (assuming mySlice elements are 4 Bytes here): 

byteSlice := (*[4 * len(mySlice)]byte)(unsafe.Pointer(&mySlice[0]))


but it won't work, since 4 * len(mySlice) is not a constant.

Thank you.
",2,
691,45618300,Can golang protocol buffers with gRPC be cross compiled and used on different OS platforms?,"This question is specifically about compiling and using golang protocol buffers (with gRPC) on different OS platforms and I haven't seen any like it. Is it possible to compile a .proto file on Windows, and then use the generated file on Linux? Or vice versa?

I compiled the same .proto file on both Windows and Linux and diff showed different results. One difference is that the Windows compiled version sometimes repeats json in fields of request structs like this: Field1Name *type`protobuf ,bytes,1,opt,name=my_name,json=myName"" json:""my_name,omitempty""` whereas the Linux version is: Field1Name *type`protobuf ,bytes,1,opt,name=my_name"" json:""my_name,omitempty""`. This happens a lot, sometimes all the fields have this issue, sometimes only some of them, and sometimes none of them for a given request struct. 

The other difference is that the fileDescriptor at the bottom is completely different for the two versions. The Windows version is longer by about 40 lines. 
",1,45619883.0
692,45652560,Interfaces and pointer receivers,"I am newbie gopher and trying to get my head around the pointer receivers and interfaces. 

type Foo interface {
    foo()
}
type Bar struct {}
func (b *Bar) foo() {}


based on the above definitions..

--- Allowed ---------
b := Bar{}
b.foo()

--- Not allowed ----- 

var foo Foo = Bar{}


Get compiler error:
cannot use Bar literal (type Bar) as type Foo in assignment:
    Bar does not implement Foo (foo method has pointer receiver)

I understand that compiler is doing some pointer conversion and de-referencing on our behalf in the first scenario. Why doesn't it do the same thing in the second scenario ?
",3,
693,45711053,What is the best way to synchronize tests in different packages which involve with a global variable?,"I'm working on a go project, my task is writing some tests for a package. The tests need to access a global variable in a different package. This global variable might be setup/access in different packages' testing. Because by default go testing runs in parallel for different packages. Therefore, setup/access to this variable might create race conditions. 

The easiest way to synchronize is to create a shared sync.Mutex which spans in the different packages. Having said that, I tried to put this sync.Mutex in the xxx_test.go of xxx.go in which the global variable is declared, unfortunately, another package was not able to access this Mutex due to scope limitation. Eventually, I figured out I have to put this sync.Mutex to a utility package which is dedicated to testing, then different packages can access this Mutex to achieve sync purpose for that global variable.

I'm new to go lang. I just felt it's awkward that I need to create a utility package to just achieve sync purpose in the testing, on the other hand, if another developer does some testing in another package, he/she probably doesn't know where to find this sync.Mutex. Is there any better way to achieve this sync purpose with an elegant solution. 

Many thanks!
",1,
694,45718580,Customize mgo upsert operation,"I've a game analytics rest API which stores the average performance statistics of the players. When a new statistic arrives, I want to update the existing game record in Mongodb by merging the new delta onto the existing document. I'm storing the past analytics data as well. So that, I can return data like the player's stats are decreasing or increasing since the game's last update.

The problem is: When I want to upsert my new game data into Mongodb with mgo, it overwrites all of a player's stats array. Actually, this is expected. I know how to fix it if I can modify my document that mgo tries to upsert into Mongodb.

Question: How can I customize mgo upsert behaviour? So that I can add a $push operator in front of Player.Stats to prevent Mongodb erasing the stats array inside the document.

My Real Question: It doesn't matter which Mongo commands I'm going to use. I'll figure it out somehow. What I actually want to know is: How can I customize the behaviour of mgo before upsert?

Some Solutions: I've tried some solutions myself before. Like, encoding/decoding Game struct into bson.M to customize it. However, I found it cumbersome and messy. If there's no other way, I'd use it.

Blocks: I don't want to hand-write all of my structs fields with bson.M, just to use a $push operator on one field. Because there are dozens of fields, that would be error-prone and will increase my code complexity.



Example:

// Assume that, this is an existing game in Mongodb:
existingGame := Game{
    ID: 1,
    Name: ""Existing game"",
    // The game has just one player
    Players: []Player{
        // The player has some stats. The newest one is 2.0.
        {1, ""foo"", []{3.5, 2.0}},
    }
}

// This is a new request coming to my API
// I want to upsert this into the existing Game
newGame := Game{
    ID: 1,
    Players: []Player{
        // As expectedly, this will reset player foo's stats to 5.0
        //
        // After upserting, I want it to be as: 
        //
        // []{3.5, 2.0, 5.0}
        //
        // in Mongodb
        {1, ""foo"", []{5.0}},
    }
}

// Example 2:
// If new Game request like this:
newGame := Game{ID: 1, Players: []Player{{1, ""foo"", []{5.0},{1, ""bar"", []{6.7}}}}
// I'm expecting this result:
Game{ID: 1, Players: []Player{{1, ""foo"", []{3.5, 2.0, 5.0},{1, ""bar"", []{6.7}}}}

func (db *Store) Merge(newGame *Game) error {
    sess := db.session.Copy()
    defer sess.Close()

    col := sess.DB(""foo"").C(""games"")
    // I want to modify newGame here to add a $push operator
    // into a new `bson.M` or `bson.D` to make mgo to upsert
    // my new delta without resetting the player stats
    _, err := col.UpsertId(newGame.ID, newGame)

    return err
}

type Game struct {
    ID int `bson:""_id""`
    Name string
    Players []Player `bson:"",omitempty""`
    // ...I omitted other details for simplicity here...
}

type Player struct {
    // This connects the player to the game
    GameID int `bson:""game_id""`
    Name string
    // I want to keep the previous values of stats
    // So, that's why I'm using an array here
    Stats []float64
    // ...
}


I tried this Mongodb command in the console to update the specific game's player:

db.competitions.update({
   _id: 1,
   ""players.game_id"": 1
}, {
   $push: { 
       ""players.$.stats"": 3
   }
}, {
   upsert: true
})

",1,45732044.0
695,45741209,Never ending Ticker in Golang works only 2 times,"I'm trying to make a channel with never ending ticker, but it works only 2 times.

Could you help me to understand where is the problem?

Code:

package main 

import (
""fmt""
""time""
) 

var mark = [2]float64{8.9876, 762.098568}

func tick(out chan <- [2]float64){

    c := time.NewTicker(time.Millisecond *500)
    for range c.C{
        out <- mark
    }
}

func main() {

    fmt.Println(""Start"")

    md := make(chan [2]float64)
    go tick(md)

    for range <-md{
        fmt.Println(<-md)
    }
}


Output:

Start
[8.9876 762.098568]
[8.9876 762.098568]


Example: https://play.golang.org/p/P2FaUwbW-3 
",1,45741268.0
696,45751869,http.Server Serve method hangs when calling Shutdown immediately,"I have an issue with Go's http.Server, which I'm embedding in a struct that is supposed to control the server startup and shutdown. The struct looks like this:

type HTTPListen struct {
    Consumers []pipeline.Consumer
    Cfg       HTTPListenConfig
    Srv       *http.Server
    Logger    log.Logger
    wg        *sync.WaitGroup
    mu        sync.Mutex
    state     State
}


The issue is that in my test code, I call my struct's Start() method (which in turn runs the Serve() method on the http.Server), check a few vars, and then call Stop(), whitch Shutdown()s the server and then waits for the http.Server to exit (return err from the Serve() method).

Now, for some reason, the Serve() method seems to just hang on the WaitGroup.Wait(), when I try to shutdown the server immediately after starting. When I add a short pause (tried 100ms), or when running the tests with the race detector, It works just fine.

Not sure if it matters, but there are no incoming requests between calling Serve() and Shutdown().

EDIT: link to a playground minimal example. If you comment out the time.Sleep call, the program hangs.

Here is the relevant code for the two methods:

func (h *HTTPListen) Start() error {

    h.Logger.Log(""msg"", ""starting HTTPListen input"")

    addr := h.Cfg.ListenAddr
    ln, err := net.Listen(""tcp"", addr)
    if err != nil {
        h.Logger.Log(""msg"", ""failed to create listener on tcp/""+addr+"": ""+err.Error())
        h.setState(StateFailed)
        return err
    }

    h.wg.Add(1)
    go func() {

        defer h.wg.Done()
        err := h.Srv.Serve(ln)
        h.Logger.Log(""msg"", ""HTTP server stopped: ""+err.Error())

    }()

    h.setState(StateStarted)
    h.Logger.Log(""msg"", ""HTTPListen input started"")

    return nil

}


Stop method:

func (h *HTTPListen) Stop() error {

    h.Logger.Log(""msg"", ""stopping HTTPListen input"")

    ctx, cancel := context.WithTimeout(context.Background(), time.Second*10)
    defer cancel()

    if err := h.Srv.Shutdown(ctx); err != nil {
        h.Logger.Log(""msg"", ""HTTP server shutdown deadline expired"")
    }

    h.wg.Wait()

    h.setState(StateStopped)
    h.Logger.Log(""msg"", ""HTTPListen input stopped"")

    return nil
}


Log output:

kwz@cyclone ~/s/stblogd> go test -v ./pkg/pipeline/input/ -run TestHTTPListen_StartStop
=== RUN   TestHTTPListen_StartStop
msg=""starting HTTPListen input""
msg=""HTTPListen input started""
msg=""stopping HTTPListen input""
... hangs indefinitely


Log output when running tests with the race detector:

kwz@cyclone ~/s/stblogd> go test -race -v ./pkg/pipeline/input/ -run TestHTTPListen_StartStop
=== RUN   TestHTTPListen_StartStop
msg=""starting HTTPListen input""
msg=""HTTPListen input started""
msg=""stopping HTTPListen input""
msg=""HTTP server stopped: http: Server closed""
msg=""HTTPListen input stopped""
--- PASS: TestHTTPListen_StartStop (0.00s)
PASS
ok      stblogd/pkg/pipeline/input      1.007s


I'm tempted to just slap a short delay on the test and call it a day, but I would like to know why it behaves like this.
",1,45754815.0
697,45836683,int data type in Go,"I am new to Go language and was trying out few examples in GO.
In GO int is not a keyword so I declared a variable with name as int.  

package main
import ""fmt""

func main() {
    var int int = 8
    fmt.Println(int)

    var number int = 10
    fmt.Println(number)
}


Now when I build this code I get following error:  

[dev@go test]$ go build variables.go
# command-line-arguments
./variables.go:8: int is not a type


I am trying to understand the reason why this is seen and what did var int int do such that int becomes an unavailable data type.  
",2,
698,45836767,Using an io.WriteSeeker without a File in Go,"I am using a third party library to generate PDFs. In order to write the PDF at the end (after all of content has been added using the lib's API), the pdfWriter type has a Write function that expects an io.WriteSeeker. 

This is OK if I want to work with files, but I need to work in-memory. Trouble is, I can't find any way to do this - the only native type I found that implements io.WriteSeeker is File. 

This is the part that works by using File for the io.Writer in the Write function of the pdfWriter:

fWrite, err := os.Create(outputPath)
if err != nil {
    return err
}

defer fWrite.Close()

err = pdfWriter.Write(fWrite)


Is there way to do this without an actual File? Like getting a []byte or something?
",1,45837752.0
699,45855530,Golang decode array of strings,"I am trying to decode an array of strings in golang and cannot unmarshall this json in golang

""{\""keys\"":[\""CovePDF:metadata:deadlineDate:asfsdbdjh\"",\""CovePDF:metadata:endedOnDate:asfsdbdjh\"",\""CovePDF:metadata:moderators:asfsdbdjh\"",\""CovePDF:metadata:reviewers:asfsdbdjh\"",\""CovePDF:metadata:title:asfsdbdjh\"",\""CovePDF:metadata:initiator:asfsdbdjh\"",\""CovePDF:metadata:startOnDate:asfsdbdjh\""]}""


my struct looks like this:

type Keys struct {
     keys []string `json:""keys""`
}


and than trying to do

    keys := args[0] 
    ks := Keys{}
    err0 := json.Unmarshal([]byte(keys), &ks)


I got an error in the logs of:


  error: unexpected end of JSON input
  error: Unmarshal unexpected end of JSON input
  error: unexpected end of JSON input

",1,45855822.0
